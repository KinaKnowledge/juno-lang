<!doctype html><html><head title='Juno Browser'><style id='juno-css'>body { `font-family: "-apple-system,BlinkMacSystemFont,'Segoe UI','Helvetica Neue',Helvetica,sans-serif;" }</style> <script id='juno-core'  type='module'>// Source: undefined  
// Build Time: 2022-09-05 07:38:42
// Version: 2022.09.05.07.38
export const DLISP_ENV_VERSION='2022.09.05.07.38';




function check_true(val) {
  return val||0===val
}
function get_next_environment_id() {
    globalThis.dlisp_environment_count++;
    return globalThis.dlisp_environment_count;
}
function get_outside_global(refname) {  try {    let tfn = new Function("{ if (typeof " + refname + " === 'undefined') { return undefined } else { return "+refname+" } }");    return tfn();  } catch (ex) {    return undefined;  }}
function subtype(value) {  if (value === null) return "null";
  else if (value === undefined) return "undefined";
  else if (value instanceof Array) return "array";
  else if (value.constructor && value.constructor!=null && value.constructor.name!=='Object') {
    return value.constructor.name;
  }
  return typeof value;
}
function lisp_writer(obj,depth,max_depth) {
  if (depth===undefined) depth=0;
  if (max_depth===undefined) max_depth=1502;
  const bracketStyles=['(',')','(',')','{','}'];
  let bracketStyle=0;
  let text='';
  let type = subtype(obj);
  //if (depth === 0) console.log("lisp_writer:->",obj);
  if (type === undefined) {
    type = "UNKNOWN"
  }
  if (max_depth && (depth > max_depth)) {
    return "...";
  }
  if (depth > 500) {
    console.warn("lisp_writer: depth bomb: object: ",type);
    throw new Error("recursion too deep");
  }
 
  if (obj===undefined) return 'undefined';
  if (obj===null) return 'null';
  if (typeof obj==='number') return obj;
  if (typeof obj==='function') {
    //if (depth === 0) console.log("lisp_writer: <- [ function ]",obj.toString());
    if (obj.name) { return obj.name }
    
    return "lambda";
  } // technically this shouldn't be a JSON object but this is a convenience for us..
  if (obj instanceof Array) {
    if (obj.length > 0 && obj[0] instanceof String && obj[0].startsWith("=:")) {
      bracketStyle = 2;
    }
    text += bracketStyles[bracketStyle];
    // determine if we have any objects or arrays in the list
    for (let i in obj) {
      if (i > 0) text += ' ';
      
      text += lisp_writer(obj[i],depth+4,max_depth);
    }
    text += bracketStyles[bracketStyle+1];
    //if (depth === 0) console.log("lisp_writer: <- [ array ]",text);
    return text;
  } else if (typeof obj ==='object') {
    // object {}
    if (obj.constructor && obj.constructor.name !== "Object") {
      if (typeof Element != 'undefined') {
        if (obj instanceof Element) {
          let clist = Array.from(obj.classList).join(" ");
          if (obj.id) {
            return obj.constructor.name+"/"+obj.tagName.toLowerCase()+"#"+obj.id;
          } else {
            return obj.constructor.name+"/"+obj.tagName.toLowerCase()+"."+clist;
          }
        } else {
          return "" + obj.constructor.name + "";
        }
      } else {
        return "" + obj.constructor.name + "";
      }
    }
    bracketStyle=4;
    text+=bracketStyles[bracketStyle];
    let keys = Object.keys(obj);
    for (let i in keys) {
      if (i > 0) text+= ' ';
      if (typeof obj[keys[i]]=="symbol") {
	text+=lisp_writer(keys[i],depth+4)+": \"<symbol>\"";
      } else {
	text+=lisp_writer(keys[i],depth+4)+":"+lisp_writer(obj[keys[i]],depth+4, max_depth)
      }
    }
    text += bracketStyles[bracketStyle+1];
    //if (depth === 0) console.log("lisp_writer: <- [ object ]",text);
    return text;
  } else if (typeof obj === 'string') {
    // string    
    if (obj==="=:") return obj;
    else if (obj==="=:##") return ",#";
    else if (obj==="=$,@") return "=$,@";
    else if (obj.startsWith("=:")) return obj.substr(2);
    
    obj = obj.replaceAll("\"","\\\"");        
    obj = obj.replaceAll("'","\\'");        
    obj = obj.replaceAll("\n",'\\n');
    obj = obj.replaceAll("\r",'\\r');
    obj = obj.replaceAll("\f",'\\f');
    obj = obj.replaceAll("\b",'\\b');			         
    //obj = JSON.stringify(obj);  // encode with JSON semantics
    
    //if (depth == 0) console.log("lisp_writer: <-",'"'+obj+'"');
    
    return '"'+obj+'"';
    
    
  } else {
    //if (depth === 0) console.log("lisp_writer: <- [ other ]",obj);
    return obj; // numbers and booleans
  }
}
function clone(src,depth) {
        if (src===null) {
            return null;
        }
        depth = depth || 0;
        if (depth >= 500) {
          throw new EvalError("too deep");
        }
        if (src===undefined) {
            return undefined;
        } else if (src === null) {
	    return null;
	} else if (src instanceof Function ) {
            return src; 
        } else if (src==this) {
          return this;	
        } else if (src.constructor===String) {	  
	  return src.toString();
	} else if (src.constructor===Number) {
	  return src;
	} else if (src.constructor===Boolean) {
	  return src;
	} else if ((src.constructor===Array)||(src.constructor===Object)) {
	  let obj;
	  if (src.constructor===Array) {
	    obj=[];
	  } else {
	    obj={}
	  }
          for (let idx in src) {
	    obj[idx]=clone(src[idx],depth+1);
	  }
	  return obj;
	} else {
	  return src;
	}
}
class LispSyntaxError extends SyntaxError {
  constructor(json_structure) {
    super(JSON.stringify(json_structure));
    this.name = 'LispSyntaxError';
  }
}


if (typeof AsyncFunction === "undefined") {
  globalThis.AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;
}
export async function init_dlisp(Environment)  {
{
    await async function(){
        globalThis["subtype"]=subtype;
        globalThis["check_true"]=check_true;
        globalThis["clone"]=clone;
        globalThis["lisp_writer"]=lisp_writer;
        globalThis["LispSyntaxError"]=LispSyntaxError;
        return globalThis;
        
    }();
    if (check_true (("undefined"===typeof dlisp_environment_count))){
        await async function(){
            globalThis["dlisp_environment_count"]=0;
            return globalThis;
            
        }()
    };
    {
        let symname;
        symname=await (async function(){
             return "dlisp_env" 
        })();
        {
            await async function(){
                globalThis[symname]=async function(opts) {
                    let subtype=function subtype(value) {  if (value === null) return "null";
  else if (value === undefined) return "undefined";
  else if (value instanceof Array) return "array";
  else if (value.constructor && value.constructor!=null && value.constructor.name!=='Object') {
    return value.constructor.name;
  }
  return typeof value;
};
                    let get_object_path=function(refname) {        if (check_true ((( refname["indexOf"].call(refname,".")>-1)|| ( refname["indexOf"].call(refname,"[")>-1)))){
            {
                let chars;
                let comps;
                let mode;
                let name_acc;
                chars=(refname).split("");
                comps=[];
                mode=0;
                name_acc=[];
                 ( function() {
                    let __for_body__12=function(c) {
                        return   (function(){
                            if (check_true (((c===".")&& (mode===0)))) {
                                {
                                    if (check_true (((name_acc && name_acc.length)>0))){
                                        {
                                            (comps).push((name_acc).join(""))
                                        }
                                    };
                                    return name_acc=[]
                                }
                            } else if (check_true (((mode===0)&& (c==="[")))) {
                                {
                                    mode=1;
                                    if (check_true (((name_acc && name_acc.length)>0))){
                                        {
                                            (comps).push((name_acc).join(""))
                                        }
                                    };
                                    return name_acc=[]
                                }
                            } else if (check_true (((mode===1)&& (c==="]")))) {
                                {
                                    mode=0;
                                    (comps).push((name_acc).join(""));
                                    return name_acc=[]
                                }
                            } else {
                                return (name_acc).push(c)
                            }
                        } )()
                    };
                    let __array__13=[],__elements__11=chars;
                    let __BREAK__FLAG__=false;
                    for(let __iter__10 in __elements__11) {
                        __array__13.push( __for_body__12(__elements__11[__iter__10]));
                        if(__BREAK__FLAG__) {
                             __array__13.pop();
                            break;
                            
                        }
                    }return __array__13;
                     
                })();
                if (check_true (((name_acc && name_acc.length)>0))){
                    (comps).push((name_acc).join(""))
                };
                return comps
            }
        } else {
            return  ( function(){
                let __array_op_rval__14=refname;
                 if (__array_op_rval__14 instanceof Function){
                    return  __array_op_rval__14() 
                } else {
                    return [__array_op_rval__14]
                }
            })()
        }
    };
                    let get_outside_global=function get_outside_global(refname) {  try {    let tfn = new Function("{ if (typeof " + refname + " === 'undefined') { return undefined } else { return "+refname+" } }");    return tfn();  } catch (ex) {    return undefined;  }};
                    ;
                    opts=await (async function(){
                        if (check_true ((opts===undefined))){
                            return new Object()
                        } else {
                            return opts
                        }
                    })();
                    let namespace=(opts.namespace|| "core");
                    ;
                    let in_boot=true;
                    ;
                    let pending_loads=new Object();
                    ;
                    let parent_environment=await (async function(){
                        if (check_true ((namespace==="core"))){
                            return null
                        } else {
                            return opts.parent_environment
                        }
                    })();
                    ;
                    let active_namespace=namespace;
                    ;
                    let contained=(opts.contained|| false);
                    ;
                    let Environment={
                        global_ctx:{
                            scope:new Object(),name:namespace
                        },build_version:DLISP_ENV_VERSION,definitions:(opts.definitions|| new Object()),declarations:(opts.declarations|| {
                            safety:{
                                level:2
                            }
                        })
                    };
                    ;
                    let id=await (async function(){
                        let __array_op_rval__4=get_next_environment_id;
                         if (__array_op_rval__4 instanceof Function){
                            return await __array_op_rval__4() 
                        } else {
                            return [__array_op_rval__4]
                        }
                    })();
                    ;
                    await async function(){
                        Environment["context"]=Environment.global_ctx;
                        return Environment;
                        
                    }();
                    let unset_compiler=async function() {
                        throw new EvalError(("compiler must be set for "+ namespace));
                        
                    };
                    ;
                    let compiler=unset_compiler;
                    ;
                    let compiler_operators=new Set();
                    ;
                    let special_identity=async function(v) {
                        return v
                    };
                    ;
                    let MAX_SAFE_INTEGER=9007199254740991;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["MAX_SAFE_INTEGER"]=MAX_SAFE_INTEGER;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["MAX_SAFE_INTEGER"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let LispSyntaxError=globalThis.LispSyntaxError;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["LispSyntaxError"]=LispSyntaxError;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["LispSyntaxError"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let sub_type=subtype;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["sub_type"]=sub_type;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["sub_type"]={
                            core_lang:true,description:"Returns a string the determined actual type of the provided value.",usage:["value:*"],tags:["type","class","prototype","typeof","instanceof"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let __VERBOSITY__=0;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["__VERBOSITY__"]=__VERBOSITY__;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["__VERBOSITY__"]={
                            core_lang:true,description:"Set __VERBOSITY__ to a positive integer for verbose console output of system activity.",tags:["debug","compiler","environment","global"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let int=parseInt;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["int"]=int;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["int"]={
                            core_lang:true,usage:"value:string|number",description:"Convenience method for parseInt, should be used in map vs. directly calling parseInt, which will not work directly",tags:["conversion","number"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let float=parseFloat;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["float"]=float;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["float"]={
                            core_lang:true,usage:"value:string|number",description:"Convenience method for parseFloat, should be used in map vs. directly calling parseFloat, which will not work directly",tags:["conversion","number"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let values=new Function("...args","{\n                                let acc = [];\n                                for (let _i in args) {\n                                    let value = args[_i];\n                                    let type = subtype(value);\n                                    if (value instanceof Set)  {\n                                        acc = acc.concat(Array.from(value));\n                                    } else if (type==='array') {\n                                        acc = acc.concat(value);\n                                    } else if (type==='object') {\n                                        acc = acc.concat(Object.values(value))\n                                    } else {\n                                        acc = acc.concat(value);\n                                    }\n                                }\n                                return acc;\n                            }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["values"]=values;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["values"]={
                            core_lang:true,description:("Given a container, returns a list containing the values of each supplied argument. Note that for objects, only the values are returned, not the keys. "+ "If given multiple values, the returned value is a concatentation of all containers provided in the arguments."),usage:["arg0:*","argn:*"],tags:["array","container","object","keys","elements"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let pairs=new Function("obj","{\n                                    if (subtype(obj)==='array') {\n                                        let rval = [];\n                                        for (let i = 0; i < obj.length; i+=2) {\n                                            rval.push([obj[i],obj[i+1]]);\n                                        }\n                                        return rval;\n                                    } else {\n                                        let keys = Object.keys(obj);\n                                        let rval = keys.reduce(function(acc,x,i) {\n                                            acc.push([x,obj[x]])\n                                            return acc;\n                                        },[]);\n                                        return rval;\n                                    }\n                                }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["pairs"]=pairs;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["pairs"]={
                            core_lang:true,description:"Given a passed object or array, returns a list containing a 2 element list for each key/value pair of the supplied object.",tags:["array","container","object"],usage:["obj:object"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let keys=new Function("obj","{  return Object.keys(obj);  }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["keys"]=keys;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["keys"]={
                            core_lang:true,description:"Given an object, returns the keys of the object.",tags:["object","values","keys","indexes","container"],usage:["obj:object"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let take=new Function("place","{ return place.shift() }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["take"]=take;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["take"]={
                            core_lang:true,description:"Takes the first value off the list, and returns the value.",tags:["array","container","mutate","first"],usage:["place:container"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let prepend=new Function("place","thing","{ return place.unshift(thing) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["prepend"]=prepend;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["prepend"]={
                            core_lang:true,description:"Places the value argument onto the first of the list (unshift) and returns the list.",tags:["array","mutate","container"],usage:["place:array","thing:*"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let first=new Function("x","{ return x[0] }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["first"]=first;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["first"]={
                            core_lang:true,description:"Given an array, returns the first element in the array.",usage:["x:array"],tags:["array","container","elements"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let last=new Function("x","{ return x[x.length - 1] }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["last"]=last;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["last"]={
                            core_lang:true,description:"Given an array, returns the last element in the array.",usage:["x:array"],tags:["array","container","elements","end"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let length=new Function("obj","{\n                                if(obj instanceof Array) {\n                                    return obj.length;\n                                } else if (obj instanceof Set) {\n                                    return obj.size;\n                                } else if ((obj === undefined)||(obj===null)) {\n                                    return 0;\n                                } else if (typeof obj==='object') {\n                                    return Object.keys(obj).length;\n                                } else if (typeof obj==='string') {\n                                    return obj.length;\n                                } \n                                return 0;\n                            }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["length"]=length;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["length"]={
                            core_lang:true,description:("Returns the length of the supplied type (array, object, set, string, number). "+ "If the supplied value is nil or a non-container type, returns 0."),tags:["size","elements","container","dimension","array","set","string","number"],usage:["thing:container"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let conj=new Function("...args","{   let list = [];\n                                if (args[0] instanceof Array) {\n                                    list = args[0];\n                                } else {\n                                    list = [args[0]];\n                                }\n                                args.slice(1).map(function(x) {\n                                    list = list.concat(x);\n                                });\n                                return list;\n                            }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["conj"]=conj;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["conj"]={
                            core_lang:true,description:("Conjoins or concatenates things (typically arrays) together and returns an array. "+ "Examples:<br>"+ "(conj [ 1 2 ] [ 3 4 ]) => [ 1 2 3 4 ]<br>"+ "(conj [ 1 2 ] 3 4 ) => [ 1 2 3 4 ]<br>"+ "(conj 1 2 [ 3 4 ]) => [ 1 2 3 4 ]<br>"+ "(conj { `abc: 123 } [ 2 3]) => [ { abc: 123 }, 2, 3 ]<br>"+ "(conj [ 1 2 3 [ 4 ]] [ 5 6 [ 7 ]]) => [ 1 2 3 [ 4 ] 5 6 [ 7 ] ]"),tags:["elements","concat","array","conjoin","append"],usage:["arg0:*","argN:*"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let reverse=new Function("container","{ return container.slice(0).reverse }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["reverse"]=reverse;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["reverse"]={
                            core_lang:true,usage:["container:list"],description:"Returns a copy of the passed list as reversed.  The original is not changed.",tags:["list","sort","order"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let map=new AsyncFunction("lambda","array_values","{ try {\n                                        let rval = [],\n                                                tl = array_values.length;\n                                        for (let i = 0; i < array_values.length; i++) {\n                                            rval.push(await lambda.apply(this,[array_values[i], i, tl]));\n                                         }\n                                        return rval;\n                                    } catch (ex) {           \n                                              if (lambda === undefined || lambda === null) {\n                                                    throw new ReferenceError(\"map: lambda argument (position 0) is undefined or nil\")\n                                              } else if (array_values === undefined || array_values === null) {\n                                                    throw new ReferenceError(\"map: container argument (position 1) is undefined or nil\")\n                                              } else if (!(lambda instanceof Function)) {\n                                                    throw new ReferenceError(\"map: lambda argument must be a function: received: \"+ typeof lambda)\n                                              } else if (!(array_values instanceof Array)) {\n                                                    throw new ReferenceError(\"map: invalid array argument, received: \" + typeof array_values)\n                                              } else {\n                                                    // something else just pass on the error\n                                                throw ex;\n                                              }\n                                    }\n                              }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["map"]=map;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["map"]={
                            core_lang:true,description:("Provided a function as a first argument, map calls the function "+ "(item, current_index, total_length) with each element from the second argument, which should be a list. Returns a new list containing the return values resulting from evaluating."),tags:["array","container","elements","iteration"],usage:["lambda:function","elements:array"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let bind=new Function("func,this_arg","{ return func.bind(this_arg) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["bind"]=bind;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["bind"]={
                            core_lang:true,description:"Given a function and a this value, the bind function returns a new function that has its this keyword set to the provided value in this_arg.",usage:["func:function","this_arg:*"],tags:["bind","this","function"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let to_object=new Function("array_values","{\n                                      let obj={}\n                                      array_values.forEach((pair)=>{\n                                             obj[pair[0]]=pair[1]\n                                      });\n                                      return obj;\n                                    }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["to_object"]=to_object;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["to_object"]={
                            core_lang:true,description:("Given an array of pairs in the form of [[key value] [key value] ...], constructs an "+ "object with the first array element of the pair as the key and the second "+ "element as the value. A single object is returned."),usage:["paired_array:array"],tags:["conversion","object","array","list","pairs"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let to_array=async function(container) {
                        return await async function(){
                            if (check_true ((container instanceof Array))) {
                                return container
                            } else if (check_true (await (await get_global("is_set?"))(container))) {
                                {
                                    let acc=[];
                                    ;
                                    await container["forEach"].call(container,async function(v) {
                                        return (acc).push(v)
                                    });
                                    return acc
                                }
                            } else if (check_true ((container instanceof String || typeof container==='string'))) {
                                return (container).split("")
                            } else if (check_true ((container instanceof Object))) {
                                return await pairs(container)
                            } else {
                                return await (async function(){
                                    let __array_op_rval__44=container;
                                     if (__array_op_rval__44 instanceof Function){
                                        return await __array_op_rval__44() 
                                    } else {
                                        return [__array_op_rval__44]
                                    }
                                })()
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["to_array"]=to_array;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["to_array"]={
                            core_lang:true,description:("Given a container of type Array, Set, Object, or a string, "+ "it will convert the members of the container to an array form, "+ "and return a new array with the values of the provided container. "+ "In the case of an object, the keys and values will be contained in "+ "paired arrays in the returned array.  A string will be split into "+ "individual characters. If provided a different "+ "type other than the listed values above, the value will be placed "+ "in an array as a single element."),usage:["container:*"],tags:["array","conversion","set","object","string","pairs"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let slice=function(target,from,to) {
                        return   (function(){
                            if (check_true (to)) {
                                return  target["slice"].call(target,from,to)
                            } else if (check_true (from)) {
                                return  target["slice"].call(target,from)
                            } else {
                                throw new SyntaxError("slice requires 2 or 3 arguments");
                                
                            }
                        } )()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["slice"]=slice;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["slice"]={
                            core_lang:true,description:"Given an array, with a starting index and an optional ending index, slice returns a new array containing the elements in the range of provided indices.",usage:["target:array","from:number","to:number"],tags:["array","slicing","dimensions","subset"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let rest=function(x) {
                        return   (function(){
                            if (check_true ((x instanceof Array))) {
                                return  x["slice"].call(x,1)
                            } else if (check_true ((x instanceof String || typeof x==='string'))) {
                                return  x["substr"].call(x,1)
                            } else {
                                return null
                            }
                        } )()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["rest"]=rest;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["rest"]={
                            core_lang:true,description:"Returns a new array containing the elements in the 2nd through last position (the tail) of the provided array.",usage:["x:array"],tags:["array","subset","slice","tail","end"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let second=new Function("x","{ return x[1] }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["second"]=second;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["second"]={
                            core_lang:true,description:"Returns the second element in the provided array (the element at index 1)",tags:["array","subset","element","first"],usage:["x:array"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let third=new Function("x","{ return x[2] }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["third"]=third;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["third"]={
                            core_lang:true,description:"Returns the third element in the provided array (the element at index 2)",tags:["array","subset","element","first"],usage:["x:array"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let chop=new Function("x","{ if (x instanceof Array) { return x.slice(0, x.length-1) } else { return x.substr(0,x.length-1) } }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["chop"]=chop;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["chop"]={
                            core_lang:true,description:"Returns a new container containing all items except the last item.  This function takes either an array or a string.",usage:["container:array|string"],tags:["array","slice","subset","first","string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let chomp=new Function("x","{ return x.substr(x.length-1) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["chomp"]=chomp;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["chomp"]={
                            core_lang:true,description:"Given a string returns a new string containing all characters except the last character.",usage:["x:string"],tags:["slice","subset","string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let not=new Function("x","{ if (check_true(x)) { return false } else { return true } }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["not"]=not;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["not"]={
                            core_lang:true,description:"Returns the logical opposite of the given value.  If given a truthy value, a false is returned.  If given a falsey value, true is returned.",usage:["x:*"],tags:["logic","not","inverse"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let push=new Function("place","thing","{ return place.push(thing) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["push"]=push;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["push"]={
                            core_lang:true,description:"Given an array as a place, and an arbitrary value, appends (pushes) the value to the end of the array.",usage:["place:array","thing:*"],tags:["array","mutate","append","concat","pop"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let pop=new Function("place","{ return place.pop() }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["pop"]=pop;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["pop"]={
                            core_lang:true,description:"Given an array as an arguments, removes the last value from the given array and returns it.",usage:["place:array"],tags:["array","mutate","take","remove","push"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let list=async function(...args) {
                        return args
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["list"]=list;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["list"]={
                            core_lang:true,description:"Given a set of arbitrary arguments, returns an array containing the provided arguments. If no arguments are provided, returns an empty array.",usage:["arg0:*","argN:*"],tags:["array","container","elements"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let flatten=new Function("x","{ return x.flat(999999999999) } ");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["flatten"]=flatten;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["flatten"]={
                            core_lang:true,description:"Given a nested array structure, returns a flattened version of the array",usage:["x:array"],tags:["array","container","flat","tree"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let jslambda=function(...args) {
                        return  ( function(){
                            let __apply_args__69= flatten(args);
                            return ( Function).apply(this,__apply_args__69)
                        })()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["jslambda"]=jslambda;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["jslambda"]={
                            core_lang:true,description:("Proxy for Javascript Function.  Given a set of string based arguments, all but the last are considered arguments to the "+ "function to be defined.  The last argument is considered the body of the function and should be provided as a string of "+ "javascript. Returns a javascript function. <br>"+ "(jslambda (`a `b) \"{ return a+b }\")<br>"+ "(jslambda () \"{ return new Date() }\")"),usage:["argument_list:array","argn:string"],tags:["javascript","embed","function"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let join=function(...args) {
                        return   (function(){
                            if (check_true ((args.length===1))) {
                                return  args['0']["join"].call(args['0'],"")
                            } else {
                                return  args['1']["join"].call(args['1'],args['0'])
                            }
                        } )()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["join"]=join;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["join"]={
                            core_lang:true,description:("Given an optional joining string and an array of strings, returns a string containing the "+ "elements of the array interlaced with the optional joining string.<br>"+ "(join \",\" [ \"red\" \"fox\" ]) -> \"red,fox\"<br>"+ "(join [\"red\" \"fox\"]) -> redfox"),tags:["array","combine","split","string","text"],usage:["joining_string?:string","container:array"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let lowercase=function(x) {
                        return  x["toLowerCase"]()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["lowercase"]=lowercase;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["lowercase"]={
                            core_lang:true,description:"Given a string, converts all capital characters to lowercase characters.",tags:["string","text","uppercase","case","convert"],usage:["text:string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let uppercase=function(x) {
                        return  x["toUpperCase"]()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["uppercase"]=uppercase;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["uppercase"]={
                            core_lang:true,description:"Given a string, converts all capital characters to uppercase characters.",tags:["string","text","lowercase","case","convert"],usage:["text:string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let log=function(...args) {
                        return  ( function(){
                            return ( console.log).apply(this,args)
                        })()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["log"]=log;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["log"]={
                            core_lang:true,description:("log is a shorthand call for console.log by default, and serves to provide a base "+ "abstraction for logging.  Log behavior can be changed by redefining log to "+ "better suit the environmental context.  For example, writing log output to a file "+ "or HTML container."),usage:["args0:*","argsN:*"],tags:["logging","console","output"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let split=new Function("container","token","{ return container.split(token) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["split"]=split;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["split"]={
                            core_lang:true,description:("Given a string to partition and a string for a splitting token, return an array whose elements "+ "are the text found between each splitting token. <br>"+ "(split \"red,fox\" \",\") => [ \"red\" \"fox\" ]"),tags:["partition","join","separate","string","array"],usage:["string_to_split:string","split_token:string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let split_by=new Function("token","container","{ return container.split(token) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["split_by"]=split_by;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["split_by"]={
                            core_lang:true,description:("Given a string for a splitting token and a string to partition, return an array whose elements "+ "are the text found between each splitting token. <br>"+ "(split_by \",\" \"red,fox\") => [ \"red\" \"fox\" ]"),tags:["partition","join","separate","string","array"],usage:["split_token:string","string_to_split:string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_object_ques_=new Function("x","{ return x instanceof Object }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_object?"]=is_object_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_object?"]={
                            core_lang:true,description:"for the given value x, returns true if x is an Javascript object type.",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_array_ques_=new Function("x","{ return x instanceof Array }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_array?"]=is_array_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_array?"]={
                            core_lang:true,description:"for the given value x, returns true if x is an array.",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_number_ques_=function(x) {
                        return ( subtype(x)==="Number")
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_number?"]=is_number_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_number?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a number.",usage:["arg:value"],tags:["type","condition","subtype","value","what","function"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_function_ques_=function(x) {
                        return (x instanceof Function)
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_function?"]=is_function_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_function?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a function.",usage:["arg:value"],tags:["type","condition","subtype","value","what","function"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_set_ques_=new Function("x","{ return x instanceof Set }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_set?"]=is_set_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_set?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a set.",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_element_ques_=new Function("x","{ return x instanceof Element }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_element?"]=is_element_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_element?"]={
                            core_lang:true,description:"for the given value x, returns true if x is an Element object",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_string_ques_=function(x) {
                        return ((x instanceof String)|| (typeof x==="string"))
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_string?"]=is_string_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_string?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a String object",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_nil_ques_=function(x) {
                        return (x===null)
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_nil?"]=is_nil_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_nil?"]={
                            core_lang:true,description:"for the given value x, returns true if x is exactly equal to nil.",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_regex_ques_=function(x) {
                        return ( sub_type(x)==="RegExp")
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_regex?"]=is_regex_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_regex?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a Javascript regex object",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let is_date_ques_=function(x) {
                        return ( sub_type(x)==="Date")
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["is_date?"]=is_date_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["is_date?"]={
                            core_lang:true,description:"for the given value x, returns true if x is a Date object.",usage:["arg:value"],tags:["type","condition","subtype","value","what"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let ends_with_ques_=new Function("val","text","{ if (text instanceof Array) { return text[text.length-1]===val } else if (subtype(text)=='String') { return text.endsWith(val) } else { return false }}");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["ends_with?"]=ends_with_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["ends_with?"]={
                            core_lang:true,description:"for a given string or array, checks to see if it ends with the given start_value.  Non string args return false.",usage:["end_value:value","collection:array|string"],tags:["string","text","list","array","filter","reduce"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let starts_with_ques_=new Function("val","text","{ if (text instanceof Array) { return text[0]===val } else if (subtype(text)=='String') { return text.startsWith(val) } else { return false }}");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["starts_with?"]=starts_with_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["starts_with?"]={
                            core_lang:true,description:"for a given string or array, checks to see if it starts with the given start_value.  Non string args return false.",usage:["start_value:value","collection:array|string"],tags:["string","text","list","array","filter","reduce","begin"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let delete_prop=new Function("obj","...args","{\n                                        if (args.length == 1) {\n                                            return delete obj[args[0]];\n                                        } else {\n                                            while (args.length > 0) {\n                                                let prop = args.shift();\n                                                delete obj[prop];\n                                            }\n                                        }\n                                        return obj;\n                                    }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["delete_prop"]=delete_prop;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["delete_prop"]={
                            core_lang:true,description:("Removes the key or keys of the provided object, and returns the modified object.<br>Example:<br>"+ "(defglobal foo { abc: 123 def: 456 ghi: 789 })<br>"+ "(delete_prop foo `abc `def) => { ghi: 789 }<br>"),usage:["obj:objects","key0:string","keyN?:string"],tags:["delete","keys","object","remove","remove_prop","mutate"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let blank_ques_=function(val) {
                        return ((val==null)|| ((val instanceof String || typeof val==='string')&& (val==="")))
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["blank?"]=blank_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["blank?"]={
                            core_lang:true,description:"Given a value, if it is equal (via eq) to nil or to \"\" (an empty string), returns true, otherwise false.",usage:["val:*"],tags:["string","empty","text"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let contains_ques_=new Function("value","container","{ if (!value && !container) { return false }\n                           else if (container === null) { throw new TypeError(\"contains?: passed nil/undefined container value\"); }\n                           else if (container instanceof Array) return container.includes(value);\n                           else if (container instanceof Set) return container.has(value);\n                           else if ((container instanceof String) || typeof container === \"string\") {\n                                if (subtype(value) === \"Number\") return container.indexOf(\"\"+value)>-1;\n                                else return container.indexOf(value)>-1;\n                           }                                                      \n                           else throw new TypeError(\"contains?: passed invalid container type: \"+subtype(container)) }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["contains?"]=contains_ques_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["contains?"]={
                            core_lang:true,description:("Given a target value and container value (array, set, or string), checks if the container has the value. "+ "If it is found, true is returned, otherwise false if returned.  "),tags:["string","array","set","has","includes","indexOf"],usage:["value:*","container:array|set|string"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let make_set=function(vals) {
                        if (check_true ((vals instanceof Array))){
                            return new Set(vals)
                        } else {
                            {
                                let vtype;
                                vtype= sub_type(vals);
                                return   (function(){
                                    if (check_true ((vtype==="Set"))) {
                                        return new Set(vals)
                                    } else if (check_true ((vtype==="object"))) {
                                        return new Set( values(vals))
                                    }
                                } )()
                            }
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["make_set"]=make_set;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["make_set"]={
                            core_lang:true,description:("If given an array, a new Set is returned containing the elements of the array. "+ "If given an object, a new Set is returned containing the values of the object, and the keys are discarded. "+ "If given a set, new Set is created and returend  from the values of the old set."),usage:["vals:array|object|set"],tags:["array","set","object","values","convert"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let meta_for_symbol=async function(quoted_symbol,search_mode) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let local_data=Environment.global_ctx.scope[quoted_symbol];
                                ;
                                let acc=[];
                                ;
                                if (check_true (search_mode)){
                                    {
                                        if (check_true (local_data)){
                                            {
                                                (acc).push(await (await get_global("add"))({
                                                    namespace:namespace,name:quoted_symbol,type:await subtype(local_data)
                                                },await (async function(){
                                                    let it;
                                                    it=Environment.definitions[quoted_symbol];
                                                    if (check_true (it)){
                                                        return it
                                                    } else {
                                                        return new Object()
                                                    }
                                                })()))
                                            }
                                        };
                                        if (check_true (parent_environment)){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(info) {
                                                        return (acc).push(info)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__121=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__122=[],__elements__120=await (async function() {
                                                            {
                                                                 let __call_target__=await parent_environment["meta_for_symbol"].call(parent_environment,quoted_symbol,true), __call_method__="flat";
                                                                return await __call_target__[__call_method__].call(__call_target__,1)
                                                            } 
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__119 in __elements__120) {
                                                            __array__122.push(await __for_body__121(__elements__120[__iter__119]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__122.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__122;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        if (check_true ((await length(await keys(children))>0))){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(details) {
                                                        return (acc).push(details)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__125=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__126=[],__elements__124=await (async function(){
                                                            let ____collector__127= async function(){
                                                                return []
                                                            };
                                                            let ____result__128= async function(){
                                                                return null
                                                            };
                                                            let ____action__129= async function(){
                                                                return async function(child_data) {
                                                                    if (check_true (await not((child_data['0']===await (await get_global("current_namespace"))())))){
                                                                        {
                                                                            return await child_data['1']["meta_for_symbol"].call(child_data['1'],quoted_symbol)
                                                                        }
                                                                    }
                                                                }
                                                            };
                                                            {
                                                                let __collector=await ____collector__127();
                                                                ;
                                                                let __result=await ____result__128();
                                                                ;
                                                                let __action=await ____action__129();
                                                                ;
                                                                ;
                                                                await (async function() {
                                                                    let __for_body__132=async function(__item) {
                                                                        __result=await __action(__item);
                                                                        if (check_true (__result)){
                                                                            return (__collector).push(__result)
                                                                        }
                                                                    };
                                                                    let __array__133=[],__elements__131=await pairs(children);
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__130 in __elements__131) {
                                                                        __array__133.push(await __for_body__132(__elements__131[__iter__130]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__133.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__133;
                                                                     
                                                                })();
                                                                return __collector
                                                            }
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__123 in __elements__124) {
                                                            __array__126.push(await __for_body__125(__elements__124[__iter__123]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__126.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__126;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        return acc
                                    }
                                } else {
                                    {
                                        quoted_symbol=await (async function(){
                                            if (check_true (await starts_with_ques_(await (async function(){
                                                 return "=:" 
                                            })(),quoted_symbol))){
                                                return await quoted_symbol["substr"].call(quoted_symbol,2)
                                            } else {
                                                return quoted_symbol
                                            }
                                        })();
                                        {
                                            let it;
                                            it=Environment.definitions[quoted_symbol];
                                            if (check_true (it)){
                                                return await (await get_global("add"))({
                                                    namespace:namespace,type:await sub_type(local_data),name:quoted_symbol
                                                },it)
                                            } else {
                                                return null
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["meta_for_symbol"]=meta_for_symbol;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["meta_for_symbol"]={
                            core_lang:true,description:("Given a quoted symbol and a boolean indicating whether or not all namespaces should be searched, returns "+ "the meta data associated with the symbol for each environment.  If search mode is requested, the value returned "+ "is an array, since there can be symbols with the same name in different environments. If no values are found "+ "an empty array is returned.  If not in search mode, meta_for_symbol searches the current namespace "+ "only, and if a matching symbol is found, returns an object with all found metadata, otherwise nil is returned."),usage:["quoted_symbol:string","search_mode:boolean"],tags:["describe","meta","help","definition","symbol","metadata"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let describe=async function(quoted_symbol,search_mode) {
                        let internal_results=await (async function(){
                             return await meta_for_symbol(quoted_symbol,true) 
                        })();
                        ;
                        if (check_true (((internal_results instanceof Array)&& internal_results['0']))){
                            if (check_true (search_mode)){
                                return internal_results
                            } else {
                                return await first(internal_results)
                            }
                        } else {
                            {
                                let external_results=await get_outside_global(quoted_symbol);
                                ;
                                if (check_true (external_results)){
                                    return {
                                        location:"external",type:await subtype(external_results)
                                    }
                                } else {
                                    return null
                                }
                            }
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["describe"]=describe;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["describe"]={
                            core_lang:true,description:"Given a quoted symbol returns the relevant metadata pertinent to the current namespace context.",usage:["quoted_symbol:string","search_mode:boolean"],tags:["meta","help","definition","symbol","metadata","info","meta_for_symbol"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let undefine=function(quoted_symbol) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let namespace_identity;
                                let parent_call;
                                let child_call;
                                let target_symbol;
                                namespace_identity=(quoted_symbol).split("/");
                                parent_call=null;
                                child_call=null;
                                target_symbol=null;
                                ;
                                return   (function(){
                                    if (check_true ((((namespace_identity.length===1)&& Environment.global_ctx.scope[namespace_identity['0']])|| ((namespace_identity.length>1)&& (namespace_identity['0']===namespace))))) {
                                        {
                                            target_symbol= ( function(){
                                                if (check_true ((namespace_identity.length>1))){
                                                    return namespace_identity['1']
                                                } else {
                                                    return namespace_identity['0']
                                                }
                                            })();
                                             delete_prop(Environment.definitions,target_symbol);
                                            if (check_true (Environment.global_ctx.scope[target_symbol])){
                                                return  delete_prop(Environment.global_ctx.scope,target_symbol)
                                            } else {
                                                return false
                                            }
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& parent_environment))) {
                                        {
                                            parent_call= parent_environment["get_global"].call(parent_environment,"undefine");
                                            return (parent_call)(quoted_symbol)
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& children[namespace_identity['0']]))) {
                                        {
                                            child_call= ( function() {
                                                {
                                                     let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                    return  __call_target__[__call_method__].call(__call_target__,"undefine")
                                                } 
                                            })();
                                            return  child_call(quoted_symbol)
                                        }
                                    } else {
                                        return false
                                    }
                                } )()
                            }
                        } else {
                            throw new SyntaxError("undefine requires a quoted symbol");
                            
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["undefine"]=undefine;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["undefine"]={
                            core_lang:true,description:("Given a quoted symbol removes the symbol and any definition information from the namespace. "+ "If the namespace is fully-qualified, then the symbol will be removed from the specified namespace "+ "instead of the currently active namespace. If the symbol is successfully removed, the function "+ "will return true, otherwise if it is not found, false will be returned.  Note that if the "+ "specified symbol is non-qualified, but exists in a different, accessible namespace, but the "+ "symbol isn't present in the current namespace, the symbol will not be deleted.  The environment "+ "is not searched and therefore symbols have to be explicitly fully-qualified for any effect "+ "of this function outside the current namespace."),usage:["quoted_symbol:string"],tags:["symbol","delete","remove","unintern","reference","value"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let eval_exp=async function(expression) {
                        return await (async function(){
                            let __array_op_rval__140=expression;
                             if (__array_op_rval__140 instanceof Function){
                                return await __array_op_rval__140() 
                            } else {
                                return [__array_op_rval__140]
                            }
                        })()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["eval_exp"]=eval_exp;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["eval_exp"]={
                            core_lang:true,description:("Evaluates the given expression and returns the value."),usage:["expression:*"],tags:["eval","evaluation","expression"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let indirect_new=new Function("...args","{\n                                    let targetClass = args[0];\n                                    if (subtype(targetClass)===\"String\") {\n                                        let tmpf=new Function(\"{ return \"+targetClass+\" }\");\n                                        targetClass = tmpf();\n                                    }\n                                    if (args.length==1) {\n                                        let f = function(Class) {\n                                            return new (Function.prototype.bind.apply(Class, args));\n                                        }\n                                        let rval = f.apply(this,[targetClass]);\n                                        return rval;\n                                    } else {\n                                        let f = function(Class) {\n                                            return new (Function.prototype.bind.apply(Class, args));\n                                        }\n                                        let rval = f.apply(this,[targetClass].concat(args.slice(1)));\n                                        return rval;\n                                    }}");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["indirect_new"]=indirect_new;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["indirect_new"]={
                            core_lang:true,description:("Used by the compiler for implementation of the new operator and shouldn't be directly called by "+ "user programs.  The new operator should be called instead."),usage:["arg0:*","argsN:*"],tags:["system","compiler","internal"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let range=function(...args) {
                        let from_to;
                        let step;
                        let idx;
                        let acc;
                        from_to= ( function(){
                            if (check_true (args['1'])){
                                return [parseInt(args['0']),parseInt(args['1'])]
                            } else {
                                return [0,parseInt(args['0'])]
                            }
                        })();
                        step= ( function(){
                            if (check_true (args['2'])){
                                return parseFloat(args['2'])
                            } else {
                                return 1
                            }
                        })();
                        idx=from_to['0'];
                        acc=[];
                         ( get_global("assert"))((step>0),"range: step must be > 0");
                         ( get_global("assert"))((from_to['1']>=from_to['0']),"range: lower bound must be greater or equal than upper bound");
                         ( function(){
                             let __test_condition__145=function() {
                                return (idx<from_to['1'])
                            };
                            let __body_ref__146=function() {
                                (acc).push(idx);
                                return idx+=step
                            };
                            let __BREAK__FLAG__=false;
                            while( __test_condition__145()) {
                                 __body_ref__146();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                        return acc
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["range"]=range;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["range"]={
                            core_lang:true,usage:["start_or_end:number","end:number","step:number"],description:("Range has a variable form depending on the amount of arguments provided to the function when "+ "calling it. If provided one argument, range will produce an array from 0 up to, but not including "+ "the provided value. If given two arguments, the first argument will be the starging value and "+ "the last value will be used as the upper bounding value, returning an array with elements starting "+ "at the start value and up to, but not including the bounding value. If given a third value, the "+ "value will be interpreted as the step value, and the returned array will contain values that "+ "increment by the step amount.  Range will throw an error if a negative range is specified. "+ "For negative ranges see neg_range."+ "<br><br>Examples:<br>"+ "(range 5) -> [ 0 1 2 3 4 ]<br>"+ "(range 10 15) -> [ 10 11 12 13 14 ]<br>"+ "(range 10 20) -> [ 10 12 14 16 18 ]<br>"+ "(range -5 0) -> [ -5 -4 -3 -2 -1 ]<br>"+ "(range -3 3) -> [ -3, -2, -1, 0, 1, 2 ]<br>")
                        };
                        return Environment.definitions;
                        
                    }()];
                    let add=new Function("...args","{\n                                let acc;\n                                if (typeof args[0]===\"number\") {\n                                    acc = 0;\n                                } else if (args[0] instanceof Array) {\n                                    return args[0].concat(args.slice(1));\n                                } else if (typeof args[0]==='object') {\n                                   let rval = {};\n                                   for (let i in args) {\n                                        if (typeof args[i] === 'object') {\n                                            for (let k in args[i]) {\n                                                rval[k] = args[i][k];\n                                            }\n                                        }\n                                   }\n                                   return rval;\n                                } else {\n                                    acc = \"\";\n                                }\n                                for (let i in args) {\n                                    acc += args[i];\n                                }\n                                return acc;\n                             }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["add"]=add;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["add"]={
                            core_lang:true,description:("Add is an overloaded function that, based on the first argument provided, determines how to 'add' the arguments. "+ "If provided a number as a first argument, then it will assume the rest of the arguments are numbers and add them "+ "to the first, returning the numerical sum of the arguments. If an object, it will merge the keys of the provided "+ "arguments, returning a combined object.  Be aware that if merging objects, if arguments that have the same keys "+ "the argument who appears last with the key will prevail.  If called with an array as a first argument, the "+ "subsequent arguments will be added to the first via 'concat'.  If strings, the strings will be joined into a "+ "single string and returned.<br>"+ "(add 1 2 3) => 6<br>"+ "(add { `abc: 123 `def: 345 } { `def: 456 }) => { abc: 123, def: 456 }"+ "(add [ 1 2 3 ] [ 4 5 6] 7) => [ 1, 2, 3, [ 4, 5, 6 ], 7 ]<br>"+ "(add \"abc\" \"def\") => \"abcdef\"<br><br>"+ "Note that add doesn't typically need to explicily called.  The compiler will try and determine the best "+ "way to handle adding based on the arguments to be added, so the + operator should be used instead, since "+ "it gives the compiler an opportunity to inline if possible."),usage:["arg0:*","argN:*"],tags:["add","+","sum","number","addition","merge","join","concat"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let merge_objects=new Function("x","{\n                                    let rval = {};\n                                    for (let i in x) {\n                                        if (typeof i === 'object') {\n                                            for (let k in x[i]) {\n                                                rval[k] = x[i][k];\n                                            }\n                                        }\n                                    }\n                                    return rval;\n                                 }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["merge_objects"]=merge_objects;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["merge_objects"]={
                            core_lang:true,description:("Merge objects takes an array of objects and returns an object whose keys and values are "+ "the sum of the provided objects (same behavior as add with objects).  If objects have the "+ "same keys, the last element in the array with the duplicate key will be used to provide the "+ "value for that key."),usage:["objects:array"],tags:["add","merge","keys","values","objects","value"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let index_of=new Function("value","container",("{ return container.indexOf(value) }"));
                    ;
                    await async function(){
                        Environment.global_ctx.scope["index_of"]=index_of;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["index_of"]={
                            core_lang:true,description:"Given a value and an array container, returns the index of the value in the array, or -1 if not found.",usage:["value:number|string|boolean","container:array"],tags:["find","position","index","array","contains"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let resolve_path=new Function("path,obj","{\n                                        if (typeof path==='string') {\n                                            path = path.split(\".\");\n                                        }\n                                        let s=obj;\n                                        return path.reduce(function(prev, curr) {\n                                            return prev ? prev[curr] : undefined\n                                        }, obj || {})\n                                    }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["resolve_path"]=resolve_path;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["resolve_path"]={
                            core_lang:true,description:("Given a path and a tree structure, which can be either an array or an object, "+ "traverse the tree structure and return the value at the path if it exists, otherwise "+ "undefined is returned.<br>"+ "(resolve_path [ 2 1 ] [ 1 2 [ 3 4 5 ] 6 7]) => 4)"),usage:["path:array","tree_structure:array|object"],tags:["find","position","index","path","array","tree","contains","set_path"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let min_value=new Function("elements","{ return Math.min(...elements); }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["min_value"]=min_value;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["min_value"]={
                            core_lang:true,description:"Returns the minimum value in the provided array of numbers.",usage:["elements:array"],tags:["min","max_value","array","elements","minimum","number"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let max_value=new Function("elements","{ return Math.max(...elements); }");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["max_value"]=max_value;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["max_value"]={
                            core_lang:true,description:"Returns the maximum value in the provided array of numbers.",usage:["elements:array"],tags:["min","max_value","array","elements","minimum","number"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let interlace=async function(...args) {
                        let min_length;
                        let rlength_args;
                        let rval;
                        min_length=await (async function(){
                             return await min_value(await (async function(){
                                 return await map(length,args) 
                            })()) 
                        })();
                        rlength_args=await range(await length(args));
                        rval=[];
                        await (async function() {
                            let __for_body__163=async function(i) {
                                return await (async function() {
                                    let __for_body__167=async function(j) {
                                        return (rval).push(await (async function(){
                                            let __targ__169=args[j];
                                            if (__targ__169){
                                                 return(__targ__169)[i]
                                            } 
                                        })())
                                    };
                                    let __array__168=[],__elements__166=rlength_args;
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__165 in __elements__166) {
                                        __array__168.push(await __for_body__167(__elements__166[__iter__165]));
                                        if(__BREAK__FLAG__) {
                                             __array__168.pop();
                                            break;
                                            
                                        }
                                    }return __array__168;
                                     
                                })()
                            };
                            let __array__164=[],__elements__162=await range(min_length);
                            let __BREAK__FLAG__=false;
                            for(let __iter__161 in __elements__162) {
                                __array__164.push(await __for_body__163(__elements__162[__iter__161]));
                                if(__BREAK__FLAG__) {
                                     __array__164.pop();
                                    break;
                                    
                                }
                            }return __array__164;
                             
                        })();
                        return rval
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["interlace"]=interlace;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["interlace"]={
                            core_lang:true,usage:["list0:array","list1:array","listn?:array"],description:"Returns a list containing a consecutive values from each list, in argument order.  I.e. list0.0 list1.0 listn.0 list0.1 list1.1 listn.1 ...",tags:["list","array","join","merge"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let trim=function(x) {
                        return  x["trim"]()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["trim"]=trim;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["trim"]={
                            core_lang:true,description:"Removes leading and trailing spaces from the provided string value.",usage:["value:string"],tags:["string","spaces","clean","squeeze","leading","trailing","space"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let assert=function(assertion_form,failure_message) {
                        if (check_true (assertion_form)){
                            return assertion_form
                        } else {
                            throw new EvalError((failure_message|| "assertion failure"));
                            
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["assert"]=assert;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["assert"]={
                            core_lang:true,description:"If the evaluated assertion form is true, the result is returned, otherwise an EvalError is thrown with the optionally provided failure message.",usage:["form:*","failure_message:string?"],tags:["true","error","check","debug","valid","assertion"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let unquotify=async function(val) {
                        let dval;
                        dval=val;
                        if (check_true (await starts_with_ques_("\"",dval))){
                            dval=await dval["substr"].call(dval,1,(dval.length- 2))
                        };
                        if (check_true (await starts_with_ques_("=:",dval))){
                            dval=await dval["substr"].call(dval,2)
                        };
                        return dval
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["unquotify"]=unquotify;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["unquotify"]={
                            core_lang:true,description:"Removes binding symbols and quotes from a supplied value.  For use in compile time function such as macros.",usage:["val:string"],tags:["macro","quote","quotes","desym"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let or_args=async function(argset) {
                        let is_true;
                        is_true=false;
                        await (async function() {
                            let __for_body__180=async function(elem) {
                                if (check_true (elem)){
                                    {
                                        is_true=true;
                                        return __BREAK__FLAG__=true;
                                        return
                                    }
                                }
                            };
                            let __array__181=[],__elements__179=argset;
                            let __BREAK__FLAG__=false;
                            for(let __iter__178 in __elements__179) {
                                __array__181.push(await __for_body__180(__elements__179[__iter__178]));
                                if(__BREAK__FLAG__) {
                                     __array__181.pop();
                                    break;
                                    
                                }
                            }return __array__181;
                             
                        })();
                        return is_true
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["or_args"]=or_args;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["or_args"]={
                            core_lang:true,description:"Provided an array of values, returns true if any of the values are true, otherwise will return false.",usage:["argset:array"],tags:["or","true","false","array","logic"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let special_operators=async function() {
                        return await make_set(await (async function(){
                             return await compiler([],{
                                special_operators:true,env:Environment
                            }) 
                        })())
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["special_operators"]=special_operators;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["special_operators"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let defclog=async function(opts) {
                        let style;
                        style=("padding: 5px;"+ await (async function(){
                            if (check_true (opts.background)){
                                return ("background: "+ opts.background+ ";")
                            } else {
                                return ""
                            }
                        })()+ await (async function(){
                            if (check_true (opts.color)){
                                return ("color: "+ opts.color+ ";")
                            }
                        })()+ "");
                        return async function(...args) {
                            return await (async function(){
                                let __target_arg__188=[].concat(await conj(await (async function(){
                                    let __array_op_rval__189=style;
                                     if (__array_op_rval__189 instanceof Function){
                                        return await __array_op_rval__189() 
                                    } else {
                                        return [__array_op_rval__189]
                                    }
                                })(),args));
                                if(!__target_arg__188 instanceof Array){
                                    throw new TypeError("Invalid final argument to apply - an array is required")
                                }let __pre_arg__190=await (async function(){
                                     return ("%c"+ await (async function(){
                                        if (check_true (opts.prefix)){
                                            return opts.prefix
                                        } else {
                                            return (args).shift()
                                        }
                                    })()) 
                                })();
                                __target_arg__188.unshift(__pre_arg__190);
                                return (console.log).apply(this,__target_arg__188)
                            })()
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["defclog"]=defclog;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["defclog"]={
                            core_lang:true,description:("Given a description object, containing specific keys, returns a customized console logging "+ "function implements the given requested properties.<br>Options<br>"+ "prefix:string:The prefix to log prior to any supplied user arguments.<br>"+ "color:string:The text color to use on the prefix (or initial argument if no prefix)<br>"+ "background:string:The background coloe to use on the prefix (or initial argument if no prefix)<br>"),usage:["options:object"],tags:["log","logging","console","utility"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let NOT_FOUND=new ReferenceError("not found");
                    ;
                    await async function(){
                        Environment.global_ctx.scope["NOT_FOUND"]=NOT_FOUND;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["NOT_FOUND"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let check_external_env_default=await (async function(){
                        if (check_true ((namespace==="core"))){
                            return true
                        } else {
                            return false
                        }
                    })();
                    ;
                    await async function(){
                        Environment.global_ctx.scope["check_external_env_default"]=check_external_env_default;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["check_external_env_default"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let _star_namespace_star_=namespace;
                    ;
                    await async function(){
                        Environment.global_ctx.scope["*namespace*"]=_star_namespace_star_;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["*namespace*"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let pending_ns_loads=new Object();
                    ;
                    await async function(){
                        Environment.global_ctx.scope["pending_ns_loads"]=pending_ns_loads;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["pending_ns_loads"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let pend_load=async function(from_namespace,target_namespace,symbol,initializer) {
                        if (check_true ((null==pending_ns_loads[from_namespace]))){
                            {
                                await async function(){
                                    pending_ns_loads[from_namespace]=[];
                                    return pending_ns_loads;
                                    
                                }()
                            }
                        };
                        return (pending_ns_loads[from_namespace]).push({
                            symbol:symbol,source_ns:from_namespace,target_ns:target_namespace,initializer:await (async function(){
                                 return ["=:quote",initializer] 
                            })()
                        })
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["pend_load"]=pend_load;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["pend_load"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let load_pends=async function(from_namespace) {
                        if (check_true (pending_ns_loads[from_namespace])){
                            {
                                let acc=[];
                                ;
                                acc=await (async function() {
                                    let __for_body__206=async function(load_instruction) {
                                        return ["=:use_symbols",load_instruction.source_ns,[load_instruction.symbol],load_instruction.target_ns]
                                    };
                                    let __array__207=[],__elements__205=pending_ns_loads[from_namespace];
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__204 in __elements__205) {
                                        __array__207.push(await __for_body__206(__elements__205[__iter__204]));
                                        if(__BREAK__FLAG__) {
                                             __array__207.pop();
                                            break;
                                            
                                        }
                                    }return __array__207;
                                     
                                })();
                                await console.log("load_pends: ",acc);
                                (await Environment.eval(await async function(){
                                    return acc
                                }()));
                                return true
                            }
                        }
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["load_pends"]=load_pends;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["load_pends"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let symbols=async function(opts) {
                        return await async function(){
                            if (check_true ((null==opts))) {
                                return await keys(Environment.global_ctx.scope)
                            } else if (check_true (opts.unique)) {
                                {
                                    let no_includes=await make_set(await conj(["meta_for_symbol","describe","undefine","*namespace*","pend_load","symbols","set_global","get_global","symbol_definition","compile","env_log","evaluate_local","evaluate","eval_struct","set_compiler","clone","eval","add_escape_encoding","get_outside_global","as_lisp","lisp_writer","clone_to_new","save_env","null","compiler"],built_ins));
                                    ;
                                    {
                                        let __collector;
                                        let __result;
                                        let __action;
                                        __collector=[];
                                        __result=null;
                                        __action=async function(sym) {
                                            if (check_true (await no_includes["has"].call(no_includes,sym))){
                                                return null
                                            } else {
                                                return sym
                                            }
                                        };
                                        ;
                                        await (async function() {
                                            let __for_body__212=async function(__item) {
                                                __result=await __action(__item);
                                                if (check_true (__result)){
                                                    return (__collector).push(__result)
                                                }
                                            };
                                            let __array__213=[],__elements__211=await keys(Environment.global_ctx.scope);
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__210 in __elements__211) {
                                                __array__213.push(await __for_body__212(__elements__211[__iter__210]));
                                                if(__BREAK__FLAG__) {
                                                     __array__213.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__213;
                                             
                                        })();
                                        return __collector
                                    }
                                }
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["symbols"]=symbols;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["symbols"]={
                            core_lang:true,description:("Returns an array of the defined global symbols for the local environment.  "+ "If opts.unique is true, only symbols that are not part of the built ins are "+ "included."),usage:["opts:object"],tags:["symbol","names","definitions","values","scope"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let set_global=function(refname,value,meta,is_constant,target_namespace,contained_req) {
                          (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true (((Environment===value)|| (Environment.global_ctx===value)|| (Environment.global_ctx.scope===value)))) {
                                {
                                    throw new EvalError("cannot set the environment scope as a global value");
                                    
                                }
                            }
                        } )();
                        if (check_true ( resolve_path( ( function(){
                            let __array_op_rval__216=refname;
                             if (__array_op_rval__216 instanceof Function){
                                return  __array_op_rval__216("constant") 
                            } else {
                                return [__array_op_rval__216,"constant"]
                            }
                        })(),Environment.definitions))){
                            {
                                throw new TypeError(("Assignment to constant variable "+ refname));
                                
                            }
                        };
                        let namespace_identity= ( function(){
                            if (check_true (target_namespace)){
                                return  ( function(){
                                    let __array_op_rval__217=target_namespace;
                                     if (__array_op_rval__217 instanceof Function){
                                        return  __array_op_rval__217(refname) 
                                    } else {
                                        return [__array_op_rval__217,refname]
                                    }
                                })()
                            } else {
                                return (refname).split("/")
                            }
                        })();
                        ;
                        return   (function(){
                            if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace===namespace_identity['0']))))) {
                                return  parent_environment["set_global"].call(parent_environment,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'],(contained|| contained_req))
                            } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                {
                                    if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                        return  ( function() {
                                            {
                                                 let __call_target__=children[namespace_identity['0']], __call_method__="set_global";
                                                return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'])
                                            } 
                                        })()
                                    } else {
                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                        
                                    }
                                }
                            } else {
                                {
                                    let comps= get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })());
                                    ;
                                      (function(){
                                        Environment.global_ctx.scope[comps['0']]=value;
                                        return Environment.global_ctx.scope;
                                        
                                    })();
                                    if (check_true (((meta instanceof Object)&&  not((meta instanceof Array))))){
                                        {
                                            if (check_true (is_constant)){
                                                {
                                                      (function(){
                                                        meta["constant"]=true;
                                                        return meta;
                                                        
                                                    })()
                                                }
                                            };
                                              (function(){
                                                Environment.definitions[comps['0']]=meta;
                                                return Environment.definitions;
                                                
                                            })()
                                        }
                                    } else {
                                        if (check_true (is_constant)){
                                            {
                                                  (function(){
                                                    Environment.definitions[comps['0']]={
                                                        constant:true
                                                    };
                                                    return Environment.definitions;
                                                    
                                                })()
                                            }
                                        }
                                    };
                                    return Environment.global_ctx.scope[comps['0']]
                                }
                            }
                        } )()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["set_global"]=set_global;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["set_global"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let get_global=function(refname,value_if_not_found,suppress_check_external_env,target_namespace,path_comps,contained_req) {
                        return   (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true ((refname==="Environment"))) {
                                return Environment
                            } else if (check_true ( compiler_operators["has"].call(compiler_operators,refname))) {
                                return special_identity
                            } else {
                                {
                                    let namespace_identity;
                                    let comps;
                                    let refval;
                                    let symbol_name;
                                    let check_external_env;
                                    namespace_identity= ( function(){
                                        if (check_true (target_namespace)){
                                            return  ( function(){
                                                let __array_op_rval__224=target_namespace;
                                                 if (__array_op_rval__224 instanceof Function){
                                                    return  __array_op_rval__224(refname) 
                                                } else {
                                                    return [__array_op_rval__224,refname]
                                                }
                                            })()
                                        } else {
                                            return (refname).split("/")
                                        }
                                    })();
                                    comps=(path_comps||  get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })()));
                                    refval=null;
                                    symbol_name=null;
                                    check_external_env= ( function(){
                                        if (check_true (suppress_check_external_env)){
                                            return false
                                        } else {
                                            return check_external_env_default
                                        }
                                    })();
                                    return   (function(){
                                        if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            return  parent_environment["get_global"].call(parent_environment,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps,(contained|| contained_req))
                                        } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            {
                                                if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                                    return  ( function() {
                                                        {
                                                             let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                            return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps)
                                                        } 
                                                    })()
                                                } else {
                                                    {
                                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                                        
                                                    }
                                                }
                                            }
                                        } else {
                                            {
                                                refval=Environment.global_ctx.scope[comps['0']];
                                                if (check_true (((undefined===refval)&& (namespace_identity.length===1)&& parent_environment))){
                                                    {
                                                        let rval= parent_environment["get_global"].call(parent_environment,refname,value_if_not_found,suppress_check_external_env,null,comps,(contained|| contained_req));
                                                        ;
                                                        return rval
                                                    }
                                                } else {
                                                    {
                                                        if (check_true (((undefined===refval)&& check_external_env))){
                                                            refval= ( function(){
                                                                if (check_true (check_external_env)){
                                                                    return ( get_outside_global(comps['0'])|| NOT_FOUND)
                                                                } else {
                                                                    return NOT_FOUND
                                                                }
                                                            })()
                                                        };
                                                        return   (function(){
                                                            if (check_true (((NOT_FOUND===refval)&&  not((undefined===value_if_not_found))))) {
                                                                return value_if_not_found
                                                            } else if (check_true ((NOT_FOUND===refval))) {
                                                                {
                                                                    throw new ReferenceError(("symbol not found: "+  ( function(){
                                                                        if (check_true ((namespace_identity.length>1))){
                                                                            return  add(namespace,"/",namespace_identity['1'])
                                                                        } else {
                                                                            return  add(namespace,"/",namespace_identity['0'])
                                                                        }
                                                                    })()));
                                                                    
                                                                }
                                                            } else if (check_true ((comps.length===1))) {
                                                                return refval
                                                            } else if (check_true ((comps.length>1))) {
                                                                {
                                                                    return  resolve_path( rest(comps),refval)
                                                                }
                                                            } else {
                                                                {
                                                                     console.warn("get_global: condition fall through: ",comps);
                                                                    return NOT_FOUND
                                                                }
                                                            }
                                                        } )()
                                                    }
                                                }
                                            }
                                        }
                                    } )()
                                }
                            }
                        } )()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["get_global"]=get_global;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["get_global"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let symbol_definition=async function(symname,target_namespace) {
                        let namespace_identity;
                        namespace_identity=await (async function(){
                            if (check_true (target_namespace)){
                                return await (async function(){
                                    let __array_op_rval__227=target_namespace;
                                     if (__array_op_rval__227 instanceof Function){
                                        return await __array_op_rval__227(symname) 
                                    } else {
                                        return [__array_op_rval__227,symname]
                                    }
                                })()
                            } else {
                                if (check_true ((await length(symname)>2))){
                                    return (symname).split("/")
                                } else {
                                    return await (async function(){
                                        let __array_op_rval__228=symname;
                                         if (__array_op_rval__228 instanceof Function){
                                            return await __array_op_rval__228() 
                                        } else {
                                            return [__array_op_rval__228]
                                        }
                                    })()
                                }
                            }
                        })();
                        return await async function(){
                            if (check_true ((namespace_identity.length===1))) {
                                {
                                    let it;
                                    it=Environment.definitions[symname];
                                    if (check_true (it)){
                                        return it
                                    } else {
                                        if (check_true (parent_environment)){
                                            return await parent_environment["symbol_definition"].call(parent_environment,symname)
                                        }
                                    }
                                }
                            } else if (check_true ((namespace_identity['0']===namespace))) {
                                return Environment.definitions[symname]
                            } else if (check_true (parent_environment)) {
                                return await parent_environment["symbol_definition"].call(parent_environment,namespace_identity['1'],namespace_identity['0'])
                            } else if (check_true ((namespace_identity.length===2))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[namespace_identity['0']], __call_method__="symbol_definition";
                                        return await __call_target__[__call_method__].call(__call_target__,namespace_identity['1'])
                                    } 
                                })()
                            } else {
                                return undefined
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["symbol_definition"]=symbol_definition;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["symbol_definition"]={
                            core_lang:true,description:("Given a symbol name and an optional namespace, either as a fully qualified path "+ "or via the target_namespace argument, returns definition information about the "+ "retquested symbol.  "+ "Used primarily by the compiler to find metadata for a specific symbol during compilation."),usage:["symname:string","namespace:string"],tags:["compiler","symbols","namespace","search","context","environment"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let compile=async function(json_expression,opts) {
                        let out;
                        opts=await add({
                            env:Environment
                        },opts,{
                            meta:await (async function(){
                                if (check_true ((opts&& opts.meta))){
                                    return true
                                } else {
                                    return false
                                }
                            })()
                        });
                        out=null;
                        out=await (async function(){
                             return await compiler(json_expression,opts) 
                        })();
                        return await async function(){
                            if (check_true (((out instanceof Array)&& out['0'].ctype&& (out['0'].ctype==="FAIL")))) {
                                return out
                            } else if (check_true (opts.meta)) {
                                return out
                            } else {
                                return out['1']
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["compile"]=compile;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["compile"]={
                            core_lang:true,description:("Compiles the given JSON or quoted lisp and returns a string containing "+ "the lisp form or expression as javascript.<br>"+ "If passed the option { meta: true } , an array is returned containing compilation metadata "+ "in element 0 and the compiled code in element 1."),usage:["json_expression:*","opts:object"],tags:["macro","quote","quotes","desym","compiler"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let env_log=await (async function(){
                         return await defclog({
                            prefix:("env"+ id),background:"#B0F0C0"
                        }) 
                    })();
                    ;
                    await async function(){
                        Environment.global_ctx.scope["env_log"]=env_log;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["env_log"]={
                            core_lang:true,description:"The environment logging function used by the environment.",usage:["arg0:*","argN:*"]
                        };
                        return Environment.definitions;
                        
                    }()];
                    let evaluate_local=async function(expression,ctx,opts) {
                        let compiled;
                        let error_data;
                        let result;
                        opts=(opts|| new Object());
                        compiled=null;
                        error_data=null;
                        result=null;
                        if (check_true (opts.compiled_source)){
                            compiled=expression
                        } else {
                            try {
                                compiled=await (async function(){
                                     return await compiler(await (async function(){
                                        if (check_true (opts.json_in)){
                                            return expression
                                        } else {
                                            return await Environment["read_lisp"].call(Environment,expression,{
                                                source_name:opts.source_name
                                            })
                                        }
                                    })(),{
                                        env:Environment,ctx:ctx,formatted_output:true,source_name:opts.source_name,throw_on_error:opts.throw_on_error,error_report:(opts.error_report|| null),quiet_mode:(opts.quiet_mode|| false)
                                    }) 
                                })()
                            } catch (__exception__235) {
                                if (__exception__235 instanceof Error) {
                                    let e=__exception__235;
                                    {
                                        {
                                            if (check_true (opts.throw_on_error)){
                                                {
                                                    throw e;
                                                    
                                                }
                                            };
                                            if (check_true ((e instanceof LispSyntaxError))){
                                                {
                                                    await async function(){
                                                        e["message"]=await JSON.parse(e.message);
                                                        return e;
                                                        
                                                    }()
                                                }
                                            };
                                            await async function(){
                                                if (check_true ((e instanceof LispSyntaxError))) {
                                                    return error_data=await add({
                                                        error:"LispSyntaxError"
                                                    },e.message)
                                                } else {
                                                    error_data={
                                                        error:await sub_type(e),message:e.message,stack:e.stack,form:await (async function(){
                                                             return await async function(){
                                                                if (check_true (((expression instanceof String || typeof expression==='string')&& (expression.length>100)))) {
                                                                    return await add(await expression["substr"].call(expression,0,100),"...")
                                                                } else {
                                                                    return await (await get_global("as_lisp"))(expression)
                                                                }
                                                            } () 
                                                        })(),parent_forms:[],source_name:opts.source_name,invalid:true
                                                    }
                                                }
                                            } ();
                                            if (check_true (opts.error_report)){
                                                await (async function(){
                                                    let __array_op_rval__237=opts.error_report;
                                                     if (__array_op_rval__237 instanceof Function){
                                                        return await __array_op_rval__237(error_data) 
                                                    } else {
                                                        return [__array_op_rval__237,error_data]
                                                    }
                                                })()
                                            } else {
                                                await console.error("Compilation Error: ",error_data)
                                            };
                                            compiled=await (async function(){
                                                 return [{
                                                    error:true
                                                },null] 
                                            })()
                                        }
                                    }
                                }
                            }
                        };
                        return await async function(){
                            if (check_true ((null==compiled))) {
                                return null
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))&& parent_environment))) {
                                return await parent_environment["evaluate_local"].call(parent_environment,compiled,ctx,await add(new Object(),opts,{
                                    compiled_source:true
                                }))
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))))) {
                                if (check_true (children[compiled['0'].namespace])){
                                    return await (async function() {
                                        {
                                             let __call_target__=children[compiled['0'].namespace], __call_method__="evaluate_local";
                                            return await __call_target__[__call_method__].call(__call_target__,compiled,ctx,await add(new Object(),opts,{
                                                compiled_source:true
                                            }))
                                        } 
                                    })()
                                } else {
                                    throw new EvalError(("unknown namespace "+ compiled['0'].namespace+ " assignment"));
                                    
                                }
                            } else {
                                {
                                    if (check_true (opts.on_compilation_complete)){
                                        await (async function(){
                                            let __array_op_rval__238=opts.on_compilation_complete;
                                             if (__array_op_rval__238 instanceof Function){
                                                return await __array_op_rval__238(compiled) 
                                            } else {
                                                return [__array_op_rval__238,compiled]
                                            }
                                        })()
                                    };
                                    try {
                                        if (check_true (((compiled instanceof Array)&& (compiled['0'] instanceof Object)&& compiled['0'].ctype&& await not((compiled['0'].ctype instanceof String || typeof compiled['0'].ctype==='string'))))){
                                            {
                                                await async function(){
                                                    compiled['0']["ctype"]=await subtype(compiled['0'].ctype);
                                                    return compiled['0'];
                                                    
                                                }()
                                            }
                                        };
                                        result=await (async function(){
                                             return await async function(){
                                                if (check_true (compiled.error)) {
                                                    throw new Error((await get_global("indirect_new"))(compiled.error,compiled.message));
                                                    
                                                } else if (check_true ((compiled['0'].ctype&& (await contains_ques_("block",compiled['0'].ctype)|| (compiled['0'].ctype==="assignment")|| (compiled['0'].ctype==="__!NOT_FOUND!__"))))) {
                                                    if (check_true (await (async function(){
                                                        let __array_op_rval__241=compiled['0'].has_lisp_globals;
                                                         if (__array_op_rval__241 instanceof Function){
                                                            return await __array_op_rval__241() 
                                                        } else {
                                                            return [__array_op_rval__241]
                                                        }
                                                    })())){
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction("Environment",("{ "+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__243=compiled['1'];
                                                                 if (__array_op_rval__243 instanceof Function){
                                                                    return await __array_op_rval__243(Environment) 
                                                                } else {
                                                                    return [__array_op_rval__243,Environment]
                                                                }
                                                            })()
                                                        }
                                                    } else {
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction(("{"+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__245=compiled['1'];
                                                                 if (__array_op_rval__245 instanceof Function){
                                                                    return await __array_op_rval__245() 
                                                                } else {
                                                                    return [__array_op_rval__245]
                                                                }
                                                            })()
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& (("AsyncFunction"===compiled['0'].ctype)|| ("statement"===compiled['0'].ctype)|| ("objliteral"===compiled['0'].ctype))))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__246=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__246 instanceof Function){
                                                                return await __array_op_rval__246() 
                                                            } else {
                                                                return [__array_op_rval__246]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__248=compiled['1'];
                                                                     if (__array_op_rval__248 instanceof Function){
                                                                        return await __array_op_rval__248(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__248,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__250=compiled['1'];
                                                                     if (__array_op_rval__250 instanceof Function){
                                                                        return await __array_op_rval__250() 
                                                                    } else {
                                                                        return [__array_op_rval__250]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& ("Function"===compiled['0'].ctype)))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__251=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__251 instanceof Function){
                                                                return await __array_op_rval__251() 
                                                            } else {
                                                                return [__array_op_rval__251]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__253=compiled['1'];
                                                                     if (__array_op_rval__253 instanceof Function){
                                                                        return await __array_op_rval__253(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__253,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__255=compiled['1'];
                                                                     if (__array_op_rval__255 instanceof Function){
                                                                        return await __array_op_rval__255() 
                                                                    } else {
                                                                        return [__array_op_rval__255]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else {
                                                    return compiled['1']
                                                }
                                            } () 
                                        })()
                                    } catch (__exception__239) {
                                        if (__exception__239 instanceof Error) {
                                            let e=__exception__239;
                                            {
                                                {
                                                    if (check_true ((opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4)))){
                                                        {
                                                            if (check_true (e.details)){
                                                                await env_log("caught error: ",e.details)
                                                            } else {
                                                                await env_log("caught error: ",e.name,e.message,e)
                                                            }
                                                        }
                                                    };
                                                    if (check_true (((await sub_type(e)==="SyntaxError")&& (opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4))))){
                                                        await console.log(compiled['1'])
                                                    };
                                                    if (check_true (opts.error_report)){
                                                        {
                                                            await (async function(){
                                                                let __array_op_rval__256=opts.error_report;
                                                                 if (__array_op_rval__256 instanceof Function){
                                                                    return await __array_op_rval__256(await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()) 
                                                                } else {
                                                                    return [__array_op_rval__256,await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()]
                                                                }
                                                            })()
                                                        }
                                                    };
                                                    result=e;
                                                    if (check_true ((await not(opts.catch_errors)|| (ctx&& ctx.in_try)))){
                                                        {
                                                            throw result;
                                                            
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    };
                                    return result
                                }
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["evaluate_local"]=evaluate_local;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["evaluate_local"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let evaluate=async function(expression,ctx,opts) {
                        return await async function(){
                            if (check_true ((namespace===active_namespace))) {
                                return await evaluate_local(expression,ctx,opts)
                            } else if (check_true ((namespace==="core"))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[active_namespace], __call_method__="evaluate";
                                        return await __call_target__[__call_method__].call(__call_target__,expression,ctx,opts)
                                    } 
                                })()
                            }
                        } ()
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["evaluate"]=evaluate;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["evaluate"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let eval_struct=async function(lisp_struct,ctx,opts) {
                        let rval;
                        rval=null;
                        if (check_true (lisp_struct instanceof Function)){
                            rval=await (async function(){
                                let __array_op_rval__261=lisp_struct;
                                 if (__array_op_rval__261 instanceof Function){
                                    return await __array_op_rval__261() 
                                } else {
                                    return [__array_op_rval__261]
                                }
                            })()
                        } else {
                            rval=await (async function(){
                                 return await evaluate(lisp_struct,ctx,await add({
                                    json_in:true
                                },(opts|| new Object()))) 
                            })()
                        };
                        return rval
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["eval_struct"]=eval_struct;
                        return Environment.global_ctx.scope;
                        
                    }();
                    [await async function(){
                        Environment.definitions["eval_struct"]={
                            core_lang:true
                        };
                        return Environment.definitions;
                        
                    }()];
                    let built_ins=["MAX_SAFE_INTEGER","LispSyntaxError","sub_type","__VERBOSITY__","int","float","values","pairs","keys","take","prepend","first","last","length","conj","reverse","map","bind","to_object","to_array","slice","rest","second","third","chop","chomp","not","push","pop","list","flatten","jslambda","join","lowercase","uppercase","log","split","split_by","is_object?","is_array?","is_number?","is_function?","is_set?","is_element?","is_string?","is_nil?","is_regex?","is_date?","ends_with?","starts_with?","blank?","contains?","make_set","eval_exp","indirect_new","get_import_entry","range","add","merge_objects","index_of","resolve_path","delete_prop","load_pends","min_value","max_value","interlace","trim","assert","unquotify","or_args","pending_ns_loads","special_operators","defclog","NOT_FOUND","check_external_env_default","built_ins","reader"];
                    ;
                    await async function(){
                        Environment.global_ctx.scope["built_ins"]=built_ins;
                        return Environment.global_ctx.scope;
                        
                    }();
                    let set_compiler=async function(compiler_function) {
                        let new_ops;
                        new_ops=await (async function(){
                            let __array_op_rval__265=compiler_function;
                             if (__array_op_rval__265 instanceof Function){
                                return await __array_op_rval__265([],{
                                    special_operators:true,env:Environment
                                }) 
                            } else {
                                return [__array_op_rval__265,[],{
                                    special_operators:true,env:Environment
                                }]
                            }
                        })();
                        if (check_true (await is_set_ques_(new_ops))){
                            {
                                compiler_operators=new_ops;
                                compiler=compiler_function;
                                await async function(){
                                    Environment.global_ctx.scope["compiler"]=compiler;
                                    return Environment.global_ctx.scope;
                                    
                                }();
                                await (await get_global("register_feature"))("compiler")
                            }
                        } else {
                            {
                                await console.error("Invalid compiler function: invalid operators returned. Not installing.");
                                throw new EvalError("Invalid compiler function");
                                
                            }
                        };
                        return compiler
                    };
                    ;
                    await async function(){
                        Environment.global_ctx.scope["set_compiler"]=set_compiler;
                        return Environment.global_ctx.scope;
                        
                    }();
                    await async function(){
                        Environment.global_ctx.scope["clone"]=async function(val) {
                            if (check_true ((val===Environment))){
                                return Environment
                            } else {
                                return await clone(val,0,Environment)
                            }
                        };
                        return Environment.global_ctx.scope;
                        
                    }();
                    await async function(){
                        Environment["get_global"]=get_global;
                        Environment["set_global"]=set_global;
                        Environment["symbol_definition"]=symbol_definition;
                        Environment["namespace"]=namespace;
                        return Environment;
                        
                    }();
                    let children=(opts.children|| new Object());
                    ;
                    let children_declarations=(opts.children_declarations|| new Object());
                    ;
                    if (check_true ((namespace==="core"))){
                        {
                            if (check_true (await not(Environment.global_ctx.scope["*env_config*"]))){
                                {
                                    await async function(){
                                        Environment.global_ctx.scope["*env_config*"]={
                                            export:{
                                                save_path:"js/juno.js",default_namespace:"core",include_source:false
                                            },features:[],build:DLISP_ENV_VERSION,imports:new Object()
                                        };
                                        return Environment.global_ctx.scope;
                                        
                                    }()
                                }
                            };
                            let current_namespace=function() {
                                return active_namespace
                            };
                            ;
                            let create_namespace=async function(name,options,defer_initialization) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true (children[name])) {
                                        throw new EvalError("namespace already exists");
                                        
                                    } else {
                                        {
                                            let child_env;
                                            options=(options|| new Object());
                                            child_env=await (async function(){
                                                 return await dlisp_env({
                                                    parent_environment:Environment,namespace:name,contained:options.contained,defer_initialization:defer_initialization
                                                }) 
                                            })();
                                            if (check_true (child_env.evaluate)){
                                                {
                                                    await child_env["set_compiler"].call(child_env,compiler);
                                                    await async function(){
                                                        children[name]=child_env;
                                                        return children;
                                                        
                                                    }();
                                                    await async function(){
                                                        children_declarations[name]=new Object();
                                                        return children_declarations;
                                                        
                                                    }();
                                                    await child_env["evaluate_local"].call(child_env,"(for_each (sym built_ins) (delete_prop Environment.context.scope sym))");
                                                    await child_env["evaluate_local"].call(child_env,"(for_each (sym built_ins) (delete_prop Environment.definitions sym))");
                                                    if (check_true (options.contained)){
                                                        await async function(){
                                                            let __target_obj__273=children_declarations[name];
                                                            __target_obj__273["contained"]=true;
                                                            return __target_obj__273;
                                                            
                                                        }()
                                                    };
                                                    await async function(){
                                                        let __target_obj__274=children_declarations[name];
                                                        __target_obj__274["serialize_with_image"]=await (async function(){
                                                            if (check_true ((false===options.serialize_with_image))){
                                                                return false
                                                            } else {
                                                                return true
                                                            }
                                                        })();
                                                        return __target_obj__274;
                                                        
                                                    }();
                                                    return name
                                                }
                                            } else {
                                                {
                                                    await console.error("ENV: couldn't create the child environment. Received: ",child_env);
                                                    throw new EvalError(("unable to create namespace "+ name));
                                                    
                                                }
                                            }
                                        }
                                    }
                                } ()
                            };
                            ;
                            let set_namespace=async function(name) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true ((await not(("core"===name))&& (null==children[name])))) {
                                        throw new EvalError(("namespace "+ name+ " doesn't exist"));
                                        
                                    } else {
                                        {
                                            if (check_true ((name==="core"))){
                                                {
                                                    active_namespace="core"
                                                }
                                            } else {
                                                {
                                                    active_namespace=name
                                                }
                                            };
                                            return name
                                        }
                                    }
                                } ()
                            };
                            ;
                            let delete_namespace=async function(name) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true (("core"===name))) {
                                        throw new EvalError("core namespace cannot be removed");
                                        
                                    } else if (check_true ((null==children[name]))) {
                                        throw new EvalError(("namespace "+ name+ "doesn't exist"));
                                        
                                    } else if (check_true ((name===await current_namespace()))) {
                                        throw new EvalError("namespace is the current namespace");
                                        
                                    } else {
                                        {
                                            await (await get_global("remove_prop"))(children,name);
                                            await (async function() {
                                                let __for_body__277=async function(k) {
                                                    if (check_true (await starts_with_ques_(k,name))){
                                                        {
                                                            return await (await get_global("remove_prop"))(Environment.global_ctx._star_env_config_star_.imports,k)
                                                        }
                                                    }
                                                };
                                                let __array__278=[],__elements__276=(await resolve_path(["global_ctx","scope","*env_config*","imports"],Environment)|| []);
                                                let __BREAK__FLAG__=false;
                                                for(let __iter__275 in __elements__276) {
                                                    __array__278.push(await __for_body__277(__elements__276[__iter__275]));
                                                    if(__BREAK__FLAG__) {
                                                         __array__278.pop();
                                                        break;
                                                        
                                                    }
                                                }return __array__278;
                                                 
                                            })();
                                            return name
                                        }
                                    }
                                } ()
                            };
                            ;
                            await async function(){
                                Environment.global_ctx.scope["create_namespace"]=create_namespace;
                                Environment.global_ctx.scope["set_namespace"]=set_namespace;
                                Environment.global_ctx.scope["delete_namespace"]=delete_namespace;
                                Environment.global_ctx.scope["namespaces"]=function() {
                                    return  add( keys(children),"core")
                                };
                                Environment.global_ctx.scope["current_namespace"]=current_namespace;
                                return Environment.global_ctx.scope;
                                
                            }()
                        }
                    };
                    let get_namespace_handle=async function(name) {
                        return await async function(){
                            if (check_true ((namespace===name))) {
                                return Environment
                            } else if (check_true ((namespace==="core"))) {
                                if (check_true (((name instanceof String || typeof name==='string')&& children[name]))){
                                    return children[name]
                                }
                            } else if (check_true (parent_environment)) {
                                return await parent_environment["get_namespace_handle"].call(parent_environment,name)
                            } else {
                                throw new Error("invalid namespace handle requested");
                                
                            }
                        } ()
                    };
                    ;
                    let included_globals=async function() {
                        return {
                            definitions:await (async function(){
                                 return { "MAX_SAFE_INTEGER":{ "core_lang":true
                            },"LispSyntaxError":{ "core_lang":true
                        },"sub_type":{ "core_lang":true,"description":"Returns a string the determined actual type of the provided value.","usage":["value:*"],"tags":["type","class","prototype","typeof","instanceof"]
                    },"__VERBOSITY__":{ "core_lang":true,"description":"Set __VERBOSITY__ to a positive integer for verbose console output of system activity.","tags":["debug","compiler","environment","global"]
                },"int":{ "core_lang":true,"usage":"value:string|number","description":"Convenience method for parseInt, should be used in map vs. directly calling parseInt, which will not work directly","tags":["conversion","number"]
            },"float":{ "core_lang":true,"usage":"value:string|number","description":"Convenience method for parseFloat, should be used in map vs. directly calling parseFloat, which will not work directly","tags":["conversion","number"]
        },"values":{ "core_lang":true,"description":"Given a container, returns a list containing the values of each supplied argument. Note that for objects, only the values are returned, not the keys. If given multiple values, the returned value is a concatentation of all containers provided in the arguments.","usage":["arg0:*","argn:*"],"tags":["array","container","object","keys","elements"]
    },"pairs":{ "core_lang":true,"description":"Given a passed object or array, returns a list containing a 2 element list for each key/value pair of the supplied object.","tags":["array","container","object"],"usage":["obj:object"]
},"keys":{ "core_lang":true,"description":"Given an object, returns the keys of the object.","tags":["object","values","keys","indexes","container"],"usage":["obj:object"]
},"take":{ "core_lang":true,"description":"Takes the first value off the list, and returns the value.","tags":["array","container","mutate","first"],"usage":["place:container"]
},"prepend":{ "core_lang":true,"description":"Places the value argument onto the first of the list (unshift) and returns the list.","tags":["array","mutate","container"],"usage":["place:array","thing:*"]
},"first":{ "core_lang":true,"description":"Given an array, returns the first element in the array.","usage":["x:array"],"tags":["array","container","elements"]
},"last":{ "core_lang":true,"description":"Given an array, returns the last element in the array.","usage":["x:array"],"tags":["array","container","elements","end"]
},"length":{ "core_lang":true,"description":"Returns the length of the supplied type (array, object, set, string, number). If the supplied value is nil or a non-container type, returns 0.","tags":["size","elements","container","dimension","array","set","string","number"],"usage":["thing:container"]
},"conj":{ "core_lang":true,"description":"Conjoins or concatenates things (typically arrays) together and returns an array. Examples:<br>(conj [ 1 2 ] [ 3 4 ]) => [ 1 2 3 4 ]<br>(conj [ 1 2 ] 3 4 ) => [ 1 2 3 4 ]<br>(conj 1 2 [ 3 4 ]) => [ 1 2 3 4 ]<br>(conj { `abc: 123 } [ 2 3]) => [ { abc: 123 }, 2, 3 ]<br>(conj [ 1 2 3 [ 4 ]] [ 5 6 [ 7 ]]) => [ 1 2 3 [ 4 ] 5 6 [ 7 ] ]","tags":["elements","concat","array","conjoin","append"],"usage":["arg0:*","argN:*"]
},"reverse":{ "core_lang":true,"usage":["container:list"],"description":"Returns a copy of the passed list as reversed.  The original is not changed.","tags":["list","sort","order"]
},"map":{ "core_lang":true,"description":"Provided a function as a first argument, map calls the function (item, current_index, total_length) with each element from the second argument, which should be a list. Returns a new list containing the return values resulting from evaluating.","tags":["array","container","elements","iteration"],"usage":["lambda:function","elements:array"]
},"bind":{ "core_lang":true,"description":"Given a function and a this value, the bind function returns a new function that has its this keyword set to the provided value in this_arg.","usage":["func:function","this_arg:*"],"tags":["bind","this","function"]
},"to_object":{ "core_lang":true,"description":"Given an array of pairs in the form of [[key value] [key value] ...], constructs an object with the first array element of the pair as the key and the second element as the value. A single object is returned.","usage":["paired_array:array"],"tags":["conversion","object","array","list","pairs"]
},"to_array":{ "core_lang":true,"description":"Given a container of type Array, Set, Object, or a string, it will convert the members of the container to an array form, and return a new array with the values of the provided container. In the case of an object, the keys and values will be contained in paired arrays in the returned array.  A string will be split into individual characters. If provided a different type other than the listed values above, the value will be placed in an array as a single element.","usage":["container:*"],"tags":["array","conversion","set","object","string","pairs"]
},"slice":{ "core_lang":true,"description":"Given an array, with a starting index and an optional ending index, slice returns a new array containing the elements in the range of provided indices.","usage":["target:array","from:number","to:number"],"tags":["array","slicing","dimensions","subset"]
},"rest":{ "core_lang":true,"description":"Returns a new array containing the elements in the 2nd through last position (the tail) of the provided array.","usage":["x:array"],"tags":["array","subset","slice","tail","end"]
},"second":{ "core_lang":true,"description":"Returns the second element in the provided array (the element at index 1)","tags":["array","subset","element","first"],"usage":["x:array"]
},"third":{ "core_lang":true,"description":"Returns the third element in the provided array (the element at index 2)","tags":["array","subset","element","first"],"usage":["x:array"]
},"chop":{ "core_lang":true,"description":"Returns a new container containing all items except the last item.  This function takes either an array or a string.","usage":["container:array|string"],"tags":["array","slice","subset","first","string"]
},"chomp":{ "core_lang":true,"description":"Given a string returns a new string containing all characters except the last character.","usage":["x:string"],"tags":["slice","subset","string"]
},"not":{ "core_lang":true,"description":"Returns the logical opposite of the given value.  If given a truthy value, a false is returned.  If given a falsey value, true is returned.","usage":["x:*"],"tags":["logic","not","inverse"]
},"push":{ "core_lang":true,"description":"Given an array as a place, and an arbitrary value, appends (pushes) the value to the end of the array.","usage":["place:array","thing:*"],"tags":["array","mutate","append","concat","pop"]
},"pop":{ "core_lang":true,"description":"Given an array as an arguments, removes the last value from the given array and returns it.","usage":["place:array"],"tags":["array","mutate","take","remove","push"]
},"list":{ "core_lang":true,"description":"Given a set of arbitrary arguments, returns an array containing the provided arguments. If no arguments are provided, returns an empty array.","usage":["arg0:*","argN:*"],"tags":["array","container","elements"]
},"flatten":{ "core_lang":true,"description":"Given a nested array structure, returns a flattened version of the array","usage":["x:array"],"tags":["array","container","flat","tree"]
},"jslambda":{ "core_lang":true,"description":"Proxy for Javascript Function.  Given a set of string based arguments, all but the last are considered arguments to the function to be defined.  The last argument is considered the body of the function and should be provided as a string of javascript. Returns a javascript function. <br>(jslambda (`a `b) \"{ return a+b }\")<br>(jslambda () \"{ return new Date() }\")","usage":["argument_list:array","argn:string"],"tags":["javascript","embed","function"]
},"join":{ "core_lang":true,"description":"Given an optional joining string and an array of strings, returns a string containing the elements of the array interlaced with the optional joining string.<br>(join \",\" [ \"red\" \"fox\" ]) -> \"red,fox\"<br>(join [\"red\" \"fox\"]) -> redfox","tags":["array","combine","split","string","text"],"usage":["joining_string?:string","container:array"]
},"lowercase":{ "core_lang":true,"description":"Given a string, converts all capital characters to lowercase characters.","tags":["string","text","uppercase","case","convert"],"usage":["text:string"]
},"uppercase":{ "core_lang":true,"description":"Given a string, converts all capital characters to uppercase characters.","tags":["string","text","lowercase","case","convert"],"usage":["text:string"]
},"log":{ "core_lang":true,"description":"log is a shorthand call for console.log by default, and serves to provide a base abstraction for logging.  Log behavior can be changed by redefining log to better suit the environmental context.  For example, writing log output to a file or HTML container.","usage":["args0:*","argsN:*"],"tags":["logging","console","output"]
},"split":{ "core_lang":true,"description":"Given a string to partition and a string for a splitting token, return an array whose elements are the text found between each splitting token. <br>(split \"red,fox\" \",\") => [ \"red\" \"fox\" ]","tags":["partition","join","separate","string","array"],"usage":["string_to_split:string","split_token:string"]
},"split_by":{ "core_lang":true,"description":"Given a string for a splitting token and a string to partition, return an array whose elements are the text found between each splitting token. <br>(split_by \",\" \"red,fox\") => [ \"red\" \"fox\" ]","tags":["partition","join","separate","string","array"],"usage":["split_token:string","string_to_split:string"]
},"is_object?":{ "core_lang":true,"description":"for the given value x, returns true if x is an Javascript object type.","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_array?":{ "core_lang":true,"description":"for the given value x, returns true if x is an array.","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_number?":{ "core_lang":true,"description":"for the given value x, returns true if x is a number.","usage":["arg:value"],"tags":["type","condition","subtype","value","what","function"]
},"is_function?":{ "core_lang":true,"description":"for the given value x, returns true if x is a function.","usage":["arg:value"],"tags":["type","condition","subtype","value","what","function"]
},"is_set?":{ "core_lang":true,"description":"for the given value x, returns true if x is a set.","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_element?":{ "core_lang":true,"description":"for the given value x, returns true if x is an Element object","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_string?":{ "core_lang":true,"description":"for the given value x, returns true if x is a String object","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_nil?":{ "name":"is_nil?","fn_args":"(\"value\")","description":"for the given value x, returns true if x is exactly equal to nil.","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_regex?":{ "name":"is_regex?","fn_args":"(x)","description":"for the given value x, returns true if x is a Javascript regex object","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"is_date?":{ "name":"is_date?","fn_args":"(x)","description":"for the given value x, returns true if x is a Date object.","usage":["arg:value"],"tags":["type","condition","subtype","value","what"]
},"ends_with?":{ "core_lang":true,"description":"for a given string or array, checks to see if it ends with the given start_value.  Non string args return false.","usage":["end_value:value","collection:array|string"],"tags":["string","text","list","array","filter","reduce"]
},"starts_with?":{ "core_lang":true,"description":"for a given string or array, checks to see if it starts with the given start_value.  Non string args return false.","usage":["start_value:value","collection:array|string"],"tags":["string","text","list","array","filter","reduce","begin"]
},"delete_prop":{ "core_lang":true,"description":"Removes the key or keys of the provided object, and returns the modified object.<br>Example:<br>(defglobal foo { abc: 123 def: 456 ghi: 789 })<br>(delete_prop foo `abc `def) => { ghi: 789 }<br>","usage":["obj:objects","key0:string","keyN?:string"],"tags":["delete","keys","object","remove","remove_prop","mutate"]
},"blank?":{ "core_lang":true,"description":"Given a value, if it is equal (via eq) to nil or to \"\" (an empty string), returns true, otherwise false.","usage":["val:*"],"tags":["string","empty","text"]
},"contains?":{ "core_lang":true,"description":"Given a target value and container value (array, set, or string), checks if the container has the value. If it is found, true is returned, otherwise false if returned.  ","tags":["string","array","set","has","includes","indexOf"],"usage":["value:*","container:array|set|string"]
},"make_set":{ "core_lang":true,"description":"If given an array, a new Set is returned containing the elements of the array. If given an object, a new Set is returned containing the values of the object, and the keys are discarded. If given a set, new Set is created and returend  from the values of the old set.","usage":["vals:array|object|set"],"tags":["array","set","object","values","convert"]
},"meta_for_symbol":{ "core_lang":true,"description":"Given a quoted symbol and a boolean indicating whether or not all namespaces should be searched, returns the meta data associated with the symbol for each environment.  If search mode is requested, the value returned is an array, since there can be symbols with the same name in different environments. If no values are found an empty array is returned.  If not in search mode, meta_for_symbol searches the current namespace only, and if a matching symbol is found, returns an object with all found metadata, otherwise nil is returned.","usage":["quoted_symbol:string","search_mode:boolean"],"tags":["describe","meta","help","definition","symbol","metadata"]
},"describe":{ "core_lang":true,"description":"Given a quoted symbol returns the relevant metadata pertinent to the current namespace context.","usage":["quoted_symbol:string","search_mode:boolean"],"tags":["meta","help","definition","symbol","metadata","info","meta_for_symbol"]
},"undefine":{ "core_lang":true,"description":"Given a quoted symbol removes the symbol and any definition information from the namespace. If the namespace is fully-qualified, then the symbol will be removed from the specified namespace instead of the currently active namespace. If the symbol is successfully removed, the function will return true, otherwise if it is not found, false will be returned.  Note that if the specified symbol is non-qualified, but exists in a different, accessible namespace, but the symbol isn't present in the current namespace, the symbol will not be deleted.  The environment is not searched and therefore symbols have to be explicitly fully-qualified for any effect of this function outside the current namespace.","usage":["quoted_symbol:string"],"tags":["symbol","delete","remove","unintern","reference","value"]
},"eval_exp":{ "core_lang":true,"description":"Evaluates the given expression and returns the value.","usage":["expression:*"],"tags":["eval","evaluation","expression"]
},"indirect_new":{ "core_lang":true,"description":"Used by the compiler for implementation of the new operator and shouldn't be directly called by user programs.  The new operator should be called instead.","usage":["arg0:*","argsN:*"],"tags":["system","compiler","internal"]
},"range":{ "core_lang":true,"usage":["start_or_end:number","end:number","step:number"],"description":"Range has a variable form depending on the amount of arguments provided to the function when calling it. If provided one argument, range will produce an array from 0 up to, but not including the provided value. If given two arguments, the first argument will be the starging value and the last value will be used as the upper bounding value, returning an array with elements starting at the start value and up to, but not including the bounding value. If given a third value, the value will be interpreted as the step value, and the returned array will contain values that increment by the step amount.  Range will throw an error if a negative range is specified. For negative ranges see neg_range.<br><br>Examples:<br>(range 5) -> [ 0 1 2 3 4 ]<br>(range 10 15) -> [ 10 11 12 13 14 ]<br>(range 10 20) -> [ 10 12 14 16 18 ]<br>(range -5 0) -> [ -5 -4 -3 -2 -1 ]<br>(range -3 3) -> [ -3, -2, -1, 0, 1, 2 ]<br>"
},"add":{ "core_lang":true,"description":"Add is an overloaded function that, based on the first argument provided, determines how to 'add' the arguments. If provided a number as a first argument, then it will assume the rest of the arguments are numbers and add them to the first, returning the numerical sum of the arguments. If an object, it will merge the keys of the provided arguments, returning a combined object.  Be aware that if merging objects, if arguments that have the same keys the argument who appears last with the key will prevail.  If called with an array as a first argument, the subsequent arguments will be added to the first via 'concat'.  If strings, the strings will be joined into a single string and returned.<br>(add 1 2 3) => 6<br>(add { `abc: 123 `def: 345 } { `def: 456 }) => { abc: 123, def: 456 }(add [ 1 2 3 ] [ 4 5 6] 7) => [ 1, 2, 3, [ 4, 5, 6 ], 7 ]<br>(add \"abc\" \"def\") => \"abcdef\"<br><br>Note that add doesn't typically need to explicily called.  The compiler will try and determine the best way to handle adding based on the arguments to be added, so the + operator should be used instead, since it gives the compiler an opportunity to inline if possible.","usage":["arg0:*","argN:*"],"tags":["add","+","sum","number","addition","merge","join","concat"]
},"merge_objects":{ "core_lang":true,"description":"Merge objects takes an array of objects and returns an object whose keys and values are the sum of the provided objects (same behavior as add with objects).  If objects have the same keys, the last element in the array with the duplicate key will be used to provide the value for that key.","usage":["objects:array"],"tags":["add","merge","keys","values","objects","value"]
},"index_of":{ "core_lang":true,"description":"Given a value and an array container, returns the index of the value in the array, or -1 if not found.","usage":["value:number|string|boolean","container:array"],"tags":["find","position","index","array","contains"]
},"resolve_path":{ "core_lang":true,"description":"Given a path and a tree structure, which can be either an array or an object, traverse the tree structure and return the value at the path if it exists, otherwise undefined is returned.<br>(resolve_path [ 2 1 ] [ 1 2 [ 3 4 5 ] 6 7]) => 4)","usage":["path:array","tree_structure:array|object"],"tags":["find","position","index","path","array","tree","contains","set_path"]
},"min_value":{ "name":"min_value","fn_args":"(v)","usage":["values:list"],"description":"Given an array of numbers, returns the smallest value found.  Any non-numbers in the array are ignored.  If there are no numbers in the list, 0 is returned."
},"max_value":{ "name":"max_value","fn_args":"(v)","usage":["values:list"],"description":"Given an array of numbers, returns the largest value found.  Any non-numbers in the array are ignored.  If there are no numbers in the list, 0 is returned."
},"interlace":{ "core_lang":true,"usage":["list0:array","list1:array","listn?:array"],"description":"Returns a list containing a consecutive values from each list, in argument order.  I.e. list0.0 list1.0 listn.0 list0.1 list1.1 listn.1 ...","tags":["list","array","join","merge"]
},"trim":{ "core_lang":true,"description":"Removes leading and trailing spaces from the provided string value.","usage":["value:string"],"tags":["string","spaces","clean","squeeze","leading","trailing","space"]
},"assert":{ "core_lang":true,"description":"If the evaluated assertion form is true, the result is returned, otherwise an EvalError is thrown with the optionally provided failure message.","usage":["form:*","failure_message:string?"],"tags":["true","error","check","debug","valid","assertion"]
},"unquotify":{ "core_lang":true,"description":"Removes binding symbols and quotes from a supplied value.  For use in compile time function such as macros.","usage":["val:string"],"tags":["macro","quote","quotes","desym"]
},"or_args":{ "core_lang":true,"description":"Provided an array of values, returns true if any of the values are true, otherwise will return false.","usage":["argset:array"],"tags":["or","true","false","array","logic"]
},"special_operators":{ "core_lang":true
},"defclog":{ "core_lang":true,"description":"Given a description object, containing specific keys, returns a customized console logging function implements the given requested properties.<br>Options<br>prefix:string:The prefix to log prior to any supplied user arguments.<br>color:string:The text color to use on the prefix (or initial argument if no prefix)<br>background:string:The background coloe to use on the prefix (or initial argument if no prefix)<br>","usage":["options:object"],"tags":["log","logging","console","utility"]
},"NOT_FOUND":{ "core_lang":true
},"check_external_env_default":{ "core_lang":true
},"*namespace*":{ "core_lang":true
},"pending_ns_loads":{ "core_lang":true
},"pend_load":{ "core_lang":true
},"load_pends":{ "core_lang":true
},"symbols":{ "core_lang":true,"description":"Returns an array of the defined global symbols for the local environment.  If opts.unique is true, only symbols that are not part of the built ins are included.","usage":["opts:object"],"tags":["symbol","names","definitions","values","scope"]
},"set_global":{ "core_lang":true
},"get_global":{ "core_lang":true
},"symbol_definition":{ "core_lang":true,"description":"Given a symbol name and an optional namespace, either as a fully qualified path or via the target_namespace argument, returns definition information about the retquested symbol.  Used primarily by the compiler to find metadata for a specific symbol during compilation.","usage":["symname:string","namespace:string"],"tags":["compiler","symbols","namespace","search","context","environment"]
},"compile":{ "core_lang":true,"description":"Compiles the given JSON or quoted lisp and returns a string containing the lisp form or expression as javascript.<br>If passed the option { meta: true } , an array is returned containing compilation metadata in element 0 and the compiled code in element 1.","usage":["json_expression:*","opts:object"],"tags":["macro","quote","quotes","desym","compiler"]
},"env_log":{ "core_lang":true,"description":"The environment logging function used by the environment.","usage":["arg0:*","argN:*"]
},"evaluate_local":{ "core_lang":true
},"evaluate":{ "core_lang":true
},"eval_struct":{ "core_lang":true
},"defmacro":{ "eval_when":{ "compile_time":true
},"description":"Defines the provided name as a compile time macro function in the current namespace environment. The parameters in the lambda list are destructured and bound to the provided names which are then available in the macro function.  The forms are used as the basis for the function with the final form expected to return a quoted form which is then as the expansion of the macro by the compiler. The body of forms are explicitly placed in a progn block.  Like with functions and defglobal, if the final argument to defmacro is an object, this will be used for the metadata associated with with the bound symbol provided as name.<br>Example:<br> (defmacro unless (condition `& forms)\n    `(if (not ,#condition)\n       (do \n         ,@forms))\n    {\n     `description: \"opposite of if, if the condition is false then the forms are evaluated\"\n     `usage: [\"condition:array\" \"forms:array\"]\n     `tags: [\"if\" \"not\" \"ifnot\" \"logic\" \"conditional\"]\n     }) <br>In the above example the macro unless is defined.  Passed arguments must be explicitly unquoted or an error may be thrown because the arguments condition and forms *may* not be defined in the final compilation environment.  Note that if the symbols used by the macro are defined in the final compilation scope, that this may cause unexpected behavior due to the form being placed into the compilation tree and then acting on those symbols. <br>Be aware that if a macro being defined returns an object (not an array) you should explicitly add the final metadata form to explictly ensure appropriate interpretation of the argument positions.<br><br>Since a macro is a function that is defined to operate at compile time vs. run time, the rules of declare apply.  Declaration operate normally and should be the first form in the block, or if using let, the first form after the allocation block of the let.","usage":["name:symbol","lambda_list:array","forms:array","meta?:object"],"tags":["macro","define","compile","function"]
},"desym":{ "eval_when":{ "compile_time":true
},"name":"desym","macro":true,"fn_args":"(val)","description":"Given a value or arrays of values, return the provided symbol in it's literal, quoted form, e.g. (desym myval) => \"myval\"","usage":["val:string|array"],"tags":["symbol","reference","literal","desymbolize","dereference","deref","desym_ref"]
},"desym_ref":{ "eval_when":{ "compile_time":true
},"name":"desym_ref","macro":true,"fn_args":"(val)","description":["=:+","Given a value will return the a string containing the desymbolized value or values. ","Example: <br>","(defglobal myvar \"foo\")<br>","(defglobal myarr [ (quote myvar) ])<br>","(desym_ref myarr) => (myvar)<br>","(desym_ref myarr.0) => myvar<br>","(subtype (desym_ref myarr.0)) => \"String\""],"usage":["val:*"],"tags":["symbol","reference","syntax","dereference","desym","desym_ref"]
},"deref":{ "eval_when":{ "compile_time":true
},"name":"deref","macro":true,"fn_args":"(val)","description":["=:+","If the value that the symbol references is a binding value, aka starting with '=:', then return the symbol value ","instead of the value that is referenced by the symbol. This is useful in macros where a value in a form is ","to be used for it's symbolic name vs. it's referenced value, which may be undefined if the symbol being ","de-referenced is not bound to any value. <br>","Example:<br>","Dereference the symbolic value being held in array element 0:<br>","(defglobal myvar \"foo\")<br>","(defglobal myarr [ (quote myvar) ])<br>","(deref my_array.0) => \"my_var\"<br>","(deref my_array) => [ \"=:my_var\" ]<br>","<br>In the last example, the input to deref isn't a string and so it returns the value as is.  See also desym_ref."],"tags":["symbol","reference","syntax","dereference","desym","desym_ref"],"usage":["symbol:string"]
},"when":{ "eval_when":{ "compile_time":true
},"name":"when","macro":true,"fn_args":"(condition \"&\" mbody)","description":["=:+","Similar to if, but the body forms are evaluated in an implicit progn, if the condition form or expression is true. ","The function when will return the last form value.  There is no evaluation of the body if the conditional expression ","is false."],"usage":["condition:*","body:*"],"tags":["if","condition","logic","true","progn","conditional"]
},"if_compile_time_defined":{ "eval_when":{ "compile_time":true
},"name":"if_compile_time_defined","macro":true,"fn_args":"(quoted_symbol exists_form not_exists_form)","description":"If the provided quoted symbol is a defined symbol at compilation time, the exists_form will be compiled, otherwise the not_exists_form will be compiled.","tags":["compile","defined","global","symbol","reference"],"usage":["quoted_symbol:string","exists_form:*","not_exists_form:*"]
},"defexternal":{ "eval_when":{ "compile_time":true
},"name":"defexternal","macro":true,"fn_args":"(name value)","description":"Given a name and a value, defexternal will add a globalThis property with the symbol name thereby creating a global variable in the javascript environment.","tags":["global","javascript","globalThis","value"],"usage":["name:string","value:*"]
},"defun":{ "eval_when":{ "compile_time":true
},"name":"defun","macro":true,"fn_args":"(name lambda_list body meta)","description":["=:+","Defines a top level function in the current environment.  Given a name, lambda_list,","body, and a meta data description, builds, compiles and installs the function in the","environment under the provided name.  The body isn't an explicit progn, and must be","within a block structure, such as progn, let or do."],"usage":["name:string:required","lambda_list:array:required","body:array:required","meta:object"],"tags":["function","lambda","define","environment"]
},"defun_sync":{ "eval_when":{ "compile_time":true
},"name":"defun_sync","macro":true,"fn_args":"(name args body meta)","description":["=:+","Creates a top level synchronous function as opposed to the default via defun, which creates an asynchronous top level function.","Doesn't support destructuring bind in the lambda list (args). ","Given a name, an argument list, a body and symbol metadata, will establish a top level synchronous function.  If the name is ","fully qualified, the function will be compiled in the current namespace (and it's lexical environment) and placed in the ","specified namespace."],"usage":["name:string","args:array","body:*","meta:object"],"tags":["define","function","synchronous","toplevel"]
},"macroexpand":{ "name":"macroexpand","fn_args":"(quoted_form)","description":"Given a quoted form, will perform the macro expansion and return the expanded form.","usage":["quoted_form:*"],"tags":["macro","expansion","debug","compile","compilation"]
},"macroexpand_nq":{ "eval_when":{ "compile_time":true
},"name":"macroexpand_nq","macro":true,"fn_args":"(form)","description":"[Deprecated] - use macroexpand.  The nq form takes a non quoted form and returns the expansion. Used primarily during early development.","usage":["form:*"],"tags":["macro","deprecated","expansion","debug","compile","compilation"],"deprecated":true
},"check_type":{ "eval_when":{ "compile_time":true
},"name":"check_type","macro":true,"fn_args":"(thing type_name error_string)","description":"If the type of thing (ascertained by sub_type) are not of the type type_name, will throw a TypeError with the optional error_string as the error message.","usage":["thing:*","type_name:string","error_string:string"],"tags":["types","validation","type","assert"]
},"get_object_path":{ "name":"get_object_path","fn_args":"(refname)","description":"get_object_path is used by the compiler to take a string based notation in the form of p[a][b] or p.a.b and returns an array of the components.","tags":["compiler"],"usage":["refname:string"]
},"do_deferred_splice":{ "name":"do_deferred_splice","fn_args":"(tree)","description":"Internally used by the compiler to facilitate splice operations on arrays.","usage":["tree:*"],"tags":["compiler","build"]
},"define":{ "eval_when":{ "compile_time":true
},"name":"define","macro":true,"fn_args":"(\"&\" defs)","usage":["declaration:array","declaration:array*"],"description":["=:+","Given 1 or more declarations in the form of (symbol value ?metadata), ","creates a symbol in global scope referencing the provided value.  If a ","metadata object is provided, this is stored as a the symbol's metadata."],"tags":["symbol","reference","definition","metadata","environment"]
},"defbinding":{ "eval_when":{ "compile_time":true
},"name":"defbinding","macro":true,"fn_args":"(\"&\" args)","description":["=:+","Defines a global binding to a potentially native function.  This macro ","facilitates the housekeeping by keeping track of the source form ","used (and stored in the environment) so that the save environment ","facility can capture the source bindings and recreate it in the initializer ","function on rehydration.<br>","The macro can take an arbitrary amount of binding arguments, with the form: ","(symbol_name (fn_to_bind_to this))"],"usage":["binding_set0:array","binding_setN:array"],"tags":["toplevel","global","bind","environment","initialize"]
},"define_env":{ "eval_when":{ "compile_time":true
},"name":"define_env","macro":true,"fn_args":"(\"&\" defs)","description":["=:+","define_env is a macro used to provide a dual definition on the top level: it creates a symbol via defvar in the ","constructed scope as well as placing a reference to the defined symbol in the scope object."],"usage":["definitions:array"],"tags":["environment","core","build"]
},"type":{ "name":"type","fn_args":"(x)","usage":["value:*"],"description":"returns the type of value that has been passed.  Deprecated, and the sub_type function should be used.","tags":["types","value","what"]
},"destructure_list":{ "name":"destructure_list","fn_args":"(elems)","description":"Destructure list takes a nested array and returns the paths of each element in the provided array.","usage":["elems:array"],"tags":["destructuring","path","array","nested","tree"]
},"destructuring_bind":{ "eval_when":{ "compile_time":true
},"name":"destructuring_bind","macro":true,"fn_args":"(bind_vars expression \"&\" forms)","description":["=:+","The macro destructuring_bind binds the variable symbols specified in bind_vars to the corresponding ","values in the tree structure resulting from the evaluation of the provided expression.  The bound ","variables are then available within the provided forms, which are then evaluated.  Note that ","destructuring_bind only supports destructuring arrays. Destructuring objects is not supported."],"usage":["bind_vars:array","expression:array","forms:*"],"tags":["destructure","array","list","bind","variables","allocation","symbols"]
},"split_by_recurse":{ "name":"split_by_recurse","fn_args":"(token container)","usage":["token:string","container:string|array"],"description":["=:+","Like split_by, splits the provided container at ","each token, returning an array of the split ","items.  If the container is an array, the function ","will recursively split the strings in the array ","and return an array containing the split values ","of that array.  The final returned array may contain ","strings and arrays."],"tags":["split","nested","recursion","array","string"]
},"reduce":{ "eval_when":{ "compile_time":true
},"name":"reduce","macro":true,"fn_args":"((elem item_list) form)","description":"Provided a first argument as a list which contains a binding variable name and a list, returns a list of all non-null return values that result from the evaluation of the second list.","usage":[["binding-elem:symbol","values:list"],["form:list"]],"tags":["filter","remove","select","list","array"]
},"bind_function":{ "description":"Reference bind and so has the exact same behavior.  Used for Kina legacy code. See bind description."
},"is_reference?":{ "eval_when":{ "compile_time":true
},"name":"is_reference?","macro":true,"fn_args":"(val)","description":["=:+","Returns true if the quoted value is a binding string; in JSON notation this would be a string starting with \"=:\". ","Note that this function doesn't check if the provided value is a defined symbol, but only if it has been ","described in the JSON structure as a bounding string."],"usage":["val:string"],"tags":["reference","JSON","binding","symbol"]
},"scan_str":{ "name":"scan_str","fn_args":"(regex search_string)","description":["=:+","Using a provided regex and a search string, performs a regex ","exec using the provided regex argument on the string argument. ","Returns an array of results or an empty array, with matched ","text, index, and any capture groups."],"usage":["regex:RegExp","text:string"],"tags":["regex","string","match","exec","array"]
},"remove_prop":{ "name":"remove_prop","fn_args":"(obj key)","usage":["obj:object","key:*"],"description":["=:+","If the provided key exists, removes the key from the provided object, ","and returns the removed value if the key exists, otherwise returned undefined."],"tags":["object","key","value","mutate","delete_prop","remove"]
},"object_methods":{ "name":"object_methods","fn_args":"(obj)","description":"Given a instantiated object, get all methods (functions) that the object and it's prototype chain contains.","usage":["obj:object"],"tags":["object","methods","functions","introspection","keys"]
},"expand_dot_accessor":{ "name":"expand_dot_accessor","fn_args":"(val ctx)","description":"Used for compilation. Expands dotted notation of a.b.0.1 to a[\"b\"][0][1]","usage":["val:string","ctx:object"],"tags":["compiler","system"]
},"getf_ctx":{ "name":"getf_ctx","fn_args":"(ctx name _value)","description":"Used for compilation. Given a context structure, provides a utility function for retrieving a context value based on a provided identifier.","usage":["tree:array","name:string"],"tags":["compiler","system"]
},"setf_ctx":{ "name":"setf_ctx","fn_args":"(ctx name value)","description":"Used for compilation. Given a context structure, provides a utility function for setting a context place with value.","usage":["tree:array","name:string","value:*"],"tags":["compiler","system"]
},"set_path":{ "name":"set_path","fn_args":"(path obj value)","description":["=:+","Given a path value as an array, a tree structure, and a value, ","sets the value within the tree at the path value, potentially overriding any existing value at that path.<br><br>","(defglobal foo [ 0 2 [ { `foo: [ 1 4 3 ] `bar: [ 0 1 2 ] } ] 3 ])<br>","(set_path [ 2 0 `bar 1 ] foo 10) => [ 0 10 2 ]<br>","foo => [ 0 2 [ { foo: [ 1 4 3 ] bar: [ 0 10 2 ] } ] 3 ]"],"tags":["resolve_path","path","set","tree","mutate"],"usage":["path:array","tree:array|object","value:*"]
},"minmax":{ "name":"minmax","fn_args":"(container)","usage":["container:array"],"description":"Given an array of numbers returns an array containing the smallest and the largest values found in the provided array. ","tags":["list","number","range","value"]
},"gen_multiples":{ "name":"gen_multiples","fn_args":"(len multiple?)","description":"Internal compiler use. utility function for return splices.","usage":["tree:array"],"tags":["compiler","system"]
},"path_multiply":{ "name":"path_multiply","fn_args":"(path multiple?)","description":"Internal compiler use. utility function for return splices.","usage":["tree:array"],"tags":["compiler","system"]
},"splice_in_return_a":{ "description":"For use in the compiler.  identifies proper placement of the return keyword in the assembled JS tree.","usage":["tree:array"],"tags":["compiler","system"]
},"splice_in_return_b":{ "name":"splice_in_return_b","fn_args":"(js_tree _ctx _depth)","description":"For use in the compiler.  Based on output of splice_in_return_a, handles placement of the return keyword in the assembled JS tree.","usage":["tree:array"],"tags":["compiler","system"]
},"aif":{ "eval_when":{ "compile_time":true
},"name":"aif","macro":true,"fn_args":"(test_expr eval_when_true eval_when_false)","description":["=:+","Anaphoric If - This macro defines a scope in which the symbol `it is used ","to store the evaluation of the test form or expression.  It is then available ","in the eval_when_true form and, if provided, the eval_when_false expression."],"usage":["test_expression:*","eval_when_true:*","eval_when_false:*?"],"tags":["conditional","logic","anaphoric","if","it"]
},"ifa":{ "eval_when":{ "compile_time":true
},"name":"ifa","macro":true,"fn_args":"(test thenclause elseclause)","description":"Similar to if, the ifa macro is anaphoric in binding, where the it value is defined as the return value of the test form. Use like if, but the it reference is bound within the bodies of the thenclause or elseclause.","usage":["test:*","thenclause:*","elseclause:*"],"tags":["cond","it","if","anaphoric"]
},"map_range":{ "name":"map_range","fn_args":"(n from_range to_range)","usage":["n:number","from_range:array","to_range:array"],"tags":["range","scale","conversion"],"description":["=:+","Given an initial number n, and two numeric ranges, maps n from the first range ","to the second range, returning the value of n as scaled into the second range. "]
},"range_inc":{ "name":"range_inc","fn_args":"(start end step)","description":["=:+","Similar to range, but is end inclusive: [start end] returning an array containing values from start, including end. ","vs. the regular range function that returns [start end).  ","If just 1 argument is provided, the function returns an array starting from 0, up to and including the provided value."],"usage":["start:number","end?:number","step?:number"],"tags":["range","iteration","loop"]
},"color_for_number":{ "name":"color_for_number","fn_args":"(num saturation brightness)","usage":["number:number","saturation:float","brightness:float"],"description":"Given an arbitrary integer, a saturation between 0 and 1 and a brightness between 0 and 1, return an RGB color string","tags":["ui","color","view"]
},"flatten_ctx":{ "name":"flatten_ctx","fn_args":"(ctx _var_table)","description":"Internal usage by the compiler, flattens the hierarchical context structure to a single level. Shadowing rules apply.","usage":["ctx_object:object"],"tags":["system","compiler"]
},"identify_symbols":{ "name":"identify_symbols","fn_args":"(quoted_form _state)"
},"unless":{ "eval_when":{ "compile_time":true
},"name":"unless","macro":true,"fn_args":"(condition \"&\" forms)","description":"opposite of if, if the condition is false then the forms are evaluated","usage":["condition:array","forms:array"],"tags":["if","not","ifnot","logic","conditional"]
},"use_quoted_initializer":{ "eval_when":{ "compile_time":true
},"name":"use_quoted_initializer","macro":true,"fn_args":"(\"&\" forms)","description":" \nuse_quoted_initializer is a macro that preserves the source form in the symbol definition object. \nWhen the environment is saved, any source forms that wish to be preserved through the \nserialization process should be in the body of this macro.  This is a necessity for global \nobjects that hold callable functions, or functions or structures that require initializers,\nsuch as things that connect or use environmental resources.\n","usage":["forms:array"],"tags":["compilation","save_env","export","source","use","compiler","compile"]
},"random_int":{ "name":"random_int","fn_args":"(\"&\" \"args\")","description":"Returns a random integer between 0 and the argument.  If two arguments are provided then returns an integer between the first argument and the second argument.","usage":["arg1:number","arg2?:number"],"tags":["rand","number","integer"]
},"resolve_multi_path":{ "name":"resolve_multi_path","fn_args":"(path obj not_found)","tags":["path","wildcard","tree","structure"],"usage":["path:array","obj:object","not_found:?*"],"description":"Given a list containing a path to a value in a nested array, return the value at the given path. If the value * is in the path, the path value is a wild card if the passed object structure at the path position is a vector or list."
},"symbol_tree":{ "name":"symbol_tree","fn_args":"(quoted_form _state _current_path)","description":"Given a quoted form as input, isolates the symbols of the form in a tree structure so dependencies can be seen.","usage":["quoted_form:quote"],"tags":["structure","development","analysis"]
},"except_nil":{ "name":"except_nil","fn_args":"(\"items\")","description":"Takes the passed list or set and returns a new list that doesn't contain any undefined or nil values.  Unlike no_empties, false values and blank strings will pass through.","usage":["items:list|set"],"tags":["filter","nil","undefined","remove","no_empties"]
},"each":{ "name":"each","fn_args":"(items property)","description":["=:+","Provided a list of items, provide a property name or ","a list of property names to be extracted and returned from the source array as a new list.","If property is an array, and contains values that are arrays, those arrays will be treated as a path."],"usage":["items:list","property:string|list|function|AsyncFunction"],"tags":["pluck","element","only","list","object","property"]
},"replace":{ "name":"replace","fn_args":"(\"&\" args)","description":["=:+","Given at least 3 arguments, finds the first  argument, and replaces with the second argument, operating on the third plus argument.  ","This function will act to replace and find values in strings, arrays and objects.  When replacing values in strings, be aware that ","only the first matching value will be replaced.  To replace ALL values in strings, use a RegExp with the `g flag set, such as ","(new RegExp \"Target String\" `g).  For example, the following replaces all target values in the target string:<br>","(replace (new RegExp \"Indiana\" `g) \"Illinois\" \"The address of the location in Indiana has now been changed to 123 Main Street, Townville, Indiana.\")"],"usage":["target:string|regexp","replacement:string|number","container:string|array|object"],"tags":["replace","find","change","edit","string","array","object"]
},"cl_encode_string":{ "name":"cl_encode_string","fn_args":"(text)"
},"path_to_js_syntax":{ "name":"path_to_js_syntax","fn_args":"(comps)","description":"Used by the compiler, converts an array containing the components of a path to Javascript syntax, which is then returned as a string.","usage":["comps:array"],"tags":["compiler","path","js","javascript"]
},"first_is_upper_case?":{ "name":"first_is_upper_case?","fn_args":"(str_val)","description":"Returns true if the first character of the provided string is an uppercase value in the range [A-Z]. ","tags":["string","case","uppercase","capitalized"]
},"safe_access_2":{ "name":"safe_access_2","fn_args":"(token ctx sanitizer_fn)"
},"safe_access":{ "name":"safe_access","fn_args":"(token ctx sanitizer_fn)"
},"compile_to_js":{ "eval_when":{ "compile_time":true
},"name":"compile_to_js","macro":true,"fn_args":"(quoted_form)","description":["=:+","Given a quoted form, returns an array with two elements, element 0 is the compilation metadata, ","and element 1 is the output Javascript as a string."],"usage":["quoted_form:*"],"tags":["compilation","source","javascript","environment"]
},"evaluate_compiled_source":{ "eval_when":{ "compile_time":true
},"name":"evaluate_compiled_source","macro":true,"fn_args":"(compiled_source)","description":["=:+","The macro evaluate_compiled_source takes the direct output of the compiler, ","which can be captured using the macro compile_to_js, and performs the ","evaluation of the compiled source, thereby handling the second half of the ","compile then evaluate cycle.  This call will return the results of ","the evaluation of the compiled code assembly."],"usage":["compiled_source:array"],"tags":["compilation","compile","eval","pre-compilation"]
},"form_structure":{ "name":"form_structure","fn_args":"(quoted_form max_depth)","description":["=:+","Given a form and an optional max_depth positive number, ","traverses the passed JSON form and produces a nested array structure that contains","the contents of the form classified as either a \"symbol\", \"number\", \"string\", \"boolean\", \"array\", \"object\", or the elem itself. ","The returned structure will mirror the passed structure in form, except with the leaf contents ","being replaced with generalized categorizations."],"tags":["validation","compilation","structure"],"usage":["quoted_form:*","max_depth:?number"]
},"validate_form_structure":{ "name":"validate_form_structure","fn_args":"(validation_rules quoted_form)","description":["=:+","Given a validation rule structure and a quoted form to analyze returns an object with ","two keys, valid and invalid, which are arrays containing the outcome of the rule ","evaluation, a rule_count key containing the total rules passed, and an all_passed key","which will be set to true if all rules passed, otherwise it will fail.","If the rule evaluates successfully, valid is populated with the rule path, ","otherwise the rule path is placed in the invalid array.<br><br>","Rule structure is as follows:<br><code>","[ [path [validation validation ...] \"rule_name\"] [path [validation ...] \"rule_name\"] ]<br>","</code>","where path is an array with the index path and ","validation is a single argument lambda (fn (v) v) that must either ","return true or false. If true, the validation is considered correct, ","false for incorrect.  The result of the rule application will be put in the valid array, ","otherwise the result will be put in invalid."],"tags":["validation","rules","form","structure"],"usage":["validation_rules:array","quoted_form:*"]
},"*compiler_syntax_rules*":{ "initializer":{ "compile_let":[[[0,1,"val"],["=:list","=:is_array?"],"let allocation section"],[[0,2],["=:list",["=:fn",["=:v"],["=:not",["=:==","=:v","=:undefined"]]]],"let missing block"]],"compile_cond":[[[0],["=:list",["=:fn",["=:v"],["=:==",["=:%",["=:length",["=:rest","=:v"]],2],0]]],"cond: odd number of arguments"]],"compile_assignment":[[[0,1],["=:list",["=:fn",["=:v"],["=:not",["=:==","=:v","=:undefined"]]]],"assignment is missing target and values"],[[0,2],["=:list",["=:fn",["=:v"],["=:not",["=:==","=:v","=:undefined"]]]],"assignment is missing value"]]
}
},"compiler_source_chain":{ "name":"compiler_source_chain","fn_args":"(cpath tree sources)"
},"compiler_syntax_validation":{ "name":"compiler_syntax_validation","fn_args":"(validator_key tokens errors ctx tree)"
},"describe_all":{ "name":"describe_all","fn_args":"()","description":"Returns an object with all defined symbols as the keys and their corresponding descriptions.","usage":[],"tags":["env","environment","symbol","symbols","global","globals"]
},"is_value?":{ "name":"is_value?","fn_args":"(val)","description":"Returns true for anything that is not nil or undefined or false.","usage":["val:*"],"tags":["if","value","truthy",false,true]
},"sort":{ "name":"sort","fn_args":"(elems options)","description":["=:+","Given an array of elements, and an optional options object, returns a new sorted array.","With no options provided, the elements are sorted in ascending order.  If the key ","reversed is set to true in options, then the elements are reverse sorted. ","<br>","An optional synchronous function can be provided (defined by the comparitor key) which is expected to take ","two values and return the difference between them as can be used by the sort method of ","JS Array.  Additionally a key value can be provided as either a string (separated by dots) or as an array ","which will be used to bind (destructure) the a and b values to be compared to nested values in the elements ","of the array.","<br>","<br>","Options:<br>","reversed:boolean:if true, the elements are reverse sorted.  Note that if a comparitor function is provided, then ","this key cannot be present, as the comparitor should deal with the sorting order.<br>","key:string|array:A path to the comparison values in the provided elements. If a string, it is provided as period ","separated values.  If it is an array, each component of the array is a successive path value in the element to be ","sorted. <br>","comparitor:function:A synchronous function that is to be provided for comparison of two elements.  It should take ","two arguments, and return the difference between the arguments, either a positive or negative."],"usage":["elements:array","options:object?"],"tags":["array","sorting","order","reverse","comparison","objects"]
},"and*":{ "name":"and*","fn_args":"(\"&\" vals)","description":["=:+","Similar to and, but unlike and, values that ","are \"\" (blank) or NaN are considered to be true.","Uses is_value? to determine if the value should be considered to be true.","Returns true if the given arguments all are considered a value, ","otherwise false.  If no arguments are provided, returns undefined."],"usage":["val0:*","val1:*","val2:*"],"tags":["truth","and","logic","truthy"]
},"or*":{ "name":"or*","fn_args":"(\"&\" vals)","description":["=:+","Similar to or, but unlike or, values that ","are \"\" (blank) or NaN are considered to be true.","Uses is_value? to determine if the value should be considered to be true.","Returns true if the given arguments all are considered a value, ","otherwise false.  If no arguments are provided, returns undefined."],"usage":["val0:*","val1:*","val2:*"],"tags":["truth","or","logic","truthy"]
},"either":{ "name":"either","fn_args":"(\"&\" args)","description":["=:+","Similar to or, but unlike or, returns the first non nil ","or undefined value in the argument list whereas or returns ","the first truthy value."],"usage":["values:*"],"tags":["nil","truthy","logic","or","undefined"]
},"is_symbol?":{ "eval_when":{ "compile_time":true
},"name":"is_symbol?","macro":true,"fn_args":"(symbol_to_find)","usage":["symbol:string|*"],"description":["=:+","If provided a quoted symbol, will return true if the symbol can be found ","in the local or global contexts."],"tags":["context","env","def"]
},"get_function_args":{ "name":"get_function_args","fn_args":"(f)","description":"Given a javascript function, return a list of arg names for that function","usage":["function:function"],"tags":["function","introspect","introspection","arguments"]
},"findpaths":{ "name":"findpaths","fn_args":"(value structure)"
},"warn":{ "description":"Prefixes a warning symbol prior to the arguments to the console.  Otherwise the same as console.log.","usage":["args0:*","argsN:*"],"tags":["log","warning","error","signal","output","notify","defclog"],"initializer":["=:defclog",{ "prefix":"⚠️  "
}]
},"success":{ "description":"Prefixes a green checkmark symbol prior to the arguments to the console.  Otherwise the same as console.log.","usage":["args0:*","argsN:*"],"tags":["log","warning","notify","signal","output","ok","success","defclog"],"initializer":["=:defclog",{ "color":"green","prefix":"✓  "
}]
},"in_background":{ "eval_when":{ "compile_time":true
},"name":"in_background","macro":true,"fn_args":"(\"&\" forms)","description":["=:+","Given a form or forms, evaluates the forms in the background, with ","the function returning true immediately prior to starting the forms."],"usage":["forms:*"],"tags":["eval","background","promise","evaluation"]
},"set_compiler":{ "name":"set_compiler","fn_args":"(compiler_function)","description":["=:+","Given a compiled compiler function, installs the provided function as the ","environment's compiler, and returns the compiler function."],"usage":["compiler_function:function"],"tags":["compilation","environment","compiler"]
},"show":{ "name":"show","fn_args":"(thing)","usage":["thing:function"],"description":"Given a name to a compiled function, returns the source of the compiled function.  Otherwise just returns the passed argument.","tags":["compile","source","javascript","js","display"]
},"export_symbols":{ "eval_when":{ "compile_time":true
},"name":"export_symbols","macro":true,"fn_args":"(\"&\" args)"
},"register_feature":{ "name":"register_feature","fn_args":"(feature)","description":"Adds the provided string to the *env_config* features.  Features are used to mark what functionality is present in the environment.","tags":["environment","modules","libraries","namespaces"],"usage":["feature:string"]
},"uniq":{ "name":"uniq","fn_args":"(values handle_complex_types)","description":["=:+","Given a list of values, returns a new list with unique, deduplicated values. ","If the values list contains complex types such as objects or arrays, set the ","handle_complex_types argument to true so they are handled appropriately. "],"usage":["values:list","handle_complex_types:boolean"],"tags":["list","dedup","duplicates","unique","values"]
},"time_in_millis":{ "eval_when":{ "compile_time":true
},"name":"time_in_millis","macro":true,"fn_args":"()","usage":[],"tags":["time","milliseconds","number","integer","date"],"description":"Returns the current time in milliseconds as an integer"
},"defns":{ "name":"defns","fn_args":"(name options)","usage":["name:string","options:object"],"description":["=:+","Given a name and an optional options object, creates a new namespace ","identified by the name argument.  If the options object is provided, the following keys are available:","<br>","ignore_if_exists:boolean:If set to true, if the namespace is already defined, do not return an error ","and instead just return with the name of the requested namespace. Any other options are ignored and ","the existing namespace isn't altered.","contained:boolean:If set to true, the newly defined namespace will not have visibility to other namespaces ","beyond 'core' and itself.  Any fully qualified symbols that reference other non-core namespaces will ","fail.","serialize_with_image:boolean:If set to false, if the environment is saved, the namespace will not be ","included in the saved image file.  Default is true."],"tags":["namespace","environment","define","scope","context"]
},"use_ns":{ "eval_when":{ "compile_time":true
},"name":"use_ns","macro":true,"fn_args":"(name)","usage":["name:symbol"],"description":"Sets the current namespace to the provided name.  Returns the name of the new namespace if succesful, otherwise an Eval error is thrown","tags":["namespace","environment","scope","change","set"]
},"bind_and_call":{ "name":"bind_and_call","fn_args":"(target_object this_object method \"&\" args)","usage":["target_object:object","this_object:object","method:string","args0:*","argsn:*"],"description":"Binds the provided method of the target object with the this_object context, and then calls the object method with the optional provided arguments.","tags":["bind","object","this","context","call"]
},"save_locally":{ "name":"save_locally","fn_args":"(fname data content_type)","description":["=:+","Provided a filename, a data buffer, and a MIME type, such as \"text/javascript\", ","triggers a browser download of the provided data with the filename.  Depending ","on the browser configuration, the data will be saved to the configured ","user download directory, or prompt the user for a save location. "],"usage":["filename:string","data:*","content_type:string"],"tags":["save","download","browser"]
},"fetch_text":{ "name":"fetch_text","fn_args":"(url)","description":["=:+","Given a url, returns the text content of that url. ","This function is a helper function for the import macro."],"usage":["url:string"],"tags":["fetch","text","string"]
},"import":{ "eval_when":{ "compile_time":true
},"name":"import","macro":true,"fn_args":"(\"&\" args)","description":["=:+","Load the contents of the specified source file (including path) into the Lisp environment ","in the current namespace.<br>","If the file is a Lisp source, it will be evaluated as part of the load and the final result returned.","If the file is a JS source, it will be loaded into the environment and a handle returned.","When importing non-Lisp sources (javascript or typescript), import requires a binding symbol in an array ","as the first argument.<br","The allowed extensions are .lisp, .js, .json, .juno, and if the JS platform is Deno, ",".ts is allowed.  Otherwise an EvalError will be thrown due to a non-handled file type.","Examples:<br>","Lisp/JSON: (import \"tests/compiler_tests.lisp\")<br>","JS/TS: (import (logger) \"https://deno.land/std@0.148.0/log/mod.ts\""],"tags":["compile","read","io","file","get","fetch","load"],"usage":["binding_symbols:array","filename:string"]
},"system_date_format":{ "description":"The system date format structure that is used by the system_date_formatter.If modified, the system_date_formatter, which is a Intl.DateTimeFormat object should be reinitialized by calling (new Intl.DateTimeFormat [] system_date_format).","tags":["time","date","system"]
},"system_date_formatter":{ "initializer":["=:new","=:Intl.DateTimeFormat",[],{ "weekday":"long","year":"numeric","month":"2-digit","day":"2-digit","hour":"numeric","minute":"numeric","second":"numeric","fractionalSecondDigits":3,"hourCycle":"h24","hour12":false,"timeZoneName":"short"
}],"tags":["time","date","system"],"description":"The instantiation of the system_date_format.  See system_date_format for additional information."
},"tzoffset":{ "name":"tzoffset","fn_args":"()","description":"Returns the number of seconds the local timezone is offset from GMT","usage":[],"tags":["time","date","timezone"]
},"date_components":{ "name":"date_components","fn_args":"(date_value date_formatter)","usage":["date_value:Date","date_formatter:DateTimeFormat?"],"description":"Given a date value, returns an object containing a the current time information broken down by time component. Optionally pass a Intl.DateTimeFormat object as a second argument.","tags":["date","time","object","component"]
},"formatted_date":{ "name":"formatted_date","fn_args":"(dval date_formatter)","usage":["dval:Date","date_formatter:DateTimeFormat?"],"description":"Given a date object, return a formatted string in the form of: \"yyyy-MM-d HH:mm:ss\".  Optionally pass a Intl.DateTimeFormat object as a second argument.","tags":["date","format","time","string"]
},"dtext":{ "name":"dtext","fn_args":"(default_text)","usage":["text:string","key:string?"],"description":["=:+","Given a default text string and an optional key, if a key ","exists in the global object *LANGUAGE*, return the text associated with the key. ","If no key is provided, attempts to find the default text as a key in the *LANGUAGE* object. ","If that is a nil entry, returns the default text."],"tags":["text","multi-lingual","language","translation","translate"]
},"nth":{ "name":"nth","fn_args":"(idx collection)","description":["=:+","Based on the index or index list passed as the first argument, ","and a collection as a second argument, return the specified values ","from the collection. If an index value is negative, the value ","retrieved will be at the offset starting from the end of the array, ","i.e. -1 will return the last value in the array."],"tags":["filter","select","pluck","object","list","key","array"],"usage":["idx:string|number|array","collection:list|object"]
},"use_symbols":{ "eval_when":{ "compile_time":true
},"name":"use_symbols","macro":true,"fn_args":"(namespace symbol_list target_namespace)","description":["=:+","Given a namespace and an array of symbols (quoted or unquoted), ","the macro will faciltate the binding of the symbols into the ","current namespace."],"usage":["namespace:string|symbol","symbol_list:array","target_namespace?:string"],"tags":["namespace","binding","import","use","symbols"]
},"use_unique_symbols":{ "name":"use_unique_symbols","fn_args":"(namespace)","description":["=:+","This function binds all symbols unique to the provided ","namespace identifier into the current namespace. Returns ","the amount of symbol bound."],"usage":["namespace:string"],"tags":["namespace","binding","import","use","symbols"]
},"readline_mod":{ "initializer":["=:javascript","undefined"]
},"streams":{ "initializer":["=:javascript","undefined"]
},"repl":{ "name":"repl","fn_args":"(instream outstream opts)","description":["=:+","Implements a Read-Eval-Print for Juno.  This function takes ","an input stream, an output stream, and an optional options object ","and starts up a continuously running loop that waits for input ","and, once a fully closed expression is received, evaluates it ","and returns the result on the output stream.  The options object ","will affect the behavior of the REPL: <br><br>","raw:boolean:false:If raw mode is true, no prompt will be emitted ","into the output stream.<br>","prompt:function|string:the prompt to display when the REPL is ready ","for input.  If no values are given the default prompt is displayed ","which contains the current namespace and an arrow to indicate ","ready for input.<br>","subprompt:function|string::When a form isn't complete, and the user ","has pressed return, the subprompt is displayed until the form is closed.<br>","sigint_message:string:If the SIGINT signal is received, the prompt for the ","REPL to display.<br>","output_processor:function::The function to call when the REPL has received output ","from the evaluation process.  This function can be used to encode or otherwise ","package the return value for consumption by the output stream.<br>","use_console:boolean:false:If true, the output is sent to the console, as opposed ","to the direct output stream. <br>"],"usage":["input:stream","output:stream","options:object"],"tags":["repl","eval","read","output"]
},"set_repl":{ "name":"set_repl","fn_args":"(key value)","description":"Given a configuration key and a value, sets the provided REPL config key to the value.","usage":["key:string","value:*"],"tags":["repl","config"]
},"repl_config":{ "name":"repl_config","fn_args":"()","description":["=:+","Returns the environment configuration options that are ","available for the repl and their current settings."],"tags":["repl","config"],"usage":[]
},"if_undefined":{ "eval_when":{ "compile_time":true
},"name":"if_undefined","macro":true,"fn_args":"(value replacer)","description":"If the first value is undefined, return the second value","usage":["value:*","replacer:*"]
},"str":{ "name":"str","fn_args":"(\"&\" \"args\")","description":"Joins arguments into a single string separated by spaces and returns a single string.","usage":["arg0:string","argn:string"],"tags":["string","join","text"]
},"on_nil":{ "eval_when":{ "compile_time":true
},"name":"on_nil","macro":true,"fn_args":"(nil_form value)","usage":["nil_form:form","value:*"],"description":"If the value argument is not nil or not undefined, return the value, otherwise evaluate the provided nil_form and return the results of the evaluation of the nil_form.","tags":["condition","nil","eval","undefined"]
},"on_empty":{ "eval_when":{ "compile_time":true
},"name":"on_empty","macro":true,"fn_args":"(on_empty_form value)","usage":["empty_form:form","value:*"],"description":"If the value argument is not an empty array, an empty object, nil or undefined, return the value, otherwise evaluate the provided empty_form and return the results of the evaluation of the empty_form.","tags":["condition","empty","list","array","object","eval","undefined"]
},"sum":{ "eval_when":{ "compile_time":true
},"name":"sum","macro":true,"fn_args":"(vals)","description":["=:+","Given an array of values, add up the contents of the array in an applied add operation.  ","If these are numbers, they will be added arithmetically.  ","If given strings, they will be joined together (appended). ","If given a first value of an array, all subsequent values will be added into the array. ","If given an array of objects, all the keys/values will be merged and a single object retuned."],"usage":["vals:array"],"tags":["add","join","summation","numbers"]
},"options_and_args":{ "name":"options_and_args","fn_args":"(arg_array)","usage":["arg_array:array"],"tags":["arguments","options"],"description":["=:+","Given an array of values, returns an array containing two values.  ","If the value at position 0 in the provided array is an non nil object, ","it will be in the position 0 of the returned value and the remaining ","values will be in position 1 of the returned array.","If the value at position 0 in the provided array is not an object type,","the value in position 0 of the returned array will be nil and ","all values will be placed in the returned array in position 1."]
},"enum":{ "name":"enum","fn_args":"(value_list)","usage":["value_list:array"],"description":"Given a list of string values, returns an object with each value in the list corresponding to a numerical value.","tags":["enumeration","values"]
},"gen_id":{ "name":"gen_id","fn_args":"(prefix)","usage":["prefix:string"],"tags":["web","html","identification"],"description":"Given a prefix returns a element safe unique id"
},"macros":{ "name":"macros","fn_args":"()","usage":[],"description":"Returns the list of currently defined macros.  This function takes no arguments.","tags":["environment","macro","defined"]
},"pluck":{ "eval_when":{ "compile_time":true
},"name":"pluck","macro":true,"fn_args":"(fields data)","description":"Similar to the 'each' commmand, given the set of desired fields as a first argument, and the data as the second argument, return only the specified fields from the supplied list of data","usage":["fields:string|array","data:array"],"tags":["list","each","filter","only","object"]
},"objects_from_list":{ "name":"objects_from_list","fn_args":"(key_path objects)","usage":["key_path:string|array","objects:array"],"description":"Given a path (string or array), and an array of object values, the function returns a new object with keys named via the value at the given path, and the object as the value.","tags":["list","object","conversion","transform"]
},"pairs_from_list":{ "name":"pairs_from_list","fn_args":"(value_list size)","usage":["value:list","size?:number"],"description":"Given a list, segment the passed list into sub list (default in pairs) or as otherwise specified in the optional size","tags":["list","pairs","collect"]
},"reorder_keys":{ "name":"reorder_keys","fn_args":"(key_list obj)","description":"Given a list of keys, returns a new object that has the keys in the order of the provided key list.","usage":["key_list:array","obj:object"],"tags":["list","object","key","order"]
},"only":{ "name":"only","fn_args":"(fields data)","usage":["fields:array","data:array|object"],"description":"Given an array of objects, or a single object, return objects only containing the specified keys and the corresponging value.","tags":["pluck","filter","select","object","each","list","objects","keys"]
},"sleep":{ "name":"sleep","fn_args":"(seconds)","usage":["seconds:number"],"tags":["time","timing","pause","control"],"description":"Pauses execution for the number of seconds provided to the function."
},"from_universal_time":{ "name":"from_universal_time","fn_args":"(seconds)","description":"Given a universal_time_value (i.e. seconds from Jan 1 1900) returns a Date object.","usage":["seconds:number"],"tags":["date","time","universal","1900"]
},"+=":{ "eval_when":{ "compile_time":true
},"name":"+=","macro":true,"fn_args":"(symbol \"&\" args)","usage":["symbol:*","arg0:*","argn?:*"],"description":"Appends in place the arguments to the symbol, adding the values of the arguments to the end.","tags":["append","mutate","text","add","number"]
},"minmax_index":{ "name":"minmax_index","fn_args":"(container)","usage":["container:array"],"description":"Given an array of numbers returns an array containing the indexes of the smallest and the largest values found in the provided array.","tags":["list","number","range","value","index"]
},"invert_pairs":{ "name":"invert_pairs","fn_args":"(value)","description":"Given an array value containing pairs of value, as in [[1 2] [3 4]], invert the positions to be: [[2 1] [4 3]]","usage":["value:array"],"tags":["array","list","invert","flip","reverse","swap"]
},"noop":{ "name":"noop","fn_args":"(val)","usage":["val:*"],"description":"No operation, just returns the value.  To be used as a placeholder operation, such as in apply_operator_list.","tags":["apply","value"]
},"apply_list_to_list":{ "name":"apply_list_to_list","fn_args":"(operator list1 list2)","usage":["operator:function","modifier_list:array","target_list:array"],"description":["=:+","Given an operator (function), a list of values to be applied (modifier list), and a list of source values (the target), ","returns a new list (array) that contains the result of calling the operator function with ","each value from the target list with the values from the modifier list. The operator function is called ","with <code>(operator source_value modifer_value)</code>."],"tags":["map","list","array","apply","range","index"]
},"apply_operator_list":{ "name":"apply_operator_list","fn_args":"(modifier_list target_list)","usage":["operator_list:array","target_list:array"],"description":["=:+","<p>Note: Deprecated.Given a list containing quoted functions (modifier list), and a list of source values (the target), ","returns a new list (array) that contains the result of calling the relative index of the modifier functions with ","the value from the relative index from the target list. The modifiers are applied in the following form: ","<code>(modifier_function target_value)</code>.</p>","<p>If the modifer_list is shorter than the target list, the modifer_list index cycles back to 0 (modulus).</p>"],"tags":["map","list","array","apply","range","index"],"example":["=:quote",["=:apply_operator_list",["first","+"],["John","Smith"]]],"deprecated":true
},"range_overlap?":{ "name":"range_overlap?","fn_args":"(range_a range_b)","description":"Given two ranges in the form of [low_val high_val], returns true if they overlap, otherwise false.  The results are undefined if the range values are not ordered from low to high.","usage":["range_a:array","range_b:array"],"tags":["range","iteration","loop"]
},"remaining_in_range":{ "name":"remaining_in_range","fn_args":"(value check_range)","usage":["value:number","check_range:array"],"description":"Given a value, and an array containing a start and end value, returns the remaining amount of positions in the given range.  If the value isn't in range, the function will return nil.","tags":["range","iteration","loop"]
},"form_id":{ "name":"form_id","fn_args":"(name)","usage":["name:string"],"description":"Given a standard string returns a compliant HTML ID suitable for forms."
},"from_key":{ "name":"from_key","fn_args":"(value sep? ignore?)","usage":["value:string","separator?:string"],"description":["=:+","Takes a key formatted value such as \"last_name\" and returns a \"prettier\" string that contains spaces ","in place of the default separator, '_' and each word's first letter is capitalized. ","An optional separator argument can be provided to use an alternative separator token.<br>E.G. last_name becomes \"Last Name\"."],"tags":["string","split","key","hash","record","form","ui"]
},"from_key1":{ "name":"from_key1","fn_args":"(v)","description":"Useful for calling with map, since this function prevents the other values being passed as arguments by map from being passed to the from_key function.","tags":["map","function","key","pretty","ui","to_key"],"usage":["value:string"]
},"to_key":{ "name":"to_key","fn_args":"(value sep? ignore?)","usage":["value:string","separator?:string"],"description":["=:+","Takes a value such as \"Last Name\" and returns a string that has the spaces removed and the characters replaced ","by the default separator, '_'.  Each word is converted to lowercase characters as well.","An optional separator argument can be provided to use an alternative separator token.<br>E.G. \"Last Name\" becomes \"last_name\"."],"tags":["string","split","key","hash","record","form","ui"]
},"extend":{ "name":"extend","fn_args":"(target_object source_object)","description":"Given a target object and a source object, add the keys and values of the source object to the target object.","usage":["target_object:object","source_object:object"],"tags":["object","extension","keys","add","values"]
},"no_empties":{ "name":"no_empties","fn_args":"(\"items\")","description":"Takes the passed list or set and returns a new list that doesn't contain any undefined, nil or empty values","usage":["items:list|set"],"tags":["filter","nil","undefined","remove","except_nil"]
},"first_with":{ "name":"first_with","fn_args":"(prop_list data_value)","usage":["property_list:array","data:object|array"],"description":"Given a list of properties or indexes and a data value, sequentially looks through the property list and returns the first non-null result.","tags":["list","array","index","properties","search","find"]
},"fixed":{ "name":"fixed","fn_args":"(v p)","description":"Given a floating point value and an optional precision value, return a string corresponding to the desired precision.  If precision is left out, defaults to 3.","usage":["value:number","precision?:number"],"tags":["format","conversion"]
},"hide":{ "name":"hide","fn_args":"(value)"
},"array_to_object":{ "name":"array_to_object","fn_args":"(input_array)","usage":["list_to_process:array"],"tags":["list","array","object","convert"],"description":"Takes the provided list and returns an object with the even indexed items as keys and odd indexed items as values."
},"split_text_in_array":{ "name":"split_text_in_array","fn_args":"(split_element input_array)","usage":["split_element:text","input_array:array"],"tags":["text","string","split","separate","parse"],"description":"Takes the provided array, and split_element, and returns an array of arrays which contain the split text strings of the input list."
},"words_and_quotes":{ "name":"words_and_quotes","fn_args":"(text)","description":"Given a text string, separates the words and quoted words, returning quoted words as their isolated string.","tags":["text","string","split","separate","parse"],"usage":["text:string"]
},"split_words":{ "name":"split_words","fn_args":"(text_string)","description":"Like words and quotes, splits the text string into words and quoted words, but the unquoted words are split by spaces.  Both the unquoted words and the quoted words inhabit their own array.","usage":["text:string"],"tags":["text","string","split","separate","words","parse"]
},"from_style_text":{ "name":"from_style_text","fn_args":"(text)","usage":["text:string"],"description":"Given a string or text in the format of an Element style attribute: \"css_attrib:value; css_attrib2:value\", split into pairs containing attribute name and value.","tags":["text","css","style","pairs","string","array","list","ui","html"]
},"remove_if":{ "name":"remove_if","fn_args":"(f container)","usage":["f:function","container:array"],"tags":["collections","reduce","filter","where","list","array","reduce"],"description":"Given a function with a single argument, if that function returns true, the value will excluded from the returned array.  Opposite of filter."
},"filter":{ "name":"filter","fn_args":"(f container)","usage":["f:function","container:array"],"tags":["collections","reduce","reject","where","list","array","reduce"],"description":"Given a function with a single argument, if that function returns true, the value will included in the returned array, otherwise it will not.  Opposite of reject."
},"add_days":{ "name":"add_days","fn_args":"(date_obj num_days)","usage":["date_obj:Date","num_days:number"],"description":"Given a date object and the number of days (either positive or negative) modifies the given date object to the appropriate date value, and returns the date object.","tags":["date","time","duration","days","add"]
},"day_of_week":{ "name":"day_of_week","fn_args":"(dval)","description":"Given a date object, returns the day of the week for that date object","usage":["date:Date"],"tags":["time","week","date","day"]
},"add_hours":{ "name":"add_hours","fn_args":"(date_obj hours)","usage":["date_obj:Date","hours:number"],"description":"Given a date object and the number of hours (either positive or negative) modifies the given date object to the appropriate date value, and returns the date object.","tags":["date","time","duration","hours","add"]
},"clear_time":{ "name":"clear_time","fn_args":"(date_obj)","usage":["date_obj:Date"],"description":"Given a date object, modifies the date object by clearing the time value and leaving the date value.  Returns the date object.","tags":["date","time","duration","midnight","add"]
},"yesterday":{ "name":"yesterday","fn_args":"()","description":"This function returns an array with two Date values.  The first, in index 0, is the start of the prior day (yesterday midnight), and the second is 24 hours later, i.e. midnight from last night.","usage":[],"tags":["time","date","range","prior","hours","24"]
},"next_sunday":{ "name":"next_sunday","fn_args":"(dval)","usage":["date:Date?"],"description":"Called with no arguments returns a date representing the upcoming sunday at midnight, 12:00 AM.  If given a date, returns the next sunday from the given date.","tags":["time","date","range","next","week","24"]
},"last_sunday":{ "name":"last_sunday","fn_args":"(dval)","usage":["date:Date?"],"description":"Called with no arguments returns a date representing the prior sunday at midnight, 12:00 AM.  If given a date, returns the prior sunday from the given date.","tags":["time","date","range","prior","week","24"]
},"day_before_yesterday":{ "name":"day_before_yesterday","fn_args":"()","description":"This function returns an array with two Date values.  The first, in index 0, is the start of the day before yesterday (midnight), and the second is 24 later.","usage":[],"tags":["time","date","range","prior","hours","24"]
},"last_week":{ "name":"last_week","fn_args":"()","description":"This function returns an array with two Date values.  The first, in index 0, is the start of the prior week at midnight, and the second is 7 days later, at midnight.","usage":[],"tags":["time","date","range","prior","hours","24"]
},"midnight-to-midnight":{ "name":"midnight-to-midnight","fn_args":"(dval)","description":"This function returns an array with two Date values.  The first, in index 0, is the start of the prior day (yesterday midnight), and the second is 24 hours later, i.e. midnight from last night.","usage":["val:Date"],"tags":["time","date","range","prior","hours","24"]
},"date_to_string":{ "name":"date_to_string","fn_args":"(date_val str_layout)","description":["=:+","Given a date value and a formatted template string, return a string representation of the date based on the formatted template string.","<br>","E.g. (date_to_string (new Date) \"yyyy-MM-dd HH:mm:ss\")<br>","<table>","<tr><td>","yyyy","</td><td>","Four position formatted year, e.g. 2021","</td></tr>","<tr><td>","yy","</td><td>","Two position formatted year, e.g. 21","</td></tr>","<tr><td>","dd","</td><td>","Two position formatted day of month, e.g. 03","</td></tr>","<tr><td>","d","</td><td>","1 position numeric day of month, e.g. 3","</td></tr>","<tr><td>","MM","</td><td>","Two position formatted month number, e.g. 06","</td></tr>","<tr><td>","M","</td><td>","One or two position formatted month number, e.g. 6 or 10","</td></tr>","<tr><td>","HH","</td><td>","Two position formatted 24 hour number, e.g. 08","</td></tr>","<tr><td>","H","</td><td>","One position formatted 24 hour, e.g 8","</td></tr>","<tr><td>","hh","</td><td>","Two position formatted 12 hour clock, e.g. 08","</td></tr>","<tr><td>","h","</td><td>","One position formatted 12 hour clock, e.g 8","</td></tr>","<tr><td>","mm","</td><td>","Minutes with 2 position width, eg. 05","</td></tr>","<tr><td>","m","</td><td>","Minutes with 1 or 2 positions, e.g 5 or 15.","</td></tr>","<tr><td>","ss","</td><td>","Seconds with 2 positions, e.g 03 or 25.","</td></tr>","<tr><td>","s","</td><td>","Seconds with 1 or 2 positions, e.g 3 or 25.","</td></tr>","<tr><td>","sss","</td><td>","Milliseconds with 3 digits, such as 092 or 562.","</td></tr>","<tr><td>","TZ","</td><td>","Include timezone abbreviated, e.g. GMT+1.","</td></tr>","<tr><td>","D","</td><td>","Weekday abbreviated to 1 position, such as T for Tuesday or Thursday, or W for Wednesday (in certain locales)","</td></tr>","<tr><td>","DD","</td><td>","Weekday shortened to 3 positions, such as Fri for Friday.","</td></tr>","<tr><td>","DDD","</td><td>","Full name of weekday, such as Saturday.","</td></tr>","</table>"],"usage":["date_val:Date","formatted_string:string"],"tags":["time","date","string","text","format","formatted"]
},"is_even?":{ "name":"is_even?","fn_args":"(x)","usage":["value:number"],"description":"If the argument passed is an even number, return true, else returns false.","tags":["list","filter","modulus","odd","number"]
},"is_odd?":{ "name":"is_odd?","fn_args":"(x)","usage":["value:number"],"description":"If the argument passed is an odd number, return true, else returns false.","tags":["list","filter","modulus","even","number"]
},"set_path_value":{ "name":"set_path_value","fn_args":"(root path value)","description":"Given an object (the root), a path array, and a value to set, sets the value at the path point in the root object.","usage":["root:object","path:list","value:*"],"tags":["object","path","resolve","assign"]
},"has_items?":{ "name":"has_items?","fn_args":"(value)","usage":["value:list"],"description":"Returns true if the list provided has a length greater than one, or false if the list is 0 or nil","tags":["list","values","contains"]
},"match_all":{ "name":"match_all","fn_args":"(regex_str search_string)","usage":["regex_str:string","search_string:string"],"description":"Given a regex expression as a string, and the string to search through, returns all matched items via matchAll.","tags":["match","regex","string","find","scan"]
},"chop_front":{ "name":"chop_front","fn_args":"(container amount)","usage":["container:array|string","amount:integer"],"mutates":false,"tags":["text","string","list","reduce"],"description":"Given a string or array, returns a new container with the first value removed from the provided container.  An optional amount can be provided to remove more than one value from the container."
},"compile_lisp":{ "name":"compile_lisp","fn_args":"(text)","usage":["text:string"],"description":"Given an input string of lisp text, returns a JSON structure ready for evaluation."
},"has_the_keys?":{ "name":"has_the_keys?","fn_args":"(key_list obj)","usage":["key_list:list","object_to_check:object"],"description":"Given a provided key_list, validate that each listed key or dotted-path-notation value exist in the object.","example":[[["=:quotem",["=:has_the_keys?",["type","values.sub_transaction_id"],{ "type":"Transaction","group":"Receivables","values":{ "sub_transaction_id":1242424
}
}]],true]]
},"demarked_number":{ "name":"demarked_number","fn_args":"(value separator precision no_show_sign)","usage":["value:number","separator:string","precision:number","no_show_sign:boolean"],"description":["=:+","Given a numeric value, a separator string, such as \",\" and a precision value ","for the fractional-part or mantissa of the value, the demarked_number function will return a string with a formatted value. ","Default value for precision is 2 if not provided.","If no_show_sign is true, there will be no negative sign returned, which can be useful for alternative formatting.  See compile_format."],"tags":["format","conversion","currency"]
},"measure_time":{ "eval_when":{ "compile_time":true
},"name":"measure_time","macro":true,"fn_args":"(\"&\" forms)","usage":["form:list"],"tags":["time","measurement","debug","timing"],"description":"Given a form as input, returns an object containing time taken to evaluate the form in milliseconds with the key time and a result key with the evaluation results."
},"compare_list_ends":{ "name":"compare_list_ends","fn_args":"(l1 l2)","usage":["array1:array","array2:array"],"tags":["comparision","values","list","array"],"description":"Compares the ends of the provided flat arrays, where the shortest list must match completely the tail end of the longer list. Returns true if the comparison matches, false if they don't."
},"hsv_to_rgb":{ "usage":["hsv_values:array"],"description":"Takes an array with three values corresponding to hue, saturation and brightness. Each value should be between 0 and 1.  The function returns an array with three values corresponding to red, green and blue.","tags":["colors","graphics","rgb","conversion"]
},"rgb_to_text":{ "name":"rgb_to_text","fn_args":"(rgb)","usage":["rgb_values:array"],"description":["=:+","Given an array with 3 values ranging from 0 to 1, corresponding to the \"red\",\"green\",\"blue\" values of the described color, ","the function returns a string in the form of FFFFFF."],"tags":["colors","graphics"]
},"text_to_rgb":{ "name":"text_to_rgb","fn_args":"(rgb_string)","usage":["rgb_string:string"],"description":"Given an RGB hex color string in the form of \"FFFFFF\", returns an array containing [ red green blue ] in the set [ 0 1 ].","tags":["colors","graphics"]
},"rgb_to_hsv":{ "name":"rgb_to_hsv","fn_args":"(rgb)","description":["=:+","Takes an array with three values corresponding to red, green and blue: [red green blue].","Each value should be between 0 and 1 (i.e the set [0 1]) ","The function returns an array with three values corresponding to [hue saturation value] in the set [0 1]."],"usage":["rgb_values:array"],"tags":["colors","graphics","rgb","conversion","hsv"]
},"tint_rgb":{ "name":"tint_rgb","fn_args":"(rgb tint_factor)","description":["=:+","Given an array containing three values between 0 and 1 corresponding to red, ","green and blue, apply the provided tint factor to the color and return the result as an rgb array.","The provided tint factor should be in the range 0 (for no tint) to 1 (full tint)."],"usage":["rgb_value:array","tint_factor:number"],"tags":["colors","graphics"]
},"shade_rgb":{ "name":"shade_rgb","fn_args":"(rgb shade_factor)","description":["=:+","Given an array containing three values between 0 and 1 corresponding to red, ","green and blue, apply the provided tint factor to the color and return the result as an rgb array.","The provided tint factor should be in the range 0 (for no tint) to 1 (full tint)."],"usage":["rgb_value:array","tint_factor:number"],"tags":["colors","graphics"]
},"modify_color_ts":{ "name":"modify_color_ts","fn_args":"(rgb factor)","description":["=:+","Given an array containing three values between 0 and 1 corresponding to red, ","green and blue, apply the provided factor to the color and return the result as an rgb array.","The provided factor should be in the range -1 to 1: -1 to 0 applies shade to the color and 0 to 1 applies tinting to the color."],"usage":["rgb_value:array","tint_factor:number"],"tags":["colors","graphics"]
},"is_lower?":{ "name":"is_lower?","fn_args":"(v)","usage":["value:string"],"description":"Given a string as an argument, returns true if the first character of the string is a lowercase character value (ASCII), and false otherwise.","tags":["text","string","lowercase","uppercase"]
},"is_upper?":{ "name":"is_upper?","fn_args":"(v)","usage":["value:string"],"description":"Given a string as an argument, returns true if the first character of the string is an uppercase character value (ASCII), and false otherwise.","tags":["text","string","lowercase","uppercase"]
},"camel_case_to_lower":{ "name":"camel_case_to_lower","fn_args":"(val)","usage":[],"description":"Given a camel case string such as camelCase, returns the equivalent lowercase/underscore: camel_case.","tags":["text","string","conversion","lowercase","uppercase"]
},"scan_list":{ "name":"scan_list","fn_args":"(regex container)","description":["=:+","Scans a list for the provided regex expression and returns the indexes in the list where it is found.  ","The provided regex expression can be a plain string or a RegExp object."],"usage":["regex:string","container:list"],"tags":["search","index","list","regex","array","string"]
},"gather_up_prop":{ "name":"gather_up_prop","fn_args":"(key values)","usage":["key:string","values:array|object"],"description":"Given a key and an object or array of objects, return all the values associated with the provided key.","tags":["key","property","objects","iteration"]
},"sum_up_prop":{ "name":"sum_up_prop","fn_args":"(key values)","usage":["key:string","values:array|object"],"description":"Given a key and an object or array of objects, return the total sum amount of the given key.","tags":["sum","key","property","objects","iteration"]
},"scan_for":{ "name":"scan_for","fn_args":"(non_nil_prop list_of_objects)","description":"Given a property name and a list of objects, find the first object with the non-nil property value specified by non_nil_prop. Returns the value of the non-nil property.","usage":["non_nil_prop:string","list_of_objects:array"],"tags":["find","scan","object","list","array","value"]
},"make_sort_buckets":{ "name":"make_sort_buckets","fn_args":"()","usage":[],"description":["=:+","Called with no arguments, this function returns a function that when called with a ","category and a value, will store that value under the category name in an array, ","which acts as an accumulator of items for that category.  In this mode, the function ","returns the passed item to be stored.<br><br>","When the returned function is called with no arguments, the function returns the ","object containing all passed categories as its keys, with the values being the accumulated","items passed in previous calls."],"tags":["objects","accumulator","values","sorting","categorize","categorization","buckets"]
},"truncate":{ "name":"truncate","fn_args":"(len value trailer)","description":["=:+","Given a length and a string or an array, return the value ","with a length no more than then the provided value. If ","the value is a string an optional trailer string can be ","provided that will be appeneded to the truncated string."],"usage":["len:number","value:array|string","trailer:string?"],"tags":["array","string","length","max","min"]
},"parse_csv":{ "name":"parse_csv","fn_args":"(csv_data options)","description":["=:+","Given a text file of CSV data and an optional options value, parse and return a JSON structure of the CSV data as nested arrays.","<br>","Options can contain the following values:<br>","<table><tr><td>separator</td><td>A text value for the separator to use.  ","The default is a comma.</td></tr><tr><td>interruptions</td><td>If set to true, ","will pause regularly during processing for 1/10th of a second to allow other event queue activities to occur.</td>","</tr><tr><td>notifier</td><td>If interruptions is true, notifier will be triggered with ","the progress of work as a percentage of completion (0 - 1), the current count and the total rows.</td></tr></table>"],"usage":["csv_data:string","options:object?"],"tags":["parse","list","values","table","tabular","csv"]
},"to_csv":{ "name":"to_csv","fn_args":"(\"rows\" delimiter)","description":["=:+","Given a list of rows, which are expected to be lists themselves, ","join the contents of the rows together via , and then join the rows ","together into a csv buffer using a newline, then returned as a string."],"usage":["rows:list","delimiter:string"],"tags":["csv","values","report","comma","serialize","list"]
},"squeeze":{ "name":"squeeze","fn_args":"(s)","usage":["string_value:string"],"description":"Returns a string that has all spaces removed from the supplied string value.","tags":["text","space","trim","remove"]
},"ensure_keys":{ "name":"ensure_keys","fn_args":"(keylist obj default_value)","description":["=:+","Given a list of key values, an object (or nil) and an optional default value to be ","assigned each key, ensures that the object returned has the specified keys (if not already set) set to either ","the specified default value, or nil."],"usage":["keylist","obj:object","default_value:*?"],"tags":["object","keys","values","required","key"]
},"show_time_in_words":{ "description":"Given an integer value representing seconds of a time duration, return a string representing the time in words, such as 2 mins.  If the key longForm is set to true in options return full words instead of contracted forms.  For example min vs. minute.","usage":["seconds:integer","options:object"],"tags":["time","date","format","string","elapsed"]
},"ago":{ "name":"ago","fn_args":"(dval)","usage":["dval:Date"],"description":"Given a date object, return a formatted string in English with the amount of time elapsed from the provided date.","tags":["date","format","time","string","elapsed"]
},"lifespan":{ "name":"lifespan","fn_args":"(dval)","usage":["dval:Date"],"description":"Given a date object, return a formatted string in English with the amount of time until the specified date.","tags":["date","format","time","string","elapsed"]
},"path":{ "initializer":["=:javascript","undefined"]
},"read_text_file":{ "description":"Given an accessible filename including path with read permissions returns the file contents as a string.","usage":["filename:string","options:object"],"tags":["file","read","text","input","io"],"initializer":["=:bind","=:Deno.readTextFile","=:Deno"]
},"write_text_file":{ "description":"Given a string path to a filename, an argument containing the string of text to be written, and an optional options argument write the file to the filesystem.<br><br>.The WriteFileOptions corresponds to the Deno WriteFileOptions interface","usage":["filepath:string","textdata:string","options:WriteFileOptions"],"tags":["file","write","io","text","string"],"initializer":["=:bind","=:Deno.writeTextFile","=:Deno"]
},"load":{ "name":"load","fn_args":"(filename)","description":["=:+","Compile and load the contents of the specified lisp filename (including path) into the Lisp environment. ","The file contents are expected to be Lisp source code in text format."],"tags":["compile","read","io","file"],"usage":["filename:string"]
},"with_fs_events":{ "eval_when":{ "compile_time":true
},"name":"with_fs_events","macro":true,"fn_args":"((event_binding location) body)","description":["=:+","This function sets up a watcher scope for events on a filesystem. ","The symbol passed to the event_binding is bound to new events that occur ","at the provided location.  Once an event occurs, the body forms are executed."],"usage":["event_binding:symbol","location:string","body:array"],"tags":["file","filesystem","events","io","watch"]
},"compile_buffer":{ "name":"compile_buffer","fn_args":"(input_buffer export_function_name options)","description":["=:+","Given an input lisp file, and an optional initalizer function name and options ","object, compile the lisp file into a javascript file. The options object will ","allow the specification of an output path and filename, given by the key ","output_file.  If the initializer function isn't specified it is named ","initializer, which when used with load, will be automatically called ","one the file is loaded.  Otherwise the initializer function should be ","called when after dynamically importing, using dynamic_import. If the ","options object is to be used, with a default initializer, nil should be ","used as a placeholder for the initializer_function name.<br><br>","Options are as follows:<br><br>","js_headers: array: If provided, this is an array of strings that represent","lines to be inserted at the top of the file.","include_source: boolean: If provided will append the block forms and ","expressions within the text as comments.","output_file: string: If provided the path and filename of the compiled ","javascript file to be produced.","include_boilerplate: boolean: If set to false explicity, the boilerplate","code will be not be included in the build.","<br><br>","NOTE: this function's API is unstable and subject to change due to ","the early phase of this language."],"usage":["input_file:string","initializer_function:string?","options:object?"],"tags":["compile","environment","building","javascript","lisp","file","export"]
},"compile_file":{ "name":"compile_file","fn_args":"(lisp_file export_function_name options)"
},"rebuild_env":{ "name":"rebuild_env","fn_args":"(opts)","description":["=:+","Builds the lisp environment from the Lisp sources and produces the Javascript output files ","necessary for initializing the environment. Options: <br>","source_dir:string:The directory of the Lisp sources, the default is './src'.<br>","output_dir:string:The directory to where the output Javascript files are placed.  The default is './js'.<br>","include_source:boolean:If true, the compiler will include comments of the lisp source (not fully supported yet).<br>","version_tag:string:A string based label signifying the text to use as the version.  If not specified, the version ","tag uses the format year.month.day.hour.minute.<br>"],"usage":["options:object?"],"tags":["compile","export","build","environment","javascript"]
},"*system_initializer*":{ "name":"core/*system_initializer*","fn_args":"()"
}
} 
})(),declarations:{
    safety:{
        level:2
    }
},config:{
    export:{
        save_path:"js/juno.js",default_namespace:"user",include_source:false
    },features:["compiler","repl","core-ext","html","build-tools","browser"],build:"2022.09.05.07.37",imports:new Object(),repl:new Object()
},imports:new Object(),symbols:await ( async function(){let __obj__1=new Object();__obj__1["MAX_SAFE_INTEGER"]=9007199254740991;__obj__1["LispSyntaxError"]=LispSyntaxError;__obj__1["sub_type"]=subtype;__obj__1["__VERBOSITY__"]=0;__obj__1["int"]=parseInt;__obj__1["float"]=parseFloat;__obj__1["values"]=function anonymous(...args
) {
{
                                let acc = [];
                                for (let _i in args) {
                                    let value = args[_i];
                                    let type = subtype(value);
                                    if (value instanceof Set)  {
                                        acc = acc.concat(Array.from(value));
                                    } else if (type==='array') {
                                        acc = acc.concat(value);
                                    } else if (type==='object') {
                                        acc = acc.concat(Object.values(value))
                                    } else {
                                        acc = acc.concat(value);
                                    }
                                }
                                return acc;
                            }
};__obj__1["pairs"]=function anonymous(obj
) {
{
                                    if (subtype(obj)==='array') {
                                        let rval = [];
                                        for (let i = 0; i < obj.length; i+=2) {
                                            rval.push([obj[i],obj[i+1]]);
                                        }
                                        return rval;
                                    } else {
                                        let keys = Object.keys(obj);
                                        let rval = keys.reduce(function(acc,x,i) {
                                            acc.push([x,obj[x]])
                                            return acc;
                                        },[]);
                                        return rval;
                                    }
                                }
};__obj__1["keys"]=function anonymous(obj
) {
{  return Object.keys(obj);  }
};__obj__1["take"]=function anonymous(place
) {
{ return place.shift() }
};__obj__1["prepend"]=function anonymous(place,thing
) {
{ return place.unshift(thing) }
};__obj__1["first"]=function anonymous(x
) {
{ return x[0] }
};__obj__1["last"]=function anonymous(x
) {
{ return x[x.length - 1] }
};__obj__1["length"]=function anonymous(obj
) {
{
                                if(obj instanceof Array) {
                                    return obj.length;
                                } else if (obj instanceof Set) {
                                    return obj.size;
                                } else if ((obj === undefined)||(obj===null)) {
                                    return 0;
                                } else if (typeof obj==='object') {
                                    return Object.keys(obj).length;
                                } else if (typeof obj==='string') {
                                    return obj.length;
                                } 
                                return 0;
                            }
};__obj__1["conj"]=function anonymous(...args
) {
{   let list = [];
                                if (args[0] instanceof Array) {
                                    list = args[0];
                                } else {
                                    list = [args[0]];
                                }
                                args.slice(1).map(function(x) {
                                    list = list.concat(x);
                                });
                                return list;
                            }
};__obj__1["reverse"]=function anonymous(container
) {
{ return container.slice(0).reverse }
};__obj__1["map"]=async function anonymous(lambda,array_values
) {
{ try {
                                        let rval = [],
                                                tl = array_values.length;
                                        for (let i = 0; i < array_values.length; i++) {
                                            rval.push(await lambda.apply(this,[array_values[i], i, tl]));
                                         }
                                        return rval;
                                    } catch (ex) {           
                                              if (lambda === undefined || lambda === null) {
                                                    throw new ReferenceError("map: lambda argument (position 0) is undefined or nil")
                                              } else if (array_values === undefined || array_values === null) {
                                                    throw new ReferenceError("map: container argument (position 1) is undefined or nil")
                                              } else if (!(lambda instanceof Function)) {
                                                    throw new ReferenceError("map: lambda argument must be a function: received: "+ typeof lambda)
                                              } else if (!(array_values instanceof Array)) {
                                                    throw new ReferenceError("map: invalid array argument, received: " + typeof array_values)
                                              } else {
                                                    // something else just pass on the error
                                                throw ex;
                                              }
                                    }
                              }
};__obj__1["bind"]=function anonymous(func,this_arg
) {
{ return func.bind(this_arg) }
};__obj__1["to_object"]=function anonymous(array_values
) {
{
                                      let obj={}
                                      array_values.forEach((pair)=>{
                                             obj[pair[0]]=pair[1]
                                      });
                                      return obj;
                                    }
};__obj__1["to_array"]=async function(container) {
                        return await async function(){
                            if (check_true ((container instanceof Array))) {
                                return container
                            } else if (check_true (await (await get_global("is_set?"))(container))) {
                                {
                                    let acc=[];
                                    ;
                                    await container["forEach"].call(container,async function(v) {
                                        return (acc).push(v)
                                    });
                                    return acc
                                }
                            } else if (check_true ((container instanceof String || typeof container==='string'))) {
                                return (container).split("")
                            } else if (check_true ((container instanceof Object))) {
                                return await pairs(container)
                            } else {
                                return await (async function(){
                                    let __array_op_rval__44=container;
                                     if (__array_op_rval__44 instanceof Function){
                                        return await __array_op_rval__44() 
                                    } else {
                                        return [__array_op_rval__44]
                                    }
                                })()
                            }
                        } ()
                    };__obj__1["slice"]=function(target,from,to) {
                        return   (function(){
                            if (check_true (to)) {
                                return  target["slice"].call(target,from,to)
                            } else if (check_true (from)) {
                                return  target["slice"].call(target,from)
                            } else {
                                throw new SyntaxError("slice requires 2 or 3 arguments");
                                
                            }
                        } )()
                    };__obj__1["rest"]=function(x) {
                        return   (function(){
                            if (check_true ((x instanceof Array))) {
                                return  x["slice"].call(x,1)
                            } else if (check_true ((x instanceof String || typeof x==='string'))) {
                                return  x["substr"].call(x,1)
                            } else {
                                return null
                            }
                        } )()
                    };__obj__1["second"]=function anonymous(x
) {
{ return x[1] }
};__obj__1["third"]=function anonymous(x
) {
{ return x[2] }
};__obj__1["chop"]=function anonymous(x
) {
{ if (x instanceof Array) { return x.slice(0, x.length-1) } else { return x.substr(0,x.length-1) } }
};__obj__1["chomp"]=function anonymous(x
) {
{ return x.substr(x.length-1) }
};__obj__1["not"]=function anonymous(x
) {
{ if (check_true(x)) { return false } else { return true } }
};__obj__1["push"]=function anonymous(place,thing
) {
{ return place.push(thing) }
};__obj__1["pop"]=function anonymous(place
) {
{ return place.pop() }
};__obj__1["list"]=async function(...args) {
                        return args
                    };__obj__1["flatten"]=function anonymous(x
) {
{ return x.flat(999999999999) } 
};__obj__1["jslambda"]=function(...args) {
                        return  ( function(){
                            let __apply_args__69= flatten(args);
                            return ( Function).apply(this,__apply_args__69)
                        })()
                    };__obj__1["join"]=function(...args) {
                        return   (function(){
                            if (check_true ((args.length===1))) {
                                return  args['0']["join"].call(args['0'],"")
                            } else {
                                return  args['1']["join"].call(args['1'],args['0'])
                            }
                        } )()
                    };__obj__1["lowercase"]=function(x) {
                        return  x["toLowerCase"]()
                    };__obj__1["uppercase"]=function(x) {
                        return  x["toUpperCase"]()
                    };__obj__1["log"]=function(...args) {
                        return  ( function(){
                            return ( console.log).apply(this,args)
                        })()
                    };__obj__1["split"]=function anonymous(container,token
) {
{ return container.split(token) }
};__obj__1["split_by"]=function anonymous(token,container
) {
{ return container.split(token) }
};__obj__1["is_object?"]=function anonymous(x
) {
{ return x instanceof Object }
};__obj__1["is_array?"]=function anonymous(x
) {
{ return x instanceof Array }
};__obj__1["is_number?"]=function(x) {
                        return ( subtype(x)==="Number")
                    };__obj__1["is_function?"]=function(x) {
                        return (x instanceof Function)
                    };__obj__1["is_set?"]=function anonymous(x
) {
{ return x instanceof Set }
};__obj__1["is_element?"]=function anonymous(x
) {
{ return x instanceof Element }
};__obj__1["is_string?"]=function(x) {
                        return ((x instanceof String)|| (typeof x==="string"))
                    };__obj__1["is_nil?"]=async function(value) {
    return (null===value)
};__obj__1["is_regex?"]=async function(x) {
    return (await (await Environment.get_global("sub_type"))(x)==="RegExp")
};__obj__1["is_date?"]=async function(x) {
    return (await (await Environment.get_global("sub_type"))(x)==="Date")
};__obj__1["ends_with?"]=function anonymous(val,text
) {
{ if (text instanceof Array) { return text[text.length-1]===val } else if (subtype(text)=='String') { return text.endsWith(val) } else { return false }}
};__obj__1["starts_with?"]=function anonymous(val,text
) {
{ if (text instanceof Array) { return text[0]===val } else if (subtype(text)=='String') { return text.startsWith(val) } else { return false }}
};__obj__1["delete_prop"]=function anonymous(obj,...args
) {
{
                                        if (args.length == 1) {
                                            return delete obj[args[0]];
                                        } else {
                                            while (args.length > 0) {
                                                let prop = args.shift();
                                                delete obj[prop];
                                            }
                                        }
                                        return obj;
                                    }
};__obj__1["blank?"]=function(val) {
                        return ((val==null)|| ((val instanceof String || typeof val==='string')&& (val==="")))
                    };__obj__1["contains?"]=function anonymous(value,container
) {
{ if (!value && !container) { return false }
                           else if (container === null) { throw new TypeError("contains?: passed nil/undefined container value"); }
                           else if (container instanceof Array) return container.includes(value);
                           else if (container instanceof Set) return container.has(value);
                           else if ((container instanceof String) || typeof container === "string") {
                                if (subtype(value) === "Number") return container.indexOf(""+value)>-1;
                                else return container.indexOf(value)>-1;
                           }                                                      
                           else throw new TypeError("contains?: passed invalid container type: "+subtype(container)) }
};__obj__1["make_set"]=function(vals) {
                        if (check_true ((vals instanceof Array))){
                            return new Set(vals)
                        } else {
                            {
                                let vtype;
                                vtype= sub_type(vals);
                                return   (function(){
                                    if (check_true ((vtype==="Set"))) {
                                        return new Set(vals)
                                    } else if (check_true ((vtype==="object"))) {
                                        return new Set( values(vals))
                                    }
                                } )()
                            }
                        }
                    };__obj__1["meta_for_symbol"]=async function(quoted_symbol,search_mode) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let local_data=Environment.global_ctx.scope[quoted_symbol];
                                ;
                                let acc=[];
                                ;
                                if (check_true (search_mode)){
                                    {
                                        if (check_true (local_data)){
                                            {
                                                (acc).push(await (await get_global("add"))({
                                                    namespace:namespace,name:quoted_symbol,type:await subtype(local_data)
                                                },await (async function(){
                                                    let it;
                                                    it=Environment.definitions[quoted_symbol];
                                                    if (check_true (it)){
                                                        return it
                                                    } else {
                                                        return new Object()
                                                    }
                                                })()))
                                            }
                                        };
                                        if (check_true (parent_environment)){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(info) {
                                                        return (acc).push(info)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__121=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__122=[],__elements__120=await (async function() {
                                                            {
                                                                 let __call_target__=await parent_environment["meta_for_symbol"].call(parent_environment,quoted_symbol,true), __call_method__="flat";
                                                                return await __call_target__[__call_method__].call(__call_target__,1)
                                                            } 
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__119 in __elements__120) {
                                                            __array__122.push(await __for_body__121(__elements__120[__iter__119]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__122.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__122;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        if (check_true ((await length(await keys(children))>0))){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(details) {
                                                        return (acc).push(details)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__125=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__126=[],__elements__124=await (async function(){
                                                            let ____collector__127= async function(){
                                                                return []
                                                            };
                                                            let ____result__128= async function(){
                                                                return null
                                                            };
                                                            let ____action__129= async function(){
                                                                return async function(child_data) {
                                                                    if (check_true (await not((child_data['0']===await (await get_global("current_namespace"))())))){
                                                                        {
                                                                            return await child_data['1']["meta_for_symbol"].call(child_data['1'],quoted_symbol)
                                                                        }
                                                                    }
                                                                }
                                                            };
                                                            {
                                                                let __collector=await ____collector__127();
                                                                ;
                                                                let __result=await ____result__128();
                                                                ;
                                                                let __action=await ____action__129();
                                                                ;
                                                                ;
                                                                await (async function() {
                                                                    let __for_body__132=async function(__item) {
                                                                        __result=await __action(__item);
                                                                        if (check_true (__result)){
                                                                            return (__collector).push(__result)
                                                                        }
                                                                    };
                                                                    let __array__133=[],__elements__131=await pairs(children);
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__130 in __elements__131) {
                                                                        __array__133.push(await __for_body__132(__elements__131[__iter__130]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__133.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__133;
                                                                     
                                                                })();
                                                                return __collector
                                                            }
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__123 in __elements__124) {
                                                            __array__126.push(await __for_body__125(__elements__124[__iter__123]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__126.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__126;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        return acc
                                    }
                                } else {
                                    {
                                        quoted_symbol=await (async function(){
                                            if (check_true (await starts_with_ques_(await (async function(){
                                                 return "=:" 
                                            })(),quoted_symbol))){
                                                return await quoted_symbol["substr"].call(quoted_symbol,2)
                                            } else {
                                                return quoted_symbol
                                            }
                                        })();
                                        {
                                            let it;
                                            it=Environment.definitions[quoted_symbol];
                                            if (check_true (it)){
                                                return await (await get_global("add"))({
                                                    namespace:namespace,type:await sub_type(local_data),name:quoted_symbol
                                                },it)
                                            } else {
                                                return null
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    };__obj__1["describe"]=async function(quoted_symbol,search_mode) {
                        let internal_results=await (async function(){
                             return await meta_for_symbol(quoted_symbol,true) 
                        })();
                        ;
                        if (check_true (((internal_results instanceof Array)&& internal_results['0']))){
                            if (check_true (search_mode)){
                                return internal_results
                            } else {
                                return await first(internal_results)
                            }
                        } else {
                            {
                                let external_results=await get_outside_global(quoted_symbol);
                                ;
                                if (check_true (external_results)){
                                    return {
                                        location:"external",type:await subtype(external_results)
                                    }
                                } else {
                                    return null
                                }
                            }
                        }
                    };__obj__1["undefine"]=function(quoted_symbol) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let namespace_identity;
                                let parent_call;
                                let child_call;
                                let target_symbol;
                                namespace_identity=(quoted_symbol).split("/");
                                parent_call=null;
                                child_call=null;
                                target_symbol=null;
                                ;
                                return   (function(){
                                    if (check_true ((((namespace_identity.length===1)&& Environment.global_ctx.scope[namespace_identity['0']])|| ((namespace_identity.length>1)&& (namespace_identity['0']===namespace))))) {
                                        {
                                            target_symbol= ( function(){
                                                if (check_true ((namespace_identity.length>1))){
                                                    return namespace_identity['1']
                                                } else {
                                                    return namespace_identity['0']
                                                }
                                            })();
                                             delete_prop(Environment.definitions,target_symbol);
                                            if (check_true (Environment.global_ctx.scope[target_symbol])){
                                                return  delete_prop(Environment.global_ctx.scope,target_symbol)
                                            } else {
                                                return false
                                            }
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& parent_environment))) {
                                        {
                                            parent_call= parent_environment["get_global"].call(parent_environment,"undefine");
                                            return (parent_call)(quoted_symbol)
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& children[namespace_identity['0']]))) {
                                        {
                                            child_call= ( function() {
                                                {
                                                     let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                    return  __call_target__[__call_method__].call(__call_target__,"undefine")
                                                } 
                                            })();
                                            return  child_call(quoted_symbol)
                                        }
                                    } else {
                                        return false
                                    }
                                } )()
                            }
                        } else {
                            throw new SyntaxError("undefine requires a quoted symbol");
                            
                        }
                    };__obj__1["eval_exp"]=async function(expression) {
                        return await (async function(){
                            let __array_op_rval__140=expression;
                             if (__array_op_rval__140 instanceof Function){
                                return await __array_op_rval__140() 
                            } else {
                                return [__array_op_rval__140]
                            }
                        })()
                    };__obj__1["indirect_new"]=function anonymous(...args
) {
{
                                    let targetClass = args[0];
                                    if (subtype(targetClass)==="String") {
                                        let tmpf=new Function("{ return "+targetClass+" }");
                                        targetClass = tmpf();
                                    }
                                    if (args.length==1) {
                                        let f = function(Class) {
                                            return new (Function.prototype.bind.apply(Class, args));
                                        }
                                        let rval = f.apply(this,[targetClass]);
                                        return rval;
                                    } else {
                                        let f = function(Class) {
                                            return new (Function.prototype.bind.apply(Class, args));
                                        }
                                        let rval = f.apply(this,[targetClass].concat(args.slice(1)));
                                        return rval;
                                    }}
};__obj__1["range"]=function(...args) {
                        let from_to;
                        let step;
                        let idx;
                        let acc;
                        from_to= ( function(){
                            if (check_true (args['1'])){
                                return [parseInt(args['0']),parseInt(args['1'])]
                            } else {
                                return [0,parseInt(args['0'])]
                            }
                        })();
                        step= ( function(){
                            if (check_true (args['2'])){
                                return parseFloat(args['2'])
                            } else {
                                return 1
                            }
                        })();
                        idx=from_to['0'];
                        acc=[];
                         ( get_global("assert"))((step>0),"range: step must be > 0");
                         ( get_global("assert"))((from_to['1']>=from_to['0']),"range: lower bound must be greater or equal than upper bound");
                         ( function(){
                             let __test_condition__145=function() {
                                return (idx<from_to['1'])
                            };
                            let __body_ref__146=function() {
                                (acc).push(idx);
                                return idx+=step
                            };
                            let __BREAK__FLAG__=false;
                            while( __test_condition__145()) {
                                 __body_ref__146();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                        return acc
                    };__obj__1["add"]=function anonymous(...args
) {
{
                                let acc;
                                if (typeof args[0]==="number") {
                                    acc = 0;
                                } else if (args[0] instanceof Array) {
                                    return args[0].concat(args.slice(1));
                                } else if (typeof args[0]==='object') {
                                   let rval = {};
                                   for (let i in args) {
                                        if (typeof args[i] === 'object') {
                                            for (let k in args[i]) {
                                                rval[k] = args[i][k];
                                            }
                                        }
                                   }
                                   return rval;
                                } else {
                                    acc = "";
                                }
                                for (let i in args) {
                                    acc += args[i];
                                }
                                return acc;
                             }
};__obj__1["merge_objects"]=function anonymous(x
) {
{
                                    let rval = {};
                                    for (let i in x) {
                                        if (typeof i === 'object') {
                                            for (let k in x[i]) {
                                                rval[k] = x[i][k];
                                            }
                                        }
                                    }
                                    return rval;
                                 }
};__obj__1["index_of"]=function anonymous(value,container
) {
{ return container.indexOf(value) }
};__obj__1["resolve_path"]=function anonymous(path,obj
) {
{
                                        if (typeof path==='string') {
                                            path = path.split(".");
                                        }
                                        let s=obj;
                                        return path.reduce(function(prev, curr) {
                                            return prev ? prev[curr] : undefined
                                        }, obj || {})
                                    }
};__obj__1["min_value"]=async function(v) {
    let m;
    m=(await Environment.get_global("MAX_SAFE_INTEGER"));
    if (check_true (await (await Environment.get_global("not"))((await (await Environment.get_global("sub_type"))(v)==="array")))){
        throw new TypeError("argument is not an array");
        
    };
    await (async function() {
        let __for_body__80=async function(x) {
            if (check_true (await (await Environment.get_global("not"))(await isNaN(x)))){
                return m=await Math.min(x,m)
            }
        };
        let __array__81=[],__elements__79=v;
        let __BREAK__FLAG__=false;
        for(let __iter__78 in __elements__79) {
            __array__81.push(await __for_body__80(__elements__79[__iter__78]));
            if(__BREAK__FLAG__) {
                 __array__81.pop();
                break;
                
            }
        }return __array__81;
         
    })();
    if (check_true ((m===(await Environment.get_global("MAX_SAFE_INTEGER"))))){
        return 0
    } else {
        return m
    }
};__obj__1["max_value"]=async function(v) {
    let m;
    m=0;
    if (check_true (await (await Environment.get_global("not"))((await (await Environment.get_global("sub_type"))(v)==="array")))){
        throw new TypeError("argument is not an array");
        
    };
    await (async function() {
        let __for_body__76=async function(x) {
            if (check_true (await (await Environment.get_global("not"))(await isNaN(x)))){
                return m=await Math.max(x,m)
            }
        };
        let __array__77=[],__elements__75=v;
        let __BREAK__FLAG__=false;
        for(let __iter__74 in __elements__75) {
            __array__77.push(await __for_body__76(__elements__75[__iter__74]));
            if(__BREAK__FLAG__) {
                 __array__77.pop();
                break;
                
            }
        }return __array__77;
         
    })();
    return m
};__obj__1["interlace"]=async function(...args) {
                        let min_length;
                        let rlength_args;
                        let rval;
                        min_length=await min_value(await (async function(){
                             return await map(length,args) 
                        })());
                        rlength_args=await range(await length(args));
                        rval=[];
                        await (async function() {
                            let __for_body__163=async function(i) {
                                return await (async function() {
                                    let __for_body__167=async function(j) {
                                        return (rval).push(await (async function(){
                                            let __targ__169=args[j];
                                            if (__targ__169){
                                                 return(__targ__169)[i]
                                            } 
                                        })())
                                    };
                                    let __array__168=[],__elements__166=rlength_args;
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__165 in __elements__166) {
                                        __array__168.push(await __for_body__167(__elements__166[__iter__165]));
                                        if(__BREAK__FLAG__) {
                                             __array__168.pop();
                                            break;
                                            
                                        }
                                    }return __array__168;
                                     
                                })()
                            };
                            let __array__164=[],__elements__162=await range(min_length);
                            let __BREAK__FLAG__=false;
                            for(let __iter__161 in __elements__162) {
                                __array__164.push(await __for_body__163(__elements__162[__iter__161]));
                                if(__BREAK__FLAG__) {
                                     __array__164.pop();
                                    break;
                                    
                                }
                            }return __array__164;
                             
                        })();
                        return rval
                    };__obj__1["trim"]=function(x) {
                        return  x["trim"]()
                    };__obj__1["assert"]=function(assertion_form,failure_message) {
                        if (check_true (assertion_form)){
                            return assertion_form
                        } else {
                            throw new EvalError((failure_message|| "assertion failure"));
                            
                        }
                    };__obj__1["unquotify"]=async function(val) {
                        let dval;
                        dval=val;
                        if (check_true (await starts_with_ques_("\"",dval))){
                            dval=await dval["substr"].call(dval,1,(dval.length- 2))
                        };
                        if (check_true (await starts_with_ques_("=:",dval))){
                            dval=await dval["substr"].call(dval,2)
                        };
                        return dval
                    };__obj__1["or_args"]=async function(argset) {
                        let is_true;
                        is_true=false;
                        await (async function() {
                            let __for_body__180=async function(elem) {
                                if (check_true (elem)){
                                    {
                                        is_true=true;
                                        return __BREAK__FLAG__=true;
                                        return
                                    }
                                }
                            };
                            let __array__181=[],__elements__179=argset;
                            let __BREAK__FLAG__=false;
                            for(let __iter__178 in __elements__179) {
                                __array__181.push(await __for_body__180(__elements__179[__iter__178]));
                                if(__BREAK__FLAG__) {
                                     __array__181.pop();
                                    break;
                                    
                                }
                            }return __array__181;
                             
                        })();
                        return is_true
                    };__obj__1["special_operators"]=async function() {
                        return await make_set(await (async function(){
                             return await compiler([],{
                                special_operators:true,env:Environment
                            }) 
                        })())
                    };__obj__1["defclog"]=async function(opts) {
                        let style;
                        style=("padding: 5px;"+ await (async function(){
                            if (check_true (opts.background)){
                                return ("background: "+ opts.background+ ";")
                            } else {
                                return ""
                            }
                        })()+ await (async function(){
                            if (check_true (opts.color)){
                                return ("color: "+ opts.color+ ";")
                            }
                        })()+ "");
                        return async function(...args) {
                            return await (async function(){
                                let __target_arg__188=[].concat(await conj(await (async function(){
                                    let __array_op_rval__189=style;
                                     if (__array_op_rval__189 instanceof Function){
                                        return await __array_op_rval__189() 
                                    } else {
                                        return [__array_op_rval__189]
                                    }
                                })(),args));
                                if(!__target_arg__188 instanceof Array){
                                    throw new TypeError("Invalid final argument to apply - an array is required")
                                }let __pre_arg__190=await (async function(){
                                     return ("%c"+ await (async function(){
                                        if (check_true (opts.prefix)){
                                            return opts.prefix
                                        } else {
                                            return (args).shift()
                                        }
                                    })()) 
                                })();
                                __target_arg__188.unshift(__pre_arg__190);
                                return (console.log).apply(this,__target_arg__188)
                            })()
                        }
                    };__obj__1["NOT_FOUND"]=new Object();__obj__1["check_external_env_default"]=true;__obj__1["*namespace*"]="core";__obj__1["pending_ns_loads"]=new Object();__obj__1["pend_load"]=async function(from_namespace,target_namespace,symbol,initializer) {
                        if (check_true ((null==pending_ns_loads[from_namespace]))){
                            {
                                await async function(){
                                    pending_ns_loads[from_namespace]=[];
                                    return pending_ns_loads;
                                    
                                }()
                            }
                        };
                        return (pending_ns_loads[from_namespace]).push({
                            symbol:symbol,source_ns:from_namespace,target_ns:target_namespace,initializer:await (async function(){
                                 return ["=:quote",initializer] 
                            })()
                        })
                    };__obj__1["load_pends"]=async function(from_namespace) {
                        if (check_true (pending_ns_loads[from_namespace])){
                            {
                                let acc=[];
                                ;
                                acc=await (async function() {
                                    let __for_body__206=async function(load_instruction) {
                                        return ["=:use_symbols",load_instruction.source_ns,[load_instruction.symbol],load_instruction.target_ns]
                                    };
                                    let __array__207=[],__elements__205=pending_ns_loads[from_namespace];
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__204 in __elements__205) {
                                        __array__207.push(await __for_body__206(__elements__205[__iter__204]));
                                        if(__BREAK__FLAG__) {
                                             __array__207.pop();
                                            break;
                                            
                                        }
                                    }return __array__207;
                                     
                                })();
                                await console.log("load_pends: ",acc);
                                (await Environment.eval(await async function(){
                                    return acc
                                }()));
                                return true
                            }
                        }
                    };__obj__1["symbols"]=async function(opts) {
                        return await async function(){
                            if (check_true ((null==opts))) {
                                return await keys(Environment.global_ctx.scope)
                            } else if (check_true (opts.unique)) {
                                {
                                    let no_includes=await make_set(await conj(["meta_for_symbol","describe","undefine","*namespace*","pend_load","symbols","set_global","get_global","symbol_definition","compile","env_log","evaluate_local","evaluate","eval_struct","set_compiler","clone","eval","add_escape_encoding","get_outside_global","as_lisp","lisp_writer","clone_to_new","save_env","null","compiler"],built_ins));
                                    ;
                                    {
                                        let __collector;
                                        let __result;
                                        let __action;
                                        __collector=[];
                                        __result=null;
                                        __action=async function(sym) {
                                            if (check_true (await no_includes["has"].call(no_includes,sym))){
                                                return null
                                            } else {
                                                return sym
                                            }
                                        };
                                        ;
                                        await (async function() {
                                            let __for_body__212=async function(__item) {
                                                __result=await __action(__item);
                                                if (check_true (__result)){
                                                    return (__collector).push(__result)
                                                }
                                            };
                                            let __array__213=[],__elements__211=await keys(Environment.global_ctx.scope);
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__210 in __elements__211) {
                                                __array__213.push(await __for_body__212(__elements__211[__iter__210]));
                                                if(__BREAK__FLAG__) {
                                                     __array__213.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__213;
                                             
                                        })();
                                        return __collector
                                    }
                                }
                            }
                        } ()
                    };__obj__1["set_global"]=function(refname,value,meta,is_constant,target_namespace,contained_req) {
                          (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true (((Environment===value)|| (Environment.global_ctx===value)|| (Environment.global_ctx.scope===value)))) {
                                {
                                    throw new EvalError("cannot set the environment scope as a global value");
                                    
                                }
                            }
                        } )();
                        if (check_true ( resolve_path( ( function(){
                            let __array_op_rval__216=refname;
                             if (__array_op_rval__216 instanceof Function){
                                return  __array_op_rval__216("constant") 
                            } else {
                                return [__array_op_rval__216,"constant"]
                            }
                        })(),Environment.definitions))){
                            {
                                throw new TypeError(("Assignment to constant variable "+ refname));
                                
                            }
                        };
                        let namespace_identity= ( function(){
                            if (check_true (target_namespace)){
                                return  ( function(){
                                    let __array_op_rval__217=target_namespace;
                                     if (__array_op_rval__217 instanceof Function){
                                        return  __array_op_rval__217(refname) 
                                    } else {
                                        return [__array_op_rval__217,refname]
                                    }
                                })()
                            } else {
                                return (refname).split("/")
                            }
                        })();
                        ;
                        return   (function(){
                            if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace===namespace_identity['0']))))) {
                                return  parent_environment["set_global"].call(parent_environment,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'],(contained|| contained_req))
                            } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                {
                                    if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                        return  ( function() {
                                            {
                                                 let __call_target__=children[namespace_identity['0']], __call_method__="set_global";
                                                return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'])
                                            } 
                                        })()
                                    } else {
                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                        
                                    }
                                }
                            } else {
                                {
                                    let comps= get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })());
                                    ;
                                      (function(){
                                        Environment.global_ctx.scope[comps['0']]=value;
                                        return Environment.global_ctx.scope;
                                        
                                    })();
                                    if (check_true (((meta instanceof Object)&&  not((meta instanceof Array))))){
                                        {
                                            if (check_true (is_constant)){
                                                {
                                                      (function(){
                                                        meta["constant"]=true;
                                                        return meta;
                                                        
                                                    })()
                                                }
                                            };
                                              (function(){
                                                Environment.definitions[comps['0']]=meta;
                                                return Environment.definitions;
                                                
                                            })()
                                        }
                                    } else {
                                        if (check_true (is_constant)){
                                            {
                                                  (function(){
                                                    Environment.definitions[comps['0']]={
                                                        constant:true
                                                    };
                                                    return Environment.definitions;
                                                    
                                                })()
                                            }
                                        }
                                    };
                                    return Environment.global_ctx.scope[comps['0']]
                                }
                            }
                        } )()
                    };__obj__1["get_global"]=function(refname,value_if_not_found,suppress_check_external_env,target_namespace,path_comps,contained_req) {
                        return   (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true ((refname==="Environment"))) {
                                return Environment
                            } else if (check_true ( compiler_operators["has"].call(compiler_operators,refname))) {
                                return special_identity
                            } else {
                                {
                                    let namespace_identity;
                                    let comps;
                                    let refval;
                                    let symbol_name;
                                    let check_external_env;
                                    namespace_identity= ( function(){
                                        if (check_true (target_namespace)){
                                            return  ( function(){
                                                let __array_op_rval__224=target_namespace;
                                                 if (__array_op_rval__224 instanceof Function){
                                                    return  __array_op_rval__224(refname) 
                                                } else {
                                                    return [__array_op_rval__224,refname]
                                                }
                                            })()
                                        } else {
                                            return (refname).split("/")
                                        }
                                    })();
                                    comps=(path_comps||  get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })()));
                                    refval=null;
                                    symbol_name=null;
                                    check_external_env= ( function(){
                                        if (check_true (suppress_check_external_env)){
                                            return false
                                        } else {
                                            return check_external_env_default
                                        }
                                    })();
                                    return   (function(){
                                        if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            return  parent_environment["get_global"].call(parent_environment,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps,(contained|| contained_req))
                                        } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            {
                                                if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                                    return  ( function() {
                                                        {
                                                             let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                            return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps)
                                                        } 
                                                    })()
                                                } else {
                                                    {
                                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                                        
                                                    }
                                                }
                                            }
                                        } else {
                                            {
                                                refval=Environment.global_ctx.scope[comps['0']];
                                                if (check_true (((undefined===refval)&& (namespace_identity.length===1)&& parent_environment))){
                                                    {
                                                        let rval= parent_environment["get_global"].call(parent_environment,refname,value_if_not_found,suppress_check_external_env,null,comps,(contained|| contained_req));
                                                        ;
                                                        return rval
                                                    }
                                                } else {
                                                    {
                                                        if (check_true (((undefined===refval)&& check_external_env))){
                                                            refval= ( function(){
                                                                if (check_true (check_external_env)){
                                                                    return ( get_outside_global(comps['0'])|| NOT_FOUND)
                                                                } else {
                                                                    return NOT_FOUND
                                                                }
                                                            })()
                                                        };
                                                        return   (function(){
                                                            if (check_true (((NOT_FOUND===refval)&&  not((undefined===value_if_not_found))))) {
                                                                return value_if_not_found
                                                            } else if (check_true ((NOT_FOUND===refval))) {
                                                                {
                                                                    throw new ReferenceError(("symbol not found: "+  ( function(){
                                                                        if (check_true ((namespace_identity.length>1))){
                                                                            return  add(namespace,"/",namespace_identity['1'])
                                                                        } else {
                                                                            return  add(namespace,"/",namespace_identity['0'])
                                                                        }
                                                                    })()));
                                                                    
                                                                }
                                                            } else if (check_true ((comps.length===1))) {
                                                                return refval
                                                            } else if (check_true ((comps.length>1))) {
                                                                {
                                                                    return  resolve_path( rest(comps),refval)
                                                                }
                                                            } else {
                                                                {
                                                                     console.warn("get_global: condition fall through: ",comps);
                                                                    return NOT_FOUND
                                                                }
                                                            }
                                                        } )()
                                                    }
                                                }
                                            }
                                        }
                                    } )()
                                }
                            }
                        } )()
                    };__obj__1["symbol_definition"]=async function(symname,target_namespace) {
                        let namespace_identity;
                        namespace_identity=await (async function(){
                            if (check_true (target_namespace)){
                                return await (async function(){
                                    let __array_op_rval__227=target_namespace;
                                     if (__array_op_rval__227 instanceof Function){
                                        return await __array_op_rval__227(symname) 
                                    } else {
                                        return [__array_op_rval__227,symname]
                                    }
                                })()
                            } else {
                                if (check_true ((await length(symname)>2))){
                                    return (symname).split("/")
                                } else {
                                    return await (async function(){
                                        let __array_op_rval__228=symname;
                                         if (__array_op_rval__228 instanceof Function){
                                            return await __array_op_rval__228() 
                                        } else {
                                            return [__array_op_rval__228]
                                        }
                                    })()
                                }
                            }
                        })();
                        return await async function(){
                            if (check_true ((namespace_identity.length===1))) {
                                {
                                    let it;
                                    it=Environment.definitions[symname];
                                    if (check_true (it)){
                                        return it
                                    } else {
                                        if (check_true (parent_environment)){
                                            return await parent_environment["symbol_definition"].call(parent_environment,symname)
                                        }
                                    }
                                }
                            } else if (check_true ((namespace_identity['0']===namespace))) {
                                return Environment.definitions[symname]
                            } else if (check_true (parent_environment)) {
                                return await parent_environment["symbol_definition"].call(parent_environment,namespace_identity['1'],namespace_identity['0'])
                            } else if (check_true ((namespace_identity.length===2))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[namespace_identity['0']], __call_method__="symbol_definition";
                                        return await __call_target__[__call_method__].call(__call_target__,namespace_identity['1'])
                                    } 
                                })()
                            } else {
                                return undefined
                            }
                        } ()
                    };__obj__1["compile"]=async function(json_expression,opts) {
                        let out;
                        opts=await add({
                            env:Environment
                        },opts,{
                            meta:await (async function(){
                                if (check_true ((opts&& opts.meta))){
                                    return true
                                } else {
                                    return false
                                }
                            })()
                        });
                        out=null;
                        out=await (async function(){
                             return await compiler(json_expression,opts) 
                        })();
                        return await async function(){
                            if (check_true (((out instanceof Array)&& out['0'].ctype&& (out['0'].ctype==="FAIL")))) {
                                return out
                            } else if (check_true (opts.meta)) {
                                return out
                            } else {
                                return out['1']
                            }
                        } ()
                    };__obj__1["env_log"]=async function(...args) {
                            return await (async function(){
                                let __target_arg__188=[].concat(await conj(await (async function(){
                                    let __array_op_rval__189=style;
                                     if (__array_op_rval__189 instanceof Function){
                                        return await __array_op_rval__189() 
                                    } else {
                                        return [__array_op_rval__189]
                                    }
                                })(),args));
                                if(!__target_arg__188 instanceof Array){
                                    throw new TypeError("Invalid final argument to apply - an array is required")
                                }let __pre_arg__190=await (async function(){
                                     return ("%c"+ await (async function(){
                                        if (check_true (opts.prefix)){
                                            return opts.prefix
                                        } else {
                                            return (args).shift()
                                        }
                                    })()) 
                                })();
                                __target_arg__188.unshift(__pre_arg__190);
                                return (console.log).apply(this,__target_arg__188)
                            })()
                        };__obj__1["evaluate_local"]=async function(expression,ctx,opts) {
                        let compiled;
                        let error_data;
                        let result;
                        opts=(opts|| new Object());
                        compiled=null;
                        error_data=null;
                        result=null;
                        if (check_true (opts.compiled_source)){
                            compiled=expression
                        } else {
                            try {
                                compiled=await (async function(){
                                     return await compiler(await (async function(){
                                        if (check_true (opts.json_in)){
                                            return expression
                                        } else {
                                            return await Environment["read_lisp"].call(Environment,expression,{
                                                source_name:opts.source_name
                                            })
                                        }
                                    })(),{
                                        env:Environment,ctx:ctx,formatted_output:true,source_name:opts.source_name,throw_on_error:opts.throw_on_error,error_report:(opts.error_report|| null),quiet_mode:(opts.quiet_mode|| false)
                                    }) 
                                })()
                            } catch (__exception__235) {
                                if (__exception__235 instanceof Error) {
                                    let e=__exception__235;
                                    {
                                        {
                                            if (check_true (opts.throw_on_error)){
                                                {
                                                    throw e;
                                                    
                                                }
                                            };
                                            if (check_true ((e instanceof LispSyntaxError))){
                                                {
                                                    await async function(){
                                                        e["message"]=await JSON.parse(e.message);
                                                        return e;
                                                        
                                                    }()
                                                }
                                            };
                                            await async function(){
                                                if (check_true ((e instanceof LispSyntaxError))) {
                                                    return error_data=await add({
                                                        error:"LispSyntaxError"
                                                    },e.message)
                                                } else {
                                                    error_data={
                                                        error:await sub_type(e),message:e.message,stack:e.stack,form:await (async function(){
                                                             return await async function(){
                                                                if (check_true (((expression instanceof String || typeof expression==='string')&& (expression.length>100)))) {
                                                                    return await add(await expression["substr"].call(expression,0,100),"...")
                                                                } else {
                                                                    return await (await get_global("as_lisp"))(expression)
                                                                }
                                                            } () 
                                                        })(),parent_forms:[],source_name:opts.source_name,invalid:true
                                                    }
                                                }
                                            } ();
                                            if (check_true (opts.error_report)){
                                                await (async function(){
                                                    let __array_op_rval__237=opts.error_report;
                                                     if (__array_op_rval__237 instanceof Function){
                                                        return await __array_op_rval__237(error_data) 
                                                    } else {
                                                        return [__array_op_rval__237,error_data]
                                                    }
                                                })()
                                            } else {
                                                await console.error("Compilation Error: ",error_data)
                                            };
                                            compiled=await (async function(){
                                                 return [{
                                                    error:true
                                                },null] 
                                            })()
                                        }
                                    }
                                }
                            }
                        };
                        return await async function(){
                            if (check_true ((null==compiled))) {
                                return null
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))&& parent_environment))) {
                                return await parent_environment["evaluate_local"].call(parent_environment,compiled,ctx,await add(new Object(),opts,{
                                    compiled_source:true
                                }))
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))))) {
                                if (check_true (children[compiled['0'].namespace])){
                                    return await (async function() {
                                        {
                                             let __call_target__=children[compiled['0'].namespace], __call_method__="evaluate_local";
                                            return await __call_target__[__call_method__].call(__call_target__,compiled,ctx,await add(new Object(),opts,{
                                                compiled_source:true
                                            }))
                                        } 
                                    })()
                                } else {
                                    throw new EvalError(("unknown namespace "+ compiled['0'].namespace+ " assignment"));
                                    
                                }
                            } else {
                                {
                                    if (check_true (opts.on_compilation_complete)){
                                        await (async function(){
                                            let __array_op_rval__238=opts.on_compilation_complete;
                                             if (__array_op_rval__238 instanceof Function){
                                                return await __array_op_rval__238(compiled) 
                                            } else {
                                                return [__array_op_rval__238,compiled]
                                            }
                                        })()
                                    };
                                    try {
                                        if (check_true (((compiled instanceof Array)&& (compiled['0'] instanceof Object)&& compiled['0'].ctype&& await not((compiled['0'].ctype instanceof String || typeof compiled['0'].ctype==='string'))))){
                                            {
                                                await async function(){
                                                    compiled['0']["ctype"]=await subtype(compiled['0'].ctype);
                                                    return compiled['0'];
                                                    
                                                }()
                                            }
                                        };
                                        result=await (async function(){
                                             return await async function(){
                                                if (check_true (compiled.error)) {
                                                    throw new Error((await get_global("indirect_new"))(compiled.error,compiled.message));
                                                    
                                                } else if (check_true ((compiled['0'].ctype&& (await contains_ques_("block",compiled['0'].ctype)|| (compiled['0'].ctype==="assignment")|| (compiled['0'].ctype==="__!NOT_FOUND!__"))))) {
                                                    if (check_true (await (async function(){
                                                        let __array_op_rval__241=compiled['0'].has_lisp_globals;
                                                         if (__array_op_rval__241 instanceof Function){
                                                            return await __array_op_rval__241() 
                                                        } else {
                                                            return [__array_op_rval__241]
                                                        }
                                                    })())){
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction("Environment",("{ "+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__243=compiled['1'];
                                                                 if (__array_op_rval__243 instanceof Function){
                                                                    return await __array_op_rval__243(Environment) 
                                                                } else {
                                                                    return [__array_op_rval__243,Environment]
                                                                }
                                                            })()
                                                        }
                                                    } else {
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction(("{"+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__245=compiled['1'];
                                                                 if (__array_op_rval__245 instanceof Function){
                                                                    return await __array_op_rval__245() 
                                                                } else {
                                                                    return [__array_op_rval__245]
                                                                }
                                                            })()
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& (("AsyncFunction"===compiled['0'].ctype)|| ("statement"===compiled['0'].ctype)|| ("objliteral"===compiled['0'].ctype))))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__246=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__246 instanceof Function){
                                                                return await __array_op_rval__246() 
                                                            } else {
                                                                return [__array_op_rval__246]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__248=compiled['1'];
                                                                     if (__array_op_rval__248 instanceof Function){
                                                                        return await __array_op_rval__248(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__248,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__250=compiled['1'];
                                                                     if (__array_op_rval__250 instanceof Function){
                                                                        return await __array_op_rval__250() 
                                                                    } else {
                                                                        return [__array_op_rval__250]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& ("Function"===compiled['0'].ctype)))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__251=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__251 instanceof Function){
                                                                return await __array_op_rval__251() 
                                                            } else {
                                                                return [__array_op_rval__251]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__253=compiled['1'];
                                                                     if (__array_op_rval__253 instanceof Function){
                                                                        return await __array_op_rval__253(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__253,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__255=compiled['1'];
                                                                     if (__array_op_rval__255 instanceof Function){
                                                                        return await __array_op_rval__255() 
                                                                    } else {
                                                                        return [__array_op_rval__255]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else {
                                                    return compiled['1']
                                                }
                                            } () 
                                        })()
                                    } catch (__exception__239) {
                                        if (__exception__239 instanceof Error) {
                                            let e=__exception__239;
                                            {
                                                {
                                                    if (check_true ((opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4)))){
                                                        {
                                                            if (check_true (e.details)){
                                                                await env_log("caught error: ",e.details)
                                                            } else {
                                                                await env_log("caught error: ",e.name,e.message,e)
                                                            }
                                                        }
                                                    };
                                                    if (check_true (((await sub_type(e)==="SyntaxError")&& (opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4))))){
                                                        await console.log(compiled['1'])
                                                    };
                                                    if (check_true (opts.error_report)){
                                                        {
                                                            await (async function(){
                                                                let __array_op_rval__256=opts.error_report;
                                                                 if (__array_op_rval__256 instanceof Function){
                                                                    return await __array_op_rval__256(await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()) 
                                                                } else {
                                                                    return [__array_op_rval__256,await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()]
                                                                }
                                                            })()
                                                        }
                                                    };
                                                    result=e;
                                                    if (check_true ((await not(opts.catch_errors)|| (ctx&& ctx.in_try)))){
                                                        {
                                                            throw result;
                                                            
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    };
                                    return result
                                }
                            }
                        } ()
                    };__obj__1["evaluate"]=async function(expression,ctx,opts) {
                        return await async function(){
                            if (check_true ((namespace===active_namespace))) {
                                return await evaluate_local(expression,ctx,opts)
                            } else if (check_true ((namespace==="core"))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[active_namespace], __call_method__="evaluate";
                                        return await __call_target__[__call_method__].call(__call_target__,expression,ctx,opts)
                                    } 
                                })()
                            }
                        } ()
                    };__obj__1["eval_struct"]=async function(lisp_struct,ctx,opts) {
                        let rval;
                        rval=null;
                        if (check_true (lisp_struct instanceof Function)){
                            rval=await (async function(){
                                let __array_op_rval__261=lisp_struct;
                                 if (__array_op_rval__261 instanceof Function){
                                    return await __array_op_rval__261() 
                                } else {
                                    return [__array_op_rval__261]
                                }
                            })()
                        } else {
                            rval=await (async function(){
                                 return await evaluate(lisp_struct,ctx,await add({
                                    json_in:true
                                },(opts|| new Object()))) 
                            })()
                        };
                        return rval
                    };__obj__1["built_ins"]=["MAX_SAFE_INTEGER","LispSyntaxError","sub_type","__VERBOSITY__","int","float","values","pairs","keys","take","prepend","first","last","length","conj","reverse","map","bind","to_object","to_array","slice","rest","second","third","chop","chomp","not","push","pop","list","flatten","jslambda","join","lowercase","uppercase","log","split","split_by","is_object?","is_array?","is_number?","is_function?","is_set?","is_element?","is_string?","is_nil?","is_regex?","is_date?","ends_with?","starts_with?","blank?","contains?","make_set","eval_exp","indirect_new","get_import_entry","range","add","merge_objects","index_of","resolve_path","delete_prop","load_pends","min_value","max_value","interlace","trim","assert","unquotify","or_args","pending_ns_loads","special_operators","defclog","NOT_FOUND","check_external_env_default","built_ins","reader"];__obj__1["set_compiler"]=async function(compiler_function) {
    await Environment["set_compiler"].call(Environment,compiler_function);
    return compiler_function
};__obj__1["clone"]=async function(val) {
                            if (check_true ((val===Environment))){
                                return Environment
                            } else {
                                return await clone(val,0,Environment)
                            }
                        };__obj__1["*env_config*"]={export:{save_path:"js/juno.js",default_namespace:"user",include_source:false},features:["compiler","repl","core-ext","io","Deno","build-tools"],build:"2022.09.05.07.37",imports:await ( async function(){let __obj__2=new Object();__obj__2["core/readline_mod"]={symbol:"readline_mod",namespace:"core",location:"https://deno.land/x/readline/mod.ts"};__obj__2["core/streams"]={symbol:"streams",namespace:"core",location:"https://deno.land/std/streams/conversion.ts"};__obj__2["core/path"]={symbol:"path",namespace:"core",location:"https://deno.land/std@0.110.0/path/mod.ts"};return __obj__2;})(),repl:new Object()};__obj__1["create_namespace"]=async function(name,options,defer_initialization) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true (children[name])) {
                                        throw new EvalError("namespace already exists");
                                        
                                    } else {
                                        {
                                            let child_env;
                                            options=(options|| new Object());
                                            child_env=await (async function(){
                                                 return await dlisp_env({
                                                    parent_environment:Environment,namespace:name,contained:options.contained,defer_initialization:defer_initialization
                                                }) 
                                            })();
                                            if (check_true (child_env.evaluate)){
                                                {
                                                    await child_env["set_compiler"].call(child_env,compiler);
                                                    await async function(){
                                                        children[name]=child_env;
                                                        return children;
                                                        
                                                    }();
                                                    await async function(){
                                                        children_declarations[name]=new Object();
                                                        return children_declarations;
                                                        
                                                    }();
                                                    await child_env["evaluate_local"].call(child_env,"(for_each (sym built_ins) (delete_prop Environment.context.scope sym))");
                                                    await child_env["evaluate_local"].call(child_env,"(for_each (sym built_ins) (delete_prop Environment.definitions sym))");
                                                    if (check_true (options.contained)){
                                                        await async function(){
                                                            let __target_obj__273=children_declarations[name];
                                                            __target_obj__273["contained"]=true;
                                                            return __target_obj__273;
                                                            
                                                        }()
                                                    };
                                                    await async function(){
                                                        let __target_obj__274=children_declarations[name];
                                                        __target_obj__274["serialize_with_image"]=await (async function(){
                                                            if (check_true ((false===options.serialize_with_image))){
                                                                return false
                                                            } else {
                                                                return true
                                                            }
                                                        })();
                                                        return __target_obj__274;
                                                        
                                                    }();
                                                    return name
                                                }
                                            } else {
                                                {
                                                    await console.error("ENV: couldn't create the child environment. Received: ",child_env);
                                                    throw new EvalError(("unable to create namespace "+ name));
                                                    
                                                }
                                            }
                                        }
                                    }
                                } ()
                            };__obj__1["set_namespace"]=async function(name) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true ((await not(("core"===name))&& (null==children[name])))) {
                                        throw new EvalError(("namespace "+ name+ " doesn't exist"));
                                        
                                    } else {
                                        {
                                            if (check_true ((name==="core"))){
                                                {
                                                    active_namespace="core"
                                                }
                                            } else {
                                                {
                                                    active_namespace=name
                                                }
                                            };
                                            return name
                                        }
                                    }
                                } ()
                            };__obj__1["delete_namespace"]=async function(name) {
                                return await async function(){
                                    if (check_true (await not((name instanceof String || typeof name==='string')))) {
                                        throw new TypeError("namespace name must be a string");
                                        
                                    } else if (check_true (("core"===name))) {
                                        throw new EvalError("core namespace cannot be removed");
                                        
                                    } else if (check_true ((null==children[name]))) {
                                        throw new EvalError(("namespace "+ name+ "doesn't exist"));
                                        
                                    } else if (check_true ((name===await current_namespace()))) {
                                        throw new EvalError("namespace is the current namespace");
                                        
                                    } else {
                                        {
                                            await (await get_global("remove_prop"))(children,name);
                                            await (async function() {
                                                let __for_body__277=async function(k) {
                                                    if (check_true (await starts_with_ques_(k,name))){
                                                        {
                                                            return await (await get_global("remove_prop"))(Environment.global_ctx._star_env_config_star_.imports,k)
                                                        }
                                                    }
                                                };
                                                let __array__278=[],__elements__276=(await resolve_path(["global_ctx","scope","*env_config*","imports"],Environment)|| []);
                                                let __BREAK__FLAG__=false;
                                                for(let __iter__275 in __elements__276) {
                                                    __array__278.push(await __for_body__277(__elements__276[__iter__275]));
                                                    if(__BREAK__FLAG__) {
                                                         __array__278.pop();
                                                        break;
                                                        
                                                    }
                                                }return __array__278;
                                                 
                                            })();
                                            return name
                                        }
                                    }
                                } ()
                            };__obj__1["namespaces"]=function() {
                                    return  add( keys(children),"core")
                                };__obj__1["current_namespace"]=function() {
                                return active_namespace
                            };__obj__1["eval"]=async function(expression) {
                        return await (async function(){
                            let __array_op_rval__140=expression;
                             if (__array_op_rval__140 instanceof Function){
                                return await __array_op_rval__140() 
                            } else {
                                return [__array_op_rval__140]
                            }
                        })()
                    };__obj__1["reader"]=async function(text,opts) {     return  await async function(){        if (check_true( (undefined==text))) {             throw new EvalError(("reader: received undefined, text must be a string."));                    } else if (check_true( await (await Environment.get_global("not"))((text instanceof String || typeof text==='string')))) {             throw new EvalError(("reader: received "+await (await Environment.get_global("sub_type"))(text)+": text must be a string."));                    } else  {            let output_structure;            let idx;            let line_number;            let column_number;            let source_name;            let len;            let debugmode;            let in_buffer;            let in_code;            let in_quotes;            let in_long_text;            let in_comment;            let in_single_quote;            let reading_object;            let mode;            let local_text;            let position;            let read_table;            let get_char;            let error;            let handle_escape_char;            let process_word;            let registered_stop_char;            let handler_stack;            let handler;            let c;            let next_c;            let depth;            let stop;            let read_block;            output_structure=[];            idx=-1;            line_number=1;            column_number=0;            source_name=await (async function () {                 if (check_true ((opts && opts["source_name"]))){                      return (opts && opts["source_name"])                } else {                      return "anonymous"                }             })();            opts=(opts||new Object());            len=(await (await Environment.get_global("length"))(text)-1);            debugmode=await async function(){                if (check_true((opts && opts["verbose"]))) {                     return true                } else if (check_true( ((opts && opts["verbose"])===false))) {                     return false                } else if (check_true( ((await Environment.get_global("__VERBOSITY__"))>6))) {                     return true                } else  {                     return false                }            } ();            in_buffer=(text).split("");            in_code=0;            in_quotes=1;            in_long_text=2;            in_comment=3;            in_single_quote=4;            reading_object=false;            mode=in_code;            local_text=async function() {                let start;                let end;                start=await Math.max(0,(idx-10));                end=await Math.min(await (await Environment.get_global("length"))(in_buffer),(idx+10));                 return  (await (await Environment.get_global("slice"))(in_buffer,start,end)).join("")            };            position=async function(offset) {                 return  ("line: "+line_number+" column: "+await (async function () {                     if (check_true (offset)){                          return (column_number+offset)                    } else {                          return column_number                    }                 })())            };            read_table=await (await Environment.get_global("add"))(new Object(),await (async function() {                 if (check_true ((opts && opts["read_table_entries"]))){                      return (opts && opts["read_table_entries"])                } else {                      return new Object()                }             } )(),await ( async function(){                let __obj__1=new Object();                __obj__1["("]=[")",async function(block) {                     return  block                }];                __obj__1["["]=["]",async function(block) {                     return  block                }];                __obj__1["{"]=["}",async function(block) {                    let obj;                    let __idx__2= async function(){                        return -1                    };                    let key_mode;                    let need_colon;                    let value_mode;                    let key;                    let value;                    let cpos;                    let state;                    let block_length;                    {                        obj=new Object();                        let idx=await __idx__2();                        ;                        key_mode=0;                        need_colon=1;                        value_mode=2;                        key=null;                        value=null;
                        cpos=null;
                        state=key_mode;
                        block_length=(await (await Environment.get_global("length"))(block)-1);
                        reading_object=false;
                        await (async function(){
                             let __test_condition__3=async function() {
                                 return  (idx<block_length)
                            };
                            let __body_ref__4=async function() {
                                (idx=idx+1);
                                key=block[idx];
                                if (check_true (((key instanceof Array)&&((key && key.length)===2)&&((key && key["0"])==="=:quotem")&&((key && key["1"]) instanceof String || typeof (key && key["1"])==='string')))){
                                     key=(key && key["1"])
                                };
                                if (check_true (((key instanceof String || typeof key==='string')&&await (await Environment.get_global("starts_with?"))("=:",key)&&(await (await Environment.get_global("length"))(key)>2)))){
                                     key=await key["substr"].call(key,2)
                                };
                                 return  await async function(){
                                    if (check_true( await (await Environment.get_global("blank?"))(key))) {
                                         return await error("missing object key",("blank or nil key: "+block[idx]))
                                    } else if (check_true( await (await Environment.get_global("is_number?"))(key))) {
                                        (idx=idx+1);
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    } else if (check_true( ((key instanceof String || typeof key==='string')&&await (await Environment.get_global("contains?"))(":",key)&&await (await Environment.get_global("not"))(await (await Environment.get_global("ends_with?"))(":",key))))) {
                                        cpos=await key["indexOf"].call(key,":");
                                        value=await key["substr"].call(key,(cpos+1));
                                        key=await key["substr"].call(key,0,cpos);
                                        value=await process_word((value).split(""),0);
                                         return  await async function(){
                                            obj[key]=value;
                                            return obj;
                                            
                                        }()
                                    } else  {
                                        (idx=idx+1);
                                        if (check_true (await (await Environment.get_global("ends_with?"))(":",key))){
                                             key=await (await Environment.get_global("chop"))(key)
                                        } else {
                                            if (check_true ((block[idx]===":"))){
                                                 (idx=idx+1)
                                            } else {
                                                 await error("missing colon",("expected colon for: "+key))
                                            }
                                        };
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    }
                                } ()
                            };
                            let __BREAK__FLAG__=false;
                            while(await __test_condition__3()) {
                                await __body_ref__4();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                         return  obj
                    }
                },async function() {
                     return  reading_object=true
                }];
                __obj__1["\""]=["\"",async function(block) {
                     return  ["quotes",block]
                }];
                return __obj__1;
                
            })());
            get_char=async function(pos) {
                 return  in_buffer[pos]
            };
            error=async function(type,message,offset) {
                throw new LispSyntaxError({
                    message:message,position:await position(offset),pos:{
                        line:line_number,column:(column_number+(offset||0))
                    },depth:depth,local_text:await local_text(),source_name:source_name,type:type
                });
                
            };
            handle_escape_char=async function(c) {
                let ccode;
                ccode=await c["charCodeAt"].call(c,0);
                 return  await async function(){
                    if (check_true( (ccode===34))) {
                         return c
                    } else if (check_true( (ccode===92))) {
                         return c
                    } else if (check_true( (c==="t"))) {
                         return await String.fromCharCode(9)
                    } else if (check_true( (c==="n"))) {
                         return await String.fromCharCode(10)
                    } else if (check_true( (c==="r"))) {
                         return await String.fromCharCode(13)
                    } else if (check_true( (c==="f"))) {
                         return c
                    } else if (check_true( (c==="b"))) {
                         return c
                    } else  {
                         return c
                    }
                } ()
            };
            process_word=async function(word_acc,backtick_mode) {
                let word;
                let word_as_number;
                word=(word_acc).join("");
                word_as_number=await Number(word);
                if (check_true (debugmode)){
                     console.log("process_word: ",word,word_as_number,backtick_mode)
                };
                 return  await async function(){
                    if (check_true( ("true"===word))) {
                         return true
                    } else if (check_true( ("false"===word))) {
                         return false
                    } else if (check_true( (":"===word))) {
                         return word
                    } else if (check_true( (",@"===word))) {
                         return "=$,@"
                    } else if (check_true( ((",#"===word)||("##"===word)))) {
                         return "=:##"
                    } else if (check_true( ("=$,@"===word))) {
                         return "=$,@"
                    } else if (check_true( ("=:##"===word))) {
                         return "=:##"
                    } else if (check_true( await isNaN(word_as_number))) {
                         return  await async function(){
                            if (check_true( (word==="=:"))) {
                                 return  "=:"
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))(")",word)))) {
                                 return await error("trailing character","unexpected trailing parenthesis")
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))("]",word)))) {
                                 return await error("trailing character","unexpected trailing bracket")
                            } else if (check_true( await (await Environment.get_global("contains?"))(word,["=:(","=:)","=:'"]))) {
                                 return  word
                            } else if (check_true( (backtick_mode===1))) {
                                 return word
                            } else  {
                                 return await (await Environment.get_global("add"))("=:",word)
                            }
                        } ()
                    } else if (check_true( await (await Environment.get_global("is_number?"))(word_as_number))) {
                         return word_as_number
                    } else  {
                        console.log("reader: ",await position()," what is this?",word,word_acc,await local_text());
                         return  word
                    }
                } ()
            };
            registered_stop_char=null;
            handler_stack=[];
            handler=null;
            c=null;
            next_c=null;
            depth=0;
            stop=false;
            read_block=async function(_depth,_prefix_op) {
                let acc;
                let word_acc;
                let backtick_mode;
                let escape_mode;
                let last_c;
                let block_return;
                acc=[];
                word_acc=[];
                backtick_mode=0;
                escape_mode=0;
                last_c=null;
                block_return=null;
                if (check_true (_prefix_op)){
                     (acc).push(_prefix_op)
                };
                depth=_depth;
                await (async function(){
                     let __test_condition__8=async function() {
                         return  (await (await Environment.get_global("not"))(stop)&&(idx<len))
                    };
                    let __body_ref__9=async function() {
                        idx+=1;
                        escape_mode=await Math.max(0,(escape_mode-1));
                        c=await get_char(idx);
                        next_c=await get_char((idx+1));
                        if (check_true ((c==="\n"))){
                            line_number+=1;
                             column_number=0
                        };
                        if (check_true (debugmode)){
                             await console.log(_depth,"C->",c,next_c,mode,escape_mode,await clone(acc),await clone(word_acc),(handler_stack && handler_stack.length))
                        };
                        await async function(){
                            if (check_true( ((next_c===undefined)&&await (await Environment.get_global("not"))((await (async function(){
                                let __targ__10=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__10){
                                     return(__targ__10)[0]
                                } 
                            })()===undefined))&&(await (await Environment.get_global("not"))((c===await (async function(){
                                let __targ__11=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__11){
                                     return(__targ__11)[0]
                                } 
                            })()))||((handler_stack && handler_stack.length)>1))))) {
                                 return await error("premature end",("premature end: expected: "+await (async function(){
                                    let __targ__12=await (await Environment.get_global("last"))(handler_stack);
                                    if (__targ__12){
                                         return(__targ__12)[0]
                                    } 
                                })()))
                            } else if (check_true( ((next_c===undefined)&&(mode===in_quotes)&&await (await Environment.get_global("not"))((await c["charCodeAt"]()===34))))) {
                                 return await error("premature end","premature end: expected: \"")
                            } else if (check_true( ((next_c===undefined)&&(mode===in_long_text)&&await (await Environment.get_global("not"))((c==="|"))))) {
                                 return await error("premature end","premature end: expected: |")
                            } else if (check_true( ((mode===in_code)&&(_depth===1)&&(next_c===")")&&(c===")")))) {
                                 return  await error("trailing character","unexpected trailing parenthesis")
                            }
                        } ();
                        await async function(){
                            if (check_true( ((c==="\n")&&(mode===in_comment)))) {
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((92===await c["charCodeAt"].call(c,0))&&(mode===in_long_text)))) {
                                (word_acc).push(c);
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(escape_mode===1)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  escape_mode=2
                            } else if (check_true( ((mode>0)&&(escape_mode===1)))) {
                                 return  (word_acc).push(await handle_escape_char(c))
                            } else if (check_true( ((mode===in_long_text)&&(escape_mode===0)&&(c==="|")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_quotes)&&(escape_mode===0)&&(c==="\"")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_single_quote)&&(escape_mode===0)&&(c==="'")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((c==="|")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_long_text;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                    block_return=["=:quotem",block_return];
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="\"")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_quotes;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="'")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_single_quote;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( (mode===in_comment))) {
                                 return false
                            } else if (check_true( ((c===";")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_comment;
                                 return  await read_block(await (await Environment.get_global("add"))(_depth,1))
                            } else if (check_true( ((mode===in_code)&&(await (await Environment.get_global("length"))(handler_stack)>0)&&(c===await (async function(){
                                let __targ__13=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__13){
                                     return(__targ__13)[0]
                                } 
                            })())))) {
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_code)&&read_table[c]&&await (await Environment.get_global("first"))(read_table[c])))) {
                                if (check_true (await (async function(){
                                    let __targ__14=read_table[c];
                                    if (__targ__14){
                                         return(__targ__14)[2]
                                    } 
                                })())){
                                    handler=await (async function(){
                                        let __targ__15=read_table[c];
                                        if (__targ__15){
                                             return(__targ__15)[2]
                                        } 
                                    })();
                                    await (async function(){
                                        let __array_op_rval__16=handler;
                                         if (__array_op_rval__16 instanceof Function){
                                            return await __array_op_rval__16() 
                                        } else {
                                            return[__array_op_rval__16]
                                        }
                                    })();
                                     handler=null
                                };
                                (handler_stack).push(read_table[c]);
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc,backtick_mode));
                                    backtick_mode=0;
                                     word_acc=[]
                                };
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                handler=await (async function(){
                                    let __targ__17=(handler_stack).pop();
                                    if (__targ__17){
                                         return(__targ__17)[1]
                                    } 
                                })();
                                block_return=await (async function(){
                                    let __array_op_rval__18=handler;
                                     if (__array_op_rval__18 instanceof Function){
                                        return await __array_op_rval__18(block_return) 
                                    } else {
                                        return[__array_op_rval__18,block_return]
                                    }
                                })();
                                if (check_true (await (await Environment.get_global("not"))((undefined===block_return)))){
                                    if (check_true ((backtick_mode===1))){
                                        block_return=["=:quotem",block_return];
                                         backtick_mode=0
                                    };
                                     return  (acc).push(block_return)
                                }
                            } else if (check_true( ((mode===in_code)&&(c==="`")))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                 return  backtick_mode=1
                            } else if (check_true( ((mode===in_code)&&(c===":")&&((word_acc && word_acc.length)===0)&&((acc && acc.length)>0)&&(await (await Environment.get_global("last"))(acc) instanceof String || typeof await (await Environment.get_global("last"))(acc)==='string')))) {
                                 return (acc).push(await (await Environment.get_global("add"))((acc).pop(),":"))
                            } else if (check_true( ((mode===in_code)&&(last_c===",")&&((c==="#")||(c==="@"))))) {
                                (word_acc).push(c);
                                (acc).push(await process_word(word_acc));
                                 return  word_acc=[]
                            } else if (check_true( ((mode===in_code)&&((c===" ")||(await c["charCodeAt"].call(c,0)===10)||(await c["charCodeAt"].call(c,0)===9)||((c===",")&&await (await Environment.get_global("not"))((next_c==="@"))&&await (await Environment.get_global("not"))((next_c==="#"))))))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    if (check_true ((backtick_mode===1))){
                                        (acc).push(await process_word(word_acc,backtick_mode));
                                         backtick_mode=0
                                    } else {
                                         (acc).push(await process_word(word_acc))
                                    };
                                     return  word_acc=[]
                                }
                            } else if (check_true( ((mode===in_code)&&(await c["charCodeAt"].call(c,0)===13)))) {
                                 return false
                            } else  {
                                 return  (word_acc).push(c)
                            }
                        } ();
                        column_number+=1;
                         return  last_c=c
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__8()) {
                        await __body_ref__9();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                if (check_true (((word_acc && word_acc.length)>0))){
                    (acc).push(await process_word(word_acc,backtick_mode));
                     word_acc=[]
                };
                 return  acc
            };
            if (check_true (debugmode)){
                 await console.log("read->",in_buffer)
            };
            output_structure=await read_block(0);
            if (check_true (debugmode)){
                 await console.log("read<-",await clone(output_structure))
            };
            if (check_true (((output_structure instanceof Array)&&(await (await Environment.get_global("length"))(output_structure)>1)))){
                (output_structure).unshift("=:iprogn");
                 return  await (await Environment.get_global("first"))(await (async function(){
                    let __array_op_rval__19=output_structure;
                     if (__array_op_rval__19 instanceof Function){
                        return await __array_op_rval__19() 
                    } else {
                        return[__array_op_rval__19]
                    }
                })())
            } else {
                  return await (await Environment.get_global("first"))(output_structure)
            }
        }
    } ()
};__obj__1["add_escape_encoding"]=async function(text) {        if (check_true ((text instanceof String || typeof text==='string'))){            let chars;            let acc;            chars=(text).split("");            acc=[];            await (async function() {                let __for_body__3=async function(c) {                     return  await async function(){                        if (check_true( ((await c["charCodeAt"].call(c,0)===34)))) {                            (acc).push(await String.fromCharCode(92));                             return  (acc).push(c)                        } else  {                             return (acc).push(c)                        }                    } ()                };                let __array__4=[],__elements__2=chars;                let __BREAK__FLAG__=false;                for(let __iter__1 in __elements__2) {                    __array__4.push(await __for_body__3(__elements__2[__iter__1]));                    if(__BREAK__FLAG__) {                         __array__4.pop();                        break;                                            }                }return __array__4;                             })();             return  (acc).join("")        } else {              return text        }    };__obj__1["get_outside_global"]=function get_outside_global(refname) {  try {    let tfn = new Function("{ if (typeof " + refname + " === 'undefined') { return undefined } else { return "+refname+" } }");    return tfn();  } catch (ex) {    return undefined;  }};__obj__1["as_lisp"]=lisp_writer;__obj__1["lisp_writer"]=lisp_writer;__obj__1["clone_to_new"]=async function(options) {
                        let new_env;
                        let my_children;
                        let my_children_declarations;
                        new_env=null;
                        my_children=null;
                        my_children_declarations=null;
                        await env_log(namespace,"cloning: # children: ",await length(children));
                        new_env=await (async function(){
                             return await dlisp_env({
                                env:await (async function(){
                                     return await clone(Environment) 
                                })(),children:await (async function(){
                                     return await clone(children) 
                                })(),children_declarations:await (async function(){
                                     return await clone(children_declarations) 
                                })()
                            }) 
                        })();
                        await env_log(namespace,"constructed: ",await new_env["id"]());
                        return new_env
                    };__obj__1["save_env"]=async function(options) {
                        let new_env;
                        let my_children;
                        let env_constructor;
                        let dcomps;
                        let version_tag;
                        let build_time;
                        let build_headers;
                        let child_env;
                        let want_buffer;
                        let comp_buffer;
                        let preserve_imports;
                        let include_source;
                        let exports;
                        let src;
                        let target_insertion_path;
                        let output_path;
                        new_env=null;
                        my_children=null;
                        env_constructor=null;
                        dcomps=await (async function(){
                             return await (await get_global("date_components"))(new Date()) 
                        })();
                        options=(options|| new Object());
                        version_tag=await (async function(){
                            if (check_true (await not(await blank_ques_(opts.version_tag)))){
                                return opts.version_tag
                            } else {
                                return (await (async function(){
                                    let __array_op_rval__334=dcomps.year;
                                     if (__array_op_rval__334 instanceof Function){
                                        return await __array_op_rval__334(dcomps.month,dcomps.day,dcomps.hour,dcomps.minute) 
                                    } else {
                                        return [__array_op_rval__334,dcomps.month,dcomps.day,dcomps.hour,dcomps.minute]
                                    }
                                })()).join(".")
                            }
                        })();
                        build_time=await (async function(){
                             return await (await get_global("formatted_date"))(new Date()) 
                        })();
                        build_headers=[];
                        child_env=null;
                        want_buffer=(options.want_buffer|| false);
                        comp_buffer=null;
                        preserve_imports=await (async function(){
                            if (check_true ((options&& (options.preserve_imports===false)))){
                                return false
                            } else {
                                return true
                            }
                        })();
                        include_source=false;
                        exports=[];
                        src=await (async function(){
                            if (check_true (await Environment["get_global"].call(Environment,"*env_skeleton*",null))){
                                return await clone(await Environment["get_global"].call(Environment,"*env_skeleton*"))
                            } else {
                                return await (await get_global("reader"))(await (async function(){
                                     return await (await get_global("read_text_file"))("./src/environment.lisp") 
                                })())
                            }
                        })();
                        target_insertion_path=null;
                        output_path=null;
                        if (check_true (Environment.global_ctx.scope["*env_skeleton*"])){
                            {
                                await (await get_global("register_feature"))("*env_skeleton*")
                            }
                        };
                        target_insertion_path=await first(await (async function(){
                             return await (await get_global("findpaths"))(await (async function(){
                                 return "=:included_globals" 
                            })(),src) 
                        })());
                        if (check_true (await not((target_insertion_path instanceof Array)))){
                            throw new EvalError("Unable to find the first included_globals symbol");
                            
                        };
                        target_insertion_path=await conj(await chop(target_insertion_path),[2]);
                        if (check_true (options.include_source)){
                            {
                                include_source=true
                            }
                        };
                        await env_log(namespace,"cloning: # children: ",await length(children));
                        await env_log(namespace,"preserve_imports: ",preserve_imports);
                        exports=await export_symbol_set(await (async function(){
                            if (check_true (options.do_not_include)){
                                return {
                                    do_not_include:options.do_not_include
                                }
                            }
                        })());
                        my_children=await to_object(await (async function(){
                            let __collector;
                            let __result;
                            let __action;
                            __collector=[];
                            __result=null;
                            __action=async function(child) {
                                if (check_true (await resolve_path(await (async function(){
                                    let __array_op_rval__335=child['0'];
                                     if (__array_op_rval__335 instanceof Function){
                                        return await __array_op_rval__335("serialize_with_image") 
                                    } else {
                                        return [__array_op_rval__335,"serialize_with_image"]
                                    }
                                })(),children_declarations))){
                                    {
                                        child_env=await child['1']["compile"].call(child['1'],await child['1']["export_symbol_set"].call(child['1'],{
                                            no_compiler:true
                                        }),{
                                            throw_on_error:true
                                        });
                                        return await (async function(){
                                            let __array_op_rval__336=child['0'];
                                             if (__array_op_rval__336 instanceof Function){
                                                return await __array_op_rval__336(await (async function(){
                                                     return ["=:javascript",child_env] 
                                                })()) 
                                            } else {
                                                return [__array_op_rval__336,await (async function(){
                                                     return ["=:javascript",child_env] 
                                                })()]
                                            }
                                        })()
                                    }
                                }
                            };
                            ;
                            await (async function() {
                                let __for_body__339=async function(__item) {
                                    __result=await __action(__item);
                                    if (check_true (__result)){
                                        return (__collector).push(__result)
                                    }
                                };
                                let __array__340=[],__elements__338=await pairs(children);
                                let __BREAK__FLAG__=false;
                                for(let __iter__337 in __elements__338) {
                                    __array__340.push(await __for_body__339(__elements__338[__iter__337]));
                                    if(__BREAK__FLAG__) {
                                         __array__340.pop();
                                        break;
                                        
                                    }
                                }return __array__340;
                                 
                            })();
                            return __collector
                        })());
                        await (await get_global("set_path"))(target_insertion_path,src,await (async function(){
                             return ["=:fn",[],await to_object(await (async function(){
                                 return [["definitions",await (async function(){
                                     return ["=:quote",await (async function(){
                                         return await clone(Environment.definitions) 
                                    })()] 
                                })()],["declarations",await (async function(){
                                     return await clone(Environment.declarations) 
                                })()],["config",await (async function(){
                                    let exp_conf;
                                    exp_conf=await (async function(){
                                         return await clone(Environment.global_ctx.scope["*env_config*"]) 
                                    })();
                                    if (check_true (await not(preserve_imports))){
                                        {
                                            await async function(){
                                                exp_conf["imports"]=new Object();
                                                return exp_conf;
                                                
                                            }()
                                        }
                                    };
                                    if (check_true (options.features)){
                                        {
                                            await async function(){
                                                exp_conf["features"]=options.features;
                                                return exp_conf;
                                                
                                            }()
                                        }
                                    };
                                    return exp_conf
                                })()],["imports",await (async function(){
                                    if (check_true (preserve_imports)){
                                        return await to_object(await (async function() {
                                            let __for_body__345=async function(imp_source) {
                                                return await (async function(){
                                                    let __array_op_rval__347=imp_source.symbol;
                                                     if (__array_op_rval__347 instanceof Function){
                                                        return await __array_op_rval__347({
                                                            initializer:await (async function(){
                                                                 return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                                            })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                                        }) 
                                                    } else {
                                                        return [__array_op_rval__347,{
                                                            initializer:await (async function(){
                                                                 return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                                            })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                                        }]
                                                    }
                                                })()
                                            };
                                            let __array__346=[],__elements__344=await values((await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)|| new Object()));
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__343 in __elements__344) {
                                                __array__346.push(await __for_body__345(__elements__344[__iter__343]));
                                                if(__BREAK__FLAG__) {
                                                     __array__346.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__346;
                                             
                                        })())
                                    } else {
                                        return new Object()
                                    }
                                })()],["symbols",await (async function(){
                                     return ["=:javascript",await compile(await to_object(exports),{
                                        throw_on_error:true
                                    })] 
                                })()],["children_declarations",await (async function(){
                                     return ["=:fn",[],await clone(children_declarations)] 
                                })()],["children",my_children]] 
                            })())] 
                        })());
                        output_path=await (async function(){
                            if (check_true (options.want_buffer)){
                                return null
                            } else {
                                return (options.save_as|| await resolve_path(["*env_config*","export","save_path"],Environment.global_ctx.scope))
                            }
                        })();
                        if (check_true (output_path instanceof Function)){
                            output_path=await (async function(){
                                let __array_op_rval__348=output_path;
                                 if (__array_op_rval__348 instanceof Function){
                                    return await __array_op_rval__348() 
                                } else {
                                    return [__array_op_rval__348]
                                }
                            })()
                        };
                        if (check_true ((await not((output_path instanceof String || typeof output_path==='string'))&& output_path))){
                            throw new EvalError("invalid name for target for saving the environment.  Must be a string or function");
                            
                        };
                        return await async function(){
                            if (check_true ((want_buffer|| (output_path&& await ends_with_ques_(".js",output_path))))) {
                                {
                                    (build_headers).push(("// Build Time: "+ build_time));
                                    (build_headers).push(("// Version: "+ version_tag));
                                    (build_headers).push(("export const DLISP_ENV_VERSION='"+ version_tag+ "';"));
                                    await env_log("saving to: ",output_path);
                                    return await (await get_global("compile_buffer"))(src,"init_dlisp",{
                                        namespace:namespace,toplevel:true,include_boilerplate:false,verbose:false,bundle:true,want_buffer:want_buffer,imports:await (async function(){
                                            if (check_true (preserve_imports)){
                                                return await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)
                                            }
                                        })(),js_headers:await (async function(){
                                             return [await (await get_global("show"))(check_true),await (async function(){
                                                 return await (await get_global("show"))(get_next_environment_id) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(get_outside_global) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(subtype) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(lisp_writer) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(clone) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(LispSyntaxError) 
                                            })()] 
                                        })(),bundle_options:{
                                            default_namespace:await resolve_path(["*env_config*","export","default_namespace"],Environment.global_ctx.scope)
                                        },output_file:output_path,include_source:(options.include_source|| await resolve_path(["*env_config*","export","include_source"],Environment.global_ctx.scope)),build_headers:build_headers
                                    })
                                }
                            } else if (check_true ((output_path&& await ends_with_ques_(".lisp",output_path)))) {
                                return await (await get_global("write_text_file"))(output_path,await JSON.stringify(src,null,4))
                            } else {
                                return src
                            }
                        } ()
                    };__obj__1["null"]=null;__obj__1["defmacro"]=async function(name,lambda_list,...forms) {
    let macro_name;
    let macro_args;
    let macro_body;
    let final_form;
    let macro_meta;
    let complex_lambda_list;
    let source_details;
    macro_name=name;
    macro_args=lambda_list;
    macro_body=forms;
    final_form=await (await Environment.get_global("last"))(forms);
    macro_meta=await (async function(){
        if (check_true (((final_form instanceof Object)&& await (await Environment.get_global("not"))(await (await Environment.get_global("blank?"))((final_form && final_form["description"])))&& await (await Environment.get_global("not"))(await (await Environment.get_global("blank?"))((final_form && final_form["usage"])))))){
            return (forms).pop()
        }
    })();
    complex_lambda_list=await (async function(){
         return await (await Environment.get_global("or_args"))(await (async function() {
            let __for_body__45=async function(elem) {
                return (await (await Environment.get_global("length"))(await (await Environment.get_global("flatten"))(await (async function(){
                     return await (await Environment.get_global("destructure_list"))(elem) 
                })()))>0)
            };
            let __array__46=[],__elements__44=lambda_list;
            let __BREAK__FLAG__=false;
            for(let __iter__43 in __elements__44) {
                __array__46.push(await __for_body__45(__elements__44[__iter__43]));
                if(__BREAK__FLAG__) {
                     __array__46.pop();
                    break;
                    
                }
            }return __array__46;
             
        })()) 
    })();
    source_details=await (await Environment.get_global("add"))({
        eval_when:{
            compile_time:true
        },name:await (async function(){
            if (check_true (await (await Environment.get_global("starts_with?"))("=:",name))){
                return await name["substr"].call(name,2)
            } else {
                return name
            }
        })(),macro:true,fn_args:await (await Environment.get_global("as_lisp"))(macro_args)
    },await (async function(){
        if (check_true (macro_meta)){
            return macro_meta
        } else {
            return new Object()
        }
    })());
    if (check_true (complex_lambda_list)){
        return ["=:defglobal",macro_name,["=:fn",["&","=:args"],["=:destructuring_bind",macro_args,"=:args",].concat(macro_body)],["=:quote",source_details]]
    } else {
        return ["=:defglobal",macro_name,["=:fn",macro_args,].concat(macro_body),["=:quote",source_details]]
    }
};__obj__1["read_lisp"]=async function(text,opts) {     return  await async function(){        if (check_true( (undefined==text))) {             throw new EvalError(("reader: received undefined, text must be a string."));                    } else if (check_true( await (await Environment.get_global("not"))((text instanceof String || typeof text==='string')))) {             throw new EvalError(("reader: received "+await (await Environment.get_global("sub_type"))(text)+": text must be a string."));                    } else  {            let output_structure;            let idx;            let line_number;            let column_number;            let source_name;            let len;            let debugmode;            let in_buffer;            let in_code;            let in_quotes;            let in_long_text;            let in_comment;            let in_single_quote;            let reading_object;            let mode;            let local_text;            let position;            let read_table;            let get_char;            let error;            let handle_escape_char;            let process_word;            let registered_stop_char;            let handler_stack;            let handler;            let c;            let next_c;            let depth;            let stop;            let read_block;            output_structure=[];            idx=-1;            line_number=1;            column_number=0;            source_name=await (async function () {                 if (check_true ((opts && opts["source_name"]))){                      return (opts && opts["source_name"])                } else {                      return "anonymous"                }             })();            opts=(opts||new Object());            len=(await (await Environment.get_global("length"))(text)-1);            debugmode=await async function(){                if (check_true((opts && opts["verbose"]))) {                     return true                } else if (check_true( ((opts && opts["verbose"])===false))) {                     return false                } else if (check_true( ((await Environment.get_global("__VERBOSITY__"))>6))) {                     return true                } else  {                     return false                }            } ();            in_buffer=(text).split("");            in_code=0;            in_quotes=1;            in_long_text=2;            in_comment=3;            in_single_quote=4;            reading_object=false;            mode=in_code;            local_text=async function() {                let start;                let end;                start=await Math.max(0,(idx-10));                end=await Math.min(await (await Environment.get_global("length"))(in_buffer),(idx+10));                 return  (await (await Environment.get_global("slice"))(in_buffer,start,end)).join("")            };            position=async function(offset) {                 return  ("line: "+line_number+" column: "+await (async function () {                     if (check_true (offset)){                          return (column_number+offset)                    } else {                          return column_number                    }                 })())            };            read_table=await (await Environment.get_global("add"))(new Object(),await (async function() {                 if (check_true ((opts && opts["read_table_entries"]))){                      return (opts && opts["read_table_entries"])                } else {                      return new Object()                }             } )(),await ( async function(){                let __obj__1=new Object();                __obj__1["("]=[")",async function(block) {                     return  block                }];                __obj__1["["]=["]",async function(block) {                     return  block                }];                __obj__1["{"]=["}",async function(block) {                    let obj;                    let __idx__2= async function(){                        return -1                    };                    let key_mode;                    let need_colon;                    let value_mode;                    let key;                    let value;                    let cpos;                    let state;                    let block_length;                    {                        obj=new Object();                        let idx=await __idx__2();                        ;                        key_mode=0;                        need_colon=1;                        value_mode=2;                        key=null;                        value=null;
                        cpos=null;
                        state=key_mode;
                        block_length=(await (await Environment.get_global("length"))(block)-1);
                        reading_object=false;
                        await (async function(){
                             let __test_condition__3=async function() {
                                 return  (idx<block_length)
                            };
                            let __body_ref__4=async function() {
                                (idx=idx+1);
                                key=block[idx];
                                if (check_true (((key instanceof Array)&&((key && key.length)===2)&&((key && key["0"])==="=:quotem")&&((key && key["1"]) instanceof String || typeof (key && key["1"])==='string')))){
                                     key=(key && key["1"])
                                };
                                if (check_true (((key instanceof String || typeof key==='string')&&await (await Environment.get_global("starts_with?"))("=:",key)&&(await (await Environment.get_global("length"))(key)>2)))){
                                     key=await key["substr"].call(key,2)
                                };
                                 return  await async function(){
                                    if (check_true( await (await Environment.get_global("blank?"))(key))) {
                                         return await error("missing object key",("blank or nil key: "+block[idx]))
                                    } else if (check_true( await (await Environment.get_global("is_number?"))(key))) {
                                        (idx=idx+1);
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    } else if (check_true( ((key instanceof String || typeof key==='string')&&await (await Environment.get_global("contains?"))(":",key)&&await (await Environment.get_global("not"))(await (await Environment.get_global("ends_with?"))(":",key))))) {
                                        cpos=await key["indexOf"].call(key,":");
                                        value=await key["substr"].call(key,(cpos+1));
                                        key=await key["substr"].call(key,0,cpos);
                                        value=await process_word((value).split(""),0);
                                         return  await async function(){
                                            obj[key]=value;
                                            return obj;
                                            
                                        }()
                                    } else  {
                                        (idx=idx+1);
                                        if (check_true (await (await Environment.get_global("ends_with?"))(":",key))){
                                             key=await (await Environment.get_global("chop"))(key)
                                        } else {
                                            if (check_true ((block[idx]===":"))){
                                                 (idx=idx+1)
                                            } else {
                                                 await error("missing colon",("expected colon for: "+key))
                                            }
                                        };
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    }
                                } ()
                            };
                            let __BREAK__FLAG__=false;
                            while(await __test_condition__3()) {
                                await __body_ref__4();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                         return  obj
                    }
                },async function() {
                     return  reading_object=true
                }];
                __obj__1["\""]=["\"",async function(block) {
                     return  ["quotes",block]
                }];
                return __obj__1;
                
            })());
            get_char=async function(pos) {
                 return  in_buffer[pos]
            };
            error=async function(type,message,offset) {
                throw new LispSyntaxError({
                    message:message,position:await position(offset),pos:{
                        line:line_number,column:(column_number+(offset||0))
                    },depth:depth,local_text:await local_text(),source_name:source_name,type:type
                });
                
            };
            handle_escape_char=async function(c) {
                let ccode;
                ccode=await c["charCodeAt"].call(c,0);
                 return  await async function(){
                    if (check_true( (ccode===34))) {
                         return c
                    } else if (check_true( (ccode===92))) {
                         return c
                    } else if (check_true( (c==="t"))) {
                         return await String.fromCharCode(9)
                    } else if (check_true( (c==="n"))) {
                         return await String.fromCharCode(10)
                    } else if (check_true( (c==="r"))) {
                         return await String.fromCharCode(13)
                    } else if (check_true( (c==="f"))) {
                         return c
                    } else if (check_true( (c==="b"))) {
                         return c
                    } else  {
                         return c
                    }
                } ()
            };
            process_word=async function(word_acc,backtick_mode) {
                let word;
                let word_as_number;
                word=(word_acc).join("");
                word_as_number=await Number(word);
                if (check_true (debugmode)){
                     console.log("process_word: ",word,word_as_number,backtick_mode)
                };
                 return  await async function(){
                    if (check_true( ("true"===word))) {
                         return true
                    } else if (check_true( ("false"===word))) {
                         return false
                    } else if (check_true( (":"===word))) {
                         return word
                    } else if (check_true( (",@"===word))) {
                         return "=$,@"
                    } else if (check_true( ((",#"===word)||("##"===word)))) {
                         return "=:##"
                    } else if (check_true( ("=$,@"===word))) {
                         return "=$,@"
                    } else if (check_true( ("=:##"===word))) {
                         return "=:##"
                    } else if (check_true( await isNaN(word_as_number))) {
                         return  await async function(){
                            if (check_true( (word==="=:"))) {
                                 return  "=:"
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))(")",word)))) {
                                 return await error("trailing character","unexpected trailing parenthesis")
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))("]",word)))) {
                                 return await error("trailing character","unexpected trailing bracket")
                            } else if (check_true( await (await Environment.get_global("contains?"))(word,["=:(","=:)","=:'"]))) {
                                 return  word
                            } else if (check_true( (backtick_mode===1))) {
                                 return word
                            } else  {
                                 return await (await Environment.get_global("add"))("=:",word)
                            }
                        } ()
                    } else if (check_true( await (await Environment.get_global("is_number?"))(word_as_number))) {
                         return word_as_number
                    } else  {
                        console.log("reader: ",await position()," what is this?",word,word_acc,await local_text());
                         return  word
                    }
                } ()
            };
            registered_stop_char=null;
            handler_stack=[];
            handler=null;
            c=null;
            next_c=null;
            depth=0;
            stop=false;
            read_block=async function(_depth,_prefix_op) {
                let acc;
                let word_acc;
                let backtick_mode;
                let escape_mode;
                let last_c;
                let block_return;
                acc=[];
                word_acc=[];
                backtick_mode=0;
                escape_mode=0;
                last_c=null;
                block_return=null;
                if (check_true (_prefix_op)){
                     (acc).push(_prefix_op)
                };
                depth=_depth;
                await (async function(){
                     let __test_condition__8=async function() {
                         return  (await (await Environment.get_global("not"))(stop)&&(idx<len))
                    };
                    let __body_ref__9=async function() {
                        idx+=1;
                        escape_mode=await Math.max(0,(escape_mode-1));
                        c=await get_char(idx);
                        next_c=await get_char((idx+1));
                        if (check_true ((c==="\n"))){
                            line_number+=1;
                             column_number=0
                        };
                        if (check_true (debugmode)){
                             await console.log(_depth,"C->",c,next_c,mode,escape_mode,await clone(acc),await clone(word_acc),(handler_stack && handler_stack.length))
                        };
                        await async function(){
                            if (check_true( ((next_c===undefined)&&await (await Environment.get_global("not"))((await (async function(){
                                let __targ__10=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__10){
                                     return(__targ__10)[0]
                                } 
                            })()===undefined))&&(await (await Environment.get_global("not"))((c===await (async function(){
                                let __targ__11=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__11){
                                     return(__targ__11)[0]
                                } 
                            })()))||((handler_stack && handler_stack.length)>1))))) {
                                 return await error("premature end",("premature end: expected: "+await (async function(){
                                    let __targ__12=await (await Environment.get_global("last"))(handler_stack);
                                    if (__targ__12){
                                         return(__targ__12)[0]
                                    } 
                                })()))
                            } else if (check_true( ((next_c===undefined)&&(mode===in_quotes)&&await (await Environment.get_global("not"))((await c["charCodeAt"]()===34))))) {
                                 return await error("premature end","premature end: expected: \"")
                            } else if (check_true( ((next_c===undefined)&&(mode===in_long_text)&&await (await Environment.get_global("not"))((c==="|"))))) {
                                 return await error("premature end","premature end: expected: |")
                            } else if (check_true( ((mode===in_code)&&(_depth===1)&&(next_c===")")&&(c===")")))) {
                                 return  await error("trailing character","unexpected trailing parenthesis")
                            }
                        } ();
                        await async function(){
                            if (check_true( ((c==="\n")&&(mode===in_comment)))) {
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((92===await c["charCodeAt"].call(c,0))&&(mode===in_long_text)))) {
                                (word_acc).push(c);
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(escape_mode===1)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  escape_mode=2
                            } else if (check_true( ((mode>0)&&(escape_mode===1)))) {
                                 return  (word_acc).push(await handle_escape_char(c))
                            } else if (check_true( ((mode===in_long_text)&&(escape_mode===0)&&(c==="|")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_quotes)&&(escape_mode===0)&&(c==="\"")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_single_quote)&&(escape_mode===0)&&(c==="'")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((c==="|")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_long_text;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                    block_return=["=:quotem",block_return];
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="\"")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_quotes;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="'")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_single_quote;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( (mode===in_comment))) {
                                 return false
                            } else if (check_true( ((c===";")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_comment;
                                 return  await read_block(await (await Environment.get_global("add"))(_depth,1))
                            } else if (check_true( ((mode===in_code)&&(await (await Environment.get_global("length"))(handler_stack)>0)&&(c===await (async function(){
                                let __targ__13=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__13){
                                     return(__targ__13)[0]
                                } 
                            })())))) {
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_code)&&read_table[c]&&await (await Environment.get_global("first"))(read_table[c])))) {
                                if (check_true (await (async function(){
                                    let __targ__14=read_table[c];
                                    if (__targ__14){
                                         return(__targ__14)[2]
                                    } 
                                })())){
                                    handler=await (async function(){
                                        let __targ__15=read_table[c];
                                        if (__targ__15){
                                             return(__targ__15)[2]
                                        } 
                                    })();
                                    await (async function(){
                                        let __array_op_rval__16=handler;
                                         if (__array_op_rval__16 instanceof Function){
                                            return await __array_op_rval__16() 
                                        } else {
                                            return[__array_op_rval__16]
                                        }
                                    })();
                                     handler=null
                                };
                                (handler_stack).push(read_table[c]);
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc,backtick_mode));
                                    backtick_mode=0;
                                     word_acc=[]
                                };
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                handler=await (async function(){
                                    let __targ__17=(handler_stack).pop();
                                    if (__targ__17){
                                         return(__targ__17)[1]
                                    } 
                                })();
                                block_return=await (async function(){
                                    let __array_op_rval__18=handler;
                                     if (__array_op_rval__18 instanceof Function){
                                        return await __array_op_rval__18(block_return) 
                                    } else {
                                        return[__array_op_rval__18,block_return]
                                    }
                                })();
                                if (check_true (await (await Environment.get_global("not"))((undefined===block_return)))){
                                    if (check_true ((backtick_mode===1))){
                                        block_return=["=:quotem",block_return];
                                         backtick_mode=0
                                    };
                                     return  (acc).push(block_return)
                                }
                            } else if (check_true( ((mode===in_code)&&(c==="`")))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                 return  backtick_mode=1
                            } else if (check_true( ((mode===in_code)&&(c===":")&&((word_acc && word_acc.length)===0)&&((acc && acc.length)>0)&&(await (await Environment.get_global("last"))(acc) instanceof String || typeof await (await Environment.get_global("last"))(acc)==='string')))) {
                                 return (acc).push(await (await Environment.get_global("add"))((acc).pop(),":"))
                            } else if (check_true( ((mode===in_code)&&(last_c===",")&&((c==="#")||(c==="@"))))) {
                                (word_acc).push(c);
                                (acc).push(await process_word(word_acc));
                                 return  word_acc=[]
                            } else if (check_true( ((mode===in_code)&&((c===" ")||(await c["charCodeAt"].call(c,0)===10)||(await c["charCodeAt"].call(c,0)===9)||((c===",")&&await (await Environment.get_global("not"))((next_c==="@"))&&await (await Environment.get_global("not"))((next_c==="#"))))))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    if (check_true ((backtick_mode===1))){
                                        (acc).push(await process_word(word_acc,backtick_mode));
                                         backtick_mode=0
                                    } else {
                                         (acc).push(await process_word(word_acc))
                                    };
                                     return  word_acc=[]
                                }
                            } else if (check_true( ((mode===in_code)&&(await c["charCodeAt"].call(c,0)===13)))) {
                                 return false
                            } else  {
                                 return  (word_acc).push(c)
                            }
                        } ();
                        column_number+=1;
                         return  last_c=c
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__8()) {
                        await __body_ref__9();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                if (check_true (((word_acc && word_acc.length)>0))){
                    (acc).push(await process_word(word_acc,backtick_mode));
                     word_acc=[]
                };
                 return  acc
            };
            if (check_true (debugmode)){
                 await console.log("read->",in_buffer)
            };
            output_structure=await read_block(0);
            if (check_true (debugmode)){
                 await console.log("read<-",await clone(output_structure))
            };
            if (check_true (((output_structure instanceof Array)&&(await (await Environment.get_global("length"))(output_structure)>1)))){
                (output_structure).unshift("=:iprogn");
                 return  await (await Environment.get_global("first"))(await (async function(){
                    let __array_op_rval__19=output_structure;
                     if (__array_op_rval__19 instanceof Function){
                        return await __array_op_rval__19() 
                    } else {
                        return[__array_op_rval__19]
                    }
                })())
            } else {
                  return await (await Environment.get_global("first"))(output_structure)
            }
        }
    } ()
};__obj__1["desym"]=async function(val) {
        let strip;
        strip=async function(v) {
            return (""+ await (await Environment.get_global("as_lisp"))(v))
        };
        return await async function(){
            if (check_true ((val instanceof String || typeof val==='string'))) {
                return await strip(val)
            } else if (check_true ((val instanceof Array))) {
                return await (async function() {
                    let __for_body__3=async function(v) {
                        return await strip(v)
                    };
                    let __array__4=[],__elements__2=val;
                    let __BREAK__FLAG__=false;
                    for(let __iter__1 in __elements__2) {
                        __array__4.push(await __for_body__3(__elements__2[__iter__1]));
                        if(__BREAK__FLAG__) {
                             __array__4.pop();
                            break;
                            
                        }
                    }return __array__4;
                     
                })()
            } else {
                return val
            }
        } ()
    };__obj__1["desym_ref"]=async function(val) {
    return ["=:+","",["=:as_lisp",val]]
};__obj__1["deref"]=async function(val) {
    return ["=:let",[["=:mval",val]],["=:if",["=:and",["=:is_string?","=:mval"],["=:starts_with?","=:","=:mval"]],["=:->","=:mval","substr",2],"=:mval"]]
};__obj__1["when"]=async function(condition,...mbody) {
    return ["=:if",condition,["=:do",].concat(mbody)]
};__obj__1["if_compile_time_defined"]=async function(quoted_symbol,exists_form,not_exists_form) {
    if (check_true (await (await Environment.get_global("describe"))(quoted_symbol))){
        return exists_form
    } else {
        return (not_exists_form|| [])
    }
};__obj__1["defexternal"]=async function(name,value) {
    return ["=:let",[["=:symname",["=:desym",].concat(name)]],["=:do",["=:set_prop","=:globalThis","=:symname",value],["=:prop","=:globalThis","=:symname"]]]
};__obj__1["defun"]=async function(name,lambda_list,body,meta) {
    let fn_name;
    let fn_args;
    let fn_body;
    let fn_meta;
    let complex_lambda_list;
    let source_details;
    fn_name=name;
    fn_args=lambda_list;
    fn_body=body;
    fn_meta=meta;
    complex_lambda_list=await (async function(){
         return await (await Environment.get_global("or_args"))(await (async function() {
            let __for_body__49=async function(elem) {
                return (await (await Environment.get_global("length"))(await (await Environment.get_global("flatten"))(await (async function(){
                     return await (await Environment.get_global("destructure_list"))(elem) 
                })()))>0)
            };
            let __array__50=[],__elements__48=lambda_list;
            let __BREAK__FLAG__=false;
            for(let __iter__47 in __elements__48) {
                __array__50.push(await __for_body__49(__elements__48[__iter__47]));
                if(__BREAK__FLAG__) {
                     __array__50.pop();
                    break;
                    
                }
            }return __array__50;
             
        })()) 
    })();
    source_details=await (await Environment.get_global("add"))({
        name:await (async function(){
             return await (await Environment.get_global("unquotify"))(name) 
        })(),fn_args:await (await Environment.get_global("as_lisp"))(fn_args)
    },await (async function(){
        if (check_true (fn_meta)){
            {
                if (check_true ((fn_meta && fn_meta["description"]))){
                    await async function(){
                        fn_meta["description"]=(fn_meta && fn_meta["description"]);
                        return fn_meta;
                        
                    }()
                };
                return fn_meta
            }
        } else {
            return new Object()
        }
    })());
    if (check_true (complex_lambda_list)){
        return ["=:defglobal",fn_name,["=:fn",["&","=:args"],["=:destructuring_bind",fn_args,"=:args",fn_body]],["=:quote",source_details]]
    } else {
        return ["=:defglobal",fn_name,["=:fn",fn_args,fn_body],["=:quote",source_details]]
    }
};__obj__1["defun_sync"]=async function(name,args,body,meta) {
    let fn_name;
    let fn_args;
    let fn_body;
    let source_details;
    fn_name=name;
    fn_args=args;
    fn_body=body;
    source_details=await (await Environment.get_global("add"))({
        name:await (async function(){
             return await (await Environment.get_global("unquotify"))(name) 
        })(),fn_args:await (await Environment.get_global("as_lisp"))(fn_args)
    },await (async function(){
        if (check_true (meta)){
            return meta
        } else {
            return new Object()
        }
    })());
    return ["=:do",["=:defglobal",fn_name,["=:function",fn_args,fn_body],["=:quote",source_details]]]
};__obj__1["macroexpand"]=async function(quoted_form) {
    let macro_name;
    let macro_func;
    let expansion;
    macro_name=await (quoted_form && quoted_form["0"])["substr"].call((quoted_form && quoted_form["0"]),2);
    macro_func=await Environment["get_global"].call(Environment,macro_name);
    expansion=await (async function(){
        if (check_true ((macro_func instanceof Function&& await (await Environment.get_global("resolve_path"))(await (async function(){
            let __array_op_rval__5=macro_name;
             if (__array_op_rval__5 instanceof Function){
                return await __array_op_rval__5("eval_when","compile_time") 
            } else {
                return [__array_op_rval__5,"eval_when","compile_time"]
            }
        })(),Environment.definitions)))){
            return await (async function(){
                let __apply_args__6=await (async function(){
                     return await quoted_form["slice"].call(quoted_form,1) 
                })();
                return ( macro_func).apply(this,__apply_args__6)
            })()
        } else {
            return quoted_form
        }
    })();
    return expansion
};__obj__1["macroexpand_nq"]=async function(form) {
    let macro_name;
    let macro_func;
    let expansion;
    macro_name=await (async function() {
        {
             let __call_target__=form[0], __call_method__="substr";
            return await __call_target__[__call_method__].call(__call_target__,2)
        } 
    })();
    macro_func=await Environment["get_global"].call(Environment,macro_name);
    expansion=await (async function(){
        if (check_true (macro_func instanceof Function)){
            return await (async function(){
                let __apply_args__8=await (async function(){
                     return await form["slice"].call(form,1) 
                })();
                return ( macro_func).apply(this,__apply_args__8)
            })()
        } else {
            return form
        }
    })();
    return ["=:quote",expansion]
};__obj__1["check_type"]=async function(thing,type_name,error_string) {
    if (check_true (error_string)){
        return ["=:if",["=:not",["=:==",["=:sub_type",thing],type_name]],["=:throw","=:TypeError",error_string]]
    } else {
        return ["=:if",["=:not",["=:==",["=:sub_type",thing],type_name]],["=:throw","=:TypeError",["=:+","invalid type: required ",type_name," but got ",["=:sub_type",thing]]]]
    }
};__obj__1["get_object_path"]=function(refname) {
        if (check_true ((( refname["indexOf"].call(refname,".")>-1)|| ( refname["indexOf"].call(refname,"[")>-1)))){
            {
                let chars;
                let comps;
                let mode;
                let name_acc;
                chars=(refname).split("");
                comps=[];
                mode=0;
                name_acc=[];
                 ( function() {
                    let __for_body__12=function(c) {
                        return   (function(){
                            if (check_true (((c===".")&& (mode===0)))) {
                                {
                                    if (check_true (((name_acc && name_acc.length)>0))){
                                        {
                                            (comps).push((name_acc).join(""))
                                        }
                                    };
                                    return name_acc=[]
                                }
                            } else if (check_true (((mode===0)&& (c==="[")))) {
                                {
                                    mode=1;
                                    if (check_true (((name_acc && name_acc.length)>0))){
                                        {
                                            (comps).push((name_acc).join(""))
                                        }
                                    };
                                    return name_acc=[]
                                }
                            } else if (check_true (((mode===1)&& (c==="]")))) {
                                {
                                    mode=0;
                                    (comps).push((name_acc).join(""));
                                    return name_acc=[]
                                }
                            } else {
                                return (name_acc).push(c)
                            }
                        } )()
                    };
                    let __array__13=[],__elements__11=chars;
                    let __BREAK__FLAG__=false;
                    for(let __iter__10 in __elements__11) {
                        __array__13.push( __for_body__12(__elements__11[__iter__10]));
                        if(__BREAK__FLAG__) {
                             __array__13.pop();
                            break;
                            
                        }
                    }return __array__13;
                     
                })();
                if (check_true (((name_acc && name_acc.length)>0))){
                    (comps).push((name_acc).join(""))
                };
                return comps
            }
        } else {
            return  ( function(){
                let __array_op_rval__14=refname;
                 if (__array_op_rval__14 instanceof Function){
                    return  __array_op_rval__14() 
                } else {
                    return [__array_op_rval__14]
                }
            })()
        }
    };__obj__1["do_deferred_splice"]=async function(tree) {
    let rval;
    let idx;
    let tval;
    let deferred_operator;
    rval=null;
    idx=0;
    tval=null;
    deferred_operator=(["=","$","&","!"]).join("");
    return await async function(){
        if (check_true ((tree instanceof Array))) {
            {
                rval=[];
                await (async function(){
                     let __test_condition__15=async function() {
                        return (idx<(tree && tree.length))
                    };
                    let __body_ref__16=async function() {
                        tval=tree[idx];
                        if (check_true ((tval===deferred_operator))){
                            {
                                idx+=1;
                                tval=tree[idx];
                                rval=await rval["concat"].call(rval,await (async function(){
                                     return await do_deferred_splice(tval) 
                                })())
                            }
                        } else {
                            (rval).push(await (async function(){
                                 return await do_deferred_splice(tval) 
                            })())
                        };
                        return idx+=1
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__15()) {
                        await __body_ref__16();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                return rval
            }
        } else if (check_true ((tree instanceof Object))) {
            {
                rval=new Object();
                await (async function() {
                    let __for_body__19=async function(pset) {
                        return await async function(){
                            rval[(pset && pset["0"])]=await (async function(){
                                 return await do_deferred_splice((pset && pset["1"])) 
                            })();
                            return rval;
                            
                        }()
                    };
                    let __array__20=[],__elements__18=await (await Environment.get_global("pairs"))(tree);
                    let __BREAK__FLAG__=false;
                    for(let __iter__17 in __elements__18) {
                        __array__20.push(await __for_body__19(__elements__18[__iter__17]));
                        if(__BREAK__FLAG__) {
                             __array__20.pop();
                            break;
                            
                        }
                    }return __array__20;
                     
                })();
                return rval
            }
        } else {
            return tree
        }
    } ()
};__obj__1["define"]=async function(...defs) {
    let acc;
    let symname;
    acc=await (async function(){
         return ["=:progl"] 
    })();
    symname=null;
    await (async function() {
        let __for_body__24=async function(defset) {
            (acc).push(await (async function(){
                 return ["=:defvar",(defset && defset["0"]),(defset && defset["1"])] 
            })());
            symname=(defset && defset["0"]);
            (acc).push(await (async function(){
                 return ["=:set_prop",await (async function(){
                     return "=:Environment.global_ctx.scope" 
                })(),(""+ await (await Environment.get_global("as_lisp"))(symname)),symname] 
            })());
            if (check_true (((defset && defset["2"]) instanceof Object))){
                {
                    return (acc).push(await (async function(){
                         return [["=:set_prop",await (async function(){
                             return "=:Environment.definitions" 
                        })(),(""+ await (await Environment.get_global("as_lisp"))(symname)+ ""),(defset && defset["2"])]] 
                    })())
                }
            }
        };
        let __array__25=[],__elements__23=defs;
        let __BREAK__FLAG__=false;
        for(let __iter__22 in __elements__23) {
            __array__25.push(await __for_body__24(__elements__23[__iter__22]));
            if(__BREAK__FLAG__) {
                 __array__25.pop();
                break;
                
            }
        }return __array__25;
         
    })();
    return acc
};__obj__1["defbinding"]=async function(...args) {
    let binding;
    let acc;
    binding=null;
    acc=await (async function(){
         return ["=:list"] 
    })();
    await (async function() {
        let __for_body__28=async function(bind_set) {
            return await async function(){
                if (check_true (((bind_set instanceof Array)&& (((bind_set && bind_set.length)===2)|| ((bind_set && bind_set.length)===3))&& ((bind_set && bind_set["1"]) instanceof Array)&& ((bind_set && bind_set["1"] && bind_set["1"]["length"])===2)))) {
                    {
                        binding=await (async function(){
                             return ["=:quotel",await (async function(){
                                 return ["=:bind",(bind_set && bind_set["1"] && bind_set["1"]["0"]),(bind_set && bind_set["1"] && bind_set["1"]["1"])] 
                            })()] 
                        })();
                        return (acc).push(await (async function(){
                             return ["=:defglobal",((await Environment.get_global("*namespace*"))+ "/"+ await (async function(){
                                let mval;
                                mval=(bind_set && bind_set["0"]);
                                if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                                    return await mval["substr"].call(mval,2)
                                } else {
                                    return mval
                                }
                            })()),await (async function(){
                                 return ["=:bind",(bind_set && bind_set["1"] && bind_set["1"]["0"]),(bind_set && bind_set["1"] && bind_set["1"]["1"])] 
                            })(),await (async function(){
                                if (check_true (((bind_set && bind_set["2"]) instanceof Object))){
                                    return await (await Environment.get_global("add"))(new Object(),(bind_set && bind_set["2"]),{
                                        initializer:binding
                                    })
                                } else {
                                    return {
                                        initializer:binding
                                    }
                                }
                            })()] 
                        })())
                    }
                } else {
                    throw new SyntaxError("defbinding received malform arguments");
                    
                }
            } ()
        };
        let __array__29=[],__elements__27=args;
        let __BREAK__FLAG__=false;
        for(let __iter__26 in __elements__27) {
            __array__29.push(await __for_body__28(__elements__27[__iter__26]));
            if(__BREAK__FLAG__) {
                 __array__29.pop();
                break;
                
            }
        }return __array__29;
         
    })();
    return acc
};__obj__1["define_env"]=async function(...defs) {
    let acc;
    let symname;
    acc=await (async function(){
         return ["=:progl"] 
    })();
    symname=null;
    await (async function() {
        let __for_body__32=async function(defset) {
            (acc).push(await (async function(){
                 return ["=:defvar",(defset && defset["0"]),(defset && defset["1"])] 
            })());
            symname=(defset && defset["0"]);
            (acc).push(await (async function(){
                 return ["=:set_prop",await (async function(){
                     return "=:Environment.global_ctx.scope" 
                })(),(""+ await (await Environment.get_global("as_lisp"))(symname)),symname] 
            })());
            if (check_true (((defset && defset["2"]) instanceof Object))){
                return (acc).push(await (async function(){
                     return [["=:set_prop",await (async function(){
                         return "=:Environment.definitions" 
                    })(),(""+ await (await Environment.get_global("as_lisp"))(symname)+ ""),await (await Environment.get_global("add"))({
                        core_lang:true
                    },(defset && defset["2"]))]] 
                })())
            } else {
                return (acc).push(await (async function(){
                     return [["=:set_prop",await (async function(){
                         return "=:Environment.definitions" 
                    })(),(""+ await (await Environment.get_global("as_lisp"))(symname)+ ""),{
                        core_lang:true
                    }]] 
                })())
            }
        };
        let __array__33=[],__elements__31=defs;
        let __BREAK__FLAG__=false;
        for(let __iter__30 in __elements__31) {
            __array__33.push(await __for_body__32(__elements__31[__iter__30]));
            if(__BREAK__FLAG__) {
                 __array__33.pop();
                break;
                
            }
        }return __array__33;
         
    })();
    return acc
};__obj__1["type"]=async function(x) {
    return await async function(){
        if (check_true ((null===x))) {
            return "null"
        } else if (check_true ((undefined===x))) {
            return "undefined"
        } else if (check_true ((x instanceof Array))) {
            return "array"
        } else {
            return typeof x
        }
    } ()
};__obj__1["destructure_list"]=async function(elems) {
    let idx;
    let acc;
    let structure;
    let follow_tree;
    idx=0;
    acc=[];
    structure=elems;
    follow_tree=async function(elems,_path_prefix) {
        return await async function(){
            if (check_true ((elems instanceof Array))) {
                return await (await Environment.get_global("map"))(async function(elem,idx) {
                    return await follow_tree(elem,await (await Environment.get_global("add"))(_path_prefix,idx))
                },elems)
            } else if (check_true ((elems instanceof Object))) {
                return await (async function() {
                    let __for_body__36=async function(pset) {
                        return await follow_tree((pset && pset["1"]),await (await Environment.get_global("add"))(_path_prefix,(pset && pset["0"])))
                    };
                    let __array__37=[],__elements__35=await (await Environment.get_global("pairs"))(elems);
                    let __BREAK__FLAG__=false;
                    for(let __iter__34 in __elements__35) {
                        __array__37.push(await __for_body__36(__elements__35[__iter__34]));
                        if(__BREAK__FLAG__) {
                             __array__37.pop();
                            break;
                            
                        }
                    }return __array__37;
                     
                })()
            } else {
                return (acc).push(_path_prefix)
            }
        } ()
    };
    await follow_tree(structure,[]);
    return acc
};__obj__1["destructuring_bind"]=async function(bind_vars,expression,...forms) {
    let binding_vars;
    let paths;
    let bound_expression;
    let allocations;
    let acc;
    binding_vars=bind_vars;
    paths=await (async function(){
         return await (await Environment.get_global("destructure_list"))(binding_vars) 
    })();
    bound_expression=expression;
    allocations=[];
    acc=await (async function(){
         return ["=:let"] 
    })();
    await (await Environment.get_global("assert"))(((bind_vars instanceof Array)&& await (async function(){
         return await (await Environment.get_global("is_value?"))(expression) 
    })()&& await (async function(){
         return await (await Environment.get_global("is_value?"))(forms) 
    })()),"destructuring_bind: requires 3 arguments");
    await (async function() {
        let __for_body__40=async function(idx) {
            return (allocations).push(await (async function(){
                 return [await (await Environment.get_global("resolve_path"))(paths[idx],binding_vars),await (async function(){
                     return await async function(){
                        if (check_true ((expression instanceof Object))) {
                            return await (await Environment.get_global("resolve_path"))(paths[idx],expression)
                        } else {
                            return (await (await Environment.get_global("conj"))(await (async function(){
                                let __array_op_rval__42=expression;
                                 if (__array_op_rval__42 instanceof Function){
                                    return await __array_op_rval__42() 
                                } else {
                                    return [__array_op_rval__42]
                                }
                            })(),paths[idx])).join(".")
                        }
                    } () 
                })()] 
            })())
        };
        let __array__41=[],__elements__39=await (await Environment.get_global("range"))(await (await Environment.get_global("length"))(paths));
        let __BREAK__FLAG__=false;
        for(let __iter__38 in __elements__39) {
            __array__41.push(await __for_body__40(__elements__39[__iter__38]));
            if(__BREAK__FLAG__) {
                 __array__41.pop();
                break;
                
            }
        }return __array__41;
         
    })();
    (acc).push(allocations);
    acc=await (await Environment.get_global("conj"))(acc,forms);
    return acc
};__obj__1["split_by_recurse"]=function(token,container) {
        return   (function(){
            if (check_true ((container instanceof String || typeof container==='string'))) {
                return (container).split(token)
            } else if (check_true ((container instanceof Array))) {
                return  ( Environment.get_global("map"))(async function(elem) {
                    return  ( Environment.get_global("split_by_recurse"))(token,elem)
                },container)
            }
        } )()
    };__obj__1["reduce"]=async function(...args) {
    let elem;
    let item_list;
    let form;
    elem=(args && args["0"] && args["0"]["0"]);
    item_list=(args && args["0"] && args["0"]["1"]);
    form=(args && args["1"]);
    return ["=:let",[["=:__collector",[]],["=:__result","=:nil"],["=:__action",["=:fn",[].concat(elem),form]]],["=:declare",["=:function","=:__action"]],["=:for_each",["=:__item",item_list],["=:do",["=:=","=:__result",["=:__action","=:__item"]],["=:if","=:__result",["=:push","=:__collector","=:__result"]]]],"=:__collector"]
};__obj__1["bind_function"]=function anonymous(func,this_arg
) {
{ return func.bind(this_arg) }
};__obj__1["is_reference?"]=async function(val) {
    return ["=:and",["=:is_string?",val],["=:>",["=:length",val],2],["=:starts_with?",["=:quote","=:"],val]]
};__obj__1["scan_str"]=async function(regex,search_string) {
    let result;
    let last_result;
    let totals;
    let strs;
    result=null;
    last_result=null;
    totals=[];
    strs=(""+ search_string);
    if (check_true (await (await Environment.get_global("is_regex?"))(regex))){
        {
            await async function(){
                regex["lastIndex"]=0;
                return regex;
                
            }();
            await (async function(){
                 let __test_condition__53=async function() {
                    return (await (async function(){
                        result=await regex["exec"].call(regex,strs);
                        return true
                    })()&& result&& await (async function(){
                        if (check_true (last_result)){
                            return await (await Environment.get_global("not"))(((result && result["0"])===(last_result && last_result["0"])))
                        } else {
                            return true
                        }
                    })())
                };
                let __body_ref__54=async function() {
                    last_result=result;
                    return (totals).push(await (await Environment.get_global("to_object"))(await (async function(){
                         return await (await Environment.get_global("map"))(async function(v) {
                            return await (async function(){
                                let __array_op_rval__55=v;
                                 if (__array_op_rval__55 instanceof Function){
                                    return await __array_op_rval__55(result[v]) 
                                } else {
                                    return [__array_op_rval__55,result[v]]
                                }
                            })()
                        },await (await Environment.get_global("keys"))(result)) 
                    })()))
                };
                let __BREAK__FLAG__=false;
                while(await __test_condition__53()) {
                    await __body_ref__54();
                     if(__BREAK__FLAG__) {
                         break;
                        
                    }
                } ;
                
            })()
        }
    } else {
        throw new Error(new ReferenceError(("scan_str: invalid RegExp provided: "+ regex)));
        
    };
    return totals
};__obj__1["remove_prop"]=async function(obj,key) {
    if (check_true (await (await Environment.get_global("not"))((undefined===obj[key])))){
        {
            {
                let val;
                val=obj[key];
                await (await Environment.get_global("delete_prop"))(obj,key);
                return val
            }
        }
    }
};__obj__1["object_methods"]=async function(obj) {
    let properties;
    let current_obj;
    properties=new Set();
    current_obj=obj;
    await (async function(){
         let __test_condition__274=async function() {
            return current_obj
        };
        let __body_ref__275=async function() {
            await (await Environment.get_global("map"))(async function(item) {
                return await properties["add"].call(properties,item)
            },await Object.getOwnPropertyNames(current_obj));
            return current_obj=await Object.getPrototypeOf(current_obj)
        };
        let __BREAK__FLAG__=false;
        while(await __test_condition__274()) {
            await __body_ref__275();
             if(__BREAK__FLAG__) {
                 break;
                
            }
        } ;
        
    })();
    return await (async function() {
        {
             let __call_target__=await Array.from(await properties["keys"]()), __call_method__="filter";
            return await __call_target__[__call_method__].call(__call_target__,async function(item) {
                return item instanceof Function
            })
        } 
    })()
};__obj__1["expand_dot_accessor"]=async function(val,ctx) {
    let comps;
    let find_in_ctx;
    let reference;
    let val_type;
    comps=(val).split(".");
    find_in_ctx=async function(the_ctx) {
        return await async function(){
            if (check_true (await (async function(){
                let __targ__58=(the_ctx && the_ctx["scope"]);
                if (__targ__58){
                     return(__targ__58)[reference]
                } 
            })())) {
                return await (async function(){
                    let __targ__59=(the_ctx && the_ctx["scope"]);
                    if (__targ__59){
                         return(__targ__59)[reference]
                    } 
                })()
            } else if (check_true ((the_ctx && the_ctx["parent"]))) {
                return await find_in_ctx((the_ctx && the_ctx["parent"]))
            }
        } ()
    };
    reference=(comps).shift();
    val_type=await find_in_ctx(ctx);
    return await async function(){
        if (check_true ((0===(comps && comps.length)))) {
            return reference
        } else if (check_true (((val_type instanceof Object)&& await (await Environment.get_global("contains?"))((comps && comps["0"]),await (async function(){
             return await (await Environment.get_global("object_methods"))(val_type) 
        })())&& await (await Environment.get_global("not"))(await val_type["propertyIsEnumerable"].call(val_type,(comps && comps["0"])))))) {
            return val
        } else {
            return (await (await Environment.get_global("conj"))(await (async function(){
                let __array_op_rval__60=reference;
                 if (__array_op_rval__60 instanceof Function){
                    return await __array_op_rval__60() 
                } else {
                    return [__array_op_rval__60]
                }
            })(),await (await Environment.get_global("flatten"))(await (async function() {
                let __for_body__63=async function(comp) {
                    if (check_true (await (await Environment.get_global("is_number?"))(comp))){
                        return ["[",comp,"]"]
                    } else {
                        return ["[\"",comp,"\"]"]
                    }
                };
                let __array__64=[],__elements__62=comps;
                let __BREAK__FLAG__=false;
                for(let __iter__61 in __elements__62) {
                    __array__64.push(await __for_body__63(__elements__62[__iter__61]));
                    if(__BREAK__FLAG__) {
                         __array__64.pop();
                        break;
                        
                    }
                }return __array__64;
                 
            })()))).join("")
        }
    } ()
};__obj__1["getf_ctx"]=async function(ctx,name,_value) {
    if (check_true ((ctx&& (name instanceof String || typeof name==='string')))){
        return await async function(){
            if (check_true (await (await Environment.get_global("not"))((undefined===await (async function(){
                let __targ__65=(ctx && ctx["scope"]);
                if (__targ__65){
                     return(__targ__65)[name]
                } 
            })())))) {
                if (check_true (await (await Environment.get_global("not"))((_value===undefined)))){
                    {
                        await async function(){
                            let __target_obj__66=(ctx && ctx["scope"]);
                            __target_obj__66[name]=_value;
                            return __target_obj__66;
                            
                        }();
                        return _value
                    }
                } else {
                    return await (async function(){
                        let __targ__67=(ctx && ctx["scope"]);
                        if (__targ__67){
                             return(__targ__67)[name]
                        } 
                    })()
                }
            } else if (check_true ((ctx && ctx["parent"]))) {
                return await (await Environment.get_global("getf_ctx"))((ctx && ctx["parent"]),name,_value)
            } else {
                return undefined
            }
        } ()
    } else {
        throw new Error("invalid call to getf_ctx: missing argument/s");
        
    }
};__obj__1["setf_ctx"]=async function(ctx,name,value) {
    let found_val;
    found_val=await (async function(){
         return await (await Environment.get_global("getf_ctx"))(ctx,name,value) 
    })();
    if (check_true ((found_val===undefined))){
        await async function(){
            let __target_obj__68=(ctx && ctx["scope"]);
            __target_obj__68[name]=value;
            return __target_obj__68;
            
        }()
    };
    return value
};__obj__1["set_path"]=async function(path,obj,value) {
    let fpath;
    let idx;
    let rpath;
    let target_obj;
    fpath=await (async function(){
         return await clone(path) 
    })();
    idx=(fpath).pop();
    rpath=fpath;
    target_obj=null;
    target_obj=await (await Environment.get_global("resolve_path"))(rpath,obj);
    if (check_true (target_obj)){
        {
            return await async function(){
                target_obj[idx]=value;
                return target_obj;
                
            }()
        }
    } else {
        throw new RangeError(("set_path: invalid path: "+ path));
        
    }
};__obj__1["minmax"]=async function(container) {
    let value_found=false;
    ;
    let smallest=(await Environment.get_global("MAX_SAFE_INTEGER"));
    ;
    let biggest=(-1* (await Environment.get_global("MAX_SAFE_INTEGER")));
    ;
    if (check_true ((container&& (container instanceof Array)&& (await (await Environment.get_global("length"))(container)>0)))){
        {
            await (async function() {
                let __for_body__25=async function(value) {
                    return (await (await Environment.get_global("is_number?"))(value)&& await (async function(){
                        value_found=true;
                        smallest=await Math.min(value,smallest);
                        return biggest=await Math.max(value,biggest)
                    })())
                };
                let __array__26=[],__elements__24=container;
                let __BREAK__FLAG__=false;
                for(let __iter__23 in __elements__24) {
                    __array__26.push(await __for_body__25(__elements__24[__iter__23]));
                    if(__BREAK__FLAG__) {
                         __array__26.pop();
                        break;
                        
                    }
                }return __array__26;
                 
            })();
            if (check_true (value_found)){
                return await (async function(){
                    let __array_op_rval__27=smallest;
                     if (__array_op_rval__27 instanceof Function){
                        return await __array_op_rval__27(biggest) 
                    } else {
                        return [__array_op_rval__27,biggest]
                    }
                })()
            } else {
                return null
            }
        }
    } else {
        return null
    }
};__obj__1["gen_multiples"]=async function(len,multiple_ques_) {
    let val;
    let acc;
    let mult;
    val=100;
    acc=await (async function(){
        let __array_op_rval__75=val;
         if (__array_op_rval__75 instanceof Function){
            return await __array_op_rval__75() 
        } else {
            return [__array_op_rval__75]
        }
    })();
    mult=(multiple_ques_|| 10);
    await (async function() {
        let __for_body__78=async function(r) {
            return (acc).push(val=(val* mult))
        };
        let __array__79=[],__elements__77=await (await Environment.get_global("range"))(len);
        let __BREAK__FLAG__=false;
        for(let __iter__76 in __elements__77) {
            __array__79.push(await __for_body__78(__elements__77[__iter__76]));
            if(__BREAK__FLAG__) {
                 __array__79.pop();
                break;
                
            }
        }return __array__79;
         
    })();
    return (acc).slice(0).reverse()
};__obj__1["path_multiply"]=async function(path,multiple_ques_) {
    let acc;
    let multiples;
    acc=0;
    multiples=await (async function(){
         return await (await Environment.get_global("gen_multiples"))(await (await Environment.get_global("length"))(path),multiple_ques_) 
    })();
    await (async function() {
        let __for_body__82=async function(pset) {
            return acc=(acc+ ((pset && pset["0"])* (pset && pset["1"])))
        };
        let __array__83=[],__elements__81=await (await Environment.get_global("pairs"))(await (async function(){
             return await (await Environment.get_global("interlace"))(path,multiples) 
        })());
        let __BREAK__FLAG__=false;
        for(let __iter__80 in __elements__81) {
            __array__83.push(await __for_body__82(__elements__81[__iter__80]));
            if(__BREAK__FLAG__) {
                 __array__83.pop();
                break;
                
            }
        }return __array__83;
         
    })();
    return acc
};__obj__1["splice_in_return_a"]=async function(js_tree,_ctx,_depth,_path) {
    return await async function(){
        if (check_true ((js_tree instanceof Array))) {
            {
                let idx;
                let ntree;
                let root;
                let if_links;
                let function_block_ques_;
                let last_path;
                let __last__84= async function(){
                    return await Environment.get_global("last")
                };
                let __add__85= async function(){
                    return await Environment.get_global("add")
                };
                let __conj__86= async function(){
                    return await Environment.get_global("conj")
                };
                let __getf_ctx__87= async function(){
                    return await Environment.get_global("getf_ctx")
                };
                let new_ctx;
                let splice_log;
                let next_val;
                {
                    idx=-1;
                    ntree=[];
                    _depth=(_depth|| 0);
                    _path=(_path|| []);
                    root=_path;
                    if_links=new Object();
                    function_block_ques_=await (async function(){
                        if (check_true ((_depth===0))){
                            return true
                        } else {
                            return false
                        }
                    })();
                    last_path=null;
                    let last=await __last__84();
                    ;
                    let add=await __add__85();
                    ;
                    let conj=await __conj__86();
                    ;
                    let getf_ctx=await __getf_ctx__87();
                    ;
                    new_ctx=async function(ctx) {
                        return {
                            parent:ctx,scope:{
                                level:await (async function(){
                                    if (check_true ((ctx && ctx["scope"] && ctx["scope"]["level"]))){
                                        return await add((ctx && ctx["scope"] && ctx["scope"]["level"]),1)
                                    } else {
                                        return 0
                                    }
                                })(),viable_return_points:[],base_path:await (async function(){
                                     return await clone(_path) 
                                })(),potential_return_points:[],return_found:false,if_links:new Object()
                            }
                        }
                    };
                    _ctx=(_ctx|| await new_ctx(null));
                    splice_log=await (async function(){
                         return await (await Environment.get_global("defclog"))({
                            prefix:("splice_return ["+ (_ctx && _ctx["scope"] && _ctx["scope"]["level"])+ "]"),color:"black",background:"#20F0F0"
                        }) 
                    })();
                    next_val=null;
                    await (async function() {
                        let __for_body__90=async function(comp) {
                            idx+=1;
                            last_path=await conj(_path,await (async function(){
                                let __array_op_rval__92=idx;
                                 if (__array_op_rval__92 instanceof Function){
                                    return await __array_op_rval__92() 
                                } else {
                                    return [__array_op_rval__92]
                                }
                            })());
                            return await async function(){
                                if (check_true ((comp instanceof Array))) {
                                    return (ntree).push(await (async function(){
                                         return await (await Environment.get_global("splice_in_return_a"))(comp,_ctx,await add(_depth,1),await conj(_path,await (async function(){
                                            let __array_op_rval__93=idx;
                                             if (__array_op_rval__93 instanceof Function){
                                                return await __array_op_rval__93() 
                                            } else {
                                                return [__array_op_rval__93]
                                            }
                                        })())) 
                                    })())
                                } else if (check_true (((comp instanceof String || typeof comp==='string')|| await (await Environment.get_global("is_number?"))(comp)|| comp instanceof Function))) {
                                    return (ntree).push(comp)
                                } else if (check_true ((comp instanceof Object))) {
                                    return await async function(){
                                        if (check_true ((comp && comp["ctype"]) instanceof Function)) {
                                            {
                                                return (ntree).push(comp)
                                            }
                                        } else if (check_true ((((comp && comp["ctype"])==="AsyncFunction")|| ((comp && comp["ctype"])==="Function")))) {
                                            {
                                                _path=[];
                                                _ctx=await new_ctx(_ctx);
                                                function_block_ques_=true;
                                                return (ntree).push(comp)
                                            }
                                        } else if (check_true (((comp && comp["mark"])==="rval"))) {
                                            {
                                                (await (async function(){
                                                     return await getf_ctx(_ctx,"potential_return_points") 
                                                })()).push({
                                                    path:await conj(_path,await (async function(){
                                                        let __array_op_rval__94=idx;
                                                         if (__array_op_rval__94 instanceof Function){
                                                            return await __array_op_rval__94() 
                                                        } else {
                                                            return [__array_op_rval__94]
                                                        }
                                                    })()),type:(comp && comp["mark"]),rp:(comp && comp["rp"]),block_step:(comp && comp["block_step"]),cbs:(comp && comp["cbs"]),suppress:(comp && comp["suppress"]),block_id:(comp && comp["block_id"]),if_id:(comp && comp["if_id"]),source:await JSON.stringify(await (async function(){
                                                         return await clone(await (await Environment.get_global("slice"))(js_tree,idx)) 
                                                    })()),lambda_step:(comp && comp["lambda_step"])
                                                });
                                                if (check_true (((comp && comp["if_id"])&& (null==await (async function(){
                                                    let __targ__95=await (async function(){
                                                         return await getf_ctx(_ctx,"if_links") 
                                                    })();
                                                    if (__targ__95){
                                                         return(__targ__95)[(comp && comp["if_id"])]
                                                    } 
                                                })())))){
                                                    {
                                                        await async function(){
                                                            let __target_obj__96=await getf_ctx(_ctx,"if_links");
                                                            __target_obj__96[(comp && comp["if_id"])]=[];
                                                            return __target_obj__96;
                                                            
                                                        }()
                                                    }
                                                };
                                                if (check_true (((comp && comp["if_id"])&& await (await Environment.get_global("not"))((comp && comp["suppress"]))))){
                                                    {
                                                        (await (async function(){
                                                            let __targ__97=await (async function(){
                                                                 return await getf_ctx(_ctx,"if_links") 
                                                            })();
                                                            if (__targ__97){
                                                                 return(__targ__97)[(comp && comp["if_id"])]
                                                            } 
                                                        })()).push(await last(await (async function(){
                                                             return await getf_ctx(_ctx,"potential_return_points") 
                                                        })()))
                                                    }
                                                };
                                                return (ntree).push(comp)
                                            }
                                        } else if (check_true (((comp && comp["mark"])==="forced_return"))) {
                                            {
                                                (await (async function(){
                                                     return await getf_ctx(_ctx,"viable_return_points") 
                                                })()).push({
                                                    path:await conj(_path,await (async function(){
                                                        let __array_op_rval__98=idx;
                                                         if (__array_op_rval__98 instanceof Function){
                                                            return await __array_op_rval__98() 
                                                        } else {
                                                            return [__array_op_rval__98]
                                                        }
                                                    })()),if_id:(comp && comp["if_id"]),block_step:(comp && comp["block_step"]),rp:(comp && comp["rp"]),block_id:(comp && comp["block_id"]),lambda_step:(comp && comp["lambda_step"]),source:await JSON.stringify(await (async function(){
                                                         return await clone(await (await Environment.get_global("slice"))(js_tree,idx)) 
                                                    })()),type:(comp && comp["mark"])
                                                });
                                                if (check_true (((comp && comp["if_id"])&& (null==await (async function(){
                                                    let __targ__99=await (async function(){
                                                         return await getf_ctx(_ctx,"if_links") 
                                                    })();
                                                    if (__targ__99){
                                                         return(__targ__99)[(comp && comp["if_id"])]
                                                    } 
                                                })())))){
                                                    {
                                                        await async function(){
                                                            let __target_obj__100=await getf_ctx(_ctx,"if_links");
                                                            __target_obj__100[(comp && comp["if_id"])]=[];
                                                            return __target_obj__100;
                                                            
                                                        }()
                                                    }
                                                };
                                                if (check_true (((comp && comp["if_id"])&& await (await Environment.get_global("not"))((comp && comp["suppress"]))))){
                                                    {
                                                        (await (async function(){
                                                            let __targ__101=await (async function(){
                                                                 return await getf_ctx(_ctx,"if_links") 
                                                            })();
                                                            if (__targ__101){
                                                                 return(__targ__101)[(comp && comp["if_id"])]
                                                            } 
                                                        })()).push(await last(await (async function(){
                                                             return await getf_ctx(_ctx,"viable_return_points") 
                                                        })()))
                                                    }
                                                };
                                                return (ntree).push(comp)
                                            }
                                        } else if (check_true (((comp && comp["mark"])==="final-return"))) {
                                            {
                                                (await (async function(){
                                                     return await getf_ctx(_ctx,"viable_return_points") 
                                                })()).push({
                                                    path:await conj(_path,await (async function(){
                                                        let __array_op_rval__102=idx;
                                                         if (__array_op_rval__102 instanceof Function){
                                                            return await __array_op_rval__102() 
                                                        } else {
                                                            return [__array_op_rval__102]
                                                        }
                                                    })()),type:(comp && comp["mark"]),lambda_step:(comp && comp["lambda_step"]),block_step:(comp && comp["block_step"]),block_id:(comp && comp["block_id"]),rp:(comp && comp["rp"]),source:await JSON.stringify(await (async function(){
                                                         return await clone(await (await Environment.get_global("slice"))(js_tree,idx)) 
                                                    })()),if_id:(comp && comp["if_id"])
                                                });
                                                if (check_true (((comp && comp["if_id"])&& (null==await (async function(){
                                                    let __targ__103=await (async function(){
                                                         return await getf_ctx(_ctx,"if_links") 
                                                    })();
                                                    if (__targ__103){
                                                         return(__targ__103)[(comp && comp["if_id"])]
                                                    } 
                                                })())))){
                                                    {
                                                        await async function(){
                                                            let __target_obj__104=await getf_ctx(_ctx,"if_links");
                                                            __target_obj__104[(comp && comp["if_id"])]=[];
                                                            return __target_obj__104;
                                                            
                                                        }()
                                                    }
                                                };
                                                if (check_true ((comp && comp["if_id"]))){
                                                    {
                                                        if (check_true (await (await Environment.get_global("not"))((comp && comp["suppress"])))){
                                                            {
                                                                (await (async function(){
                                                                    let __targ__105=await (async function(){
                                                                         return await getf_ctx(_ctx,"if_links") 
                                                                    })();
                                                                    if (__targ__105){
                                                                         return(__targ__105)[(comp && comp["if_id"])]
                                                                    } 
                                                                })()).push(await last(await (async function(){
                                                                     return await getf_ctx(_ctx,"viable_return_points") 
                                                                })()))
                                                            }
                                                        };
                                                        (await (async function(){
                                                             return await getf_ctx(_ctx,"potential_return_points") 
                                                        })()).push({
                                                            path:await conj(_path,await (async function(){
                                                                let __array_op_rval__106=idx;
                                                                 if (__array_op_rval__106 instanceof Function){
                                                                    return await __array_op_rval__106() 
                                                                } else {
                                                                    return [__array_op_rval__106]
                                                                }
                                                            })()),type:(comp && comp["mark"]),lambda_step:(comp && comp["lambda_step"]),block_step:(comp && comp["block_step"]),block_id:(comp && comp["block_id"]),rp:(comp && comp["rp"]),source:await JSON.stringify(await (async function(){
                                                                 return await clone(await (await Environment.get_global("slice"))(js_tree,idx)) 
                                                            })()),if_id:(comp && comp["if_id"])
                                                        })
                                                    }
                                                };
                                                await (await Environment.get_global("setf_ctx"))(_ctx,"return_found",true);
                                                return (ntree).push(comp)
                                            }
                                        } else {
                                            return (ntree).push(comp)
                                        }
                                    } ()
                                } else {
                                    return (ntree).push(comp)
                                }
                            } ()
                        };
                        let __array__91=[],__elements__89=js_tree;
                        let __BREAK__FLAG__=false;
                        for(let __iter__88 in __elements__89) {
                            __array__91.push(await __for_body__90(__elements__89[__iter__88]));
                            if(__BREAK__FLAG__) {
                                 __array__91.pop();
                                break;
                                
                            }
                        }return __array__91;
                         
                    })();
                    if (check_true (function_block_ques_)){
                        {
                            {
                                let viables;
                                let potentials;
                                let base_path;
                                let base_addr;
                                let final_viable_path;
                                let max_viable;
                                let last_return_score;
                                let handled_blocks;
                                let plength;
                                let rscore;
                                let if_paths;
                                let max_path_segment_length;
                                let final_return_found;
                                viables=((await (async function(){
                                     return await getf_ctx(_ctx,"viable_return_points") 
                                })()|| [])).slice(0).reverse();
                                potentials=((await (async function(){
                                     return await getf_ctx(_ctx,"potential_return_points") 
                                })()|| [])).slice(0).reverse();
                                base_path=await (async function(){
                                     return await getf_ctx(_ctx,"base_path") 
                                })();
                                base_addr=null;
                                final_viable_path=(viables&& await (await Environment.get_global("first"))(viables)&& await (async function(){
                                    let __targ__107=await (await Environment.get_global("first"))(viables);
                                    if (__targ__107){
                                         return(__targ__107)["path"]
                                    } 
                                })());
                                max_viable=0;
                                last_return_score=null;
                                handled_blocks=[];
                                plength=0;
                                rscore=0;
                                if_paths=[];
                                max_path_segment_length=null;
                                final_return_found=await (async function(){
                                     return await getf_ctx(_ctx,"return_found") 
                                })();
                                await (async function() {
                                    let __for_body__110=async function(v) {
                                        await (await Environment.get_global("set_path"))((v && v["path"]),ntree,{
                                            mark:"return_point",rpoint:(v && v["rpoint"])
                                        });
                                        if (check_true ((v && v["block_id"]))){
                                            {
                                                return (handled_blocks).push((v && v["block_id"]))
                                            }
                                        }
                                    };
                                    let __array__111=[],__elements__109=viables;
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__108 in __elements__109) {
                                        __array__111.push(await __for_body__110(__elements__109[__iter__108]));
                                        if(__BREAK__FLAG__) {
                                             __array__111.pop();
                                            break;
                                            
                                        }
                                    }return __array__111;
                                     
                                })();
                                await (async function() {
                                    let __for_body__114=async function(p) {
                                        plength=await Math.min(await (await Environment.get_global("length"))((p && p["path"])),await (await Environment.get_global("length"))(final_viable_path));
                                        let ppath=await (await Environment.get_global("slice"))((p && p["path"]),0,plength);
                                        ;
                                        let vpath=await (async function(){
                                            if (check_true (final_viable_path)){
                                                return await (await Environment.get_global("slice"))(final_viable_path,0,plength)
                                            } else {
                                                return []
                                            }
                                        })();
                                        ;
                                        max_path_segment_length=await Math.max(8,(1+ await (async function(){
                                            let __targ__116=await (async function(){
                                                 return await (await Environment.get_global("minmax"))(ppath) 
                                            })();
                                            if (__targ__116){
                                                 return(__targ__116)[1]
                                            } 
                                        })()),(1+ await (async function(){
                                            let __targ__117=await (async function(){
                                                 return await (await Environment.get_global("minmax"))(vpath) 
                                            })();
                                            if (__targ__117){
                                                 return(__targ__117)[1]
                                            } 
                                        })()));
                                        if (check_true (await isNaN(max_path_segment_length))){
                                            {
                                                max_path_segment_length=8
                                            }
                                        };
                                        if (check_true ((null==last_return_score))){
                                            last_return_score=await (async function(){
                                                 return await (await Environment.get_global("path_multiply"))(vpath,max_path_segment_length) 
                                            })()
                                        };
                                        rscore=await (async function(){
                                             return await (await Environment.get_global("path_multiply"))(vpath,max_path_segment_length) 
                                        })();
                                        if (check_true (((await (await Environment.get_global("path_multiply"))(ppath,max_path_segment_length)>last_return_score)|| (((p && p["block_step"])===0)&& ((p && p["lambda_step"])===0)&& await (await Environment.get_global("not"))((p && p["suppress"])))|| (0===await (await Environment.get_global("length"))(viables))))){
                                            {
                                                await (await Environment.get_global("set_path"))((p && p["path"]),ntree,{
                                                    mark:"return_point"
                                                });
                                                last_return_score=await Math.max(await (async function(){
                                                     return await (await Environment.get_global("path_multiply"))(ppath,max_path_segment_length) 
                                                })(),last_return_score);
                                                if (check_true (((p && p["if_id"])&& await (async function(){
                                                    let __targ__118=await (async function(){
                                                         return await getf_ctx(_ctx,"if_links") 
                                                    })();
                                                    if (__targ__118){
                                                         return(__targ__118)[(p && p["if_id"])]
                                                    } 
                                                })()))){
                                                    {
                                                        return await (async function() {
                                                            let __for_body__121=async function(pinfo) {
                                                                if (check_true ((undefined===if_paths[await (await Environment.get_global("as_lisp"))((pinfo && pinfo["path"]))]))){
                                                                    {
                                                                        await async function(){
                                                                            if_paths[await (await Environment.get_global("as_lisp"))((pinfo && pinfo["path"]))]=true;
                                                                            return if_paths;
                                                                            
                                                                        }();
                                                                        return await (await Environment.get_global("set_path"))((pinfo && pinfo["path"]),ntree,{
                                                                            mark:"return_point"
                                                                        })
                                                                    }
                                                                }
                                                            };
                                                            let __array__122=[],__elements__120=await (async function(){
                                                                let __targ__124=await (async function(){
                                                                     return await getf_ctx(_ctx,"if_links") 
                                                                })();
                                                                if (__targ__124){
                                                                     return(__targ__124)[(p && p["if_id"])]
                                                                } 
                                                            })();
                                                            let __BREAK__FLAG__=false;
                                                            for(let __iter__119 in __elements__120) {
                                                                __array__122.push(await __for_body__121(__elements__120[__iter__119]));
                                                                if(__BREAK__FLAG__) {
                                                                     __array__122.pop();
                                                                    break;
                                                                    
                                                                }
                                                            }return __array__122;
                                                             
                                                        })()
                                                    }
                                                }
                                            }
                                        } else {
                                            {
                                                if (check_true (((undefined===if_paths[await (await Environment.get_global("as_lisp"))((p && p["path"]))])&& await (await Environment.get_global("not"))(((p && p["type"])==="final-return"))))){
                                                    {
                                                        return await (await Environment.get_global("set_path"))((p && p["path"]),ntree,{
                                                            mark:"ignore"
                                                        })
                                                    }
                                                }
                                            }
                                        }
                                    };
                                    let __array__115=[],__elements__113=potentials;
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__112 in __elements__113) {
                                        __array__115.push(await __for_body__114(__elements__113[__iter__112]));
                                        if(__BREAK__FLAG__) {
                                             __array__115.pop();
                                            break;
                                            
                                        }
                                    }return __array__115;
                                     
                                })()
                            }
                        }
                    };
                    return ntree
                }
            }
        } else {
            return js_tree
        }
    } ()
};__obj__1["splice_in_return_b"]=async function(js_tree,_ctx,_depth) {
    return await async function(){
        if (check_true ((js_tree instanceof Array))) {
            {
                let idx;
                let ntree;
                let next_val;
                let flattened;
                idx=0;
                ntree=[];
                _ctx=(_ctx|| new Object());
                next_val=null;
                flattened=await (await Environment.get_global("flatten"))(js_tree);
                await (async function() {
                    let __for_body__127=async function(comp) {
                        next_val=flattened[(idx+ 1)];
                        await async function(){
                            if (check_true ((comp instanceof Array))) {
                                return (ntree).push(await (async function(){
                                     return await (await Environment.get_global("splice_in_return_b"))(comp,_ctx,await (await Environment.get_global("add"))((_depth|| 0),1)) 
                                })())
                            } else if (check_true (((comp instanceof Object)&& ((comp && comp["mark"])==="return_point")&& (await (await Environment.get_global("not"))(("return"===next_val))&& await (await Environment.get_global("not"))(("throw"===next_val))&& await (await Environment.get_global("not"))(("yield"===next_val))&& await (await Environment.get_global("not"))(((next_val instanceof Object)&& ((next_val && next_val["ctype"]) instanceof String || typeof (next_val && next_val["ctype"])==='string')&& await (await Environment.get_global("contains?"))("block",((next_val && next_val["ctype"])|| "")))))))) {
                                {
                                    (ntree).push(comp);
                                    (ntree).push(" ");
                                    (ntree).push("return");
                                    (ntree).push(" ")
                                }
                            } else {
                                (ntree).push(comp)
                            }
                        } ();
                        return idx+=1
                    };
                    let __array__128=[],__elements__126=flattened;
                    let __BREAK__FLAG__=false;
                    for(let __iter__125 in __elements__126) {
                        __array__128.push(await __for_body__127(__elements__126[__iter__125]));
                        if(__BREAK__FLAG__) {
                             __array__128.pop();
                            break;
                            
                        }
                    }return __array__128;
                     
                })();
                return ntree
            }
        } else {
            return js_tree
        }
    } ()
};__obj__1["aif"]=async function(test_expr,eval_when_true,eval_when_false) {
    return ["=:let",[["=:it",test_expr]],["=:if","=:it",eval_when_true,eval_when_false]]
};__obj__1["ifa"]=async function(test,thenclause,elseclause) {
    return ["=:let",[["=:it",test]],["=:if","=:it",thenclause,elseclause]]
};__obj__1["map_range"]=async function(n,from_range,to_range) {
    return await (await Environment.get_global("add"))((to_range && to_range["0"]),(((n- (from_range && from_range["0"]))/ ((from_range && from_range["1"])- (from_range && from_range["0"])))* ((to_range && to_range["1"])- (to_range && to_range["0"]))))
};__obj__1["range_inc"]=async function(start,end,step) {
    if (check_true (end)){
        return await (await Environment.get_global("range"))(start,await (await Environment.get_global("add"))(end,1),step)
    } else {
        return await (await Environment.get_global("range"))(await (await Environment.get_global("add"))(start,1))
    }
};__obj__1["HSV_to_RGB"]=function anonymous(h, s, v
) {
{
        var r, g, b, i, f, p, q, t;
        if (arguments.length === 1) {
            s = h.s, v = h.v, h = h.h;
        }
        i = Math.floor(h * 6);
        f = h * 6 - i;
        p = v * (1 - s);
        q = v * (1 - f * s);
        t = v * (1 - (1 - f) * s);
        switch (i % 6) {
            case 0: r = v, g = t, b = p; break;
            case 1: r = q, g = v, b = p; break;
            case 2: r = p, g = v, b = t; break;
            case 3: r = p, g = q, b = v; break;
            case 4: r = t, g = p, b = v; break;
            case 5: r = v, g = p, b = q; break;
        }
        return {
            r: Math.round(r * 255),
            g: Math.round(g * 255),
            b: Math.round(b * 255)
        }
    }
};__obj__1["color_for_number"]=async function(num,saturation,brightness) {
    let h;
    let pos;
    let color_key;
    let rgb;
    let v;
    h=await Math.abs(await parseInt(num));
    pos=(8% h);
    color_key=[0,4,1,5,2,6,3,7];
    rgb=null;
    v=color_key[pos];
    ;
    h=await (async function(){
         return await (await Environment.get_global("map_range"))((360% (28* h)),[0,360],[0,1]) 
    })();
    v=await (async function(){
         return await (await Environment.get_global("map_range"))([v,[0,7],[0.92,1]]) 
    })();
    rgb=await (await Environment.get_global("HSV_to_RGB"))(h,saturation,brightness);
    return ("#"+ await (async function() {
        {
             let __call_target__=await (rgb && rgb["r"])["toString"].call((rgb && rgb["r"]),16), __call_method__="padStart";
            return await __call_target__[__call_method__].call(__call_target__,2,"0")
        } 
    })()+ await (async function() {
        {
             let __call_target__=await (rgb && rgb["g"])["toString"].call((rgb && rgb["g"]),16), __call_method__="padStart";
            return await __call_target__[__call_method__].call(__call_target__,2,"0")
        } 
    })()+ await (async function() {
        {
             let __call_target__=await (rgb && rgb["b"])["toString"].call((rgb && rgb["b"]),16), __call_method__="padStart";
            return await __call_target__[__call_method__].call(__call_target__,2,"0")
        } 
    })())
};__obj__1["flatten_ctx"]=async function(ctx,_var_table) {
    let var_table;
    let ctx_keys;
    var_table=(_var_table|| new Object());
    ctx_keys=await (await Environment.get_global("keys"))(var_table);
    if (check_true ((ctx && ctx["scope"]))){
        {
            await (async function() {
                let __for_body__131=async function(k) {
                    if (check_true (await (await Environment.get_global("not"))(await (await Environment.get_global("contains?"))(k,ctx_keys)))){
                        {
                            return await async function(){
                                var_table[k]=await (async function(){
                                    let __targ__134=(ctx && ctx["scope"]);
                                    if (__targ__134){
                                         return(__targ__134)[k]
                                    } 
                                })();
                                return var_table;
                                
                            }()
                        }
                    }
                };
                let __array__132=[],__elements__130=await (await Environment.get_global("keys"))((ctx && ctx["scope"]));
                let __BREAK__FLAG__=false;
                for(let __iter__129 in __elements__130) {
                    __array__132.push(await __for_body__131(__elements__130[__iter__129]));
                    if(__BREAK__FLAG__) {
                         __array__132.pop();
                        break;
                        
                    }
                }return __array__132;
                 
            })();
            if (check_true ((ctx && ctx["parent"]))){
                {
                    await (await Environment.get_global("flatten_ctx"))((ctx && ctx["parent"]),var_table)
                }
            };
            return var_table
        }
    }
};__obj__1["identify_symbols"]=async function(quoted_form,_state) {
    let acc;
    acc=[];
    _state=await (async function(){
        if (check_true (_state)){
            return _state
        } else {
            return new Object()
        }
    })();
    debugger;
    ;
    await async function(){
        if (check_true ((quoted_form instanceof Array))) {
            {
                return await (async function() {
                    let __for_body__137=async function(elem) {
                        return (acc).push(await (async function(){
                             return await (await Environment.get_global("identify_symbols"))(elem,_state) 
                        })())
                    };
                    let __array__138=[],__elements__136=quoted_form;
                    let __BREAK__FLAG__=false;
                    for(let __iter__135 in __elements__136) {
                        __array__138.push(await __for_body__137(__elements__136[__iter__135]));
                        if(__BREAK__FLAG__) {
                             __array__138.pop();
                            break;
                            
                        }
                    }return __array__138;
                     
                })()
            }
        } else if (check_true (((quoted_form instanceof String || typeof quoted_form==='string')&& await (await Environment.get_global("starts_with?"))("=:",quoted_form)))) {
            (acc).push({
                name:await (await Environment.get_global("as_lisp"))(quoted_form),where:await (async function(){
                     return await (await Environment.get_global("describe"))(await (await Environment.get_global("as_lisp"))(quoted_form)) 
                })()
            })
        } else if (check_true ((quoted_form instanceof Object))) {
            await (async function() {
                let __for_body__141=async function(elem) {
                    return (acc).push(await (async function(){
                         return await (await Environment.get_global("identify_symbols"))(elem,_state) 
                    })())
                };
                let __array__142=[],__elements__140=await (await Environment.get_global("values"))(quoted_form);
                let __BREAK__FLAG__=false;
                for(let __iter__139 in __elements__140) {
                    __array__142.push(await __for_body__141(__elements__140[__iter__139]));
                    if(__BREAK__FLAG__) {
                         __array__142.pop();
                        break;
                        
                    }
                }return __array__142;
                 
            })()
        }
    } ();
    return ["=:quote",acc]
};__obj__1["unless"]=async function(condition,...forms) {
    return ["=:if",["=:not",condition],["=:do",].concat(forms)]
};__obj__1["use_quoted_initializer"]=async function(...forms) {
    let insert_initializer;
    insert_initializer=async function(form) {
        let meta=form[3];
        ;
        if (check_true ((null==form[3]))){
            meta=await async function(){
                form[3]=new Object();
                return form;
                
            }()
        };
        return await async function(){
            if (check_true (((meta instanceof Array)&& (await (await Environment.get_global("resolve_path"))([3,1],form) instanceof Object)))) {
                {
                    await (await Environment.get_global("set_path"))([3,1,"initializer"],form,await (async function(){
                         return ["=:quote",(form && form["2"])] 
                    })());
                    return form
                }
            } else if (check_true ((meta instanceof Object))) {
                {
                    {
                        await async function(){
                            let __target_obj__144=(form && form["3"]);
                            __target_obj__144["initializer"]=await (async function(){
                                 return ["=:quote",(form && form["2"])] 
                            })();
                            return __target_obj__144;
                            
                        }();
                        return form
                    }
                }
            } else {
                {
                    await (await Environment.get_global("warn"))("use_quoted_initializer: cannot quote ",await (async function(){
                        if (check_true (((form && form["2"]) instanceof String || typeof (form && form["2"])==='string'))){
                            return (form && form["2"])
                        } else {
                            return form
                        }
                    })());
                    return form
                }
            }
        } ()
    };
    return await (async function() {
        let __for_body__147=async function(form) {
            form=await (async function(){
                 return await (await Environment.get_global("macroexpand"))(form) 
            })();
            if (check_true (((form instanceof Array)&& ((form && form["0"])==="=:defglobal")))){
                {
                    return await insert_initializer(form)
                }
            } else {
                return form
            }
        };
        let __array__148=[],__elements__146=forms;
        let __BREAK__FLAG__=false;
        for(let __iter__145 in __elements__146) {
            __array__148.push(await __for_body__147(__elements__146[__iter__145]));
            if(__BREAK__FLAG__) {
                 __array__148.pop();
                break;
                
            }
        }return __array__148;
         
    })()
};__obj__1["random_int"]=async function(...args) {
    let top;
    let bottom;
    top=0;
    bottom=0;
    if (check_true ((await (await Environment.get_global("length"))(args)>1))){
        {
            top=await parseInt((args && args["1"]));
            bottom=await parseInt((args && args["0"]))
        }
    } else {
        top=await parseInt((args && args["0"]))
    };
    return await parseInt(await (await Environment.get_global("add"))((await Math.random()* (top- bottom)),bottom))
};__obj__1["resolve_multi_path"]=async function(path,obj,not_found) {
    return await async function(){
        if (check_true ((obj instanceof Object))) {
            return await async function(){
                if (check_true (((await (await Environment.get_global("length"))(path)===1)&& ("*"===await (await Environment.get_global("first"))(path))))) {
                    return (obj|| not_found)
                } else if (check_true (((await (await Environment.get_global("length"))(path)===1)&& (obj[await (await Environment.get_global("first"))(path)] instanceof Object)))) {
                    return (obj[await (await Environment.get_global("first"))(path)]|| not_found)
                } else if (check_true (((await (await Environment.get_global("length"))(path)===1)&& await (await Environment.get_global("not"))((obj[await (await Environment.get_global("first"))(path)] instanceof Object))&& await (await Environment.get_global("not"))((null==obj[await (await Environment.get_global("first"))(path)]))))) {
                    return obj[await (await Environment.get_global("first"))(path)]
                } else if (check_true (((obj instanceof Array)&& ("*"===await (await Environment.get_global("first"))(path))))) {
                    return await (async function() {
                        let __for_body__151=async function(val) {
                            return await (await Environment.get_global("resolve_multi_path"))(await (await Environment.get_global("rest"))(path),val,not_found)
                        };
                        let __array__152=[],__elements__150=obj;
                        let __BREAK__FLAG__=false;
                        for(let __iter__149 in __elements__150) {
                            __array__152.push(await __for_body__151(__elements__150[__iter__149]));
                            if(__BREAK__FLAG__) {
                                 __array__152.pop();
                                break;
                                
                            }
                        }return __array__152;
                         
                    })()
                } else if (check_true (((obj instanceof Object)&& ("*"===await (await Environment.get_global("first"))(path))))) {
                    return await (async function() {
                        let __for_body__155=async function(val) {
                            return await (await Environment.get_global("resolve_multi_path"))(await (await Environment.get_global("rest"))(path),val,not_found)
                        };
                        let __array__156=[],__elements__154=await (await Environment.get_global("values"))(obj);
                        let __BREAK__FLAG__=false;
                        for(let __iter__153 in __elements__154) {
                            __array__156.push(await __for_body__155(__elements__154[__iter__153]));
                            if(__BREAK__FLAG__) {
                                 __array__156.pop();
                                break;
                                
                            }
                        }return __array__156;
                         
                    })()
                } else if (check_true ((await (await Environment.get_global("length"))(path)>1))) {
                    return await (await Environment.get_global("resolve_multi_path"))(await (await Environment.get_global("rest"))(path),obj[await (await Environment.get_global("first"))(path)],not_found)
                }
            } ()
        } else {
            return not_found
        }
    } ()
};__obj__1["symbol_tree"]=async function(quoted_form,_state,_current_path) {
    let acc;
    let allocators;
    let uop;
    let get_allocations;
    let idx;
    let fval;
    let sym_paths;
    let is_root;
    acc=[];
    allocators={
        let:await (async function(){
             return [[1,"*",0]] 
        })(),defun:await (async function(){
             return [[1],[2,"*"]] 
        })()
    };
    uop=null;
    get_allocations=async function() {
        sym_paths=allocators[await (async function(){
             return await (await Environment.get_global("unquotify"))((quoted_form && quoted_form["0"])) 
        })()];
        if (check_true (sym_paths)){
            {
                return await (async function() {
                    let __for_body__159=async function(sym_path) {
                        fval=await (async function(){
                             return await (await Environment.get_global("resolve_multi_path"))(sym_path,quoted_form) 
                        })();
                        await console.log("Fval is: ",fval,"sym_path: ",sym_path,"current_path: ",_current_path," ",quoted_form);
                        uop=await (async function(){
                             return await (await Environment.get_global("unquotify"))((quoted_form && quoted_form["0"])) 
                        })();
                        if (check_true ((fval instanceof Array))){
                            return await (async function() {
                                let __for_body__163=async function(s) {
                                    s=await (async function(){
                                         return await (await Environment.get_global("unquotify"))(s) 
                                    })();
                                    if (check_true ((null==await (async function(){
                                        let __targ__165=(_state && _state["definitions"]);
                                        if (__targ__165){
                                             return(__targ__165)[fval]
                                        } 
                                    })()))){
                                        {
                                            await async function(){
                                                let __target_obj__166=(_state && _state["definitions"]);
                                                __target_obj__166[s]=[];
                                                return __target_obj__166;
                                                
                                            }()
                                        }
                                    };
                                    return (await (async function(){
                                        let __targ__167=(_state && _state["definitions"]);
                                        if (__targ__167){
                                             return(__targ__167)[s]
                                        } 
                                    })()).push({
                                        path:_current_path,op:uop
                                    })
                                };
                                let __array__164=[],__elements__162=fval;
                                let __BREAK__FLAG__=false;
                                for(let __iter__161 in __elements__162) {
                                    __array__164.push(await __for_body__163(__elements__162[__iter__161]));
                                    if(__BREAK__FLAG__) {
                                         __array__164.pop();
                                        break;
                                        
                                    }
                                }return __array__164;
                                 
                            })()
                        } else {
                            {
                                if (check_true ((null==await (async function(){
                                    let __targ__168=(_state && _state["definitions"]);
                                    if (__targ__168){
                                         return(__targ__168)[fval]
                                    } 
                                })()))){
                                    {
                                        await async function(){
                                            let __target_obj__169=(_state && _state["definitions"]);
                                            __target_obj__169[fval]=[];
                                            return __target_obj__169;
                                            
                                        }()
                                    }
                                };
                                return (await (async function(){
                                    let __targ__170=(_state && _state["definitions"]);
                                    if (__targ__170){
                                         return(__targ__170)[fval]
                                    } 
                                })()).push({
                                    path:_current_path,op:uop
                                })
                            }
                        }
                    };
                    let __array__160=[],__elements__158=sym_paths;
                    let __BREAK__FLAG__=false;
                    for(let __iter__157 in __elements__158) {
                        __array__160.push(await __for_body__159(__elements__158[__iter__157]));
                        if(__BREAK__FLAG__) {
                             __array__160.pop();
                            break;
                            
                        }
                    }return __array__160;
                     
                })()
            }
        }
    };
    idx=-1;
    fval=null;
    sym_paths=null;
    is_root=await (async function(){
        if (check_true ((_state==undefined))){
            return true
        } else {
            return false
        }
    })();
    _state=await (async function(){
        if (check_true (_state)){
            return _state
        } else {
            return {
                definitions:new Object()
            }
        }
    })();
    _current_path=(_current_path|| []);
    ;
    await console.log("symbol_tree: quoted_form: ",quoted_form,_current_path);
    await get_allocations();
    return await async function(){
        if (check_true ((quoted_form instanceof Array))) {
            {
                await (await Environment.get_global("map"))(async function(elem,idx) {
                    {
                        let it;
                        it=await (async function(){
                             return await (await Environment.get_global("symbol_tree"))(elem,_state,await (await Environment.get_global("conj"))(_current_path,idx)) 
                        })();
                        if (check_true (it)){
                            return (acc).push(it)
                        } else {
                            return 
                        }
                    }
                },quoted_form);
                if (check_true (is_root)){
                    return await (await Environment.get_global("add"))({
                        tree:acc
                    },_state)
                } else {
                    return acc
                }
            }
        } else if (check_true (((quoted_form instanceof String || typeof quoted_form==='string')&& await (await Environment.get_global("starts_with?"))("=:",quoted_form)))) {
            {
                return await (await Environment.get_global("unquotify"))(quoted_form)
            }
        } else if (check_true ((quoted_form instanceof Object))) {
            {
                await (async function() {
                    let __for_body__173=async function(pset) {
                        {
                            let it;
                            it=await (async function(){
                                 return await (await Environment.get_global("symbol_tree"))((pset && pset["1"]),_state,await (await Environment.get_global("conj"))(_current_path,await (async function(){
                                    let __array_op_rval__175=(pset && pset["1"]);
                                     if (__array_op_rval__175 instanceof Function){
                                        return await __array_op_rval__175() 
                                    } else {
                                        return [__array_op_rval__175]
                                    }
                                })())) 
                            })();
                            if (check_true (it)){
                                return (acc).push(it)
                            } else {
                                return 
                            }
                        }
                    };
                    let __array__174=[],__elements__172=await (await Environment.get_global("pairs"))(quoted_form);
                    let __BREAK__FLAG__=false;
                    for(let __iter__171 in __elements__172) {
                        __array__174.push(await __for_body__173(__elements__172[__iter__171]));
                        if(__BREAK__FLAG__) {
                             __array__174.pop();
                            break;
                            
                        }
                    }return __array__174;
                     
                })();
                if (check_true (is_root)){
                    return await (await Environment.get_global("add"))({
                        tree:acc
                    },_state)
                } else {
                    return acc
                }
            }
        }
    } ()
};__obj__1["except_nil"]=async function(items) {
    let acc=[];
    ;
    if (check_true (await (await Environment.get_global("not"))((await (await Environment.get_global("sub_type"))(items)==="array")))){
        items=[items]
    };
    await (async function() {
        let __for_body__53=async function(value) {
            if (check_true (await (await Environment.get_global("not"))((null==value)))){
                return (acc).push(value)
            }
        };
        let __array__54=[],__elements__52=items;
        let __BREAK__FLAG__=false;
        for(let __iter__51 in __elements__52) {
            __array__54.push(await __for_body__53(__elements__52[__iter__51]));
            if(__BREAK__FLAG__) {
                 __array__54.pop();
                break;
                
            }
        }return __array__54;
         
    })();
    return acc
};__obj__1["each"]=async function(items,property) {
    return await async function(){
        if (check_true (((property instanceof String || typeof property==='string')|| await (await Environment.get_global("is_number?"))(property)))) {
            return await (await Environment.get_global("except_nil"))(await (async function() {
                let __for_body__182=async function(item) {
                    if (check_true (item)){
                        {
                            return item[property]
                        }
                    }
                };
                let __array__183=[],__elements__181=(items|| []);
                let __BREAK__FLAG__=false;
                for(let __iter__180 in __elements__181) {
                    __array__183.push(await __for_body__182(__elements__181[__iter__180]));
                    if(__BREAK__FLAG__) {
                         __array__183.pop();
                        break;
                        
                    }
                }return __array__183;
                 
            })())
        } else if (check_true ((await (await Environment.get_global("sub_type"))(property)=="array"))) {
            {
                let __collector;
                let __result;
                let __action;
                __collector=[];
                __result=null;
                __action=async function(item) {
                    let nl=[];
                    ;
                    await (async function() {
                        let __for_body__186=async function(p) {
                            return await async function(){
                                if (check_true ((p instanceof Array))) {
                                    return (nl).push(await (await Environment.get_global("resolve_path"))(p,item))
                                } else if (check_true (p instanceof Function)) {
                                    return (nl).push(await (async function(){
                                        let __array_op_rval__188=p;
                                         if (__array_op_rval__188 instanceof Function){
                                            return await __array_op_rval__188(item) 
                                        } else {
                                            return [__array_op_rval__188,item]
                                        }
                                    })())
                                } else {
                                    return (nl).push(item[p])
                                }
                            } ()
                        };
                        let __array__187=[],__elements__185=property;
                        let __BREAK__FLAG__=false;
                        for(let __iter__184 in __elements__185) {
                            __array__187.push(await __for_body__186(__elements__185[__iter__184]));
                            if(__BREAK__FLAG__) {
                                 __array__187.pop();
                                break;
                                
                            }
                        }return __array__187;
                         
                    })();
                    return nl
                };
                ;
                await (async function() {
                    let __for_body__191=async function(__item) {
                        __result=await __action(__item);
                        if (check_true (__result)){
                            return (__collector).push(__result)
                        }
                    };
                    let __array__192=[],__elements__190=items;
                    let __BREAK__FLAG__=false;
                    for(let __iter__189 in __elements__190) {
                        __array__192.push(await __for_body__191(__elements__190[__iter__189]));
                        if(__BREAK__FLAG__) {
                             __array__192.pop();
                            break;
                            
                        }
                    }return __array__192;
                     
                })();
                return __collector
            }
        } else if (check_true ((await (await Environment.get_global("sub_type"))(property)=="AsyncFunction"))) {
            {
                let __collector;
                let __result;
                let __action;
                __collector=[];
                __result=null;
                __action=async function(item) {
                    return await (async function(){
                        let __array_op_rval__193=property;
                         if (__array_op_rval__193 instanceof Function){
                            return await __array_op_rval__193(item) 
                        } else {
                            return [__array_op_rval__193,item]
                        }
                    })()
                };
                ;
                await (async function() {
                    let __for_body__196=async function(__item) {
                        __result=await __action(__item);
                        if (check_true (__result)){
                            return (__collector).push(__result)
                        }
                    };
                    let __array__197=[],__elements__195=items;
                    let __BREAK__FLAG__=false;
                    for(let __iter__194 in __elements__195) {
                        __array__197.push(await __for_body__196(__elements__195[__iter__194]));
                        if(__BREAK__FLAG__) {
                             __array__197.pop();
                            break;
                            
                        }
                    }return __array__197;
                     
                })();
                return __collector
            }
        } else if (check_true ((await (await Environment.get_global("sub_type"))(property)=="Function"))) {
            {
                let __collector;
                let __result;
                let __action;
                __collector=[];
                __result=null;
                __action=async function(item) {
                    return await (async function(){
                        let __array_op_rval__198=property;
                         if (__array_op_rval__198 instanceof Function){
                            return await __array_op_rval__198(item) 
                        } else {
                            return [__array_op_rval__198,item]
                        }
                    })()
                };
                ;
                await (async function() {
                    let __for_body__201=async function(__item) {
                        __result=await __action(__item);
                        if (check_true (__result)){
                            return (__collector).push(__result)
                        }
                    };
                    let __array__202=[],__elements__200=items;
                    let __BREAK__FLAG__=false;
                    for(let __iter__199 in __elements__200) {
                        __array__202.push(await __for_body__201(__elements__200[__iter__199]));
                        if(__BREAK__FLAG__) {
                             __array__202.pop();
                            break;
                            
                        }
                    }return __array__202;
                     
                })();
                return __collector
            }
        } else {
            throw new TypeError(("each: strings, arrays, and functions can be provided for the property name or names to extract - received: "+ await (await Environment.get_global("sub_type"))(property)));
            
        }
    } ()
};__obj__1["replace"]=async function(...args) {
    if (check_true (((args && args.length)<3))){
        throw new SyntaxError("Invalid syntax for replace: requires at least three arguments, target value or regex, the replacement value, and at least one value (object list or string)");
        
    } else {
        try {
            {
                let target;
                let replacement;
                let work_values;
                let value_type;
                let sr_val;
                let arg_value_type;
                let rval;
                target=(args && args["0"]);
                replacement=(args && args["1"]);
                work_values=await (await Environment.get_global("slice"))(args,2);
                value_type=null;
                sr_val=null;
                arg_value_type=await subtype((args && args["2"]));
                rval=[];
                await (async function() {
                    let __for_body__206=async function(value) {
                        value_type=await subtype(value);
                        if (check_true ((value_type==="Number"))){
                            {
                                value_type="String";
                                value=(""+ value)
                            }
                        };
                        return await async function(){
                            if (check_true ((value_type==="String"))) {
                                return (rval).push(await value["replace"].call(value,target,replacement))
                            } else if (check_true ((value_type==="array"))) {
                                return await (async function() {
                                    let __for_body__210=async function(elem) {
                                        return (rval).push(await (async function(){
                                             return await (await Environment.get_global("replace"))(target,replacement,elem) 
                                        })())
                                    };
                                    let __array__211=[],__elements__209=value;
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__208 in __elements__209) {
                                        __array__211.push(await __for_body__210(__elements__209[__iter__208]));
                                        if(__BREAK__FLAG__) {
                                             __array__211.pop();
                                            break;
                                            
                                        }
                                    }return __array__211;
                                     
                                })()
                            } else if (check_true ((value_type==="object"))) {
                                {
                                    sr_val=new Object();
                                    await (async function() {
                                        let __for_body__214=async function(k) {
                                            if (check_true (await value["hasOwnProperty"].call(value,k))){
                                                {
                                                    return await async function(){
                                                        sr_val[k]=await (async function(){
                                                             return await (await Environment.get_global("replace"))(target,replacement,value[k]) 
                                                        })();
                                                        return sr_val;
                                                        
                                                    }()
                                                }
                                            }
                                        };
                                        let __array__215=[],__elements__213=await (await Environment.get_global("keys"))(value);
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__212 in __elements__213) {
                                            __array__215.push(await __for_body__214(__elements__213[__iter__212]));
                                            if(__BREAK__FLAG__) {
                                                 __array__215.pop();
                                                break;
                                                
                                            }
                                        }return __array__215;
                                         
                                    })();
                                    return rval=await rval["concat"].call(rval,sr_val)
                                }
                            }
                        } ()
                    };
                    let __array__207=[],__elements__205=work_values;
                    let __BREAK__FLAG__=false;
                    for(let __iter__204 in __elements__205) {
                        __array__207.push(await __for_body__206(__elements__205[__iter__204]));
                        if(__BREAK__FLAG__) {
                             __array__207.pop();
                            break;
                            
                        }
                    }return __array__207;
                     
                })();
                if (check_true ((await (await Environment.get_global("not"))((arg_value_type==="array"))&& await (await Environment.get_global("not"))((arg_value_type==="object"))))){
                    return await (await Environment.get_global("first"))(rval)
                } else {
                    return rval
                }
            }
        } catch (__exception__203) {
            if (__exception__203 instanceof Error) {
                let e=__exception__203;
                {
                    return await console.error(("replace: "+ e))
                }
            }
        }
    }
};__obj__1["cl_encode_string"]=async function(text) {
    if (check_true ((text instanceof String || typeof text==='string'))){
        {
            let escaped;
            let nq;
            let step1;
            let snq;
            escaped=await (async function(){
                 return await (await Environment.get_global("replace"))(new RegExp("\n","g"),await (await Environment.get_global("add"))(await String.fromCharCode(92),"n"),text) 
            })();
            escaped=await (async function(){
                 return await (await Environment.get_global("replace"))(new RegExp("\r","g"),await (await Environment.get_global("add"))(await String.fromCharCode(92),"r"),escaped) 
            })();
            nq=(escaped).split(await String.fromCharCode(34));
            step1=(nq).join(await (await Environment.get_global("add"))(await String.fromCharCode(92),await String.fromCharCode(34)));
            snq=(step1).split(await String.fromCharCode(39));
            return step1
        }
    } else {
        return text
    }
};__obj__1["path_to_js_syntax"]=async function(comps) {
    if (check_true ((comps instanceof Array))){
        if (check_true (((comps && comps.length)>1))){
            return (await (async function(){
                 return await (await Environment.get_global("map"))(async function(comp,idx) {
                    if (check_true ((idx===0))){
                        return comp
                    } else {
                        return await async function(){
                            if (check_true ((await isNaN(parseInt(comp))&& await (await Environment.get_global("starts_with?"))("\"",comp)))) {
                                return ("["+ comp+ "]")
                            } else if (check_true (await isNaN(parseInt(comp)))) {
                                return ("."+ comp)
                            } else {
                                return ("["+ "'"+ comp+ "'"+ "]")
                            }
                        } ()
                    }
                },comps) 
            })()).join("")
        } else {
            return (comps && comps["0"])
        }
    } else {
        throw new TypeError(("path_to_js_syntax: need array - given "+ await (await Environment.get_global("sub_type"))(comps)));
        
    }
};__obj__1["first_is_upper_case?"]=async function(str_val) {
    let rval=await str_val["match"].call(str_val,new RegExp("^[A-Z]"));
    ;
    if (check_true ((rval&& (rval && rval["0"])))){
        return true
    } else {
        return false
    }
};__obj__1["safe_access_2"]=async function(token,ctx,sanitizer_fn) {
    let comps;
    let acc;
    let acc_full;
    let pos;
    let rval;
    comps=null;
    acc=[];
    acc_full=[];
    pos=null;
    rval=null;
    comps=((token && token.name)).split(".");
    if (check_true (((comps && comps.length)===1))){
        return (token && token.name)
    } else {
        {
            await async function(){
                comps[0]=await (async function(){
                    let __array_op_rval__218=sanitizer_fn;
                     if (__array_op_rval__218 instanceof Function){
                        return await __array_op_rval__218((comps && comps["0"])) 
                    } else {
                        return [__array_op_rval__218,(comps && comps["0"])]
                    }
                })();
                return comps;
                
            }();
            await (async function(){
                 let __test_condition__219=async function() {
                    return ((comps && comps.length)>0)
                };
                let __body_ref__220=async function() {
                    (acc).push((comps).shift());
                    if (check_true (((comps && comps.length)>0))){
                        return (acc_full).push((["check_true(",await (async function(){
                             return await (await Environment.get_global("expand_dot_accessor"))((acc).join("."),ctx) 
                        })(),")"]).join(""))
                    } else {
                        return (acc_full).push(await (async function(){
                             return await (await Environment.get_global("expand_dot_accessor"))((acc).join("."),ctx) 
                        })())
                    }
                };
                let __BREAK__FLAG__=false;
                while(await __test_condition__219()) {
                    await __body_ref__220();
                     if(__BREAK__FLAG__) {
                         break;
                        
                    }
                } ;
                
            })();
            rval=await (await Environment.get_global("flatten"))(["(",(acc_full).join(" && "),")"]);
            return rval
        }
    }
};__obj__1["safe_access"]=async function(token,ctx,sanitizer_fn) {
    let comps;
    let acc;
    let acc_full;
    let pos;
    let rval;
    comps=null;
    acc=[];
    acc_full=[];
    pos=null;
    rval=null;
    comps=((token && token.name)).split(".");
    if (check_true (((comps && comps.length)===1))){
        return (token && token.name)
    } else {
        {
            await async function(){
                comps[0]=await (async function(){
                    let __array_op_rval__222=sanitizer_fn;
                     if (__array_op_rval__222 instanceof Function){
                        return await __array_op_rval__222((comps && comps["0"])) 
                    } else {
                        return [__array_op_rval__222,(comps && comps["0"])]
                    }
                })();
                return comps;
                
            }();
            await (async function(){
                 let __test_condition__223=async function() {
                    return ((comps && comps.length)>0)
                };
                let __body_ref__224=async function() {
                    (acc).push((comps).shift());
                    return (acc_full).push(await (async function(){
                         return await (await Environment.get_global("expand_dot_accessor"))((acc).join("."),ctx) 
                    })())
                };
                let __BREAK__FLAG__=false;
                while(await __test_condition__223()) {
                    await __body_ref__224();
                     if(__BREAK__FLAG__) {
                         break;
                        
                    }
                } ;
                
            })();
            rval=await (await Environment.get_global("flatten"))(["(",(acc_full).join(" && "),")"]);
            return rval
        }
    }
};__obj__1["compile_to_js"]=async function(quoted_form) {
    return ["=:->","=:Environment","compile",quoted_form]
};__obj__1["evaluate_compiled_source"]=async function(compiled_source) {
    return ["=:->","=:Environment","evaluate",compiled_source,"=:nil",{ "compiled_source":true
}]
};__obj__1["form_structure"]=async function(quoted_form,max_depth) {
    let idx;
    let acc;
    let structure;
    let follow_tree;
    idx=0;
    acc=[];
    max_depth=(max_depth|| (await Environment.get_global("MAX_SAFE_INTEGER")));
    structure=quoted_form;
    follow_tree=async function(elems,acc,_depth) {
        return await async function(){
            if (check_true ((((elems instanceof Array)|| (elems instanceof Object))&& (_depth>=max_depth)))) {
                if (check_true ((elems instanceof Array))){
                    return "array"
                } else {
                    return "object"
                }
            } else if (check_true ((elems instanceof Array))) {
                return await (await Environment.get_global("map"))(async function(elem,idx) {
                    return await follow_tree(elem,[],await (await Environment.get_global("add"))(_depth,1))
                },elems)
            } else if (check_true ((elems instanceof Object))) {
                {
                    return await (async function() {
                        let __for_body__227=async function(pset) {
                            return await follow_tree((pset && pset["1"]),[],await (await Environment.get_global("add"))(_depth,1))
                        };
                        let __array__228=[],__elements__226=await (await Environment.get_global("pairs"))(elems);
                        let __BREAK__FLAG__=false;
                        for(let __iter__225 in __elements__226) {
                            __array__228.push(await __for_body__227(__elements__226[__iter__225]));
                            if(__BREAK__FLAG__) {
                                 __array__228.pop();
                                break;
                                
                            }
                        }return __array__228;
                         
                    })()
                }
            } else {
                return await async function(){
                    if (check_true (((elems instanceof String || typeof elems==='string')&& await (await Environment.get_global("starts_with?"))("=:",elems)))) {
                        return "symbol"
                    } else if (check_true (await (await Environment.get_global("is_number?"))(elems))) {
                        return "number"
                    } else if (check_true ((elems instanceof String || typeof elems==='string'))) {
                        return "string"
                    } else if (check_true (((elems===true)|| (elems===false)))) {
                        return "boolean"
                    } else {
                        return elems
                    }
                } ()
            }
        } ()
    };
    return await follow_tree(structure,[],0)
};__obj__1["validate_form_structure"]=async function(validation_rules,quoted_form) {
    let results;
    let all_valid;
    let target;
    results={
        valid:[],invalid:[],rule_count:await (await Environment.get_global("length"))(validation_rules),all_passed:false
    };
    all_valid=null;
    target=null;
    await (async function() {
        let __for_body__231=async function(rule) {
            if (check_true (((rule instanceof Array)&& ((rule && rule.length)>1)&& ((rule && rule["0"]) instanceof Array)&& ((rule && rule["1"]) instanceof Array)))){
                {
                    all_valid=true;
                    target=await (await Environment.get_global("resolve_path"))((rule && rule["0"]),quoted_form);
                    await (async function() {
                        let __for_body__235=async function(validation) {
                            if (check_true (await (await Environment.get_global("not"))(await (async function(){
                                let __array_op_rval__237=validation;
                                 if (__array_op_rval__237 instanceof Function){
                                    return await __array_op_rval__237(target) 
                                } else {
                                    return [__array_op_rval__237,target]
                                }
                            })()))){
                                {
                                    all_valid=false;
                                    return __BREAK__FLAG__=true;
                                    return
                                }
                            }
                        };
                        let __array__236=[],__elements__234=(rule && rule["1"]);
                        let __BREAK__FLAG__=false;
                        for(let __iter__233 in __elements__234) {
                            __array__236.push(await __for_body__235(__elements__234[__iter__233]));
                            if(__BREAK__FLAG__) {
                                 __array__236.pop();
                                break;
                                
                            }
                        }return __array__236;
                         
                    })();
                    if (check_true (all_valid)){
                        return ((results && results["valid"])).push(((rule && rule["2"])|| (rule && rule["0"])))
                    } else {
                        return ((results && results["invalid"])).push(((rule && rule["2"])|| (rule && rule["0"])))
                    }
                }
            }
        };
        let __array__232=[],__elements__230=(validation_rules|| []);
        let __BREAK__FLAG__=false;
        for(let __iter__229 in __elements__230) {
            __array__232.push(await __for_body__231(__elements__230[__iter__229]));
            if(__BREAK__FLAG__) {
                 __array__232.pop();
                break;
                
            }
        }return __array__232;
         
    })();
    await async function(){
        results["all_passed"]=(await (await Environment.get_global("length"))((results && results["valid"]))===(results && results["rule_count"]));
        return results;
        
    }();
    return results
};__obj__1["*compiler_syntax_rules*"]={compile_let:await (async function(){ return [[[0,1,"val"],[(await Environment.get_global("is_array?"))],"let allocation section"],await (async function(){ return [[0,2],[async function(v) {return await (await Environment.get_global("not"))((v===undefined))}],"let missing block"] })()] })(),compile_cond:await (async function(){ return [[[0],[async function(v) {return ((await (await Environment.get_global("length"))(await (await Environment.get_global("rest"))(v))% 2)===0)}],"cond: odd number of arguments"]] })(),compile_assignment:await (async function(){ return [[[0,1],[async function(v) {return await (await Environment.get_global("not"))((v===undefined))}],"assignment is missing target and values"],await (async function(){ return [[0,2],[async function(v) {return await (await Environment.get_global("not"))((v===undefined))}],"assignment is missing value"] })()] })()};__obj__1["compiler_source_chain"]=async function(cpath,tree,sources) {
    if (check_true (((cpath instanceof Array)&& tree))){
        {
            let source;
            sources=(sources|| []);
            source=null;
            cpath=await (await Environment.get_global("chop"))(cpath);
            source=await (await Environment.get_global("as_lisp"))(await (await Environment.get_global("resolve_path"))(cpath,tree));
            if (check_true (((source && source.length)>80))){
                source=await (await Environment.get_global("add"))(await source["substr"].call(source,0,80),"...")
            };
            if (check_true (await (await Environment.get_global("not"))(await (await Environment.get_global("blank?"))(source)))){
                {
                    (sources).push(source)
                }
            };
            if (check_true ((((cpath && cpath.length)>0)&& ((sources && sources.length)<2)))){
                await (await Environment.get_global("compiler_source_chain"))(cpath,tree,sources)
            };
            return sources
        }
    }
};__obj__1["compiler_syntax_validation"]=async function(validator_key,tokens,errors,ctx,tree) {
    let validation_results;
    let syntax_error;
    let cpath;
    let rules;
    validation_results=null;
    syntax_error=null;
    cpath=null;
    rules=await (async function(){
        let __targ__240=(await Environment.get_global("*compiler_syntax_rules*"));
        if (__targ__240){
             return(__targ__240)[validator_key]
        } 
    })();
    if (check_true (rules)){
        {
            validation_results=await (async function(){
                 return await (await Environment.get_global("validate_form_structure"))(rules,await (async function(){
                    let __array_op_rval__241=tokens;
                     if (__array_op_rval__241 instanceof Function){
                        return await __array_op_rval__241() 
                    } else {
                        return [__array_op_rval__241]
                    }
                })()) 
            })();
            cpath=await (async function(){
                 return await async function(){
                    if (check_true ((tokens instanceof Array))) {
                        return await (await Environment.get_global("chop"))((tokens && tokens["0"] && tokens["0"]["path"]))
                    } else if (check_true ((tokens instanceof Object))) {
                        return (tokens && tokens["path"])
                    }
                } () 
            })();
            if (check_true (await (await Environment.get_global("not"))((validation_results && validation_results["all_passed"])))){
                {
                    await (async function() {
                        let __for_body__244=async function(problem) {
                            return (errors).push({
                                error:"SyntaxError",message:problem,source_name:await (async function(){
                                     return await (await Environment.get_global("getf_ctx"))(ctx,"__SOURCE_NAME__") 
                                })(),form:await (await Environment.get_global("first"))(await (async function(){
                                     return await (await Environment.get_global("compiler_source_chain"))(cpath,tree) 
                                })()),parent_forms:await (await Environment.get_global("rest"))(await (async function(){
                                     return await (await Environment.get_global("compiler_source_chain"))(cpath,tree) 
                                })()),invalid:true
                            })
                        };
                        let __array__245=[],__elements__243=((validation_results && validation_results["invalid"])|| []);
                        let __BREAK__FLAG__=false;
                        for(let __iter__242 in __elements__243) {
                            __array__245.push(await __for_body__244(__elements__243[__iter__242]));
                            if(__BREAK__FLAG__) {
                                 __array__245.pop();
                                break;
                                
                            }
                        }return __array__245;
                         
                    })();
                    syntax_error=new SyntaxError("invalid syntax");
                    await async function(){
                        syntax_error["handled"]=true;
                        return syntax_error;
                        
                    }();
                    throw syntax_error;
                    
                }
            }
        }
    } else {
        await console.log("compiler_syntax_validation: no rules for: ",validator_key," -> tokens: ",tokens,"tree: ",tree)
    };
    return validation_results
};__obj__1["describe_all"]=async function() {
    return await (async function(){
        let __apply_args__247=await (async function(){
             return await (async function() {
                let __for_body__251=async function(s) {
                    return await (await Environment.get_global("to_object"))(await (async function(){
                         return [await (async function(){
                            let __array_op_rval__253=s;
                             if (__array_op_rval__253 instanceof Function){
                                return await __array_op_rval__253(await (async function(){
                                     return await (await Environment.get_global("describe"))(s) 
                                })()) 
                            } else {
                                return [__array_op_rval__253,await (async function(){
                                     return await (await Environment.get_global("describe"))(s) 
                                })()]
                            }
                        })()] 
                    })())
                };
                let __array__252=[],__elements__250=await (async function(){
                     return await (await Environment.get_global("symbols"))() 
                })();
                let __BREAK__FLAG__=false;
                for(let __iter__249 in __elements__250) {
                    __array__252.push(await __for_body__251(__elements__250[__iter__249]));
                    if(__BREAK__FLAG__) {
                         __array__252.pop();
                        break;
                        
                    }
                }return __array__252;
                 
            })() 
        })();
        return ( (await Environment.get_global("add"))).apply(this,__apply_args__247)
    })()
};__obj__1["is_value?"]=async function(val) {
    if (check_true ((val===""))){
        return true
    } else {
        if (check_true ((val===undefined))){
            return false
        } else {
            if (check_true (await isNaN(val))){
                return true
            } else {
                if (check_true (val)){
                    return true
                } else {
                    return false
                }
            }
        }
    }
};__obj__1["sort"]=async function(elems,options) {
    let opts;
    let sort_fn;
    let sort_fn_inner;
    let keyed;
    let reverser;
    let comparitor;
    let key_path_a;
    let key_path_b;
    opts=(((options instanceof Object)&& options)|| new Object());
    sort_fn=null;
    sort_fn_inner=null;
    keyed=false;
    reverser=await (async function(){
        if (check_true ((opts && opts["reversed"]))){
            return -1
        } else {
            return 1
        }
    })();
    comparitor=await (async function(){
         return await async function(){
            if (check_true ((opts && opts["comparitor"]) instanceof Function)) {
                return (opts && opts["comparitor"])
            } else {
                return function(a,b) {
                    return   (function(){
                        if (check_true ((a instanceof String || typeof a==='string'))) {
                            if (check_true ((b instanceof String || typeof b==='string'))){
                                return (reverser*  a["localeCompare"].call(a,b))
                            } else {
                                return (reverser*  a["localeCompare"].call(a,(""+ b)))
                            }
                        } else if (check_true ((b instanceof String || typeof b==='string'))) {
                            return (reverser*  ( function() {
                                {
                                     let __call_target__=(""+ a), __call_method__="localeCompare";
                                    return  __call_target__[__call_method__].call(__call_target__,b)
                                } 
                            })())
                        } else if (check_true ((opts && opts["reversed"]))) {
                            return (b- a)
                        } else {
                            return (a- b)
                        }
                    } )()
                }
            }
        } () 
    })();
    key_path_a="aval";
    key_path_b="bval";
    await (await Environment.get_global("assert"))((elems instanceof Array),"sort: elements must be an array");
    await (await Environment.get_global("assert"))((await subtype(comparitor)==="Function"),("sort: invalid comparitor provided : "+ await subtype(comparitor)+ " - must be a synchronous function, or evaluate to a synchronous function."));
    await (await Environment.get_global("assert"))((((opts && opts["comparitor"])&& await (await Environment.get_global("not"))((opts && opts["reversed"])))|| (await (await Environment.get_global("not"))((opts && opts["comparitor"]))&& (opts && opts["reversed"]))|| (await (await Environment.get_global("not"))((opts && opts["comparitor"]))&& await (await Environment.get_global("not"))((opts && opts["reversed"])))),"sort: comparitor option cannot be combined with reversed option");
    await async function(){
        if (check_true (((opts && opts["key"]) instanceof String || typeof (opts && opts["key"])==='string'))) {
            {
                keyed=true;
                key_path_a=await (async function(){
                     return await (await Environment.get_global("path_to_js_syntax"))(await (await Environment.get_global("get_object_path"))(("aval."+ (opts && opts["key"])))) 
                })();
                return key_path_b=await (async function(){
                     return await (await Environment.get_global("path_to_js_syntax"))(await (await Environment.get_global("get_object_path"))(("bval."+ (opts && opts["key"])))) 
                })()
            }
        } else if (check_true (((opts && opts["key"]) instanceof Array))) {
            {
                keyed=true;
                key_path_a=await (async function(){
                     return await (await Environment.get_global("path_to_js_syntax"))(await (await Environment.get_global("conj"))(["aval"],(opts && opts["key"]))) 
                })();
                key_path_b=await (async function(){
                     return await (await Environment.get_global("path_to_js_syntax"))(await (await Environment.get_global("conj"))(["bval"],(opts && opts["key"]))) 
                })()
            }
        }
    } ();
    sort_fn_inner=new Function("aval","bval","comparitor",("return comparitor( "+ key_path_a+ ","+ key_path_b+ ")"));
    sort_fn=function(aval,bval) {
        return  sort_fn_inner(aval,bval,comparitor)
    };
    return await elems["sort"].call(elems,sort_fn)
};__obj__1["and*"]=async function(...vals) {
    if (check_true (((vals && vals.length)>0))){
        {
            let rval=true;
            ;
            await (async function() {
                let __for_body__256=async function(v) {
                    if (check_true (await (await Environment.get_global("not"))(await (async function(){
                         return await (await Environment.get_global("is_value?"))(v) 
                    })()))){
                        {
                            rval=false;
                            return __BREAK__FLAG__=true;
                            return
                        }
                    }
                };
                let __array__257=[],__elements__255=vals;
                let __BREAK__FLAG__=false;
                for(let __iter__254 in __elements__255) {
                    __array__257.push(await __for_body__256(__elements__255[__iter__254]));
                    if(__BREAK__FLAG__) {
                         __array__257.pop();
                        break;
                        
                    }
                }return __array__257;
                 
            })();
            return rval
        }
    }
};__obj__1["or*"]=async function(...vals) {
    if (check_true (((vals && vals.length)>0))){
        {
            let rval=false;
            ;
            await (async function() {
                let __for_body__260=async function(v) {
                    if (check_true (await (await Environment.get_global("is_value?"))(v))){
                        {
                            rval=true;
                            return __BREAK__FLAG__=true;
                            return
                        }
                    }
                };
                let __array__261=[],__elements__259=vals;
                let __BREAK__FLAG__=false;
                for(let __iter__258 in __elements__259) {
                    __array__261.push(await __for_body__260(__elements__259[__iter__258]));
                    if(__BREAK__FLAG__) {
                         __array__261.pop();
                        break;
                        
                    }
                }return __array__261;
                 
            })();
            return rval
        }
    }
};__obj__1["either"]=async function(...args) {
    let rval;
    rval=null;
    await (async function() {
        let __for_body__264=async function(arg) {
            rval=arg;
            if (check_true ((await (await Environment.get_global("not"))((undefined===arg))&& await (await Environment.get_global("not"))((null===arg))))){
                {
                    return __BREAK__FLAG__=true;
                    return
                }
            }
        };
        let __array__265=[],__elements__263=args;
        let __BREAK__FLAG__=false;
        for(let __iter__262 in __elements__263) {
            __array__265.push(await __for_body__264(__elements__263[__iter__262]));
            if(__BREAK__FLAG__) {
                 __array__265.pop();
                break;
                
            }
        }return __array__265;
         
    })();
    return rval
};__obj__1["is_symbol?"]=async function(symbol_to_find) {
    return ["=:not",["=:or",["=:==",["=:typeof",symbol_to_find],"undefined"],["=:==",["=:->","=:Environment","get_global",symbol_to_find,"=:ReferenceError"],"=:ReferenceError"]]]
};__obj__1["get_function_args"]=async function(f) {
    let r;
    let s;
    r=new RegExp("^[a-zA-Z_]+ [a-zA-Z ]*\\\\(([a-zA-Z 0-9_,\\\\.\\\\n]*)\\\\)","gm");
    s=await f["toString"]();
    r=await (async function(){
         return await (await Environment.get_global("scan_str"))(r,s) 
    })();
    if (check_true ((((r && r.length)>0)&& ((r && r["0"]) instanceof Object)))){
        {
            return await (await Environment.get_global("map"))(async function(v) {
                if (check_true (await (await Environment.get_global("ends_with?"))("\n",v))){
                    return await (await Environment.get_global("chop"))(v)
                } else {
                    return v
                }
            },((await (await Environment.get_global("second"))((r && r["0"]))|| "")).split(","))
        }
    }
};__obj__1["findpaths"]=async function(value,structure) {
    let acc;
    let search;
    acc=[];
    search=async function(struct,_cpath) {
        return await async function(){
            if (check_true ((struct instanceof Array))) {
                return await (await Environment.get_global("map"))(async function(elem,idx) {
                    return await async function(){
                        if (check_true ((elem instanceof Object))) {
                            return await search(elem,await (await Environment.get_global("conj"))(_cpath,await (async function(){
                                let __array_op_rval__266=idx;
                                 if (__array_op_rval__266 instanceof Function){
                                    return await __array_op_rval__266() 
                                } else {
                                    return [__array_op_rval__266]
                                }
                            })()))
                        } else if (check_true ((elem===value))) {
                            return (acc).push(await (await Environment.get_global("conj"))(_cpath,await (async function(){
                                let __array_op_rval__267=idx;
                                 if (__array_op_rval__267 instanceof Function){
                                    return await __array_op_rval__267() 
                                } else {
                                    return [__array_op_rval__267]
                                }
                            })()))
                        }
                    } ()
                },struct)
            } else if (check_true ((struct instanceof Object))) {
                return await (await Environment.get_global("map"))(async function(pset) {
                    return await async function(){
                        if (check_true (((pset && pset["1"]) instanceof Object))) {
                            return await search((pset && pset["1"]),await (await Environment.get_global("conj"))(_cpath,await (async function(){
                                let __array_op_rval__268=(pset && pset["0"]);
                                 if (__array_op_rval__268 instanceof Function){
                                    return await __array_op_rval__268() 
                                } else {
                                    return [__array_op_rval__268]
                                }
                            })()))
                        } else if (check_true (((pset && pset["1"])===value))) {
                            return (acc).push(await (await Environment.get_global("conj"))(_cpath,await (async function(){
                                let __array_op_rval__269=(pset && pset["1"]);
                                 if (__array_op_rval__269 instanceof Function){
                                    return await __array_op_rval__269() 
                                } else {
                                    return [__array_op_rval__269]
                                }
                            })()))
                        }
                    } ()
                },await (await Environment.get_global("pairs"))(struct))
            } else if (check_true ((struct===value))) {
                return (acc).push(_cpath)
            }
        } ()
    };
    await search(structure,[]);
    return acc
};__obj__1["warn"]=await (async function(){ return await (await Environment.get_global("defclog"))({prefix:"⚠️  "}) })();__obj__1["success"]=await (async function(){ return await (await Environment.get_global("defclog"))({color:"green",prefix:"✓  "}) })();__obj__1["in_background"]=async function(...forms) {
    return ["=:new","=:Promise",["=:fn",["=:resolve","=:reject"],["=:progn",["=:resolve",true],].concat(forms)]]
};__obj__1["show"]=async function(thing) {
    return await async function(){
        if (check_true (thing instanceof Function)) {
            return await thing["toString"]()
        } else {
            return thing
        }
    } ()
};__obj__1["export_symbols"]=async function(...args) {
    let acc;
    let numargs;
    let idx;
    acc=await (async function(){
         return ["=:javascript","export","{"] 
    })();
    numargs=await (await Environment.get_global("length"))(args);
    idx=0;
    await (async function() {
        let __for_body__272=async function(symname) {
            await async function(){
                if (check_true (((symname instanceof Array)&& ((symname && symname.length)===2)))) {
                    {
                        (acc).push(await (async function(){
                            let mval;
                            mval=(symname && symname["0"]);
                            if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                                return await mval["substr"].call(mval,2)
                            } else {
                                return mval
                            }
                        })());
                        (acc).push(" as ");
                        return (acc).push(await (async function(){
                            let mval;
                            mval=(symname && symname["1"]);
                            if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                                return await mval["substr"].call(mval,2)
                            } else {
                                return mval
                            }
                        })())
                    }
                } else if (check_true ((symname instanceof String || typeof symname==='string'))) {
                    (acc).push(await (async function(){
                        let mval;
                        mval=symname;
                        if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                            return await mval["substr"].call(mval,2)
                        } else {
                            return mval
                        }
                    })())
                } else {
                    throw new SyntaxError("Invalid argument for export");
                    
                }
            } ();
            idx+=1;
            if (check_true ((idx<numargs))){
                return (acc).push(", ")
            }
        };
        let __array__273=[],__elements__271=args;
        let __BREAK__FLAG__=false;
        for(let __iter__270 in __elements__271) {
            __array__273.push(await __for_body__272(__elements__271[__iter__270]));
            if(__BREAK__FLAG__) {
                 __array__273.pop();
                break;
                
            }
        }return __array__273;
         
    })();
    return (acc).push("}")
};__obj__1["register_feature"]=async function(feature) {
    if (check_true (await (await Environment.get_global("not"))(await (await Environment.get_global("contains?"))(feature,(await Environment.get_global("*env_config*.features")))))){
        {
            ((await Environment.get_global("*env_config*.features"))).push(feature);
            return true
        }
    } else {
        return false
    }
};__obj__1["uniq"]=async function(values,handle_complex_types) {
    let s;
    s=new Set();
    if (check_true (handle_complex_types)){
        {
            await (await Environment.get_global("map"))(async function(x) {
                return await s["add"].call(s,await JSON.stringify(x))
            },(values|| []));
            return await (await Environment.get_global("map"))(async function(x) {
                return await JSON.parse(x)
            },await (async function(){
                 return await (await Environment.get_global("to_array"))(s) 
            })())
        }
    } else {
        {
            await (await Environment.get_global("map"))(async function(x) {
                return await s["add"].call(s,x)
            },(values|| []));
            return await (await Environment.get_global("to_array"))(s)
        }
    }
};__obj__1["time_in_millis"]=async function() {
    return ["=:Date.now"]
};__obj__1["defns"]=async function(name,options) {
    if (check_true ((options&& (options && options["ignore_if_exists"])&& (name instanceof String || typeof name==='string')&& await (await Environment.get_global("contains?"))(name,await (await Environment.get_global("namespaces"))())))){
        return name
    } else {
        return await (await Environment.get_global("create_namespace"))(name,options)
    }
};__obj__1["use_ns"]=async function(name) {
    return ["=:set_namespace",["=:desym",name]]
};__obj__1["bind_and_call"]=async function(target_object,this_object,method,...args) {
    let boundf=await (await Environment.get_global("bind"))(target_object[method],this_object);
    ;
    if (check_true (boundf)){
        return await (async function(){
            return ( boundf).apply(this,args)
        })()
    } else {
        throw new Error("unable to bind target_object");
        
    }
};__obj__1["save_locally"]=async function(fname,data,content_type) {
    if (check_true (window["document"])){
        {
            let blob;
            let elem;
            let dbody;
            blob=new Blob(await (async function(){
                let __array_op_rval__278=data;
                 if (__array_op_rval__278 instanceof Function){
                    return await __array_op_rval__278() 
                } else {
                    return [__array_op_rval__278]
                }
            })(),{
                type:content_type
            });
            elem=await (async function() {
                {
                     let __call_target__=window["document"], __call_method__="createElement";
                    return await __call_target__[__call_method__].call(__call_target__,"a")
                } 
            })();
            dbody=await (async function(){
                let __targ__279=(await Environment.get_global("document"));
                if (__targ__279){
                     return(__targ__279)["body"]
                } 
            })();
            ;
            await async function(){
                elem["href"]=await window.URL["createObjectURL"].call(window.URL,blob);
                elem["download"]=fname;
                return elem;
                
            }();
            await dbody["appendChild"].call(dbody,elem);
            await elem["click"]();
            await dbody["removeChild"].call(dbody,elem);
            return true
        }
    } else {
        return false
    }
};__obj__1["fetch_text"]=async function(url) {
    let resp;
    resp=await fetch(url);
    if (check_true ((resp && resp["ok"]))){
        return await resp["text"]()
    } else {
        throw new EvalError(("unable to fetch "+ url+ ": "+ (resp && resp["status"])+ ": "+ (resp && resp["statusText"])));
        
    }
};__obj__1["import"]=async function(...args) {
    let filespec;
    let is_url_ques_;
    let js_mode;
    let url_comps;
    let js_mod;
    let load_fn;
    let target_symbols;
    let target_path;
    let acc;
    filespec=await (await Environment.get_global("last"))(args);
    is_url_ques_=await (await Environment.get_global("contains?"))("://",filespec);
    js_mode=null;
    url_comps=null;
    js_mod=null;
    load_fn=null;
    target_symbols=await (async function(){
        if (check_true (((args && args.length)>1))){
            return (args && args["0"])
        }
    })();
    target_path=null;
    acc=[];
    await async function(){
        if (check_true ((is_url_ques_|| await (await Environment.get_global("not"))((null==location))))) {
            {
                load_fn="fetch_text";
                url_comps=await (async function(){
                     return await async function(){
                        if (check_true (is_url_ques_)) {
                            return new URL(filespec)
                        } else if (check_true (await (await Environment.get_global("starts_with?"))("/",filespec))) {
                            return new URL((""+ location["origin"]+ filespec))
                        } else {
                            return new URL((""+ location["href"]+ "/"+ filespec))
                        }
                    } () 
                })();
                return target_path=(url_comps && url_comps["pathname"])
            }
        } else if (check_true (await (await Environment.get_global("not"))(((typeof "read_text_file"==="undefined")|| (await Environment["get_global"].call(Environment,"read_text_file",ReferenceError)===ReferenceError))))) {
            {
                load_fn="read_text_file";
                target_path=filespec
            }
        } else {
            throw new EvalError(("unable to handle import of "+ filespec));
            
        }
    } ();
    return await async function(){
        if (check_true ((await (await Environment.get_global("ends_with?"))(".lisp",target_path)|| await (await Environment.get_global("ends_with?"))(".juno",target_path)))) {
            return ["=:evaluate",[await (async function(){
                 return ("=:"+ load_fn) 
            })(),filespec],"=:nil",["=:to_object",[["source_name",filespec],["throw_on_error",true]]]]
        } else if (check_true (await (await Environment.get_global("ends_with?"))(".json",target_path))) {
            return ["=:evaluate",["=:JSON.parse",[await (async function(){
                 return ("=:"+ load_fn) 
            })(),filespec]],"=:nil",["=:to_object",[["json_in",true],["source_name",filespec],["throw_on_error",true]]]]
        } else if (check_true ((await (await Environment.get_global("ends_with?"))(".js",target_path)|| (await (await Environment.get_global("not"))(((typeof "Deno"==="undefined")|| (await Environment["get_global"].call(Environment,"Deno",ReferenceError)===ReferenceError)))&& await (await Environment.get_global("ends_with?"))(".ts",target_path))))) {
            {
                return await async function(){
                    if (check_true ((await (await Environment.get_global("length"))(target_symbols)===0))) {
                        throw new SyntaxError("imports of javascript sources require binding symbols as the first argument");
                        
                    } else if (check_true ((target_symbols instanceof Array))) {
                        {
                            (acc).push(await (async function(){
                                 return ["=:defglobal",(target_symbols && target_symbols["0"]),["=:dynamic_import",filespec]] 
                            })());
                            (acc).push(await (async function(){
                                 return ["=:set_path",["imports",["=:+",await (await Environment.get_global("current_namespace"))(),"/",["=:desym",(target_symbols && target_symbols["0"])]]],"=:*env_config*",["=:to_object",[["symbol",["=:desym",(target_symbols && target_symbols["0"])]],["namespace",await (await Environment.get_global("current_namespace"))()],["location",filespec]]]] 
                            })());
                            (acc).push(await (async function(){
                                 return ["=:when",["=:prop",(target_symbols && target_symbols["0"]),"initializer"],["=:->",(target_symbols && target_symbols["0"]),"initializer","=:Environment"]] 
                            })());
                            (acc).push((target_symbols && target_symbols["0"]));
                            return ["=:iprogn",].concat(acc)
                        }
                    }
                } ()
            }
        } else {
            throw new EvalError("invalid extension: needs to be .lisp, .js, .json or .juno");
            
        }
    } ()
};__obj__1["system_date_format"]={weekday:"long",year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hourCycle:"h24",hour12:false,timeZoneName:"short"};__obj__1["system_date_formatter"]=new Intl.DateTimeFormat([],{weekday:"long",year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hourCycle:"h24",hour12:false,timeZoneName:"short"});__obj__1["tzoffset"]=async function() {
    return (60* await (async function() {
        {
             let __call_target__=new Date(), __call_method__="getTimezoneOffset";
            return await __call_target__[__call_method__]()
        } 
    })())
};__obj__1["date_components"]=async function(date_value,date_formatter) {
    if (check_true (await (await Environment.get_global("is_date?"))(date_value))){
        return await (await Environment.get_global("to_object"))(await (async function(){
             return await (await Environment.get_global("map"))(async function(x) {
                return await (async function(){
                    let __array_op_rval__281=(x && x["type"]);
                     if (__array_op_rval__281 instanceof Function){
                        return await __array_op_rval__281((x && x["value"])) 
                    } else {
                        return [__array_op_rval__281,(x && x["value"])]
                    }
                })()
            },await (async function(){
                if (check_true (date_formatter)){
                    return await (await Environment.get_global("bind_and_call"))(date_formatter,date_formatter,"formatToParts",date_value)
                } else {
                    return await (await Environment.get_global("bind_and_call"))((await Environment.get_global("system_date_formatter")),(await Environment.get_global("system_date_formatter")),"formatToParts",date_value)
                }
            })()) 
        })())
    } else {
        return null
    }
};__obj__1["formatted_date"]=async function(dval,date_formatter) {
    let comps;
    comps=await (async function(){
         return await (await Environment.get_global("date_components"))(dval,date_formatter) 
    })();
    if (check_true (comps)){
        if (check_true (date_formatter)){
            return (await (await Environment.get_global("values"))(comps)).join("")
        } else {
            return (""+ (comps && comps["year"])+ "-"+ (comps && comps["month"])+ "-"+ (comps && comps["day"])+ " "+ (comps && comps["hour"])+ ":"+ (comps && comps["minute"])+ ":"+ (comps && comps["second"]))
        }
    } else {
        return null
    }
};__obj__1["*LANGUAGE*"]=new Object();__obj__1["dtext"]=async function(default_text) {
    return (await (async function(){
        let __targ__282=(await Environment.get_global("*LANGUAGE*"));
        if (__targ__282){
             return(__targ__282)[default_text]
        } 
    })()|| default_text)
};__obj__1["nth"]=async function(idx,collection) {
    return await async function(){
        if (check_true ((idx instanceof Array))) {
            return await (await Environment.get_global("map"))(async function(v) {
                return await (await Environment.get_global("nth"))(v,collection)
            },idx)
        } else if (check_true ((await (await Environment.get_global("is_number?"))(idx)&& (idx<0)&& (await (await Environment.get_global("length"))(collection)>=(-1* idx))))) {
            return collection[await (await Environment.get_global("add"))(await (await Environment.get_global("length"))(collection),idx)]
        } else if (check_true ((await (await Environment.get_global("is_number?"))(idx)&& (idx<0)&& (await (await Environment.get_global("length"))(collection)<(-1* idx))))) {
            return undefined
        } else {
            return collection[idx]
        }
    } ()
};__obj__1["use_symbols"]=async function(namespace,symbol_list,target_namespace) {
    let acc;
    let nspace;
    let nspace_handle;
    let decs;
    acc=await (async function(){
         return ["=:progn"] 
    })();
    nspace=await (async function(){
        if (check_true (namespace)){
            {
                let mval;
                mval=namespace;
                if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                    return await mval["substr"].call(mval,2)
                } else {
                    return mval
                }
            }
        }
    })();
    nspace_handle=null;
    decs=null;
    await (await Environment.get_global("assert"))((nspace instanceof String || typeof nspace==='string'));
    await (await Environment.get_global("assert"))((symbol_list instanceof Array),"invalid symbol list provided to use_symbols");
    nspace_handle=await Environment["get_namespace_handle"].call(Environment,nspace);
    await (async function() {
        let __for_body__285=async function(sym) {
            decs=await (async function(){
                let __targ__287=(nspace_handle && nspace_handle["definitions"]);
                if (__targ__287){
                     return(__targ__287)[await (async function(){
                        let mval;
                        mval=sym;
                        if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                            return await mval["substr"].call(mval,2)
                        } else {
                            return mval
                        }
                    })()]
                } 
            })();
            return (acc).push(await (async function(){
                 return ["=:defglobal",await (async function(){
                    let mval;
                    mval=sym;
                    if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                        return await mval["substr"].call(mval,2)
                    } else {
                        return mval
                    }
                })(),await (async function(){
                     return ("=:"+ nspace+ "/"+ await (async function(){
                        let mval;
                        mval=sym;
                        if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                            return await mval["substr"].call(mval,2)
                        } else {
                            return mval
                        }
                    })()) 
                })(),["=:to_object",[["initializer",["=:quotem",["=:pend_load",nspace,await (async function(){
                     return (target_namespace|| await (await Environment.get_global("current_namespace"))()) 
                })(),await (async function(){
                    let mval;
                    mval=sym;
                    if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                        return await mval["substr"].call(mval,2)
                    } else {
                        return mval
                    }
                })(),["=:quote",await (async function(){
                     return ("=:"+ nspace+ "/"+ await (async function(){
                        let mval;
                        mval=sym;
                        if (check_true (((mval instanceof String || typeof mval==='string')&& await (await Environment.get_global("starts_with?"))("=:",mval)))){
                            return await mval["substr"].call(mval,2)
                        } else {
                            return mval
                        }
                    })()) 
                })()]]]],["eval_when",await (async function(){
                     return (decs&& decs["eval_when"]) 
                })()]]]] 
            })())
        };
        let __array__286=[],__elements__284=symbol_list;
        let __BREAK__FLAG__=false;
        for(let __iter__283 in __elements__284) {
            __array__286.push(await __for_body__285(__elements__284[__iter__283]));
            if(__BREAK__FLAG__) {
                 __array__286.pop();
                break;
                
            }
        }return __array__286;
         
    })();
    return acc
};__obj__1["use_unique_symbols"]=async function(namespace) {
    if (check_true ((namespace instanceof String || typeof namespace==='string'))){
        {
            let symlist;
            symlist=await Environment["evaluate"].call(Environment,("("+ namespace+ "/symbols { `unique: true })"));
            (await Environment.eval(await async function(){
                return ["=:use_symbols",namespace,symlist]
            }()));
            return await (await Environment.get_global("length"))(symlist)
        }
    } else {
        throw new EvalError("provided namespace must be a string");
        
    }
};__obj__1["compiler"]=async function(quoted_lisp,opts) {
    let Environment=(opts && opts["env"]);
    ;
    let get_global=(opts && opts["env"] && opts["env"]["get_global"]);
    ;
    {
        let length=function anonymous(obj) {
{
                                if(obj instanceof Array) {
                                    return obj.length;
                                } else if (obj instanceof Set) {
                                    return obj.size;
                                } else if ((obj === undefined)||(obj===null)) {
                                    return 0;
                                } else if (typeof obj==='object') {
                                    return Object.keys(obj).length;
                                } else if (typeof obj==='string') {
                                    return obj.length;
                                } 
                                return 0;
                            }
};
        let first=function anonymous(x) {
{ return x[0] }
};
        let second=function anonymous(x) {
{ return x[1] }
};
        let map=async function anonymous(lambda,array_values) {
{ try {
                                        let rval = [],
                                                tl = array_values.length;
                                        for (let i = 0; i < array_values.length; i++) {
                                            rval.push(await lambda.apply(this,[array_values[i], i, tl]));
                                         }
                                        return rval;
                                    } catch (ex) {           
                                              if (lambda === undefined || lambda === null) {
                                                    throw new ReferenceError("map: lambda argument (position 0) is undefined or nil")
                                              } else if (array_values === undefined || array_values === null) {
                                                    throw new ReferenceError("map: container argument (position 1) is undefined or nil")
                                              } else if (!(lambda instanceof Function)) {
                                                    throw new ReferenceError("map: lambda argument must be a function: received: "+ typeof lambda)
                                              } else if (!(array_values instanceof Array)) {
                                                    throw new ReferenceError("map: invalid array argument, received: " + typeof array_values)
                                              } else {
                                                    // something else just pass on the error
                                                throw ex;
                                              }
                                    }
                              }
};
        let do_deferred_splice=async function(tree) {    let rval;
    let idx;
    let tval;
    let deferred_operator;
    rval=null;
    idx=0;
    tval=null;
    deferred_operator=(["=","$","&","!"]).join("");
    return await async function(){
        if (check_true ((tree instanceof Array))) {
            {
                rval=[];
                await (async function(){
                     let __test_condition__15=async function() {
                        return (idx<(tree && tree.length))
                    };
                    let __body_ref__16=async function() {
                        tval=tree[idx];
                        if (check_true ((tval===deferred_operator))){
                            {
                                idx+=1;
                                tval=tree[idx];
                                rval=await rval["concat"].call(rval,await (async function(){
                                     return await do_deferred_splice(tval) 
                                })())
                            }
                        } else {
                            (rval).push(await (async function(){
                                 return await do_deferred_splice(tval) 
                            })())
                        };
                        return idx+=1
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__15()) {
                        await __body_ref__16();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                return rval
            }
        } else if (check_true ((tree instanceof Object))) {
            {
                rval=new Object();
                await (async function() {
                    let __for_body__19=async function(pset) {
                        return await async function(){
                            rval[(pset && pset["0"])]=await (async function(){
                                 return await do_deferred_splice((pset && pset["1"])) 
                            })();
                            return rval;
                            
                        }()
                    };
                    let __array__20=[],__elements__18=await (await Environment.get_global("pairs"))(tree);
                    let __BREAK__FLAG__=false;
                    for(let __iter__17 in __elements__18) {
                        __array__20.push(await __for_body__19(__elements__18[__iter__17]));
                        if(__BREAK__FLAG__) {
                             __array__20.pop();
                            break;
                            
                        }
                    }return __array__20;
                     
                })();
                return rval
            }
        } else {
            return tree
        }
    } ()
};
        let not=function anonymous(x) {
{ if (check_true(x)) { return false } else { return true } }
};
        let sub_type=function subtype(value) {  if (value === null) return "null";  else if (value === undefined) return "undefined";
  else if (value instanceof Array) return "array";
  else if (value.constructor && value.constructor!=null && value.constructor.name!=='Object') {
    return value.constructor.name;
  }
  return typeof value;
};
        let last=function anonymous(x) {
{ return x[x.length - 1] }
};
        let flatten=function anonymous(x) {
{ return x.flat(999999999999) } 
};
        let add=function anonymous(...args) {
{
                                let acc;
                                if (typeof args[0]==="number") {
                                    acc = 0;
                                } else if (args[0] instanceof Array) {
                                    return args[0].concat(args.slice(1));
                                } else if (typeof args[0]==='object') {
                                   let rval = {};
                                   for (let i in args) {
                                        if (typeof args[i] === 'object') {
                                            for (let k in args[i]) {
                                                rval[k] = args[i][k];
                                            }
                                        }
                                   }
                                   return rval;
                                } else {
                                    acc = "";
                                }
                                for (let i in args) {
                                    acc += args[i];
                                }
                                return acc;
                             }
};
        let subtype=function subtype(value) {  if (value === null) return "null";
  else if (value === undefined) return "undefined";
  else if (value instanceof Array) return "array";
  else if (value.constructor && value.constructor!=null && value.constructor.name!=='Object') {
    return value.constructor.name;
  }
  return typeof value;
};
        let is_nil_ques_=async function(value) {    return (null===value)
};
        let is_number_ques_=function(x) {                        return ( subtype(x)==="Number")
                    };
        let starts_with_ques_=function anonymous(val,text) {
{ if (text instanceof Array) { return text[0]===val } else if (subtype(text)=='String') { return text.startsWith(val) } else { return false }}
};
        let uniq=async function(values,handle_complex_types) {    let s;
    s=new Set();
    if (check_true (handle_complex_types)){
        {
            await (await Environment.get_global("map"))(async function(x) {
                return await s["add"].call(s,await JSON.stringify(x))
            },(values|| []));
            return await (await Environment.get_global("map"))(async function(x) {
                return await JSON.parse(x)
            },await (async function(){
                 return await (await Environment.get_global("to_array"))(s) 
            })())
        }
    } else {
        {
            await (await Environment.get_global("map"))(async function(x) {
                return await s["add"].call(s,x)
            },(values|| []));
            return await (await Environment.get_global("to_array"))(s)
        }
    }
};
        let object_methods=async function(obj) {    let properties;
    let current_obj;
    properties=new Set();
    current_obj=obj;
    await (async function(){
         let __test_condition__274=async function() {
            return current_obj
        };
        let __body_ref__275=async function() {
            await (await Environment.get_global("map"))(async function(item) {
                return await properties["add"].call(properties,item)
            },await Object.getOwnPropertyNames(current_obj));
            return current_obj=await Object.getPrototypeOf(current_obj)
        };
        let __BREAK__FLAG__=false;
        while(await __test_condition__274()) {
            await __body_ref__275();
             if(__BREAK__FLAG__) {
                 break;
                
            }
        } ;
        
    })();
    return await (async function() {
        {
             let __call_target__=await Array.from(await properties["keys"]()), __call_method__="filter";
            return await __call_target__[__call_method__].call(__call_target__,async function(item) {
                return item instanceof Function
            })
        } 
    })()
};
        let conj=function anonymous(...args) {
{   let list = [];
                                if (args[0] instanceof Array) {
                                    list = args[0];
                                } else {
                                    list = [args[0]];
                                }
                                args.slice(1).map(function(x) {
                                    list = list.concat(x);
                                });
                                return list;
                            }
};
        let cl_encode_string=async function(text) {    if (check_true ((text instanceof String || typeof text==='string'))){
        {
            let escaped;
            let nq;
            let step1;
            let snq;
            escaped=await (async function(){
                 return await (await Environment.get_global("replace"))(new RegExp("\n","g"),await (await Environment.get_global("add"))(await String.fromCharCode(92),"n"),text) 
            })();
            escaped=await (async function(){
                 return await (await Environment.get_global("replace"))(new RegExp("\r","g"),await (await Environment.get_global("add"))(await String.fromCharCode(92),"r"),escaped) 
            })();
            nq=(escaped).split(await String.fromCharCode(34));
            step1=(nq).join(await (await Environment.get_global("add"))(await String.fromCharCode(92),await String.fromCharCode(34)));
            snq=(step1).split(await String.fromCharCode(39));
            return step1
        }
    } else {
        return text
    }
};
        let contains_ques_=function anonymous(value,container) {
{ if (!value && !container) { return false }
                           else if (container === null) { throw new TypeError("contains?: passed nil/undefined container value"); }
                           else if (container instanceof Array) return container.includes(value);
                           else if (container instanceof Set) return container.has(value);
                           else if ((container instanceof String) || typeof container === "string") {
                                if (subtype(value) === "Number") return container.indexOf(""+value)>-1;
                                else return container.indexOf(value)>-1;
                           }                                                      
                           else throw new TypeError("contains?: passed invalid container type: "+subtype(container)) }
};
        let tree;
        let expanded_tree;
        let op;
        let default_safety_level;
        let source_name;
        let build_environment_mode;
        let env_ref;
        let operator;
        let break_out;
        let tokens;
        let tokenized;
        let target_namespace;
        let errors;
        let external_dependencies;
        let first_level_setup;
        let needs_first_level;
        let signal_error;
        let warnings;
        let blk_counter;
        let ctx;
        let output;
        let __log__1= async function(){
            return await Environment.get_global("log")
        };
        let __defclog__2= async function(){
            return async function(opts) {
                let style;
                style=("padding: 5px;"+ await (async function(){
                    if (check_true ((opts && opts["background"]))){
                        return ("background: "+ (opts && opts["background"])+ ";")
                    } else {
                        return ""
                    }
                })()+ await (async function(){
                    if (check_true ((opts && opts["color"]))){
                        return ("color: "+ (opts && opts["color"])+ ";")
                    }
                })()+ "");
                ;
                return async function(...args) {
                    return await (async function(){
                        let __target_arg__6=[].concat(await conj([style],args));
                        if(!__target_arg__6 instanceof Array){
                            throw new TypeError("Invalid final argument to apply - an array is required")
                        }let __pre_arg__7=await (async function(){
                             return ("%c"+ await (async function(){
                                if (check_true ((opts && opts["prefix"]))){
                                    return (opts && opts["prefix"])
                                } else {
                                    return (args).shift()
                                }
                            })()) 
                        })();
                        __target_arg__6.unshift(__pre_arg__7);
                        return (console.log).apply(this,__target_arg__6)
                    })()
                }
            }
        };
        let quiet_mode;
        let show_hints;
        let error_log;
        let assembly;
        let async_function_type_placeholder;
        let function_type_placeholder;
        let type_marker;
        let return_marker;
        let entry_signature;
        let temp_fn_asn_template;
        let anon_fn_template;
        let build_fn_with_assignment;
        let build_anon_fn;
        let completion_types;
        let referenced_global_symbols;
        let new_ctx;
        let set_ctx_log;
        let map_ctype_to_value;
        let map_value_to_ctype;
        let set_ctx;
        let get_ctx;
        let get_ctx_val;
        let get_declarations;
        let set_declaration;
        let is_ambiguous_ques_;
        let set_ambiguous;
        let unset_ambiguous;
        let invalid_js_ref_chars;
        let invalid_js_ref_chars_regex;
        let check_invalid_js_ref;
        let sanitize_js_ref_name;
        let find_in_context;
        let source_chain;
        let source_from_tokens;
        let source_comment;
        let NOT_FOUND;
        let THIS_REFERENCE;
        let NOT_FOUND_THING;
        let get_lisp_ctx_log;
        let get_lisp_ctx;
        let get_val;
        let has_lisp_globals;
        let root_ctx;
        let tokenize_object;
        let tokenize_quote;
        let tokenize;
        let comp_time_log;
        let compile_time_eval;
        let infix_ops;
        let compile_set_prop;
        let compile_prop;
        let compile_elem;
        let inline_log;
        let compile_inline;
        let compile_push;
        let compile_list;
        let compile_typeof;
        let compile_instanceof;
        let compile_compare;
        let compile_assignment;
        let top_level_log;
        let compile_toplevel;
        let check_statement_completion;
        let compile_block;
        let Expression;
        let Statement;
        let NumberType;
        let StringType;
        let NilType;
        let UnknownType;
        let ArgumentType;
        let compile_defvar;
        let get_declaration_details;
        let clean_quoted_reference;
        let compile_let;
        let in_sync_ques_;
        let await_ques_;
        let calling_preamble;
        let fn_log;
        let completion_scope_id;
        let set_new_completion_scope;
        let compile_fn;
        let compile_jslambda;
        let compile_yield;
        let var_counter;
        let gen_temp_name;
        let if_id;
        let compile_cond;
        let compile_cond_inner;
        let ensure_block;
        let compile_if;
        let compile_as_call;
        let compile_wrapper_fn;
        let compile_block_to_anon_fn;
        let make_do_block;
        let push_as_arg_list;
        let compile_new;
        let compile_val_mod;
        let compile_try;
        let compile_try_inner;
        let compile_throw;
        let compile_break;
        let compile_return;
        let apply_log;
        let compile_apply;
        let compile_call;
        let compile_call_inner;
        let check_needs_wrap;
        let compile_import;
        let compile_dynamic_import;
        let compile_javascript;
        let compile_set_global;
        let is_token_ques_;
        let compile_quote;
        let compile_quotel;
        let wrap_and_run;
        let quote_tree;
        let quotem_log;
        let compile_quotem;
        let compile_unquotem;
        let eval_log;
        let compile_eval;
        let compile_debug;
        let compile_for_each;
        let compile_for_each_inner;
        let compile_while;
        let compile_for_with;
        let compile_for_with_inner;
        let silence;
        let verbosity;
        let check_verbosity;
        let declare_log;
        let compile_declare;
        let safety_level;
        let get_scoped_type;
        let compile_scoped_reference;
        let compile_lisp_scoped_reference;
        let standard_types;
        let is_error;
        let is_block_ques_;
        let is_complex_ques_;
        let is_form_ques_;
        let op_lookup;
        let comp_log;
        let last_source;
        let compile_obj_literal;
        let is_literal_ques_;
        let comp_warn;
        let __compile__3= async function(){
            return async function(tokens,ctx,_cdepth) {
                if (check_true (is_error)){
                    return is_error
                } else {
                    {
                        let rval=await compile_inner(tokens,ctx,_cdepth);
                        ;
                        if (check_true (is_error)){
                            {
                                if (check_true ((opts && opts["throw_on_error"]))){
                                    {
                                        let error=new Error((is_error && is_error["error"]));
                                        ;
                                        await (async function() {
                                            let __for_body__558=async function(pset) {
                                                return await async function(){
                                                    error[(pset && pset["0"])]=(pset && pset["1"]);
                                                    return error;
                                                    
                                                }()
                                            };
                                            let __array__559=[],__elements__557=await (await Environment.get_global("pairs"))(is_error);
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__556 in __elements__557) {
                                                __array__559.push(await __for_body__558(__elements__557[__iter__556]));
                                                if(__BREAK__FLAG__) {
                                                     __array__559.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__559;
                                             
                                        })();
                                        throw error;
                                        
                                    }
                                }
                            }
                        };
                        return rval
                    }
                }
            }
        };
        let compile_inner;
        let final_token_assembly;
        let main_log;
        let assemble_output;
        {
            tree=quoted_lisp;
            expanded_tree=await (async function(){
                 return await clone(tree) 
            })();
            op=null;
            default_safety_level=((Environment && Environment["declarations"] && Environment["declarations"]["safety"] && Environment["declarations"]["safety"]["level"])|| 1);
            source_name=((opts && opts["source_name"])|| "anonymous");
            build_environment_mode=((opts && opts["build_environment"])|| false);
            env_ref=await (async function(){
                if (check_true (build_environment_mode)){
                    return ""
                } else {
                    return "Environment."
                }
            })();
            operator=null;
            break_out="__BREAK__FLAG__";
            tokens=[];
            tokenized=null;
            target_namespace=null;
            errors=[];
            external_dependencies=new Object();
            first_level_setup=[];
            needs_first_level=true;
            signal_error=async function(message) {
                return new LispSyntaxError(message)
            };
            warnings=[];
            blk_counter=0;
            ctx=null;
            output=null;
            let log=await __log__1();
            ;
            let defclog=await __defclog__2();
            ;
            quiet_mode=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    {
                        log=console.log;
                        return true
                    }
                } else {
                    return false
                }
            })();
            show_hints=null;
            error_log=await (async function(){
                 return await defclog({
                    prefix:"Compile Error",background:"#CA3040",color:"white"
                }) 
            })();
            assembly=[];
            async_function_type_placeholder=async function() {
                return true
            };
            function_type_placeholder=function() {
                return true
            };
            type_marker=async function(type) {
                return await async function(){
                    let __target_obj__8=new Object();
                    __target_obj__8["ctype"]=type;
                    __target_obj__8["args"]=[];
                    return __target_obj__8;
                    
                }()
            };
            return_marker=async function() {
                return {
                    mark:"rval"
                }
            };
            entry_signature=null;
            temp_fn_asn_template=await (async function(){
                 return [{
                    type:"special",val:await (async function(){
                         return "=:defvar" 
                    })(),ref:true,name:"defvar"
                },{
                    type:"literal",val:"\"\"",ref:false,name:""
                },{
                    type:"arr",val:await (async function(){
                         return [{
                            type:"special",val:await (async function(){
                                 return "=:fn" 
                            })(),ref:true,name:"fn"
                        },{
                            type:"arr",val:[],ref:false,name:null
                        },{
                            type:"arr",val:[],ref:false,name:null
                        }] 
                    })(),ref:false,name:null
                }] 
            })();
            anon_fn_template=await temp_fn_asn_template["slice"].call(temp_fn_asn_template,2);
            build_fn_with_assignment=async function(tmp_var_name,body,args,ctx) {
                let tmp_template;
                tmp_template=await (async function(){
                     return await clone(temp_fn_asn_template) 
                })();
                if (check_true (await (async function(){
                    let __array_op_rval__9=in_sync_ques_;
                     if (__array_op_rval__9 instanceof Function){
                        return await __array_op_rval__9(ctx) 
                    } else {
                        return [__array_op_rval__9,ctx]
                    }
                })())){
                    {
                        await async function(){
                            let __target_obj__10=(tmp_template && tmp_template["2"] && tmp_template["2"]["val"] && tmp_template["2"]["val"]["0"]);
                            __target_obj__10["val"]=await (async function(){
                                 return "=:function" 
                            })();
                            return __target_obj__10;
                            
                        }();
                        await async function(){
                            let __target_obj__11=(tmp_template && tmp_template["2"] && tmp_template["2"]["val"] && tmp_template["2"]["val"]["0"]);
                            __target_obj__11["name"]="function";
                            return __target_obj__11;
                            
                        }()
                    }
                };
                await async function(){
                    let __target_obj__12=(tmp_template && tmp_template["1"]);
                    __target_obj__12["name"]=tmp_var_name;
                    __target_obj__12["val"]=tmp_var_name;
                    return __target_obj__12;
                    
                }();
                if (check_true ((args instanceof Array))){
                    {
                        await async function(){
                            let __target_obj__13=(tmp_template && tmp_template["2"] && tmp_template["2"]["val"] && tmp_template["2"]["val"]["1"]);
                            __target_obj__13["val"]=args;
                            return __target_obj__13;
                            
                        }()
                    }
                };
                await async function(){
                    let __target_obj__14=(tmp_template && tmp_template["2"] && tmp_template["2"]["val"] && tmp_template["2"]["val"]["2"]);
                    __target_obj__14["val"]=body;
                    return __target_obj__14;
                    
                }();
                return tmp_template
            };
            build_anon_fn=async function(body,args) {
                let tmp_template;
                tmp_template=await (async function(){
                     return await clone(anon_fn_template) 
                })();
                if (check_true (await verbosity(ctx))){
                    {
                        await console.log("build_anon_function: -> body: ",body);
                        await console.log("build_anon_function: -> args: ",args)
                    }
                };
                if (check_true ((args instanceof Array))){
                    {
                        await async function(){
                            let __target_obj__15=(tmp_template && tmp_template["0"] && tmp_template["0"]["val"] && tmp_template["0"]["val"]["1"]);
                            __target_obj__15["val"]=args;
                            return __target_obj__15;
                            
                        }()
                    }
                };
                await async function(){
                    let __target_obj__16=(tmp_template && tmp_template["0"] && tmp_template["0"]["val"] && tmp_template["0"]["val"]["2"]);
                    __target_obj__16["val"]=body;
                    return __target_obj__16;
                    
                }();
                return tmp_template
            };
            completion_types=["return","throw","yield"];
            referenced_global_symbols=new Object();
            new_ctx=function(parent) {
                let ctx_obj;
                ctx_obj=new Object();
                  (function(){
                    ctx_obj["scope"]=new Object();
                    ctx_obj["source"]="";
                    ctx_obj["parent"]=parent;
                    ctx_obj["ambiguous"]=new Object();
                    ctx_obj["declared_types"]=new Object();
                    ctx_obj["defs"]=[];
                    return ctx_obj;
                    
                })();
                if (check_true (parent)){
                    {
                          (function(){
                            let __target_obj__18=(ctx_obj && ctx_obj["scope"]);
                            __target_obj__18["namespace"]=(parent && parent["scope"] && parent["scope"]["namespace"]);
                            return __target_obj__18;
                            
                        })();
                        if (check_true ((parent && parent["defvar_eval"]))){
                            {
                                  (function(){
                                    ctx_obj["defvar_eval"]=true;
                                    return ctx_obj;
                                    
                                })()
                            }
                        };
                        if (check_true ((parent && parent["has_first_level"]))){
                            {
                                  (function(){
                                    ctx_obj["has_first_level"]=true;
                                    return ctx_obj;
                                    
                                })()
                            }
                        };
                        if (check_true ((parent && parent["block_step"]))){
                            {
                                  (function(){
                                    ctx_obj["block_step"]=(parent && parent["block_step"]);
                                    return ctx_obj;
                                    
                                })()
                            }
                        };
                        if (check_true ((parent && parent["block_id"]))){
                            {
                                  (function(){
                                    ctx_obj["block_id"]=(parent && parent["block_id"]);
                                    return ctx_obj;
                                    
                                })()
                            }
                        };
                        if (check_true ((parent && parent["sub_block_step"]))){
                            {
                                  (function(){
                                    ctx_obj["sub_block_step"]=(parent && parent["sub_block_step"]);
                                    return ctx_obj;
                                    
                                })()
                            }
                        };
                        if (check_true (false)){
                            {
                                  (function(){
                                    ctx_obj["return_point"]= add((parent && parent["return_point"]),1);
                                    return ctx_obj;
                                    
                                })()
                            }
                        }
                    }
                };
                return ctx_obj
            };
            set_ctx_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"set_ctx",background:"darkgreen",color:"white"
                    })
                }
            })();
            map_ctype_to_value=async function(ctype,value) {
                return await async function(){
                    if (check_true ((ctype==="Function"))) {
                        return Function
                    } else if (check_true ((ctype==="AsyncFunction"))) {
                        return AsyncFunction
                    } else if (check_true ((ctype==="expression"))) {
                        return Expression
                    } else if (check_true (((ctype instanceof String || typeof ctype==='string')&& await contains_ques_("block",ctype)))) {
                        return UnknownType
                    } else if (check_true ((ctype==="array"))) {
                        return Array
                    } else if (check_true ((ctype==="nil"))) {
                        return NilType
                    } else if (check_true (ctype instanceof Function)) {
                        return ctype
                    } else {
                        return value
                    }
                } ()
            };
            map_value_to_ctype=async function(value) {
                return await async function(){
                    if (check_true ((Function===value))) {
                        return "Function"
                    } else if (check_true ((AsyncFunction===value))) {
                        return "AsyncFunction"
                    } else if (check_true ((NumberType===value))) {
                        return "NumberType"
                    } else if (check_true ((Expression===value))) {
                        return "Expression"
                    } else if (check_true ((Array===value))) {
                        return "array"
                    } else if (check_true ((Boolean===value))) {
                        return "Boolean"
                    } else if (check_true ((NilType===value))) {
                        return "nil"
                    } else if (check_true ((Object===value))) {
                        return "Object"
                    } else {
                        return value
                    }
                } ()
            };
            set_ctx=async function(ctx,name,value) {
                let sanitized_name=await sanitize_js_ref_name(name);
                ;
                if (check_true (((value instanceof Array)&& (value && value["0"] && value["0"]["ctype"])))){
                    return await async function(){
                        let __target_obj__25=(ctx && ctx["scope"]);
                        __target_obj__25[sanitized_name]=await (async function(){
                             return await async function(){
                                if (check_true (((value && value["0"] && value["0"]["ctype"])==="Function"))) {
                                    return Function
                                } else if (check_true (((value && value["0"] && value["0"]["ctype"])==="AsyncFunction"))) {
                                    return AsyncFunction
                                } else if (check_true (((value && value["0"] && value["0"]["ctype"])==="expression"))) {
                                    return Expression
                                } else {
                                    return value
                                }
                            } () 
                        })();
                        return __target_obj__25;
                        
                    }()
                } else {
                    return await async function(){
                        let __target_obj__26=(ctx && ctx["scope"]);
                        __target_obj__26[sanitized_name]=value;
                        return __target_obj__26;
                        
                    }()
                }
            };
            get_ctx=async function(ctx,name) {
                let ref_name;
                ref_name=null;
                return await async function(){
                    if (check_true (await (async function(){
                         return await is_nil_ques_(name) 
                    })())) {
                        throw new SyntaxError(("get_ctx: nil identifier passed: "+ await sub_type(name)));
                        
                    } else if (check_true (await is_number_ques_(name))) {
                        return name
                    } else if (check_true (name instanceof Function)) {
                        throw new SyntaxError(("get_ctx: invalid identifier passed: "+ await sub_type(name)));
                        
                    } else {
                        {
                            ref_name=await first(await (await Environment.get_global("get_object_path"))(name));
                            return await async function(){
                                if (check_true (await not((undefined===await (async function(){
                                    let __targ__27=(ctx && ctx["scope"]);
                                    if (__targ__27){
                                         return(__targ__27)[ref_name]
                                    } 
                                })())))) {
                                    return await (async function(){
                                        let __targ__28=(ctx && ctx["scope"]);
                                        if (__targ__28){
                                             return(__targ__28)[ref_name]
                                        } 
                                    })()
                                } else if (check_true ((ctx && ctx["parent"]))) {
                                    return await get_ctx((ctx && ctx["parent"]),ref_name)
                                }
                            } ()
                        }
                    }
                } ()
            };
            get_ctx_val=async function(ctx,name) {
                let ref_name;
                let declared_type_value;
                ref_name=null;
                declared_type_value=null;
                if (check_true ((null==ctx))){
                    {
                        await console.error("get_ctx_val: undefined/nil ctx passed.")
                    }
                };
                return await async function(){
                    if (check_true (await (async function(){
                         return await is_nil_ques_(name) 
                    })())) {
                        throw new TypeError(("get_ctx_val: nil identifier passed: "+ await sub_type(name)));
                        
                    } else if (check_true (await is_number_ques_(name))) {
                        return name
                    } else if (check_true (name instanceof Function)) {
                        throw new Error(("get_ctx_val: invalid identifier passed: "+ await sub_type(name)));
                        
                    } else {
                        {
                            if (check_true (await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),name))){
                                ref_name=await name["substr"].call(name,2)
                            } else {
                                ref_name=name
                            };
                            ref_name=await sanitize_js_ref_name(name);
                            declared_type_value=await get_declarations(ctx,ref_name);
                            return await async function(){
                                if (check_true ((declared_type_value && declared_type_value["declared_global"]))) {
                                    return undefined
                                } else if (check_true ((declared_type_value && declared_type_value["type"]))) {
                                    return (declared_type_value && declared_type_value["type"])
                                } else {
                                    {
                                        ref_name=await first(await (await Environment.get_global("get_object_path"))(ref_name));
                                        return await async function(){
                                            if (check_true (op_lookup[ref_name])) {
                                                return AsyncFunction
                                            } else if (check_true (await not((undefined===await (async function(){
                                                let __targ__29=(ctx && ctx["scope"]);
                                                if (__targ__29){
                                                     return(__targ__29)[ref_name]
                                                } 
                                            })())))) {
                                                return await (async function(){
                                                    let __targ__30=(ctx && ctx["scope"]);
                                                    if (__targ__30){
                                                         return(__targ__30)[ref_name]
                                                    } 
                                                })()
                                            } else if (check_true ((ctx && ctx["parent"]))) {
                                                return await get_ctx((ctx && ctx["parent"]),ref_name)
                                            }
                                        } ()
                                    }
                                }
                            } ()
                        }
                    }
                } ()
            };
            get_declarations=async function(ctx,name,_tagged) {
                let ref_name;
                let oname;
                let root_name;
                ref_name=null;
                oname=name;
                root_name=null;
                name=await (async function(){
                    if (check_true (_tagged)){
                        return name
                    } else {
                        return await sanitize_js_ref_name(name)
                    }
                })();
                return await async function(){
                    if (check_true (await not((ctx instanceof Object)))) {
                        throw new TypeError(("get_declarations: invalid ctx passed"));
                        
                    } else if (check_true (await (async function(){
                         return await is_nil_ques_(name) 
                    })())) {
                        throw new TypeError(("get_declarations: nil identifier passed: "+ await sub_type(oname)));
                        
                    } else if (check_true (await is_number_ques_(name))) {
                        return name
                    } else if (check_true (name instanceof Function)) {
                        throw new Error(("get_declarations: invalid identifier passed: "+ await sub_type(oname)));
                        
                    } else {
                        if (check_true ((name instanceof String || typeof name==='string'))){
                            {
                                if (check_true (await starts_with_ques_(await (async function(){
                                     return "=:" 
                                })(),name))){
                                    ref_name=await name["substr"].call(name,2)
                                } else {
                                    ref_name=name
                                };
                                return await async function(){
                                    if (check_true (op_lookup[ref_name])) {
                                        return null
                                    } else if (check_true (await not((undefined===await (async function(){
                                        let __targ__31=(ctx && ctx["declared_types"]);
                                        if (__targ__31){
                                             return(__targ__31)[ref_name]
                                        } 
                                    })())))) {
                                        return await (async function(){
                                            let __targ__32=(ctx && ctx["declared_types"]);
                                            if (__targ__32){
                                                 return(__targ__32)[ref_name]
                                            } 
                                        })()
                                    } else if (check_true ((ctx && ctx["parent"]))) {
                                        return await get_declarations((ctx && ctx["parent"]),ref_name,true)
                                    }
                                } ()
                            }
                        }
                    }
                } ()
            };
            set_declaration=async function(ctx,name,declaration_type,value) {
                let sname;
                let dec_struct;
                sname=await sanitize_js_ref_name(name);
                dec_struct=await get_declarations(ctx,sname);
                if (check_true (await (await Environment.get_global("blank?"))(dec_struct))){
                    {
                        dec_struct={
                            type:undefined,inlined:false
                        }
                    }
                };
                return await async function(){
                    if (check_true (((declaration_type==="location")&& (value==="global")))) {
                        {
                            has_lisp_globals=true;
                            if (check_true ((undefined===dec_struct["type"]))){
                                throw new SyntaxError("global declaration must be after declaration of type for symbol");
                                
                            };
                            await async function(){
                                dec_struct["declared_global"]=true;
                                return dec_struct;
                                
                            }();
                            return await async function(){
                                let __target_obj__34=(root_ctx && root_ctx["defined_lisp_globals"]);
                                __target_obj__34[name]=dec_struct["type"];
                                return __target_obj__34;
                                
                            }()
                        }
                    } else {
                        {
                            await async function(){
                                dec_struct[declaration_type]=value;
                                return dec_struct;
                                
                            }();
                            await async function(){
                                let __target_obj__36=(ctx && ctx["declared_types"]);
                                __target_obj__36[sname]=dec_struct;
                                return __target_obj__36;
                                
                            }();
                            return await (async function(){
                                let __targ__37=(ctx && ctx["declared_types"]);
                                if (__targ__37){
                                     return(__targ__37)[sname]
                                } 
                            })()
                        }
                    }
                } ()
            };
            is_ambiguous_ques_=async function(ctx,name) {
                let ref_name;
                ref_name=null;
                return await async function(){
                    if (check_true (await (async function(){
                         return await is_nil_ques_(ctx) 
                    })())) {
                        throw new TypeError(("is_ambiguous?: nil ctx passed"));
                        
                    } else if (check_true (await (async function(){
                         return await is_nil_ques_(name) 
                    })())) {
                        throw new TypeError(("is_ambiguous?: nil reference name passed"));
                        
                    } else if (check_true (await not((name instanceof String || typeof name==='string')))) {
                        throw new TypeError(("is_ambiguous?: reference name given is a "+ await sub_type(name)+ ", requires a string"));
                        
                    } else {
                        {
                            if (check_true (await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),name))){
                                ref_name=await name["substr"].call(name,2)
                            } else {
                                ref_name=name
                            };
                            ref_name=await first(await (await Environment.get_global("get_object_path"))(ref_name));
                            return await async function(){
                                if (check_true (await (async function(){
                                    let __targ__38=(ctx && ctx["ambiguous"]);
                                    if (__targ__38){
                                         return(__targ__38)[ref_name]
                                    } 
                                })())) {
                                    return true
                                } else if (check_true ((ctx && ctx["parent"]))) {
                                    return await (async function(){
                                        let __array_op_rval__39=is_ambiguous_ques_;
                                         if (__array_op_rval__39 instanceof Function){
                                            return await __array_op_rval__39((ctx && ctx["parent"]),ref_name) 
                                        } else {
                                            return [__array_op_rval__39,(ctx && ctx["parent"]),ref_name]
                                        }
                                    })()
                                }
                            } ()
                        }
                    }
                } ()
            };
            set_ambiguous=async function(ctx,name) {
                return await async function(){
                    let __target_obj__40=(ctx && ctx["ambiguous"]);
                    __target_obj__40[name]=true;
                    return __target_obj__40;
                    
                }()
            };
            unset_ambiguous=async function(ctx,name) {
                return await (await Environment.get_global("delete_prop"))((ctx && ctx["ambiguous"]),name)
            };
            invalid_js_ref_chars="+?-%&^#!*[]~{}/|";
            invalid_js_ref_chars_regex=new RegExp("[/\%\+\[\>\?\<\\}\{&\#\^\=\~\*\!\)\(\-]+","g");
            check_invalid_js_ref=async function(symname) {
                return await async function(){
                    if (check_true (await not((symname instanceof String || typeof symname==='string')))) {
                        return false
                    } else if (check_true (((symname instanceof String || typeof symname==='string')&& (await length(symname)>2)&& await starts_with_ques_(await (async function(){
                         return "=:" 
                    })(),symname)))) {
                        return (await length(await (async function(){
                             return await (await Environment.get_global("scan_str"))(invalid_js_ref_chars_regex,await symname["substr"].call(symname,2)) 
                        })())>0)
                    } else {
                        return (await length(await (async function(){
                             return await (await Environment.get_global("scan_str"))(invalid_js_ref_chars_regex,symname) 
                        })())>0)
                    }
                } ()
            };
            sanitize_js_ref_name=async function(symname) {
                return await async function(){
                    if (check_true (await not((symname instanceof String || typeof symname==='string')))) {
                        return symname
                    } else {
                        {
                            let text_chars;
                            let acc;
                            text_chars=(symname).split("");
                            acc=[];
                            await (async function() {
                                let __for_body__43=async function(t) {
                                    return await async function(){
                                        if (check_true ((t==="+"))) {
                                            return (acc).push("_plus_")
                                        } else if (check_true ((t==="?"))) {
                                            return (acc).push("_ques_")
                                        } else if (check_true ((t==="-"))) {
                                            return (acc).push("_")
                                        } else if (check_true ((t==="&"))) {
                                            return (acc).push("_amper_")
                                        } else if (check_true ((t==="^"))) {
                                            return (acc).push("_carot_")
                                        } else if (check_true ((t==="#"))) {
                                            return (acc).push("_hash_")
                                        } else if (check_true ((t==="!"))) {
                                            return (acc).push("_exclaim_")
                                        } else if (check_true ((t==="*"))) {
                                            return (acc).push("_star_")
                                        } else if (check_true ((t==="~"))) {
                                            return (acc).push("_tilde_")
                                        } else if (check_true ((t==="~"))) {
                                            return (acc).push("_percent_")
                                        } else if (check_true ((t==="|"))) {
                                            return (acc).push("_pipe_")
                                        } else if (check_true (await contains_ques_(t,"(){}"))) {
                                            throw new SyntaxError(("Invalid character in symbol: "+ symname));
                                            
                                        } else {
                                            return (acc).push(t)
                                        }
                                    } ()
                                };
                                let __array__44=[],__elements__42=text_chars;
                                let __BREAK__FLAG__=false;
                                for(let __iter__41 in __elements__42) {
                                    __array__44.push(await __for_body__43(__elements__42[__iter__41]));
                                    if(__BREAK__FLAG__) {
                                         __array__44.pop();
                                        break;
                                        
                                    }
                                }return __array__44;
                                 
                            })();
                            return (acc).join("")
                        }
                    }
                } ()
            };
            find_in_context=async function(ctx,name) {
                let symname;
                let ref;
                let __is_literal_ques___45= async function(){
                    return (await is_number_ques_(name)|| (await not(ref)&& (name instanceof String || typeof name==='string'))|| ("nil"===symname)|| ("null"===symname)|| (ref&& ("undefined"===symname))|| (ref&& ("else"===symname))|| (ref&& ("catch"===symname))|| (true===name)|| (false===name))
                };
                let special;
                let local;
                let global;
                let val;
                {
                    symname=await (async function(){
                         return await async function(){
                            if (check_true (((name instanceof String || typeof name==='string')&& (await length(name)>2)&& await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),name)))) {
                                return await name["substr"].call(name,2)
                            } else if (check_true ((name instanceof String || typeof name==='string'))) {
                                return name
                            } else {
                                {
                                    if (check_true ((name===null))){
                                        {
                                            name=await (async function(){
                                                 return "=:nil" 
                                            })()
                                        }
                                    };
                                    return "null"
                                }
                            }
                        } () 
                    })();
                    ref=(symname&& ((name instanceof String || typeof name==='string')&& (await length(name)>2)&& await starts_with_ques_(await (async function(){
                         return "=:" 
                    })(),name)));
                    let is_literal_ques_=await __is_literal_ques___45();
                    ;
                    special=(ref&& symname&& await contains_ques_(symname,await conj(["unquotem","quotem"],await (await Environment.get_global("keys"))(op_lookup))));
                    local=(await not(special)&& await not(is_literal_ques_)&& symname&& ref&& await get_ctx_val(ctx,symname));
                    global=(await not(special)&& await not(is_literal_ques_)&& ref&& symname&& await get_lisp_ctx(symname));
                    val=await (async function(){
                         return await async function(){
                            if (check_true (is_literal_ques_)) {
                                return name
                            } else if (check_true ((name instanceof Array))) {
                                return name
                            } else if (check_true ((name instanceof Object))) {
                                return name
                            } else if (check_true (special)) {
                                return name
                            } else if (check_true (local)) {
                                return local
                            } else if (check_true ((await not((global===undefined))&& await not((global===NOT_FOUND))))) {
                                return global
                            } else if (check_true ((symname===name))) {
                                return name
                            }
                        } () 
                    })();
                    return {
                        type:await (async function(){
                             return await async function(){
                                if (check_true ((name instanceof Array))) {
                                    return "arr"
                                } else if (check_true (name instanceof Element)) {
                                    return "dom"
                                } else if (check_true ((name instanceof Object))) {
                                    return await sub_type(name)
                                } else if (check_true (special)) {
                                    return "special"
                                } else if (check_true (is_literal_ques_)) {
                                    return "literal"
                                } else if (check_true (local)) {
                                    return await sub_type(local)
                                } else if (check_true (await not((undefined==global)))) {
                                    return await sub_type(global)
                                } else if (check_true ((ref&& symname))) {
                                    return "unbound"
                                } else if (check_true ((name===undefined))) {
                                    return "literal"
                                } else {
                                    {
                                        (error_log)("find_in_context: unknown type: ",name);
                                        debugger;
                                        ;
                                        return "??"
                                    }
                                }
                            } () 
                        })(),name:await (async function(){
                             return await async function(){
                                if (check_true ((symname&& ref))) {
                                    return await sanitize_js_ref_name(symname)
                                } else if (check_true ((false&& is_literal_ques_&& (val instanceof String || typeof val==='string')))) {
                                    return await sanitize_js_ref_name(name)
                                } else if (check_true (is_literal_ques_)) {
                                    if (check_true (ref)){
                                        return await sanitize_js_ref_name(name)
                                    } else {
                                        return name
                                    }
                                } else {
                                    return null
                                }
                            } () 
                        })(),val:await (async function(){
                            if (check_true ((val===undefined))){
                                return undefined
                            } else {
                                return val
                            }
                        })(),ref:await (async function(){
                            if (check_true (ref)){
                                return true
                            } else {
                                return false
                            }
                        })(),local:(local|| null),global:((global&& await not((NOT_FOUND===global)))|| null)
                    }
                }
            };
            source_chain=async function(cpath,tree,sources) {
                if (check_true (((cpath instanceof Array)&& tree))){
                    {
                        let source;
                        sources=(sources|| []);
                        source=null;
                        cpath=await (await Environment.get_global("chop"))(cpath);
                        source=await (await Environment.get_global("as_lisp"))(await (await Environment.get_global("resolve_path"))(cpath,tree));
                        if (check_true (((source && source.length)>80))){
                            source=await add(await source["substr"].call(source,0,80),"...")
                        };
                        if (check_true (await not(await (await Environment.get_global("blank?"))(source)))){
                            {
                                (sources).push(source)
                            }
                        };
                        if (check_true ((((cpath && cpath.length)>0)&& ((sources && sources.length)<4)))){
                            await source_chain(cpath,tree,sources)
                        };
                        return sources
                    }
                }
            };
            source_from_tokens=async function(tokens,tree,collect_parents_ques_) {
                return await async function(){
                    if (check_true (((tokens && tokens["path"])&& collect_parents_ques_))) {
                        return await source_chain((tokens && tokens["path"]),tree)
                    } else if (check_true ((tree instanceof String || typeof tree==='string'))) {
                        return await (await Environment.get_global("as_lisp"))(tree)
                    } else if (check_true ((tokens && tokens["path"]))) {
                        return await (await Environment.get_global("as_lisp"))(await (await Environment.get_global("resolve_path"))((tokens && tokens["path"]),tree))
                    } else if (check_true (((tokens instanceof Array)&& (tokens && tokens["0"] && tokens["0"]["path"])&& collect_parents_ques_))) {
                        return await source_chain((tokens && tokens["0"] && tokens["0"]["path"]),tree)
                    } else if (check_true (((tokens instanceof Array)&& (tokens && tokens["0"] && tokens["0"]["path"])))) {
                        return await (await Environment.get_global("as_lisp"))(await (await Environment.get_global("resolve_path"))(await (await Environment.get_global("chop"))((tokens && tokens["0"] && tokens["0"]["path"])),tree))
                    } else if (check_true (((undefined===tokens)&& await not((undefined===tree))))) {
                        return await (await Environment.get_global("as_lisp"))(tree)
                    } else {
                        {
                            if (check_true (await verbosity(ctx))){
                                {
                                    await console.warn("source_from_tokens: unable to determine source path from: ",await (async function(){
                                         return await clone(tokens) 
                                    })())
                                }
                            };
                            return ""
                        }
                    }
                } ()
            };
            source_comment=async function(tokens) {
                return {
                    comment:await source_from_tokens(tokens,expanded_tree)
                }
            };
            NOT_FOUND="__!NOT_FOUND!__";
            THIS_REFERENCE=async function() {
                return "this"
            };
            NOT_FOUND_THING=async function() {
                return true
            };
            get_lisp_ctx_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"get_lisp_ctx",color:"darkgreen",background:"#A0A0A0"
                    })
                }
            })();
            get_lisp_ctx=async function(name) {
                if (check_true (await not((name instanceof String || typeof name==='string')))){
                    throw new Error("Compiler Error: get_lisp_ctx passed a non string identifier");
                    
                } else {
                    {
                        let comps;
                        let cannot_be_js_global;
                        let ref_name;
                        let ref_type;
                        comps=await (await Environment.get_global("get_object_path"))(name);
                        cannot_be_js_global=await check_invalid_js_ref((comps && comps["0"]));
                        ref_name=(comps).shift();
                        ref_type=await (async function(){
                            if (check_true ((ref_name==="this"))){
                                return THIS_REFERENCE
                            } else {
                                {
                                    let global_ref=await (async function(){
                                        let __targ__46=(root_ctx && root_ctx["defined_lisp_globals"]);
                                        if (__targ__46){
                                             return(__targ__46)[ref_name]
                                        } 
                                    })();
                                    ;
                                    if (check_true (((undefined==global_ref)|| (global_ref==="statement")))){
                                        return await Environment["get_global"].call(Environment,ref_name,NOT_FOUND_THING,cannot_be_js_global)
                                    } else {
                                        return global_ref
                                    }
                                }
                            }
                        })();
                        if (check_true ((await not((NOT_FOUND_THING===ref_type))&& await not(await contains_ques_(ref_name,standard_types))&& await async function(){
                            referenced_global_symbols[ref_name]=ref_type;
                            return referenced_global_symbols;
                            
                        }()))){
                            {
                                
                            }
                        };
                        if (check_true (await verbosity(root_ctx))){
                            {
                                await (async function(){
                                    let __array_op_rval__48=get_lisp_ctx_log;
                                     if (__array_op_rval__48 instanceof Function){
                                        return await __array_op_rval__48("name: ",name,"type: ",ref_type,"components: ",comps) 
                                    } else {
                                        return [__array_op_rval__48,"name: ",name,"type: ",ref_type,"components: ",comps]
                                    }
                                })()
                            }
                        };
                        return await async function(){
                            if (check_true ((NOT_FOUND_THING===ref_type))) {
                                return undefined
                            } else if (check_true ((ref_type===THIS_REFERENCE))) {
                                return ref_type
                            } else if (check_true (((comps && comps.length)===0))) {
                                return ref_type
                            } else if (check_true ((((comps && comps.length)===1)&& (ref_type instanceof Object)&& await contains_ques_((comps && comps["0"]),await (async function(){
                                 return await object_methods(ref_type) 
                            })())))) {
                                return ref_type[(comps && comps["0"])]
                            } else if (check_true ((ref_type instanceof Function&& await (async function(){
                                let __array_op_rval__49=is_ambiguous_ques_;
                                 if (__array_op_rval__49 instanceof Function){
                                    return await __array_op_rval__49(root_ctx,ref_name) 
                                } else {
                                    return [__array_op_rval__49,root_ctx,ref_name]
                                }
                            })()))) {
                                return ref_type
                            } else if (check_true ((ref_type instanceof Array))) {
                                return ref_type
                            } else if (check_true ((ref_type==="array"))) {
                                return []
                            } else if (check_true ((ref_type instanceof Object))) {
                                return await (await Environment.get_global("resolve_path"))(comps,ref_type)
                            } else if (check_true (((typeof ref_type==="object")&& await contains_ques_((comps && comps["0"]),await Object["keys"].call(Object,ref_type))))) {
                                {
                                    await (async function(){
                                         let __test_condition__50=async function() {
                                            return ((ref_type==undefined)|| ((comps && comps.length)>0))
                                        };
                                        let __body_ref__51=async function() {
                                            return ref_type=ref_type[(comps).shift()]
                                        };
                                        let __BREAK__FLAG__=false;
                                        while(await __test_condition__50()) {
                                            await __body_ref__51();
                                             if(__BREAK__FLAG__) {
                                                 break;
                                                
                                            }
                                        } ;
                                        
                                    })();
                                    return ref_type
                                }
                            } else if (check_true ((ref_type==="objliteral"))) {
                                return ref_type
                            } else {
                                {
                                    await (async function(){
                                        let __array_op_rval__52=get_lisp_ctx_log;
                                         if (__array_op_rval__52 instanceof Function){
                                            return await __array_op_rval__52("symbol not found: ",name,ref_name,ref_type,cannot_be_js_global) 
                                        } else {
                                            return [__array_op_rval__52,"symbol not found: ",name,ref_name,ref_type,cannot_be_js_global]
                                        }
                                    })();
                                    return undefined
                                }
                            }
                        } ()
                    }
                }
            };
            get_val=async function(token,ctx) {
                return await async function(){
                    if (check_true ((token && token["ref"]))) {
                        {
                            let comps=((token && token.name)).split(".");
                            ;
                            if (check_true (await verbosity(ctx))){
                                {
                                    console.log("get_val: reference: ",await (async function(){
                                         return await (await Environment.get_global("safe_access"))(token,ctx,sanitize_js_ref_name) 
                                    })())
                                }
                            };
                            let ref_name=await (async function(){
                                if (check_true (((await safety_level(ctx)>1)&& ((comps && comps.length)>1)))){
                                    return await (await Environment.get_global("safe_access"))(token,ctx,sanitize_js_ref_name)
                                } else {
                                    return await sanitize_js_ref_name(await (async function(){
                                         return await (await Environment.get_global("expand_dot_accessor"))((token && token.name),ctx) 
                                    })())
                                }
                            })();
                            ;
                            return await async function(){
                                if (check_true ((await get_ctx(ctx,"__IN_QUOTEM__")&& await not(await get_ctx(ctx,"__IN_LAMBDA__"))))) {
                                    return await get_ctx(ctx,ref_name)
                                } else if (check_true ((false&& await get_ctx(ctx,"__IN_QUOTEM__")&& await get_ctx(ctx,"__IN_LAMBDA__")))) {
                                    return ("await ctx_access(\""+ ref_name+ "\")")
                                } else {
                                    return ref_name
                                }
                            } ()
                        }
                    } else {
                        return (token && token["val"])
                    }
                } ()
            };
            has_lisp_globals=false;
            root_ctx=await new_ctx(((opts && opts["ctx"])));
            tokenize_object=async function(obj,ctx,_path) {
                let ser=null;
                ;
                try {
                    ser=await JSON.stringify(obj)
                } catch (__exception__53) {
                    if (__exception__53 instanceof Error) {
                        let e=__exception__53;
                        {
                            {
                                await console.warn("compiler: cannot serialize: ",obj);
                                await console.error(e);
                                ser=""
                            }
                        }
                    }
                };
                _path=(_path|| []);
                if (check_true ((ser==="{}"))){
                    {
                        return {
                            type:"object",ref:false,val:"{}",name:"{}",__token__:true,path:_path
                        }
                    }
                } else {
                    return await (async function() {
                        let __for_body__56=async function(pset) {
                            return {
                                type:"keyval",val:await tokenize(pset,ctx,"path:",await add(_path,(pset && pset["0"]))),ref:false,name:(""+ await (await Environment.get_global("as_lisp"))((pset && pset["0"]))),__token__:true
                            }
                        };
                        let __array__57=[],__elements__55=await (await Environment.get_global("pairs"))(obj);
                        let __BREAK__FLAG__=false;
                        for(let __iter__54 in __elements__55) {
                            __array__57.push(await __for_body__56(__elements__55[__iter__54]));
                            if(__BREAK__FLAG__) {
                                 __array__57.pop();
                                break;
                                
                            }
                        }return __array__57;
                         
                    })()
                }
            };
            tokenize_quote=async function(args,_path) {
                return await async function(){
                    if (check_true (((args && args["0"])==="=:quote"))) {
                        return {
                            type:"arr",__token__:true,source:await (await Environment.get_global("as_lisp"))(args),val:await conj(await (async function(){
                                 return [{
                                    type:"special",val:await (async function(){
                                         return "=:quote" 
                                    })(),ref:true,name:"quote",__token__:true
                                }] 
                            })(),await args["slice"].call(args,1)),ref:((args instanceof String || typeof args==='string')&& (await length(args)>2)&& await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),args)),name:null,path:_path
                        }
                    } else if (check_true (((args && args["0"])==="=:quotem"))) {
                        return {
                            type:"arr",__token__:true,source:await (await Environment.get_global("as_lisp"))(args),val:await conj(await (async function(){
                                 return [{
                                    type:"special",path:await conj(_path,[0]),val:await (async function(){
                                         return "=:quotem" 
                                    })(),ref:true,name:"quotem",__token__:true
                                }] 
                            })(),await args["slice"].call(args,1)),ref:((args instanceof String || typeof args==='string')&& (await length(args)>2)&& await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),args)),name:null,path:_path
                        }
                    } else {
                        return {
                            type:"arr",__token__:true,source:await (await Environment.get_global("as_lisp"))(args),val:await conj(await (async function(){
                                 return [{
                                    type:"special",val:await (async function(){
                                         return "=:quotel" 
                                    })(),ref:true,name:"quotel",__token__:true
                                }] 
                            })(),await args["slice"].call(args,1)),ref:((args instanceof String || typeof args==='string')&& (await length(args)>2)&& await starts_with_ques_(await (async function(){
                                 return "=:" 
                            })(),args)),name:null,path:_path
                        }
                    }
                } ()
            };
            tokenize=async function(args,ctx,_path,_suppress_comptime_eval) {
                let argtype;
                let rval;
                let qval;
                let idx;
                let tobject;
                let argdetails;
                let argvalue;
                let is_ref;
                argtype=null;
                rval=null;
                ctx=ctx;
                _path=(_path|| []);
                qval=null;
                idx=-1;
                tobject=null;
                argdetails=null;
                argvalue=null;
                is_ref=null;
                ;
                if (check_true ((null==ctx))){
                    {
                        await console.error("tokenize: nil ctx passed: ",await (async function(){
                             return await clone(args) 
                        })());
                        throw new ReferenceError("nil/undefined ctx passed to tokenize");
                        
                    }
                };
                if (check_true (((args instanceof Array)&& await not(_suppress_comptime_eval)))){
                    {
                        args=await compile_time_eval(ctx,args,_path);
                        await async function(){
                            if (check_true (((_path && _path.length)>1))) {
                                {
                                    tobject=await (await Environment.get_global("resolve_path"))(await (await Environment.get_global("chop"))(_path),expanded_tree);
                                    if (check_true (tobject)){
                                        {
                                            return await async function(){
                                                tobject[await last(_path)]=args;
                                                return tobject;
                                                
                                            }()
                                        }
                                    }
                                }
                            } else if (check_true (((_path && _path.length)===1))) {
                                {
                                    await async function(){
                                        expanded_tree[await first(_path)]=args;
                                        return expanded_tree;
                                        
                                    }()
                                }
                            } else {
                                expanded_tree=args
                            }
                        } ()
                    }
                };
                return await async function(){
                    if (check_true (((args instanceof String || typeof args==='string')|| await is_number_ques_(args)|| ((args===true)|| (args===false))))) {
                        return await first(await tokenize([args],ctx,_path,true))
                    } else if (check_true (((args instanceof Array)&& (((args && args["0"])==="=:quotem")|| ((args && args["0"])==="=:quote")|| ((args && args["0"])==="=:quotel"))))) {
                        {
                            rval=await tokenize_quote(args,_path);
                            return rval
                        }
                    } else if (check_true (((args instanceof Array)&& await not(await get_ctx_val(ctx,"__IN_LAMBDA__"))&& ((args && args["0"])==="=:iprogn")))) {
                        {
                            rval=await compile_toplevel(args,ctx);
                            return await tokenize(rval,ctx,_path)
                        }
                    } else if (check_true ((await not((args instanceof Array))&& (args instanceof Object)))) {
                        return await first(await tokenize([args],ctx,await add(_path,0)))
                    } else {
                        {
                            if (check_true ((((args && args["0"])==="=:fn")|| ((args && args["0"])==="=:function")|| ((args && args["0"])==="=:=>")))){
                                {
                                    ctx=await new_ctx(ctx);
                                    await set_ctx(ctx,"__IN_LAMBDA__",true)
                                }
                            };
                            return await (async function() {
                                let __for_body__62=async function(arg) {
                                    idx+=1;
                                    argdetails=await find_in_context(ctx,arg);
                                    argvalue=(argdetails && argdetails["val"]);
                                    argtype=(argdetails && argdetails["type"]);
                                    is_ref=(argdetails && argdetails["ref"]);
                                    return await async function(){
                                        if (check_true ((await sub_type(arg)==="array"))) {
                                            return {
                                                type:"arr",__token__:true,val:await tokenize(arg,ctx,await add(_path,idx)),ref:is_ref,name:null,path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="Function"))) {
                                            return {
                                                type:"fun",__token__:true,val:arg,ref:is_ref,name:(""+ await (await Environment.get_global("as_lisp"))(arg)),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="AsyncFunction"))) {
                                            return {
                                                type:"asf",__token__:true,val:arg,ref:is_ref,name:(""+ await (await Environment.get_global("as_lisp"))(arg)),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="array"))) {
                                            return {
                                                type:"array",__token__:true,val:arg,ref:is_ref,name:(""+ await (await Environment.get_global("as_lisp"))(arg)),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="Number"))) {
                                            return {
                                                type:"num",__token__:true,val:argvalue,ref:is_ref,name:(""+ await (await Environment.get_global("as_lisp"))(arg)),path:await add(_path,idx)
                                            }
                                        } else if (check_true (((argtype==="String")&& is_ref))) {
                                            return {
                                                type:"arg",__token__:true,val:argvalue,ref:is_ref,name:await clean_quoted_reference((""+ await (await Environment.get_global("as_lisp"))(arg))),global:(argdetails && argdetails["global"]),local:(argdetails && argdetails["local"]),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="String"))) {
                                            return {
                                                type:"literal",__token__:true,val:argvalue,ref:is_ref,name:await clean_quoted_reference((""+ await (await Environment.get_global("as_lisp"))(arg))),global:(argdetails && argdetails["global"]),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((argtype==="dom"))) {
                                            return {
                                                type:"null",__token__:true,val:null,ref:is_ref,name:await clean_quoted_reference((""+ await (await Environment.get_global("as_lisp"))(arg))),global:(argdetails && argdetails["global"]),path:await add(_path,idx)
                                            }
                                        } else if (check_true ((arg instanceof Object))) {
                                            {
                                                return {
                                                    type:"objlit",__token__:true,val:await tokenize_object(arg,ctx,await add(_path,idx)),ref:is_ref,name:null,path:await add(_path,idx)
                                                }
                                            }
                                        } else if (check_true (((argtype==="literal")&& is_ref&& ((""+ await (await Environment.get_global("as_lisp"))(arg))==="nil")))) {
                                            return {
                                                type:"null",__token__:true,val:null,ref:true,name:"null",path:await add(_path,idx)
                                            }
                                        } else if (check_true (((argtype==="unbound")&& is_ref&& (null==argvalue)))) {
                                            return {
                                                type:"arg",__token__:true,val:arg,ref:true,name:await clean_quoted_reference((""+ await (await Environment.get_global("as_lisp"))(arg))),path:await add(_path,idx)
                                            }
                                        } else if (check_true (((argtype==="unbound")&& is_ref))) {
                                            return {
                                                type:await sub_type(argvalue),__token__:true,val:argvalue,ref:true,name:await clean_quoted_reference(await sanitize_js_ref_name((""+ await (await Environment.get_global("as_lisp"))(arg)))),path:await add(_path,idx)
                                            }
                                        } else {
                                            return {
                                                type:argtype,__token__:true,val:argvalue,ref:is_ref,name:await clean_quoted_reference((""+ await (await Environment.get_global("as_lisp"))(arg))),global:(argdetails && argdetails["global"]),local:(argdetails && argdetails["local"]),path:await add(_path,idx)
                                            }
                                        }
                                    } ()
                                };
                                let __array__63=[],__elements__61=args;
                                let __BREAK__FLAG__=false;
                                for(let __iter__60 in __elements__61) {
                                    __array__63.push(await __for_body__62(__elements__61[__iter__60]));
                                    if(__BREAK__FLAG__) {
                                         __array__63.pop();
                                        break;
                                        
                                    }
                                }return __array__63;
                                 
                            })()
                        }
                    }
                } ()
            };
            comp_time_log=await (async function(){
                 return await defclog({
                    prefix:"compile_time_eval",background:"#C0C0C0",color:"darkblue"
                }) 
            })();
            compile_time_eval=async function(ctx,lisp_tree,path) {
                if (check_true (((lisp_tree instanceof Array)&& (((lisp_tree && lisp_tree["0"]) instanceof String || typeof (lisp_tree && lisp_tree["0"])==='string')&& (await length((lisp_tree && lisp_tree["0"]))>2)&& await starts_with_ques_(await (async function(){
                     return "=:" 
                })(),(lisp_tree && lisp_tree["0"])))&& await (async function(){
                    let it;
                    it=await Environment["symbol_definition"].call(Environment,await (lisp_tree && lisp_tree["0"])["substr"].call((lisp_tree && lisp_tree["0"]),2));
                    if (check_true (it)){
                        return await (await Environment.get_global("resolve_path"))(["eval_when","compile_time"],it)
                    } else {
                        return 
                    }
                })()))){
                    {
                        let ntree;
                        let precompile_function;
                        ntree=null;
                        precompile_function=await Environment["get_global"].call(Environment,await (lisp_tree && lisp_tree["0"])["substr"].call((lisp_tree && lisp_tree["0"]),2));
                        if (check_true (await verbosity(ctx))){
                            {
                                (comp_time_log)(path,"->",await (lisp_tree && lisp_tree["0"])["substr"].call((lisp_tree && lisp_tree["0"]),2),lisp_tree,"to function: ",await lisp_tree["slice"].call(lisp_tree,1))
                            }
                        };
                        try {
                            ntree=await (async function(){
                                let __apply_args__65=await (async function(){
                                     return await lisp_tree["slice"].call(lisp_tree,1) 
                                })();
                                return ( precompile_function).apply(this,__apply_args__65)
                            })()
                        } catch (__exception__64) {
                            if (__exception__64 instanceof Error) {
                                let e=__exception__64;
                                {
                                    {
                                        await async function(){
                                            e["handled"]=true;
                                            return e;
                                            
                                        }();
                                        (errors).push({
                                            error:(e && e.name),message:(e && e.message),source_name:source_name,precompilation:true,form:lisp_tree,parent_forms:[],invalid:true,stack:(e && e.stack)
                                        });
                                        throw e;
                                        
                                    }
                                }
                            }
                        };
                        if (check_true ((null==ntree))){
                            (warnings).push(("compile time function "+ await (lisp_tree && lisp_tree["0"])["substr"].call((lisp_tree && lisp_tree["0"]),2)+ " returned nil"))
                        } else {
                            {
                                ntree=await (async function(){
                                     return await do_deferred_splice(ntree) 
                                })();
                                if (check_true (await not((await JSON.stringify(ntree)===await JSON.stringify(lisp_tree))))){
                                    {
                                        ntree=await compile_time_eval(ctx,ntree,path)
                                    }
                                };
                                if (check_true (await verbosity(ctx))){
                                    {
                                        (comp_time_log)(await (lisp_tree && lisp_tree["0"])["substr"].call((lisp_tree && lisp_tree["0"]),2),"<- lisp: ",await (await Environment.get_global("as_lisp"))(ntree))
                                    }
                                }
                            }
                        };
                        return ntree
                    }
                } else {
                    return lisp_tree
                }
            };
            infix_ops=async function(tokens,ctx,opts) {
                let op_translation;
                let math_op_a;
                let math_op;
                let idx;
                let stmts;
                let declaration;
                let symbol_ctx_val;
                let is_overloaded;
                let token;
                let add_operand;
                let acc;
                op_translation={
                    or:"||",and:"&&"
                };
                ctx=await new_ctx(ctx);
                math_op_a=await (async function(){
                    let __targ__68=await first(tokens);
                    if (__targ__68){
                         return(__targ__68)["name"]
                    } 
                })();
                math_op=(op_translation[math_op_a]|| math_op_a);
                idx=0;
                stmts=null;
                declaration=await (async function(){
                    if (check_true (((tokens && tokens["1"] && tokens["1"]["name"]) instanceof String || typeof (tokens && tokens["1"] && tokens["1"]["name"])==='string'))){
                        return await get_declarations(ctx,(tokens && tokens["1"] && tokens["1"]["name"]),await not((tokens && tokens["1"] && tokens["1"]["ref"])))
                    } else {
                        return null
                    }
                })();
                symbol_ctx_val=await (async function(){
                    if (check_true (((tokens && tokens["1"] && tokens["1"]["ref"])&& ((tokens && tokens["1"] && tokens["1"]["name"]) instanceof String || typeof (tokens && tokens["1"] && tokens["1"]["name"])==='string')))){
                        return await get_ctx_val(ctx,(tokens && tokens["1"] && tokens["1"]["name"]))
                    }
                })();
                is_overloaded=false;
                token=null;
                add_operand=async function() {
                    if (check_true (((idx>1)&& (idx<((tokens && tokens.length)- 0))))){
                        {
                            (acc).push(math_op);
                            return (acc).push(" ")
                        }
                    }
                };
                acc=await (async function(){
                     return [{
                        ctype:"expression"
                    }] 
                })();
                await set_ctx(ctx,"__COMP_INFIX_OPS__",true);
                if (check_true (((symbol_ctx_val instanceof Array)&& (symbol_ctx_val && symbol_ctx_val["0"] && symbol_ctx_val["0"]["ctype"])))){
                    {
                        symbol_ctx_val=(symbol_ctx_val && symbol_ctx_val["0"] && symbol_ctx_val["0"]["ctype"])
                    }
                };
                if (check_true (((((declaration && declaration["type"])===Array)|| ((declaration && declaration["type"])===Object)|| (symbol_ctx_val==="objliteral")|| (symbol_ctx_val===Expression)|| (symbol_ctx_val===ArgumentType)|| ((tokens && tokens["1"] && tokens["1"]["type"])==="objlit")|| ((tokens && tokens["1"] && tokens["1"]["type"])==="arr"))&& (math_op==="+")))){
                    {
                        is_overloaded=true
                    }
                };
                if (check_true (is_overloaded)){
                    {
                        await async function(){
                            tokens[0]={
                                type:"function",val:await add(await (async function(){
                                     return "=:" 
                                })(),"add"),name:"add",ref:true
                            };
                            return tokens;
                            
                        }();
                        await async function(){
                            ctx["block_step"]=0;
                            return ctx;
                            
                        }();
                        stmts=await compile_wrapper_fn(tokens,ctx);
                        return stmts
                    }
                } else {
                    {
                        (acc).push("(");
                        await (async function(){
                             let __test_condition__71=async function() {
                                return (idx<((tokens && tokens.length)- 1))
                            };
                            let __body_ref__72=async function() {
                                idx+=1;
                                token=tokens[idx];
                                await add_operand();
                                await async function(){
                                    ctx["block_step"]=0;
                                    return ctx;
                                    
                                }();
                                return (acc).push(await compile_wrapper_fn(token,ctx))
                            };
                            let __BREAK__FLAG__=false;
                            while(await __test_condition__71()) {
                                await __body_ref__72();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                        (acc).push(")");
                        return acc
                    }
                }
            };
            compile_set_prop=async function(tokens,ctx) {
                let acc;
                let wrapper;
                let stmt;
                let preamble;
                let token;
                let complicated;
                let target;
                let target_reference;
                let idx;
                acc=[];
                wrapper=[];
                stmt=null;
                preamble=await calling_preamble(ctx);
                token=await second(tokens);
                ctx=await new_ctx(ctx);
                complicated=await (async function(){
                    let __array_op_rval__74=is_complex_ques_;
                     if (__array_op_rval__74 instanceof Function){
                        return await __array_op_rval__74((token && token["val"])) 
                    } else {
                        return [__array_op_rval__74,(token && token["val"])]
                    }
                })();
                target=await (async function(){
                    if (check_true (complicated)){
                        return await compile_wrapper_fn((token && token["val"]),ctx)
                    } else {
                        return await compile(token,ctx)
                    }
                })();
                target_reference=await gen_temp_name("target_obj");
                idx=1;
                ;
                await set_new_completion_scope(ctx);
                await (async function() {
                    let __for_body__77=async function(t) {
                        return (wrapper).push(t)
                    };
                    let __array__78=[],__elements__76=[(preamble && preamble["0"])," ",(preamble && preamble["1"])," ",(preamble && preamble["3"]),"function","()","{"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__75 in __elements__76) {
                        __array__78.push(await __for_body__77(__elements__76[__iter__75]));
                        if(__BREAK__FLAG__) {
                             __array__78.pop();
                            break;
                            
                        }
                    }return __array__78;
                     
                })();
                if (check_true (await not((target instanceof String || typeof target==='string')))){
                    await (async function() {
                        let __for_body__81=async function(t) {
                            return (wrapper).push(t)
                        };
                        let __array__82=[],__elements__80=["let"," ",target_reference,"=",target,";"];
                        let __BREAK__FLAG__=false;
                        for(let __iter__79 in __elements__80) {
                            __array__82.push(await __for_body__81(__elements__80[__iter__79]));
                            if(__BREAK__FLAG__) {
                                 __array__82.pop();
                                break;
                                
                            }
                        }return __array__82;
                         
                    })()
                } else {
                    {
                        target_reference=target
                    }
                };
                await (async function(){
                     let __test_condition__83=async function() {
                        return (idx<((tokens && tokens.length)- 1))
                    };
                    let __body_ref__84=async function() {
                        idx+=1;
                        (acc).push(target_reference);
                        token=tokens[idx];
                        (acc).push("[");
                        stmt=await compile_as_call(token,ctx);
                        (acc).push(stmt);
                        (acc).push("]");
                        idx+=1;
                        (acc).push("=");
                        token=tokens[idx];
                        if (check_true ((null==token))){
                            throw new SyntaxError("set_prop: odd number of arguments");
                            
                        };
                        stmt=await compile_wrapper_fn(token,ctx);
                        (acc).push(stmt);
                        return (acc).push(";")
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__83()) {
                        await __body_ref__84();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                (wrapper).push(acc);
                (wrapper).push("return");
                (wrapper).push(" ");
                (wrapper).push(target_reference);
                (wrapper).push(";");
                (wrapper).push("}");
                (wrapper).push((preamble && preamble["4"]));
                (wrapper).push("()");
                return wrapper
            };
            compile_prop=async function(tokens,ctx) {
                if (check_true (await not(((tokens && tokens.length)===3)))){
                    {
                        throw new SyntaxError("prop requires exactly 2 arguments");
                        
                    }
                } else {
                    {
                        let acc;
                        let target;
                        let target_val;
                        let preamble;
                        let idx_key;
                        acc=[];
                        target=await compile_wrapper_fn(await second(tokens),ctx);
                        target_val=null;
                        preamble=await calling_preamble(ctx);
                        idx_key=await compile_wrapper_fn(tokens[2],ctx);
                        ;
                        if (check_true ((await safety_level(ctx)>1))){
                            return await async function(){
                                if (check_true ((target instanceof String || typeof target==='string'))) {
                                    {
                                        return await (async function(){
                                            let __array_op_rval__85=target;
                                             if (__array_op_rval__85 instanceof Function){
                                                return await __array_op_rval__85("[",idx_key,"]") 
                                            } else {
                                                return [__array_op_rval__85,"[",idx_key,"]"]
                                            }
                                        })()
                                    }
                                } else {
                                    {
                                        target_val=await gen_temp_name("targ");
                                        return [(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()","{","let"," ",target_val,"=",target,";","if"," ","(",target_val,")","{"," ","return","(",target_val,")","[",idx_key,"]","}"," ","}",")","()"]
                                    }
                                }
                            } ()
                        } else {
                            return ["(",target,")","[",idx_key,"]"]
                        }
                    }
                }
            };
            compile_elem=async function(token,ctx) {
                let rval;
                rval=null;
                await console.warn("compile_elem - deprecated: check call: ",token);
                if (check_true ((await (async function(){
                    let __array_op_rval__86=is_complex_ques_;
                     if (__array_op_rval__86 instanceof Function){
                        return await __array_op_rval__86((token && token["val"])) 
                    } else {
                        return [__array_op_rval__86,(token && token["val"])]
                    }
                })()|| (((token && token["val"]) instanceof Array)&& ((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="if"))))){
                    rval=await compile_wrapper_fn(token,ctx)
                } else {
                    rval=await (async function(){
                         return await compile(token,ctx) 
                    })()
                };
                if (check_true (await not((rval instanceof Array)))){
                    {
                        rval=await (async function(){
                            let __array_op_rval__87=rval;
                             if (__array_op_rval__87 instanceof Function){
                                return await __array_op_rval__87() 
                            } else {
                                return [__array_op_rval__87]
                            }
                        })()
                    }
                };
                return rval
            };
            inline_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"compile_inline:",background:"#404880",color:"white"
                    })
                }
            })();
            compile_inline=async function(tokens,ctx) {
                let rval;
                let stmt;
                let inline_fn;
                let has_literal_ques_;
                let wrap_style;
                let args;
                rval=null;
                stmt=null;
                inline_fn=null;
                has_literal_ques_=false;
                wrap_style=0;
                args=[];
                await (async function() {
                    let __for_body__90=async function(token) {
                        stmt=await compile_wrapper_fn(token,ctx);
                        return (args).push(stmt)
                    };
                    let __array__91=[],__elements__89=await tokens["slice"].call(tokens,1);
                    let __BREAK__FLAG__=false;
                    for(let __iter__88 in __elements__89) {
                        __array__91.push(await __for_body__90(__elements__89[__iter__88]));
                        if(__BREAK__FLAG__) {
                             __array__91.pop();
                            break;
                            
                        }
                    }return __array__91;
                     
                })();
                if (check_true (await verbosity())){
                    {
                        (inline_log)("args: ",args)
                    }
                };
                if (check_true (await (async function(){
                    let __targ__92=(Environment && Environment["inlines"]);
                    if (__targ__92){
                         return(__targ__92)[(tokens && tokens["0"] && tokens["0"]["name"])]
                    } 
                })())){
                    {
                        inline_fn=await (async function(){
                            let __targ__93=(Environment && Environment["inlines"]);
                            if (__targ__93){
                                 return(__targ__93)[(tokens && tokens["0"] && tokens["0"]["name"])]
                            } 
                        })();
                        rval=await (async function(){
                            let __array_op_rval__94=inline_fn;
                             if (__array_op_rval__94 instanceof Function){
                                return await __array_op_rval__94(args,ctx) 
                            } else {
                                return [__array_op_rval__94,args,ctx]
                            }
                        })()
                    }
                } else {
                    throw new ReferenceError(("no source for named lib function "+ (tokens && tokens["0"] && tokens["0"]["name"])));
                    
                };
                return rval
            };
            compile_push=async function(tokens,ctx) {
                let acc;
                let place;
                let thing;
                acc=[];
                place=await compile_wrapper_fn((tokens && tokens["1"]),ctx);
                thing=await compile_wrapper_fn((tokens && tokens["2"]),ctx);
                return await (async function(){
                    let __array_op_rval__95=place;
                     if (__array_op_rval__95 instanceof Function){
                        return await __array_op_rval__95(".push","(",thing,")") 
                    } else {
                        return [__array_op_rval__95,".push","(",thing,")"]
                    }
                })()
            };
            compile_list=async function(tokens,ctx) {
                let acc;
                let compiled_values;
                acc=["["];
                compiled_values=[];
                await (async function() {
                    let __for_body__98=async function(t) {
                        return (compiled_values).push(await compile_wrapper_fn(t,ctx))
                    };
                    let __array__99=[],__elements__97=await tokens["slice"].call(tokens,1);
                    let __BREAK__FLAG__=false;
                    for(let __iter__96 in __elements__97) {
                        __array__99.push(await __for_body__98(__elements__97[__iter__96]));
                        if(__BREAK__FLAG__) {
                             __array__99.pop();
                            break;
                            
                        }
                    }return __array__99;
                     
                })();
                await push_as_arg_list(acc,compiled_values);
                (acc).push("]");
                return acc
            };
            compile_typeof=async function(tokens,ctx) {
                let local_details=await (async function(){
                    if (check_true ((tokens && tokens["1"] && tokens["1"]["ref"]))){
                        return await get_ctx_val(ctx,(tokens && tokens["1"] && tokens["1"]["name"]))
                    } else {
                        return null
                    }
                })();
                ;
                let fully_qualified=await (async function(){
                    if (check_true (((tokens && tokens["1"] && tokens["1"]["name"])&& await contains_ques_("/",(tokens && tokens["1"] && tokens["1"]["name"]))))){
                        return true
                    } else {
                        return false
                    }
                })();
                ;
                if (check_true (await verbosity(ctx))){
                    {
                        await console.log("compile_typeof -> ",tokens)
                    }
                };
                if (check_true (((tokens && tokens.length)<2))){
                    {
                        throw new SyntaxError("typeof requires 1 argument");
                        
                    }
                };
                return await async function(){
                    if (check_true (((tokens && tokens["1"] && tokens["1"]["ref"])&& local_details))) {
                        return ["typeof"," ",await (async function(){
                             return await compile((tokens && tokens["1"]),ctx) 
                        })()]
                    } else if (check_true (((tokens && tokens["1"] && tokens["1"]["ref"])&& await get_lisp_ctx((tokens && tokens["1"] && tokens["1"]["name"]))))) {
                        return ["typeof"," ",await (async function(){
                             return await compile((tokens && tokens["1"]),ctx) 
                        })()]
                    } else if (check_true ((tokens && tokens["1"] && tokens["1"]["ref"]))) {
                        return ["(","typeof"," ","(","function","() { let __tval=",await compile_lisp_scoped_reference((tokens && tokens["1"] && tokens["1"]["name"]),ctx,true),"; if (__tval === ReferenceError) return undefined; else return __tval; }",")()",")"]
                    } else {
                        return ["typeof"," ",await compile_wrapper_fn((tokens && tokens["1"]),ctx)]
                    }
                } ()
            };
            compile_instanceof=async function(tokens,ctx) {
                let acc;
                acc=[];
                if (check_true (((tokens instanceof Array)&& ((tokens && tokens.length)===3)))){
                    return ["(",await (async function(){
                        if (check_true (await (async function(){
                            let __array_op_rval__100=is_complex_ques_;
                             if (__array_op_rval__100 instanceof Function){
                                return await __array_op_rval__100((tokens && tokens["1"])) 
                            } else {
                                return [__array_op_rval__100,(tokens && tokens["1"])]
                            }
                        })())){
                            return await compile_wrapper_fn((tokens && tokens["1"]),ctx)
                        } else {
                            return await compile((tokens && tokens["1"]),ctx)
                        }
                    })()," ","instanceof"," ",await (async function(){
                        if (check_true (await (async function(){
                            let __array_op_rval__101=is_complex_ques_;
                             if (__array_op_rval__101 instanceof Function){
                                return await __array_op_rval__101((tokens && tokens["1"])) 
                            } else {
                                return [__array_op_rval__101,(tokens && tokens["1"])]
                            }
                        })())){
                            return await compile_wrapper_fn((tokens && tokens["2"]),ctx)
                        } else {
                            return await compile((tokens && tokens["2"]),ctx)
                        }
                    })(),")"]
                } else {
                    throw new SyntaxError("instanceof requires 2 arguments");
                    
                }
            };
            compile_compare=async function(tokens,ctx) {
                let acc;
                let ops;
                let __operator__102= async function(){
                    return ops[await (async function(){
                        let __targ__104=await first(tokens);
                        if (__targ__104){
                             return(__targ__104)["name"]
                        } 
                    })()]
                };
                let left;
                let right;
                {
                    acc=await (async function(){
                         return [{
                            ctype:"expression"
                        }] 
                    })();
                    ctx=await new_ctx(ctx);
                    ops=await ( async function(){
                        let __obj__103=new Object();
                        __obj__103["eq"]="==";
                        __obj__103["=="]="===";
                        __obj__103["<"]="<";
                        __obj__103[">"]=">";
                        __obj__103["gt"]=">";
                        __obj__103["lt"]="<";
                        __obj__103["<="]="<=";
                        __obj__103[">="]=">=";
                        return __obj__103;
                        
                    })();
                    let operator=await __operator__102();
                    ;
                    left=tokens[1];
                    right=tokens[2];
                    if (check_true (((tokens && tokens.length)<3))){
                        {
                            throw new SyntaxError("comparison operation requires 2 arguments");
                            
                        }
                    };
                    await set_ctx(ctx,"__COMP_INFIX_OPS__",true);
                    (acc).push("(");
                    (acc).push(await (async function(){
                         return await compile(left,ctx) 
                    })());
                    (acc).push(operator);
                    (acc).push(await (async function(){
                         return await compile(right,ctx) 
                    })());
                    (acc).push(")");
                    return acc
                }
            };
            compile_assignment=async function(tokens,ctx) {
                let acc;
                let assignment_operator;
                let token;
                let assignment_value;
                let assignment_type;
                let wrap_as_function_ques_;
                let preamble;
                let target;
                let target_details;
                let target_location_compile_time;
                acc=[];
                assignment_operator=await (async function(){
                    let __targ__105=await first(tokens);
                    if (__targ__105){
                         return(__targ__105)["name"]
                    } 
                })();
                token=await second(tokens);
                assignment_value=null;
                assignment_type=null;
                wrap_as_function_ques_=null;
                preamble=await calling_preamble(ctx);
                target=await sanitize_js_ref_name(await (async function(){
                     return await async function(){
                        if (check_true ((token && token["ref"]))) {
                            return (token && token["name"])
                        } else {
                            throw new SyntaxError(("assignment: invalid target: "+ (token && token["name"])));
                            
                        }
                    } () 
                })());
                target_details=await get_declaration_details(ctx,target);
                target_location_compile_time=await (async function(){
                     return await async function(){
                        if (check_true ((target_details && target_details["is_argument"]))) {
                            return "local"
                        } else if (check_true ((target_details && target_details["declared_global"]))) {
                            return "global"
                        } else if (check_true (target_details)) {
                            return "local"
                        } else {
                            return null
                        }
                    } () 
                })();
                ;
                await (await Environment.get_global("compiler_syntax_validation"))("compile_assignment",tokens,errors,ctx,expanded_tree);
                if (check_true ((undefined===target_details))){
                    throw new ReferenceError(("assignment to undeclared symbol: "+ target));
                    
                };
                await unset_ambiguous(ctx,target);
                await async function(){
                    ctx["in_assignment"]=true;
                    return ctx;
                    
                }();
                assignment_value=await compile_wrapper_fn((tokens && tokens["2"]),ctx);
                if (check_true (((assignment_value instanceof Array)&& ((assignment_value && assignment_value["0"]) instanceof Object)&& (assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])))){
                    {
                        assignment_type=await map_ctype_to_value((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"]),assignment_value)
                    }
                } else {
                    {
                        await set_ambiguous(ctx,target);
                        assignment_type=UnknownType
                    }
                };
                if (check_true ((target_location_compile_time==="local"))){
                    {
                        await set_ctx(ctx,target,assignment_type);
                        (acc).push(target);
                        (acc).push("=");
                        (acc).push(assignment_value)
                    }
                } else {
                    {
                        await (async function() {
                            let __for_body__109=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__110=[],__elements__108=await (async function(){
                                 return [{
                                    ctype:"statement"
                                },(preamble && preamble["0"])," ","Environment",".","set_global","(","\"",target,"\"",",",assignment_value,")"] 
                            })();
                            let __BREAK__FLAG__=false;
                            for(let __iter__107 in __elements__108) {
                                __array__110.push(await __for_body__109(__elements__108[__iter__107]));
                                if(__BREAK__FLAG__) {
                                     __array__110.pop();
                                    break;
                                    
                                }
                            }return __array__110;
                             
                        })()
                    }
                };
                await async function(){
                    ctx["in_assignment"]=false;
                    return ctx;
                    
                }();
                if (check_true ((target_location_compile_time==="local"))){
                    await set_ctx(ctx,target,assignment_type)
                };
                return acc
            };
            top_level_log=await (async function(){
                 return await defclog({
                    prefix:"top-level",color:"darkgreen",background:"#300010"
                }) 
            })();
            compile_toplevel=async function(lisp_tree,ctx,block_options) {
                if (check_true (await get_ctx_val(ctx,"__IN_LAMBDA__"))){
                    throw new EvalError("Compiler attempt to compile top-level in lambda (most likely a bug)");
                    
                } else {
                    {
                        {
                            let idx;
                            let rval;
                            let __tokens__112= async function(){
                                return null
                            };
                            let stmt;
                            let base_ctx;
                            let num_non_return_statements;
                            {
                                idx=0;
                                rval=null;
                                let tokens=await __tokens__112();
                                ;
                                stmt=null;
                                base_ctx=ctx;
                                num_non_return_statements=(await length(lisp_tree)- 2);
                                ctx=await (async function(){
                                    if (check_true ((block_options && block_options["no_scope_boundary"]))){
                                        return ctx
                                    } else {
                                        return await new_ctx(ctx)
                                    }
                                })();
                                await (async function(){
                                     let __test_condition__113=async function() {
                                        return (idx<num_non_return_statements)
                                    };
                                    let __body_ref__114=async function() {
                                        idx+=1;
                                        ctx=await new_ctx(ctx);
                                        await set_new_completion_scope(ctx);
                                        await set_ctx(ctx,"__TOP_LEVEL__",true);
                                        if (check_true (await verbosity(ctx))){
                                            {
                                                await console.log("");
                                                (top_level_log)((""+ idx+ "/"+ num_non_return_statements),"->",await (await Environment.get_global("as_lisp"))(lisp_tree[idx]))
                                            }
                                        };
                                        tokens=await tokenize(lisp_tree[idx],ctx);
                                        stmt=await (async function(){
                                             return await compile(tokens,ctx) 
                                        })();
                                        rval=await wrap_and_run(stmt,ctx,{
                                            bind_mode:true
                                        });
                                        if (check_true (await verbosity(ctx))){
                                            {
                                                (top_level_log)((""+ idx+ "/"+ num_non_return_statements),"compiled <- ",await (await Environment.get_global("as_lisp"))(stmt));
                                                return (top_level_log)((""+ idx+ "/"+ num_non_return_statements),"<-",await (await Environment.get_global("as_lisp"))(rval))
                                            }
                                        }
                                    };
                                    let __BREAK__FLAG__=false;
                                    while(await __test_condition__113()) {
                                        await __body_ref__114();
                                         if(__BREAK__FLAG__) {
                                             break;
                                            
                                        }
                                    } ;
                                    
                                })();
                                return lisp_tree[(idx+ 1)]
                            }
                        }
                    }
                }
            };
            check_statement_completion=async function(ctx,stmts) {
                let stmt;
                let cmp_rec;
                stmt=await (async function(){
                    if (check_true ((null==stmts))){
                        throw new Error("compiler error: check_statement_completion: received undefined/nil statement array.");
                        
                    } else {
                        return await last(stmts)
                    }
                })();
                cmp_rec=await get_ctx(ctx,"__COMPLETION_SCOPE__");
                if (check_true ((((ctx && ctx["block_step"])===0)&& await not(await contains_ques_((stmt && stmt["0"] && stmt["0"]["ctype"]),["block","ifblock","tryblock","letblock"]))&& await not(await contains_ques_((stmt && stmt["0"] && stmt["0"]["completion"]),completion_types))))){
                    {
                        (stmts).pop();
                        await (await Environment.get_global("assert"))(cmp_rec,"compiler error: check_statement_completion unable to find completion_scope record in context");
                        if (check_true ((((stmt && stmt["0"]) instanceof Object)&& await not(((stmt && stmt["0"]) instanceof Array))))){
                            {
                                await async function(){
                                    let __target_obj__115=(stmt && stmt["0"]);
                                    __target_obj__115["completion"]="return";
                                    return __target_obj__115;
                                    
                                }();
                                (stmts).push(await (async function(){
                                    let __array_op_rval__116=(stmt && stmt["0"]);
                                     if (__array_op_rval__116 instanceof Function){
                                        return await __array_op_rval__116("return ",await (await Environment.get_global("rest"))(stmt)) 
                                    } else {
                                        return [__array_op_rval__116,"return ",await (await Environment.get_global("rest"))(stmt)]
                                    }
                                })());
                                ((cmp_rec && cmp_rec["completion_records"])).push({
                                    block_id:(ctx && ctx["block_id"]),block_step:(ctx && ctx["block_step"]),type:"return",stmt:await last(stmts)
                                })
                            }
                        } else {
                            {
                                (stmts).push(await (async function(){
                                     return [{
                                        completion:"return"
                                    },"return ",stmt] 
                                })());
                                ((cmp_rec && cmp_rec["completion_records"])).push({
                                    block_id:(ctx && ctx["block_id"]),type:"return",block_step:(ctx && ctx["block_step"]),stmt:await last(stmts)
                                })
                            }
                        };
                        return stmts
                    }
                } else {
                    return stmts
                }
            };
            compile_block=async function(tokens,ctx,block_options) {
                let acc;
                let block_id;
                let clog;
                let token;
                let block_type;
                let last_stmt;
                let is_first_level;
                let return_last;
                let stmt;
                let subacc;
                let completion_scope;
                let stmt_ctype;
                let lambda_block;
                let stmts;
                let idx;
                acc=[];
                block_id=(((block_options && block_options.name)&& await add((block_options && block_options.name),(blk_counter=blk_counter+1)))|| (blk_counter=blk_counter+1));
                clog=await (async function(){
                    if (check_true (quiet_mode)){
                        return log
                    } else {
                        return await defclog({
                            prefix:("compile_block ("+ block_id+ "):"),background:"#404080",color:"white"
                        })
                    }
                })();
                ctx=await (async function(){
                    if (check_true ((block_options && block_options["force_no_new_ctx"]))){
                        return ctx
                    } else {
                        return await new_ctx(ctx)
                    }
                })();
                token=null;
                block_type="sub";
                last_stmt=null;
                is_first_level=false;
                return_last=(ctx && ctx["return_last_value"]);
                stmt=null;
                subacc=[];
                completion_scope=await get_ctx(ctx,"__COMPLETION_SCOPE__");
                stmt_ctype=null;
                lambda_block=false;
                stmts=[];
                idx=0;
                if (check_true ((null==ctx))){
                    {
                        throw new ReferenceError("undefined ctx passed to compile block");
                        
                    }
                };
                if (check_true (await verbosity(ctx))){
                    {
                        (clog)("->",tokens,ctx,block_options)
                    }
                };
                if (check_true (needs_first_level)){
                    {
                        is_first_level=true;
                        needs_first_level=false
                    }
                };
                if (check_true ((opts && opts["include_source"]))){
                    {
                        if (check_true (((tokens && tokens["path"])&& ((tokens && tokens["path"] && tokens["path"]["length"])>0)))){
                            {
                                (acc).push(await source_comment(tokens))
                            }
                        }
                    }
                };
                await async function(){
                    ctx["block_id"]=block_id;
                    return ctx;
                    
                }();
                await (await Environment.get_global("assert"))(completion_scope,"block called with no completion scope");
                await (await Environment.get_global("assert"))((completion_scope instanceof Object),"block called with an invalid completion scope");
                if (check_true ((completion_scope && completion_scope["root_block_id"]))){
                    {
                        await set_ctx(ctx,"__IN_SUB_BLOCK__",true)
                    }
                } else {
                    {
                        await async function(){
                            completion_scope["root_block_id"]=block_id;
                            return completion_scope;
                            
                        }();
                        block_type="root";
                        await set_ctx(ctx,"__IN_SUB_BLOCK__",false)
                    }
                };
                if (check_true ((await get_ctx_val(ctx,"__LAMBDA_STEP__")===-1))){
                    {
                        lambda_block=true;
                        await (await Environment.get_global("setf_ctx"))(ctx,"__LAMBDA_STEP__",((tokens && tokens.length)- 1))
                    }
                };
                if (check_true (is_first_level)){
                    {
                        (acc).push(first_level_setup)
                    }
                };
                await async function(){
                    ctx["final_block_statement"]=false;
                    return ctx;
                    
                }();
                await (async function(){
                     let __test_condition__120=async function() {
                        return (idx<((tokens && tokens.length)- 1))
                    };
                    let __body_ref__121=async function() {
                        idx+=1;
                        subacc=[];
                        token=tokens[idx];
                        if (check_true ((idx===((tokens && tokens.length)- 1)))){
                            {
                                await async function(){
                                    ctx["final_block_statement"]=true;
                                    return ctx;
                                    
                                }()
                            }
                        };
                        if (check_true ((block_type==="root"))){
                            await async function(){
                                ctx["block_step"]=((tokens && tokens.length)- 1- idx);
                                return ctx;
                                
                            }()
                        };
                        await async function(){
                            ctx["sub_block_step"]=((tokens && tokens.length)- 1- idx);
                            return ctx;
                            
                        }();
                        if (check_true (lambda_block)){
                            {
                                await set_ctx(ctx,"__LAMBDA_STEP__",((tokens && tokens.length)- 1- idx))
                            }
                        };
                        await async function(){
                            if (check_true (((block_type==="root")&& ((token && token["type"])==="arr")&& ((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="return")))) {
                                {
                                    return stmt=await compile_return((token && token["val"]),ctx)
                                }
                            } else if (check_true ((((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="declare")&& (block_options && block_options["ignore_declarations"])))) {
                                stmt={
                                    ignored:"declare"
                                }
                            } else if (check_true (((((tokens && tokens.length)- 1- idx)>0)&& ((token && token["val"] && token["val"]["0"] && token["val"]["0"]["type"])==="special")&& (((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="if")|| ((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="try"))))) {
                                {
                                    let subctx;
                                    subctx=await new_ctx(ctx);
                                    await async function(){
                                        subctx["block_step"]=((tokens && tokens.length)- 1- idx);
                                        return subctx;
                                        
                                    }();
                                    if (check_true (((token && token["val"] && token["val"]["0"] && token["val"]["0"]["name"])==="if"))){
                                        stmt=await compile_if((token && token["val"]),subctx)
                                    } else {
                                        stmt=await compile_try((token && token["val"]),subctx)
                                    }
                                }
                            } else {
                                stmt=await (async function(){
                                     return await compile(token,ctx) 
                                })()
                            }
                        } ();
                        await (await Environment.get_global("assert"))(await not((stmt===undefined)),"compile_block: returned stmt is undefined");
                        (stmts).push(stmt);
                        if (check_true ((idx<((tokens && tokens.length)- 1)))){
                            {
                                return (stmts).push(";")
                            }
                        }
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__120()) {
                        await __body_ref__121();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                await check_statement_completion(ctx,stmts);
                (acc).push(stmts);
                if (check_true (await not((block_options && block_options["no_scope_boundary"])))){
                    {
                        (acc).unshift("{");
                        (acc).push("}")
                    }
                };
                (acc).unshift({
                    ctype:"block",block_id:block_id,block_options:block_options
                });
                return acc
            };
            Expression=new Function("","{ return \"expression\" }");
            Statement=new Function("","{ return \"statement\" }");
            NumberType=new Function("","{ return \"number\" }");
            StringType=new Function("","{ return \"string\" }");
            NilType=new Function("","{ return \"nil\" }");
            UnknownType=new Function(""," { return \"unknown\"} ");
            ArgumentType=new Function(""," { return \"argument\" }");
            compile_defvar=async function(tokens,ctx,opts) {
                let target;
                let wrap_as_function_ques_;
                let ctx_details;
                let allocation_type;
                let assignment_type;
                let assignment_value;
                target=await clean_quoted_reference(await sanitize_js_ref_name((tokens && tokens["1"] && tokens["1"]["name"])));
                wrap_as_function_ques_=null;
                ctx_details=null;
                ctx=ctx;
                allocation_type=await (async function(){
                    if (check_true ((opts && opts["constant"]))){
                        return "const"
                    } else {
                        return "let"
                    }
                })();
                assignment_type=null;
                assignment_value=null;
                assignment_value=await (async function(){
                    return await compile_wrapper_fn((tokens && tokens["2"]),ctx)
                })();
                ctx_details=await get_declaration_details(ctx,target);
                assignment_type=await add(new Object(),ctx_details,await get_declarations(ctx,target));
                await async function(){
                    if (check_true (((assignment_value instanceof Array)&& ((assignment_value && assignment_value["0"]) instanceof Object)&& (assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])))) {
                        {
                            return await set_ctx(ctx,target,await map_ctype_to_value((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"]),assignment_value))
                        }
                    } else if (check_true ((assignment_type && assignment_type["value"]) instanceof Function)) {
                        await set_ctx(ctx,target,(assignment_type && assignment_type["value"]))
                    } else {
                        await set_ctx(ctx,target,assignment_value)
                    }
                } ();
                if (check_true ((ctx && ctx["defvar_eval"]))){
                    {
                        await (await Environment.get_global("delete_prop"))(ctx,"defvar_eval");
                        return [{
                            ctype:"assignment"
                        },allocation_type," ",target,"=",assignment_value,"()",";"]
                    }
                } else {
                    return [{
                        ctype:"assignment"
                    },await (async function(){
                        if (check_true (((ctx_details && ctx_details["is_argument"])&& ((ctx_details && ctx_details["levels_up"])===1)))){
                            return ""
                        } else {
                            return (allocation_type+ " ")
                        }
                    })(),"",target,"=",[assignment_value],";"]
                }
            };
            get_declaration_details=async function(ctx,symname,_levels_up) {
                if (check_true (false)){
                    {
                        symname=await first((symname).split("."))
                    }
                };
                return await async function(){
                    if (check_true ((await (async function(){
                        let __targ__126=(ctx && ctx["scope"]);
                        if (__targ__126){
                             return(__targ__126)[symname]
                        } 
                    })()&& ctx["lambda_scope"]))) {
                        return {
                            name:symname,is_argument:true,levels_up:(_levels_up|| 0),value:await (async function(){
                                let __targ__127=(ctx && ctx["scope"]);
                                if (__targ__127){
                                     return(__targ__127)[symname]
                                } 
                            })(),declared_global:await (async function(){
                                if (check_true (await (async function(){
                                    let __targ__128=(root_ctx && root_ctx["defined_lisp_globals"]);
                                    if (__targ__128){
                                         return(__targ__128)[symname]
                                    } 
                                })())){
                                    return true
                                } else {
                                    return false
                                }
                            })()
                        }
                    } else if (check_true (await (async function(){
                        let __targ__129=(ctx && ctx["scope"]);
                        if (__targ__129){
                             return(__targ__129)[symname]
                        } 
                    })())) {
                        return {
                            name:symname,is_argument:false,levels_up:(_levels_up|| 0),value:await (async function(){
                                let __targ__130=(ctx && ctx["scope"]);
                                if (__targ__130){
                                     return(__targ__130)[symname]
                                } 
                            })(),declarations:await get_declarations(ctx,symname),declared_global:await (async function(){
                                if (check_true (await (async function(){
                                    let __targ__131=(root_ctx && root_ctx["defined_lisp_globals"]);
                                    if (__targ__131){
                                         return(__targ__131)[symname]
                                    } 
                                })())){
                                    return true
                                } else {
                                    return false
                                }
                            })()
                        }
                    } else if (check_true (((ctx["parent"]==null)&& await (async function(){
                        let __targ__132=(root_ctx && root_ctx["defined_lisp_globals"]);
                        if (__targ__132){
                             return(__targ__132)[symname]
                        } 
                    })()))) {
                        return {
                            name:symname,is_argument:false,levels_up:(_levels_up|| 0),value:await (async function(){
                                let __targ__133=(ctx && ctx["scope"]);
                                if (__targ__133){
                                     return(__targ__133)[symname]
                                } 
                            })(),declarations:await get_declarations(ctx,symname),declared_global:true
                        }
                    } else if (check_true ((ctx && ctx["parent"]))) {
                        return await get_declaration_details((ctx && ctx["parent"]),symname,((_levels_up&& await add(_levels_up,1))|| 1))
                    } else if (check_true (await not((NOT_FOUND_THING===await Environment["get_global"].call(Environment,symname,NOT_FOUND_THING))))) {
                        return {
                            name:symname,is_argument:false,levels_up:(_levels_up|| 0),value:await Environment["get_global"].call(Environment,symname),declared_global:true
                        }
                    }
                } ()
            };
            clean_quoted_reference=async function(name) {
                return await async function(){
                    if (check_true (((name instanceof String || typeof name==='string')&& await starts_with_ques_("\"",name)&& await (await Environment.get_global("ends_with?"))("\"",name)))) {
                        return await (async function() {
                            {
                                 let __call_target__=await name["substr"].call(name,1), __call_method__="substr";
                                return await __call_target__[__call_method__].call(__call_target__,0,(await length(name)- 2))
                            } 
                        })()
                    } else {
                        return name
                    }
                } ()
            };
            compile_let=async function(tokens,ctx) {
                let acc;
                let clog;
                let token;
                let declarations_handled;
                let assignment_value;
                let suppress_return;
                let block_declarations;
                let my_tokens;
                let assignment_type;
                let stmt;
                let def_idx;
                let redefinitions;
                let need_sub_block;
                let assignments;
                let reference_name;
                let shadowed_globals;
                let alloc_set;
                let is_first_level;
                let sub_block_count;
                let ctx_details;
                let preamble;
                let structure_validation_rules;
                let validation_results;
                let allocations;
                let block;
                let syntax_error;
                let idx;
                acc=[];
                ctx=await new_ctx(ctx);
                clog=await (async function(){
                    if (check_true (quiet_mode)){
                        return log
                    } else {
                        return await defclog({
                            prefix:("compile_let: "+ ((ctx && ctx["block_id"])|| "")),background:"#B0A0F0",color:"black"
                        })
                    }
                })();
                token=null;
                declarations_handled=false;
                assignment_value=null;
                suppress_return=null;
                block_declarations=new Object();
                my_tokens=tokens;
                assignment_type=null;
                stmt=null;
                def_idx=null;
                redefinitions=new Object();
                need_sub_block=false;
                assignments=new Object();
                reference_name=null;
                shadowed_globals=new Object();
                alloc_set=null;
                is_first_level=false;
                sub_block_count=0;
                ctx_details=null;
                preamble=await calling_preamble(ctx);
                structure_validation_rules=await (async function(){
                     return [[[1,"val"],[(await Environment.get_global("is_array?"))],"allocation section"],await (async function(){
                         return [[2],[async function(v) {
                            return await not((v===undefined))
                        }],"block"] 
                    })()] 
                })();
                validation_results=null;
                allocations=(tokens && tokens["1"] && tokens["1"]["val"]);
                block=await tokens["slice"].call(tokens,2);
                syntax_error=null;
                idx=-1;
                ;
                await (await Environment.get_global("compiler_syntax_validation"))("compile_let",tokens,errors,ctx,expanded_tree);
                await async function(){
                    ctx["return_last_value"]=true;
                    return ctx;
                    
                }();
                await set_ctx(ctx,"__LOCAL_SCOPE__",true);
                (acc).push("{");
                sub_block_count+=1;
                if (check_true (((block && block["0"] && block["0"]["val"] && block["0"]["val"]["0"] && block["0"]["val"]["0"]["name"])==="declare"))){
                    {
                        declarations_handled=true;
                        (acc).push(await compile_declare((block && block["0"] && block["0"]["val"]),ctx))
                    }
                };
                if (check_true (needs_first_level)){
                    {
                        is_first_level=true;
                        needs_first_level=false;
                        if (check_true (is_first_level)){
                            {
                                (acc).push(first_level_setup)
                            }
                        }
                    }
                };
                await (async function(){
                     let __test_condition__135=async function() {
                        return (idx<((allocations && allocations.length)- 1))
                    };
                    let __body_ref__136=async function() {
                        idx+=1;
                        alloc_set=await (async function(){
                            let __targ__137=allocations[idx];
                            if (__targ__137){
                                 return(__targ__137)["val"]
                            } 
                        })();
                        reference_name=await clean_quoted_reference(await sanitize_js_ref_name((alloc_set && alloc_set["0"] && alloc_set["0"]["name"])));
                        await (await Environment.get_global("assert"))(((reference_name instanceof String || typeof reference_name==='string')&& (await length(reference_name)>0)),("Invalid reference name: "+ (alloc_set && alloc_set["0"] && alloc_set["0"]["name"])));
                        ctx_details=await get_declaration_details(ctx,reference_name);
                        if (check_true (ctx_details)){
                            {
                                if (check_true ((await not((ctx_details && ctx_details["is_argument"]))&& ((ctx_details && ctx_details["levels_up"])>1)))){
                                    {
                                        need_sub_block=true;
                                        if (check_true (redefinitions[reference_name])){
                                            (redefinitions[reference_name]).push(await gen_temp_name(reference_name))
                                        } else {
                                            await async function(){
                                                redefinitions[reference_name]=[0,await gen_temp_name(reference_name)];
                                                return redefinitions;
                                                
                                            }()
                                        };
                                        if (check_true (((ctx_details && ctx_details["declared_global"])&& await not((ctx_details && ctx_details["is_argument"]))))){
                                            {
                                                await async function(){
                                                    shadowed_globals[(alloc_set && alloc_set["0"] && alloc_set["0"]["name"])]=true;
                                                    return shadowed_globals;
                                                    
                                                }()
                                            }
                                        }
                                    }
                                }
                            }
                        };
                        if (check_true (await not((ctx_details && ctx_details["is_argument"])))){
                            {
                                return await set_ctx(ctx,reference_name,AsyncFunction)
                            }
                        }
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__135()) {
                        await __body_ref__136();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                idx=-1;
                await (async function(){
                     let __test_condition__140=async function() {
                        return (idx<((allocations && allocations.length)- 1))
                    };
                    let __body_ref__141=async function() {
                        idx+=1;
                        stmt=[];
                        alloc_set=await (async function(){
                            let __targ__142=allocations[idx];
                            if (__targ__142){
                                 return(__targ__142)["val"]
                            } 
                        })();
                        reference_name=await clean_quoted_reference(await sanitize_js_ref_name((alloc_set && alloc_set["0"] && alloc_set["0"]["name"])));
                        ctx_details=await get_declaration_details(ctx,reference_name);
                        await async function(){
                            if (check_true (((alloc_set && alloc_set["1"] && alloc_set["1"]["val"]) instanceof Array))) {
                                {
                                    await async function(){
                                        ctx["in_assignment"]=true;
                                        return ctx;
                                        
                                    }();
                                    assignment_value=await compile_wrapper_fn((alloc_set && alloc_set["1"]),ctx);
                                    return await async function(){
                                        ctx["in_assignment"]=false;
                                        return ctx;
                                        
                                    }()
                                }
                            } else if (check_true ((((alloc_set && alloc_set["1"] && alloc_set["1"]["name"]) instanceof String || typeof (alloc_set && alloc_set["1"] && alloc_set["1"]["name"])==='string')&& await not((ctx_details && ctx_details["is_argument"]))&& (alloc_set && alloc_set["1"] && alloc_set["1"]["ref"])&& await not((await Environment["get_global"].call(Environment,(alloc_set && alloc_set["1"] && alloc_set["1"]["name"]),NOT_FOUND_THING)===NOT_FOUND_THING))&& shadowed_globals[(alloc_set && alloc_set["0"] && alloc_set["0"]["name"])]))) {
                                {
                                    assignment_value=await (async function(){
                                         return [{
                                            ctype:(ctx_details && ctx_details["value"])
                                        },"await"," ",env_ref,"get_global","(","\"",(alloc_set && alloc_set["0"] && alloc_set["0"]["name"]),"\"",")"] 
                                    })()
                                }
                            } else {
                                {
                                    assignment_value=await compile_wrapper_fn((alloc_set && alloc_set["1"]),ctx);
                                    if (check_true (await verbosity(ctx))){
                                        {
                                            (clog)("setting simple assignment value for",reference_name,": <- ",await (async function(){
                                                 return await clone(assignment_value) 
                                            })())
                                        }
                                    }
                                }
                            }
                        } ();
                        await async function(){
                            if (check_true (((assignment_value instanceof Array)&& ((assignment_value && assignment_value["0"]) instanceof Object)&& (assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])))) {
                                {
                                    return await set_ctx(ctx,reference_name,await map_ctype_to_value((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"]),assignment_value))
                                }
                            } else if (check_true (((assignment_value instanceof Array)&& ((assignment_value && assignment_value["0"]) instanceof Array)&& (assignment_value && assignment_value["0"] && assignment_value["0"]["0"] && assignment_value["0"]["0"]["ctype"])))) {
                                {
                                    await set_ctx(ctx,reference_name,await map_ctype_to_value((assignment_value && assignment_value["0"] && assignment_value["0"]["0"] && assignment_value["0"]["0"]["ctype"]),assignment_value))
                                }
                            } else {
                                {
                                    await set_ctx(ctx,reference_name,assignment_value)
                                }
                            }
                        } ();
                        if (check_true ((ctx_details && ctx_details["is_argument"]))){
                            {
                                await async function(){
                                    block_declarations[reference_name]=true;
                                    return block_declarations;
                                    
                                }()
                            }
                        };
                        def_idx=null;
                        await async function(){
                            if (check_true ((redefinitions[reference_name]&& await first(redefinitions[reference_name])))) {
                                {
                                    def_idx=await first(redefinitions[reference_name]);
                                    def_idx+=1;
                                    await async function(){
                                        let __target_obj__146=redefinitions[reference_name];
                                        __target_obj__146[0]=def_idx;
                                        return __target_obj__146;
                                        
                                    }();
                                    return await (async function() {
                                        let __for_body__149=async function(t) {
                                            return (acc).push(t)
                                        };
                                        let __array__150=[],__elements__148=["let"," ",await (async function(){
                                            let __targ__151=redefinitions[reference_name];
                                            if (__targ__151){
                                                 return(__targ__151)[def_idx]
                                            } 
                                        })(),"="," ",(preamble && preamble["1"])," ","function","()","{","return"," ",assignment_value,"}",";"];
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__147 in __elements__148) {
                                            __array__150.push(await __for_body__149(__elements__148[__iter__147]));
                                            if(__BREAK__FLAG__) {
                                                 __array__150.pop();
                                                break;
                                                
                                            }
                                        }return __array__150;
                                         
                                    })()
                                }
                            } else if (check_true (await not(block_declarations[reference_name]))) {
                                {
                                    await (async function() {
                                        let __for_body__154=async function(t) {
                                            return (acc).push(t)
                                        };
                                        let __array__155=[],__elements__153=["let"," ",reference_name,";"];
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__152 in __elements__153) {
                                            __array__155.push(await __for_body__154(__elements__153[__iter__152]));
                                            if(__BREAK__FLAG__) {
                                                 __array__155.pop();
                                                break;
                                                
                                            }
                                        }return __array__155;
                                         
                                    })();
                                    await async function(){
                                        block_declarations[reference_name]=true;
                                        return block_declarations;
                                        
                                    }()
                                }
                            }
                        } ();
                        if (check_true (await not(assignments[reference_name]))){
                            {
                                await async function(){
                                    assignments[reference_name]=[];
                                    return assignments;
                                    
                                }()
                            }
                        };
                        return (assignments[reference_name]).push(await (async function(){
                            if (check_true (def_idx)){
                                return [(preamble && preamble["0"])," ",await (async function(){
                                    let __targ__158=redefinitions[reference_name];
                                    if (__targ__158){
                                         return(__targ__158)[def_idx]
                                    } 
                                })(),"()",";"]
                            } else {
                                return assignment_value
                            }
                        })())
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__140()) {
                        await __body_ref__141();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                if (check_true (need_sub_block)){
                    {
                        await (async function() {
                            let __for_body__161=async function(pset) {
                                return await (async function() {
                                    let __for_body__165=async function(redef) {
                                        return (redefinitions[(pset && pset["0"])]).shift()
                                    };
                                    let __array__166=[],__elements__164=(pset && pset["1"]);
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__163 in __elements__164) {
                                        __array__166.push(await __for_body__165(__elements__164[__iter__163]));
                                        if(__BREAK__FLAG__) {
                                             __array__166.pop();
                                            break;
                                            
                                        }
                                    }return __array__166;
                                     
                                })()
                            };
                            let __array__162=[],__elements__160=await (await Environment.get_global("pairs"))(redefinitions);
                            let __BREAK__FLAG__=false;
                            for(let __iter__159 in __elements__160) {
                                __array__162.push(await __for_body__161(__elements__160[__iter__159]));
                                if(__BREAK__FLAG__) {
                                     __array__162.pop();
                                    break;
                                    
                                }
                            }return __array__162;
                             
                        })()
                    }
                };
                if (check_true (need_sub_block)){
                    {
                        (acc).push("{");
                        sub_block_count+=1
                    }
                };
                idx=-1;
                await (async function(){
                     let __test_condition__167=async function() {
                        return (idx<((allocations && allocations.length)- 1))
                    };
                    let __body_ref__168=async function() {
                        idx+=1;
                        def_idx=null;
                        stmt=[];
                        alloc_set=await (async function(){
                            let __targ__169=allocations[idx];
                            if (__targ__169){
                                 return(__targ__169)["val"]
                            } 
                        })();
                        reference_name=await clean_quoted_reference(await sanitize_js_ref_name((alloc_set && alloc_set["0"] && alloc_set["0"]["name"])));
                        ctx_details=await get_declaration_details(ctx,reference_name);
                        assignment_value=(assignments[reference_name]).shift();
                        await async function(){
                            if (check_true (block_declarations[reference_name])) {
                                return true
                            } else {
                                {
                                    (stmt).push("let");
                                    (stmt).push(" ")
                                }
                            }
                        } ();
                        (stmt).push(reference_name);
                        await async function(){
                            block_declarations[reference_name]=true;
                            return block_declarations;
                            
                        }();
                        (stmt).push("=");
                        (stmt).push(assignment_value);
                        (stmt).push(";");
                        return (acc).push(stmt)
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__167()) {
                        await __body_ref__168();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                (acc).push(await compile_block(await conj(["PLACEHOLDER"],block),ctx,{
                    no_scope_boundary:true,suppress_return:suppress_return,ignore_declarations:declarations_handled
                }));
                await (async function() {
                    let __for_body__173=async function(i) {
                        return (acc).push("}")
                    };
                    let __array__174=[],__elements__172=await (await Environment.get_global("range"))(sub_block_count);
                    let __BREAK__FLAG__=false;
                    for(let __iter__171 in __elements__172) {
                        __array__174.push(await __for_body__173(__elements__172[__iter__171]));
                        if(__BREAK__FLAG__) {
                             __array__174.pop();
                            break;
                            
                        }
                    }return __array__174;
                     
                })();
                if (check_true (false)){
                    return acc
                } else {
                    {
                        (acc).unshift({
                            ctype:"letblock",block_step:(ctx && ctx["parent"] && ctx["parent"]["block_step"])
                        });
                        return acc
                    }
                }
            };
            in_sync_ques_=async function(ctx) {
                return await get_ctx(ctx,"__SYNCF__")
            };
            await_ques_=async function(ctx) {
                if (check_true (await (async function(){
                    let __array_op_rval__175=in_sync_ques_;
                     if (__array_op_rval__175 instanceof Function){
                        return await __array_op_rval__175(ctx) 
                    } else {
                        return [__array_op_rval__175,ctx]
                    }
                })())){
                    return ""
                } else {
                    return "await"
                }
            };
            calling_preamble=async function(ctx) {
                if (check_true (await (async function(){
                    let __array_op_rval__176=in_sync_ques_;
                     if (__array_op_rval__176 instanceof Function){
                        return await __array_op_rval__176(ctx) 
                    } else {
                        return [__array_op_rval__176,ctx]
                    }
                })())){
                    return ["","",{
                        ctype:"Function",block_step:0
                    },"(",")"]
                } else {
                    return ["await","async",{
                        ctype:"AsyncFunction",block_step:0
                    },"",""]
                }
            };
            fn_log=await (async function(){
                 return await defclog({
                    prefix:"compile_fn",background:"black",color:"lightblue"
                }) 
            })();
            completion_scope_id=0;
            set_new_completion_scope=async function(ctx) {
                let completion_scope;
                completion_scope={
                    id:completion_scope_id+=1,root_block_id:null,completion_records:[],is_top:false
                };
                await set_ctx(ctx,"__COMPLETION_SCOPE__",completion_scope);
                return completion_scope
            };
            compile_fn=async function(tokens,ctx,fn_opts) {
                let acc;
                let idx;
                let arg;
                let fn_args;
                let body;
                let external_declarations;
                let type_mark;
                let completion_scope;
                let nbody;
                acc=[];
                idx=-1;
                arg=null;
                ctx=await new_ctx(ctx);
                fn_args=(tokens && tokens["1"] && tokens["1"]["val"]);
                body=(tokens && tokens["2"]);
                external_declarations=(tokens && tokens["3"]);
                type_mark=null;
                completion_scope=await set_new_completion_scope(ctx);
                nbody=null;
                if (check_true ((undefined==body))){
                    {
                        throw new SyntaxError("Invalid function call syntax");
                        
                    }
                };
                await async function(){
                    ctx["return_point"]=0;
                    return ctx;
                    
                }();
                await set_ctx(ctx,"__IN_LAMBDA__",true);
                await set_ctx(ctx,"__LAMBDA_STEP__",-1);
                await async function(){
                    ctx["lambda_scope"]=true;
                    return ctx;
                    
                }();
                await async function(){
                    ctx["suppress_return"]=false;
                    return ctx;
                    
                }();
                await async function(){
                    if (check_true ((fn_opts && fn_opts["synchronous"]))) {
                        {
                            type_mark=await type_marker("Function");
                            await set_ctx(ctx,"__SYNCF__",true);
                            await async function(){
                                completion_scope["in_sync"]=true;
                                return completion_scope;
                                
                            }();
                            return (acc).push(type_mark)
                        }
                    } else if (check_true ((fn_opts && fn_opts["arrow"]))) {
                        {
                            type_mark=await type_marker("Function");
                            (acc).push(type_mark)
                        }
                    } else if (check_true ((fn_opts && fn_opts["generator"]))) {
                        {
                            type_mark=await type_marker("GeneratorFunction");
                            (acc).push(type_mark);
                            (acc).push("async");
                            (acc).push(" ")
                        }
                    } else {
                        {
                            type_mark=await type_marker("AsyncFunction");
                            (acc).push(type_mark);
                            (acc).push("async");
                            (acc).push(" ")
                        }
                    }
                } ();
                await async function(){
                    type_mark["args"]=[];
                    return type_mark;
                    
                }();
                await async function(){
                    if (check_true ((fn_opts && fn_opts["arrow"]))) {
                        return await async function(){
                            completion_scope["scope_type"]="arrow";
                            return completion_scope;
                            
                        }()
                    } else if (check_true ((fn_opts && fn_opts["generator"]))) {
                        {
                            (acc).push("function*");
                            await async function(){
                                completion_scope["scope_type"]="generator";
                                return completion_scope;
                                
                            }()
                        }
                    } else {
                        {
                            await async function(){
                                completion_scope["scope_type"]="function";
                                return completion_scope;
                                
                            }();
                            (acc).push("function")
                        }
                    }
                } ();
                (acc).push("(");
                await (async function(){
                     let __test_condition__185=async function() {
                        return (idx<((fn_args && fn_args.length)- 1))
                    };
                    let __body_ref__186=async function() {
                        idx+=1;
                        arg=fn_args[idx];
                        if (check_true (((arg && arg.name)==="&"))){
                            {
                                idx+=1;
                                arg=fn_args[idx];
                                if (check_true ((null==arg))){
                                    {
                                        throw new SyntaxError("Missing argument symbol after &");
                                        
                                    }
                                };
                                await set_ctx(ctx,(arg && arg.name),ArgumentType);
                                await async function(){
                                    arg["name"]=("..."+ (arg && arg.name));
                                    return arg;
                                    
                                }()
                            }
                        } else {
                            {
                                await set_ctx(ctx,(arg && arg.name),ArgumentType)
                            }
                        };
                        (acc).push(await sanitize_js_ref_name((arg && arg.name)));
                        ((type_mark && type_mark["args"])).push(await sanitize_js_ref_name((arg && arg.name)));
                        if (check_true ((idx<((fn_args && fn_args.length)- 1)))){
                            {
                                return (acc).push(",")
                            }
                        }
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__185()) {
                        await __body_ref__186();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                (acc).push(")");
                (acc).push(" ");
                if (check_true ((fn_opts && fn_opts["arrow"]))){
                    {
                        (acc).push("=>")
                    }
                };
                if (check_true ((fn_opts && fn_opts["generator"]))){
                    await async function(){
                        ctx["return_last_value"]=false;
                        return ctx;
                        
                    }()
                } else {
                    await async function(){
                        ctx["return_last_value"]=true;
                        return ctx;
                        
                    }()
                };
                await async function(){
                    if (check_true (((body && body["val"] && body["val"]["0"] && body["val"]["0"]["name"])==="let"))) {
                        {
                            return (acc).push(await (async function(){
                                 return await compile((body && body["val"]),ctx) 
                            })())
                        }
                    } else if (check_true (await contains_ques_((body && body["val"] && body["val"]["0"] && body["val"]["0"]["name"]),["do","progn","progl"]))) {
                        {
                            (acc).push(await compile_block((body && body["val"]),ctx))
                        }
                    } else {
                        {
                            nbody=await (async function(){
                                 return [{
                                    type:"special",val:await (async function(){
                                         return "=:do" 
                                    })(),ref:true,name:"do"
                                },body] 
                            })();
                            await async function(){
                                ctx["return_last_value"]=true;
                                return ctx;
                                
                            }();
                            (acc).push({
                                mark:"nbody"
                            });
                            (acc).push(await compile_block(nbody,ctx))
                        }
                    }
                } ();
                await async function(){
                    if (check_true (((completion_scope && completion_scope["completion_records"] && completion_scope["completion_records"]["length"])===0))) {
                        throw new Error("internal compile error: no completion records for callable");
                        
                    } else {
                        true
                    }
                } ();
                return acc
            };
            compile_jslambda=async function(tokens,ctx) {
                let acc;
                let fn_args;
                let body;
                let idx;
                let quoted_body;
                let arg;
                let type_mark;
                acc=[];
                fn_args=(tokens && tokens["1"] && tokens["1"]["val"]);
                body=await (async function(){
                     return await compile((tokens && tokens["2"] && tokens["2"]["val"]),ctx) 
                })();
                idx=-1;
                quoted_body=[];
                arg=null;
                type_mark=await type_marker("Function");
                (acc).push(type_mark);
                await (async function() {
                    let __for_body__193=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__194=[],__elements__192=["new"," ","Function","("];
                    let __BREAK__FLAG__=false;
                    for(let __iter__191 in __elements__192) {
                        __array__194.push(await __for_body__193(__elements__192[__iter__191]));
                        if(__BREAK__FLAG__) {
                             __array__194.pop();
                            break;
                            
                        }
                    }return __array__194;
                     
                })();
                if (check_true (await not((body instanceof String || typeof body==='string')))){
                    {
                        throw new SyntaxError(("Invalid jslambda body, need string, got: "+ await subtype(body)));
                        
                    }
                };
                await (async function(){
                     let __test_condition__195=async function() {
                        return (idx<((fn_args && fn_args.length)- 1))
                    };
                    let __body_ref__196=async function() {
                        idx+=1;
                        arg=fn_args[idx];
                        await set_ctx(ctx,(arg && arg.name),ArgumentType);
                        (acc).push(("\""+ (arg && arg.name)+ "\""));
                        ((type_mark && type_mark["args"])).push((arg && arg.name));
                        return (acc).push(",")
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__195()) {
                        await __body_ref__196();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                (acc).push("\"");
                await (async function() {
                    let __for_body__199=async function(c) {
                        if (check_true (await not((c==="\n"),(c==="\r")))){
                            {
                                if (check_true ((c==="\""))){
                                    {
                                        (quoted_body).push(await String.fromCharCode(92))
                                    }
                                };
                                return (quoted_body).push(c)
                            }
                        }
                    };
                    let __array__200=[],__elements__198=(body).split("");
                    let __BREAK__FLAG__=false;
                    for(let __iter__197 in __elements__198) {
                        __array__200.push(await __for_body__199(__elements__198[__iter__197]));
                        if(__BREAK__FLAG__) {
                             __array__200.pop();
                            break;
                            
                        }
                    }return __array__200;
                     
                })();
                (acc).push((await flatten(quoted_body)).join(""));
                (acc).push("\"");
                (acc).push(")");
                return acc
            };
            compile_yield=async function(tokens,ctx) {
                let acc;
                let expr;
                let cmp_rec;
                acc=[];
                expr=null;
                cmp_rec=await get_ctx(ctx,"__COMPLETION_SCOPE__");
                (acc).push(["yield"," ",await compile_wrapper_fn((tokens && tokens["1"]),ctx),";"]);
                ((cmp_rec && cmp_rec["completion_records"])).push({
                    block_id:(ctx && ctx["block_id"]),block_step:(ctx && ctx["block_step"]),type:"yield",stmt:await last(acc)
                });
                return acc
            };
            var_counter=0;
            gen_temp_name=async function(arg) {
                return ("__"+ (arg|| "")+ "__"+ (var_counter=var_counter+1))
            };
            if_id=0;
            compile_cond=async function(tokens,ctx) {
                let preamble;
                preamble=await calling_preamble(ctx);
                ctx=await new_ctx(ctx);
                ;
                await set_new_completion_scope(ctx);
                return [(preamble && preamble["2"]),(preamble && preamble["0"])," ",(preamble && preamble["1"])," ",(preamble && preamble["3"]),"function","()","{",await compile_cond_inner(tokens,ctx),"} ",(preamble && preamble["4"]),"()"]
            };
            compile_cond_inner=async function(tokens,ctx) {
                let acc;
                let conditions;
                let block_step;
                let condition_tokens;
                let idx;
                let preamble;
                let compile_condition;
                acc=[];
                conditions=[];
                block_step=(ctx && ctx["block_step"]);
                condition_tokens=await tokens["slice"].call(tokens,1);
                idx=-2;
                preamble=await calling_preamble(ctx);
                compile_condition=async function(cond_test,cond_block) {
                    let stmts;
                    let compiled_test;
                    let stmt;
                    stmts=[];
                    compiled_test=null;
                    stmt=null;
                    if (check_true (((cond_test && cond_test.name)==="else"))){
                        if (check_true ((idx>=2))){
                            (stmts).push(" else ")
                        }
                    } else {
                        {
                            if (check_true ((idx>=2))){
                                (stmts).push(" else ")
                            };
                            compiled_test=await compile_wrapper_fn(cond_test,ctx);
                            if (check_true (((await first(compiled_test) instanceof Object)&& await (async function(){
                                let __targ__201=await first(compiled_test);
                                if (__targ__201){
                                     return(__targ__201)["ctype"]
                                } 
                            })()&& (await (async function(){
                                let __targ__202=await first(compiled_test);
                                if (__targ__202){
                                     return(__targ__202)["ctype"]
                                } 
                            })() instanceof String || typeof await (async function(){
                                let __targ__202=await first(compiled_test);
                                if (__targ__202){
                                     return(__targ__202)["ctype"]
                                } 
                            })()==='string')&& await contains_ques_("unction",await (async function(){
                                let __targ__203=await first(compiled_test);
                                if (__targ__203){
                                     return(__targ__203)["ctype"]
                                } 
                            })())))){
                                (stmts).push(["if"," ","(check_true (",(preamble && preamble["0"])," ",compiled_test,"()",")) "])
                            } else {
                                (stmts).push(["if"," ","(check_true (",compiled_test,")) "])
                            }
                        }
                    };
                    stmt=await compile_block(await ensure_block(cond_block),ctx);
                    (stmts).push(stmt);
                    return stmts
                };
                ;
                await (await Environment.get_global("compiler_syntax_validation"))("compile_cond",tokens,errors,ctx,expanded_tree);
                await async function(){
                    if (check_true (await not((((condition_tokens && condition_tokens.length)% 2)===0)))) {
                        throw new SyntaxError("cond: Invalid syntax: missing condition block");
                        
                    } else if (check_true (((condition_tokens && condition_tokens.length)===0))) {
                        throw new SyntaxError("cond: Invalid syntax: no conditions provided");
                        
                    }
                } ();
                await (async function(){
                     let __test_condition__204=async function() {
                        return (idx<((condition_tokens && condition_tokens.length)- 2))
                    };
                    let __body_ref__205=async function() {
                        idx+=2;
                        return (acc).push(await compile_condition(condition_tokens[idx],condition_tokens[(idx+ 1)]))
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__204()) {
                        await __body_ref__205();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                return acc
            };
            ensure_block=async function(tokens) {
                if (check_true (((tokens instanceof Array)&& ("special"===(tokens && tokens["0"] && tokens["0"]["type"]))&& await contains_ques_((tokens && tokens["0"] && tokens["0"]["name"]),["do","progn"])))){
                    return tokens
                } else {
                    return ["PLACEHOLDER",tokens]
                }
            };
            compile_if=async function(tokens,ctx) {
                let acc;
                let subacc;
                let stmts;
                let test_form;
                let if_true;
                let if_false;
                let compiled_test;
                let compiled_true;
                let compiled_false;
                let block_step;
                let preamble;
                acc=[];
                subacc=[];
                stmts=null;
                test_form=(tokens && tokens["1"]);
                if_true=(tokens && tokens["2"]);
                if_false=(tokens && tokens["3"]);
                compiled_test=null;
                compiled_true=null;
                compiled_false=null;
                block_step=(ctx && ctx["block_step"]);
                preamble=await calling_preamble(ctx);
                ;
                if (check_true ((null==block_step))){
                    block_step=0
                };
                (acc).push({
                    ctype:"ifblock",block_step:(ctx && ctx["block_step"]),block_id:(ctx && ctx["block_id"])
                });
                compiled_test=await (async function(){
                     return await compile(test_form,ctx) 
                })();
                if (check_true (((await first(compiled_test) instanceof Object)&& await (async function(){
                    let __targ__206=await first(compiled_test);
                    if (__targ__206){
                         return(__targ__206)["ctype"]
                    } 
                })()&& (await (async function(){
                    let __targ__207=await first(compiled_test);
                    if (__targ__207){
                         return(__targ__207)["ctype"]
                    } 
                })() instanceof String || typeof await (async function(){
                    let __targ__207=await first(compiled_test);
                    if (__targ__207){
                         return(__targ__207)["ctype"]
                    } 
                })()==='string')&& await contains_ques_("unction",await (async function(){
                    let __targ__208=await first(compiled_test);
                    if (__targ__208){
                         return(__targ__208)["ctype"]
                    } 
                })())))){
                    await (async function() {
                        let __for_body__211=async function(t) {
                            return (subacc).push(t)
                        };
                        let __array__212=[],__elements__210=["if"," ","(check_true (",(preamble && preamble["0"])," ",compiled_test,"()","))"];
                        let __BREAK__FLAG__=false;
                        for(let __iter__209 in __elements__210) {
                            __array__212.push(await __for_body__211(__elements__210[__iter__209]));
                            if(__BREAK__FLAG__) {
                                 __array__212.pop();
                                break;
                                
                            }
                        }return __array__212;
                         
                    })()
                } else {
                    await (async function() {
                        let __for_body__215=async function(t) {
                            return (subacc).push(t)
                        };
                        let __array__216=[],__elements__214=["if"," ","(check_true (",compiled_test,"))"];
                        let __BREAK__FLAG__=false;
                        for(let __iter__213 in __elements__214) {
                            __array__216.push(await __for_body__215(__elements__214[__iter__213]));
                            if(__BREAK__FLAG__) {
                                 __array__216.pop();
                                break;
                                
                            }
                        }return __array__216;
                         
                    })()
                };
                (acc).push(subacc);
                subacc=[];
                compiled_true=await compile_block(await ensure_block(if_true),ctx);
                (acc).push(compiled_true);
                if (check_true (if_false)){
                    {
                        (acc).push(" ");
                        (acc).push("else");
                        (acc).push(" ");
                        compiled_false=await compile_block(await ensure_block(if_false),ctx);
                        (acc).push(compiled_false)
                    }
                };
                return acc
            };
            compile_as_call=async function(tokens,ctx) {
                return await compile_wrapper_fn(tokens,ctx,{
                    force:true
                })
            };
            compile_wrapper_fn=async function(tokens,ctx,opts) {
                let acc;
                let preamble;
                let needs_await;
                acc=[];
                ctx=ctx;
                preamble=await calling_preamble(ctx);
                needs_await=true;
                ;
                await async function(){
                    if (check_true (((tokens instanceof Object)&& await not((tokens instanceof Array))&& await not(((tokens && tokens["type"])==="arr"))))) {
                        {
                            needs_await=false;
                            return acc=await (async function(){
                                 return await compile(tokens,ctx) 
                            })()
                        }
                    } else if (check_true (((tokens instanceof Object)&& ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["type"])==="fun")))) {
                        {
                            needs_await=false;
                            acc=await (async function(){
                                 return await compile(tokens,ctx) 
                            })()
                        }
                    } else if (check_true ((await (async function(){
                        let __array_op_rval__217=is_block_ques_;
                         if (__array_op_rval__217 instanceof Function){
                            return await __array_op_rval__217(tokens) 
                        } else {
                            return [__array_op_rval__217,tokens]
                        }
                    })()|| (opts && opts["force"])))) {
                        {
                            ctx=await new_ctx(ctx);
                            await set_new_completion_scope(ctx);
                            await async function(){
                                ctx["block_step"]=0;
                                return ctx;
                                
                            }();
                            acc=await (async function(){
                                let __array_op_rval__219=(preamble && preamble["2"]);
                                 if (__array_op_rval__219 instanceof Function){
                                    return await __array_op_rval__219("(",(preamble && preamble["1"])," ","function","()","{",await (async function(){
                                         return await compile(tokens,ctx) 
                                    })(),"}",")","()") 
                                } else {
                                    return [__array_op_rval__219,"(",(preamble && preamble["1"])," ","function","()","{",await (async function(){
                                         return await compile(tokens,ctx) 
                                    })(),"}",")","()"]
                                }
                            })()
                        }
                    } else if (check_true (((tokens instanceof Object)&& ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["name"])==="if")&& ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["type"])==="special")))) {
                        {
                            ctx=await new_ctx(ctx);
                            await set_new_completion_scope(ctx);
                            await async function(){
                                ctx["block_step"]=0;
                                return ctx;
                                
                            }();
                            await (async function() {
                                let __for_body__223=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__224=[],__elements__222=await (async function(){
                                    let __array_op_rval__225=(preamble && preamble["2"]);
                                     if (__array_op_rval__225 instanceof Function){
                                        return await __array_op_rval__225("(",(preamble && preamble["1"])," ","function","()","{",await compile_if((tokens && tokens["val"]),ctx),"}",")","()") 
                                    } else {
                                        return [__array_op_rval__225,"(",(preamble && preamble["1"])," ","function","()","{",await compile_if((tokens && tokens["val"]),ctx),"}",")","()"]
                                    }
                                })();
                                let __BREAK__FLAG__=false;
                                for(let __iter__221 in __elements__222) {
                                    __array__224.push(await __for_body__223(__elements__222[__iter__221]));
                                    if(__BREAK__FLAG__) {
                                         __array__224.pop();
                                        break;
                                        
                                    }
                                }return __array__224;
                                 
                            })()
                        }
                    } else if (check_true (((tokens instanceof Array)&& (((tokens && tokens["0"] && tokens["0"]["type"])==="fun")|| ((tokens && tokens["0"] && tokens["0"]["type"])==="asf")|| ((tokens && tokens["0"] && tokens["0"]["type"])==="function"))))) {
                        {
                            needs_await=false;
                            acc=await (async function(){
                                 return await compile(tokens,ctx) 
                            })()
                        }
                    } else if (check_true ((tokens instanceof Array))) {
                        {
                            ctx=await new_ctx(ctx);
                            await set_new_completion_scope(ctx);
                            acc=await compile_block_to_anon_fn(tokens,ctx)
                        }
                    } else if (check_true (((tokens instanceof Object)&& ((tokens && tokens["type"])==="arr")&& (((tokens && tokens["val"] && tokens["val"]["length"])===0)|| ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["type"])==="literal")|| (((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["type"])==="arg")|| (((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["type"])==="special")&& await not(await contains_ques_((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["name"]),["if","try","do","progn","let","cond"])))))))) {
                        {
                            needs_await=false;
                            acc=await (async function(){
                                 return await compile(tokens,ctx) 
                            })()
                        }
                    } else if (check_true (((tokens instanceof Object)&& (tokens && tokens["val"])&& ((tokens && tokens["type"])==="arr")))) {
                        {
                            ctx=await new_ctx(ctx);
                            await set_new_completion_scope(ctx);
                            acc=await compile_block_to_anon_fn((tokens && tokens["val"]),ctx)
                        }
                    } else {
                        acc=await (async function(){
                             return await compile(tokens,ctx) 
                        })()
                    }
                } ();
                if (check_true (needs_await)){
                    return [(preamble && preamble["0"])," ",acc]
                } else {
                    return acc
                }
            };
            compile_block_to_anon_fn=async function(tokens,ctx,opts) {
                let acc;
                let preamble;
                acc=[];
                preamble=await calling_preamble(ctx);
                ctx=await new_ctx(ctx);
                await async function(){
                    ctx["return_point"]=0;
                    return ctx;
                    
                }();
                await async function(){
                    ctx["block_step"]=0;
                    return ctx;
                    
                }();
                await async function(){
                    if (check_true (await (async function(){
                        let __array_op_rval__228=is_block_ques_;
                         if (__array_op_rval__228 instanceof Function){
                            return await __array_op_rval__228(tokens) 
                        } else {
                            return [__array_op_rval__228,tokens]
                        }
                    })())) {
                        {
                            await async function(){
                                ctx["return_last_value"]=true;
                                return ctx;
                                
                            }();
                            await async function(){
                                ctx["return_point"]=0;
                                return ctx;
                                
                            }();
                            return await (async function() {
                                let __for_body__233=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__234=[],__elements__232=["(",(preamble && preamble["1"])," ","function","()",await compile_block(tokens,ctx),")","()"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__231 in __elements__232) {
                                    __array__234.push(await __for_body__233(__elements__232[__iter__231]));
                                    if(__BREAK__FLAG__) {
                                         __array__234.pop();
                                        break;
                                        
                                    }
                                }return __array__234;
                                 
                            })()
                        }
                    } else if (check_true ((((tokens && tokens["0"] && tokens["0"]["name"])==="let")&& ((tokens && tokens["0"] && tokens["0"]["type"])==="special")))) {
                        {
                            await async function(){
                                ctx["return_last_value"]=true;
                                return ctx;
                                
                            }();
                            await async function(){
                                ctx["return_point"]=0;
                                return ctx;
                                
                            }();
                            await (async function() {
                                let __for_body__239=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__240=[],__elements__238=["(",(preamble && preamble["1"])," ","function","()",await (async function(){
                                     return await compile(tokens,ctx) 
                                })(),")","()"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__237 in __elements__238) {
                                    __array__240.push(await __for_body__239(__elements__238[__iter__237]));
                                    if(__BREAK__FLAG__) {
                                         __array__240.pop();
                                        break;
                                        
                                    }
                                }return __array__240;
                                 
                            })()
                        }
                    } else if (check_true ((((tokens && tokens["0"] && tokens["0"]["type"])==="special")&& (((tokens && tokens["0"] && tokens["0"]["name"])==="if")|| ((tokens && tokens["0"] && tokens["0"]["name"])==="try"))))) {
                        {
                            await (async function() {
                                let __for_body__243=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__244=[],__elements__242=["(",(preamble && preamble["1"])," ","function","() { ",await (async function(){
                                     return await compile(tokens,ctx) 
                                })(),"})","()"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__241 in __elements__242) {
                                    __array__244.push(await __for_body__243(__elements__242[__iter__241]));
                                    if(__BREAK__FLAG__) {
                                         __array__244.pop();
                                        break;
                                        
                                    }
                                }return __array__244;
                                 
                            })()
                        }
                    } else {
                        {
                            await async function(){
                                ctx["return_last_value"]=true;
                                return ctx;
                                
                            }();
                            await async function(){
                                ctx["return_point"]=0;
                                return ctx;
                                
                            }();
                            await (async function() {
                                let __for_body__249=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__250=[],__elements__248=["(",(preamble && preamble["1"])," ","function","()","{"," ","return"," ",await (async function(){
                                     return await compile(tokens,ctx) 
                                })()," ","}",")","()"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__247 in __elements__248) {
                                    __array__250.push(await __for_body__249(__elements__248[__iter__247]));
                                    if(__BREAK__FLAG__) {
                                         __array__250.pop();
                                        break;
                                        
                                    }
                                }return __array__250;
                                 
                            })()
                        }
                    }
                } ();
                return acc
            };
            make_do_block=async function(tokens) {
                let preamble;
                let place;
                preamble=await (async function(){
                     return await clone({
                        type:"arr",ref:false,name:null,val:[]
                    }) 
                })();
                place=(preamble && preamble["val"]);
                (place).push({
                    type:"special",val:await (async function(){
                         return "=:do" 
                    })(),ref:true,name:"do"
                });
                await async function(){
                    if (check_true ((tokens instanceof Array))) {
                        return await (async function() {
                            let __for_body__253=async function(token) {
                                return (place).push(token)
                            };
                            let __array__254=[],__elements__252=tokens;
                            let __BREAK__FLAG__=false;
                            for(let __iter__251 in __elements__252) {
                                __array__254.push(await __for_body__253(__elements__252[__iter__251]));
                                if(__BREAK__FLAG__) {
                                     __array__254.pop();
                                    break;
                                    
                                }
                            }return __array__254;
                             
                        })()
                    } else {
                        await (async function() {
                            let __for_body__257=async function(token) {
                                return (place).push(token)
                            };
                            let __array__258=[],__elements__256=await (async function(){
                                let __array_op_rval__259=tokens;
                                 if (__array_op_rval__259 instanceof Function){
                                    return await __array_op_rval__259() 
                                } else {
                                    return [__array_op_rval__259]
                                }
                            })();
                            let __BREAK__FLAG__=false;
                            for(let __iter__255 in __elements__256) {
                                __array__258.push(await __for_body__257(__elements__256[__iter__255]));
                                if(__BREAK__FLAG__) {
                                     __array__258.pop();
                                    break;
                                    
                                }
                            }return __array__258;
                             
                        })()
                    }
                } ();
                return preamble
            };
            push_as_arg_list=async function(place,args) {
                await map(async function(v,i,t) {
                    (place).push(v);
                    if (check_true ((i<=(t- 2)))){
                        {
                            return (place).push(",")
                        }
                    }
                },args);
                return place
            };
            compile_new=async function(tokens,ctx) {
                let acc;
                let prebuild;
                let target_type;
                let comps;
                let type_details;
                let root_type_details;
                let target_return_type;
                let new_arg_name;
                let args;
                let preamble;
                let new_opts;
                acc=[];
                prebuild=[];
                target_type=await clean_quoted_reference(await sanitize_js_ref_name((tokens && tokens["1"] && tokens["1"]["name"])));
                comps=await (await Environment.get_global("get_object_path"))(target_type);
                type_details=await get_declaration_details(ctx,target_type);
                root_type_details=await (async function(){
                    if (check_true (((comps && comps.length)>1))){
                        return await get_declaration_details(ctx,(comps && comps["0"]))
                    } else {
                        return null
                    }
                })();
                target_return_type=null;
                new_arg_name=null;
                args=[];
                ctx=await new_ctx(ctx);
                preamble=await calling_preamble(ctx);
                new_opts=await tokens["slice"].call(tokens,2);
                if (check_true (((comps && comps.length)>1))){
                    {
                        target_type=await (async function(){
                             return await (await Environment.get_global("path_to_js_syntax"))(comps) 
                        })()
                    }
                };
                await (async function() {
                    let __for_body__262=async function(opt_token) {
                        return (args).push(await compile_wrapper_fn(opt_token,ctx))
                    };
                    let __array__263=[],__elements__261=(new_opts|| []);
                    let __BREAK__FLAG__=false;
                    for(let __iter__260 in __elements__261) {
                        __array__263.push(await __for_body__262(__elements__261[__iter__260]));
                        if(__BREAK__FLAG__) {
                             __array__263.pop();
                            break;
                            
                        }
                    }return __array__263;
                     
                })();
                await async function(){
                    if (check_true ((await not((null==(type_details && type_details["value"])))&& (type_details && type_details["declared_global"])))) {
                        {
                            await (async function() {
                                let __for_body__266=async function(arg) {
                                    return (acc).push(arg)
                                };
                                let __array__267=[],__elements__265=["new"," ",await (async function(){
                                     return await compile((tokens && tokens["1"]),ctx) 
                                })(),"("];
                                let __BREAK__FLAG__=false;
                                for(let __iter__264 in __elements__265) {
                                    __array__267.push(await __for_body__266(__elements__265[__iter__264]));
                                    if(__BREAK__FLAG__) {
                                         __array__267.pop();
                                        break;
                                        
                                    }
                                }return __array__267;
                                 
                            })();
                            await push_as_arg_list(acc,args);
                            return (acc).push(")")
                        }
                    } else if (check_true ((await not((null==(type_details && type_details["value"])))&& (type_details && type_details["value"]) instanceof Function))) {
                        {
                            await (async function() {
                                let __for_body__270=async function(arg) {
                                    return (acc).push(arg)
                                };
                                let __array__271=[],__elements__269=["new"," ",target_type,"("];
                                let __BREAK__FLAG__=false;
                                for(let __iter__268 in __elements__269) {
                                    __array__271.push(await __for_body__270(__elements__269[__iter__268]));
                                    if(__BREAK__FLAG__) {
                                         __array__271.pop();
                                        break;
                                        
                                    }
                                }return __array__271;
                                 
                            })();
                            await push_as_arg_list(acc,args);
                            (acc).push(")")
                        }
                    } else if (check_true (((null==(type_details && type_details["value"]))&& await not((null==(root_type_details && root_type_details["value"])))))) {
                        {
                            await (async function() {
                                let __for_body__274=async function(arg) {
                                    return (acc).push(arg)
                                };
                                let __array__275=[],__elements__273=["(",(preamble && preamble["0"])," ",env_ref,"get_global","(","\"","indirect_new","\"",")",")","(",target_type];
                                let __BREAK__FLAG__=false;
                                for(let __iter__272 in __elements__273) {
                                    __array__275.push(await __for_body__274(__elements__273[__iter__272]));
                                    if(__BREAK__FLAG__) {
                                         __array__275.pop();
                                        break;
                                        
                                    }
                                }return __array__275;
                                 
                            })();
                            if (check_true (((args && args.length)>0))){
                                {
                                    (acc).push(",");
                                    await push_as_arg_list(acc,args)
                                }
                            };
                            (acc).push(")")
                        }
                    }
                } ();
                target_return_type=(await get_ctx_val(ctx,target_type)|| await (async function(){
                    let __targ__276=(await get_declarations(ctx,target_type)|| new Object());
                    if (__targ__276){
                         return(__targ__276)["type"]
                    } 
                })()|| await (await Environment.get_global("get_outside_global"))(target_type)|| UnknownType);
                (acc).unshift({
                    ctype:target_return_type
                });
                return acc
            };
            compile_val_mod=async function(tokens,ctx) {
                let target_location;
                let target;
                let in_infix;
                let operation;
                let mod_source;
                let how_much;
                target_location=await (async function(){
                     return await async function(){
                        if (check_true (await get_ctx(ctx,(tokens && tokens["1"] && tokens["1"]["name"])))) {
                            return "local"
                        } else if (check_true (await get_lisp_ctx((tokens && tokens["1"] && tokens["1"]["name"])))) {
                            return "global"
                        }
                    } () 
                })();
                target=(tokens && tokens["1"] && tokens["1"]["name"]);
                in_infix=await get_ctx_val(ctx,"__COMP_INFIX_OPS__");
                operation=await (async function(){
                    if (check_true (in_infix)){
                        return await async function(){
                            if (check_true (((tokens && tokens["0"] && tokens["0"]["name"])==="inc"))) {
                                return "+"
                            } else if (check_true (((tokens && tokens["0"] && tokens["0"]["name"])==="dec"))) {
                                return "-"
                            } else {
                                throw new Error(("Invalid value modification operator: "+ (tokens && tokens["0"] && tokens["0"]["name"])));
                                
                            }
                        } ()
                    } else {
                        return await async function(){
                            if (check_true (((target_location==="local")&& ((tokens && tokens["0"] && tokens["0"]["name"])==="inc")))) {
                                return "+="
                            } else if (check_true (((target_location==="local")&& ((tokens && tokens["0"] && tokens["0"]["name"])==="dec")))) {
                                return "-="
                            } else if (check_true (((tokens && tokens["0"] && tokens["0"]["name"])==="inc"))) {
                                return "+"
                            } else {
                                return "-"
                            }
                        } ()
                    }
                })();
                mod_source=null;
                how_much=(((tokens && tokens["2"])&& await (async function(){
                     return await compile((tokens && tokens["2"]),ctx) 
                })())|| 1);
                return await async function(){
                    if (check_true ((target_location==="global"))) {
                        {
                            has_lisp_globals=true;
                            return ["(","await"," ",env_ref,"set_global(\"",target,"\",","await"," ",env_ref,"get_global(\"",target,"\")"," ",operation," ",how_much,"))"]
                        }
                    } else if (check_true (in_infix)) {
                        {
                            return ["(",target,"=",target,operation,how_much,")"]
                        }
                    } else {
                        return await (async function(){
                            let __array_op_rval__277=target;
                             if (__array_op_rval__277 instanceof Function){
                                return await __array_op_rval__277(operation,how_much) 
                            } else {
                                return [__array_op_rval__277,operation,how_much]
                            }
                        })()
                    }
                } ()
            };
            compile_try=async function(tokens,ctx) {
                if (check_true ((null==(ctx && ctx["block_step"])))){
                    return await compile_block(await ensure_block(tokens),ctx)
                } else {
                    return await compile_try_inner(tokens,ctx)
                }
            };
            compile_try_inner=async function(tokens,ctx) {
                let acc;
                let try_block;
                let compiled_try_block;
                let catch_block;
                let idx;
                let exception_ref;
                let base_error_caught;
                let catch_stmts;
                let catches;
                let compile_catch;
                acc=[];
                try_block=(tokens && tokens["1"] && tokens["1"]["val"]);
                compiled_try_block=null;
                catch_block=null;
                idx=-1;
                exception_ref=await gen_temp_name("exception");
                base_error_caught=false;
                catch_stmts=[];
                catches=await tokens["slice"].call(tokens,2);
                compile_catch=async function(catch_block) {
                    let throwable_type;
                    let throwable_ref;
                    let catch_statements;
                    let stmts;
                    let subacc;
                    throwable_type=(catch_block && catch_block["1"] && catch_block["1"]["name"]);
                    throwable_ref=(catch_block && catch_block["2"] && catch_block["2"]["val"] && catch_block["2"]["val"]["0"] && catch_block["2"]["val"]["0"]["name"]);
                    catch_statements=(catch_block && catch_block["3"]);
                    stmts=null;
                    subacc=[];
                    ctx=await new_ctx(ctx);
                    await set_ctx(ctx,throwable_ref,(await Environment.get_global("indirect_new"))(catch_block['1'].name));
                    if (check_true ((throwable_type==="Error"))){
                        {
                            base_error_caught=true
                        }
                    };
                    stmts=await compile_block(await ensure_block(catch_statements),ctx);
                    if (check_true ((idx>0))){
                        (subacc).push([" ","else"," "])
                    };
                    (subacc).push(["if (",exception_ref," instanceof ",throwable_type,") ","{","let ",throwable_ref,"=",exception_ref,";",stmts,"}"]);
                    if (check_true (((idx===((catches && catches.length)- 1))&& await not(base_error_caught)))){
                        {
                            (subacc).push([" ","else"," "]);
                            (subacc).push(await (async function(){
                                 return [{
                                    completion:"throw"
                                },"throw"," ",exception_ref,";"] 
                            })())
                        }
                    };
                    return subacc
                };
                await async function(){
                    if (check_true ((null==try_block))) {
                        throw new SyntaxError("invalid try form: missing try block");
                        
                    } else if (check_true (((null==catches)|| ((catches && catches.length)<1)))) {
                        throw new SyntaxError("invalid catch block: missing catch");
                        
                    }
                } ();
                compiled_try_block=await compile_block(await ensure_block(try_block),ctx);
                (acc).push({
                    ctype:"tryblock"
                });
                (acc).push(["try"," ",compiled_try_block]);
                (catch_stmts).push([" ","catch"," ","(",exception_ref,")"," "]);
                (catch_stmts).push("{");
                await (async function(){
                     let __test_condition__278=async function() {
                        return (idx<((catches && catches.length)- 1))
                    };
                    let __body_ref__279=async function() {
                        idx+=1;
                        catch_block=await (async function(){
                            let __targ__280=catches[idx];
                            if (__targ__280){
                                 return(__targ__280)["val"]
                            } 
                        })();
                        if (check_true ((catch_block instanceof Array))){
                            return (catch_stmts).push(await compile_catch(catch_block))
                        } else {
                            throw new SyntaxError("invalid catch form");
                            
                        }
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__278()) {
                        await __body_ref__279();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                (catch_stmts).push("}");
                (acc).push(catch_stmts);
                return acc
            };
            compile_throw=async function(tokens,ctx) {
                let acc;
                let error_message;
                let mode;
                let cmp_rec;
                let error_instance;
                acc=[];
                error_message=null;
                mode=1;
                cmp_rec=await get_ctx(ctx,"__COMPLETION_SCOPE__");
                error_instance=null;
                await (await Environment.get_global("assert"))(cmp_rec,"compiler error: throw unable to find completion scope in context");
                await async function(){
                    if (check_true (((tokens instanceof Array)&& ((tokens && tokens.length)===2)&& (tokens && tokens["1"] && tokens["1"]["ref"])))) {
                        {
                            mode=0;
                            return error_instance=await (async function(){
                                 return await compile((tokens && tokens["1"]),ctx) 
                            })()
                        }
                    } else if (check_true (((tokens instanceof Array)&& ((tokens && tokens.length)===3)))) {
                        {
                            error_instance=await (async function(){
                                 return await compile((tokens && tokens["1"]),ctx) 
                            })();
                            error_message=await (async function(){
                                 return await compile((tokens && tokens["2"]),ctx) 
                            })()
                        }
                    } else if (check_true (((tokens instanceof Array)&& ((tokens && tokens.length)===2)))) {
                        {
                            error_message=await (async function(){
                                 return await compile((tokens && tokens["1"]),ctx) 
                            })();
                            error_instance="Error"
                        }
                    } else {
                        throw new SyntaxError("Invalid Throw Syntax");
                        
                    }
                } ();
                if (check_true ((mode===0))){
                    await (async function() {
                        let __for_body__283=async function(t) {
                            return (acc).push(t)
                        };
                        let __array__284=[],__elements__282=await (async function(){
                             return [{
                                completion:"throw"
                            },"throw"," ",error_instance,";"] 
                        })();
                        let __BREAK__FLAG__=false;
                        for(let __iter__281 in __elements__282) {
                            __array__284.push(await __for_body__283(__elements__282[__iter__281]));
                            if(__BREAK__FLAG__) {
                                 __array__284.pop();
                                break;
                                
                            }
                        }return __array__284;
                         
                    })()
                } else {
                    await (async function() {
                        let __for_body__287=async function(t) {
                            return (acc).push(t)
                        };
                        let __array__288=[],__elements__286=await (async function(){
                             return [{
                                completion:"throw"
                            },"throw"," ","new"," ",error_instance,"(",error_message,")",";"] 
                        })();
                        let __BREAK__FLAG__=false;
                        for(let __iter__285 in __elements__286) {
                            __array__288.push(await __for_body__287(__elements__286[__iter__285]));
                            if(__BREAK__FLAG__) {
                                 __array__288.pop();
                                break;
                                
                            }
                        }return __array__288;
                         
                    })()
                };
                ((cmp_rec && cmp_rec["completion_records"])).push({
                    block_id:(ctx && ctx["block_id"]),type:"throw",block_step:(ctx && ctx["block_step"]),stmt:acc
                });
                return acc
            };
            compile_break=async function(tokens,ctx) {
                return await (async function(){
                    let __array_op_rval__289=break_out;
                     if (__array_op_rval__289 instanceof Function){
                        return await __array_op_rval__289("=","true",";","return") 
                    } else {
                        return [__array_op_rval__289,"=","true",";","return"]
                    }
                })()
            };
            compile_return=async function(tokens,ctx) {
                let acc;
                let return_val_reference;
                let return_value;
                let cmp_rec;
                acc=[];
                return_val_reference=await gen_temp_name("return");
                return_value=null;
                cmp_rec=await get_ctx(ctx,"__COMPLETION_SCOPE__");
                await (await Environment.get_global("assert"))(cmp_rec,"compiler error: compile_return: no completion scope record found");
                if (check_true (await (async function(){
                    let __array_op_rval__290=is_block_ques_;
                     if (__array_op_rval__290 instanceof Function){
                        return await __array_op_rval__290((tokens && tokens["1"] && tokens["1"]["val"])) 
                    } else {
                        return [__array_op_rval__290,(tokens && tokens["1"] && tokens["1"]["val"])]
                    }
                })())){
                    {
                        (acc).push(["let"," ",return_val_reference,"=",await (async function(){
                             return await compile((tokens && tokens["1"] && tokens["1"]["val"]),ctx) 
                        })(),";"]);
                        (acc).push(await (async function(){
                             return [{
                                completion:"return"
                            },"return"," ",return_val_reference,";"] 
                        })())
                    }
                } else {
                    {
                        await (async function() {
                            let __for_body__293=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__294=[],__elements__292=["return"," ",await (async function(){
                                 return await compile((tokens && tokens["1"]),ctx) 
                            })(),";"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__291 in __elements__292) {
                                __array__294.push(await __for_body__293(__elements__292[__iter__291]));
                                if(__BREAK__FLAG__) {
                                     __array__294.pop();
                                    break;
                                    
                                }
                            }return __array__294;
                             
                        })()
                    }
                };
                ((cmp_rec && cmp_rec["completion_records"])).push({
                    block_id:(ctx && ctx["block_id"]),block_step:(ctx && ctx["block_step"]),type:"return",stmt:await last(acc)
                });
                return acc
            };
            apply_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"compile_apply",background:"sienna",color:"white"
                    })
                }
            })();
            compile_apply=async function(tokens,ctx) {
                let acc;
                let fn_ref;
                let complex_ques_;
                let args_ref;
                let function_ref;
                let target_argument_ref;
                let target_arg;
                let ctype;
                let preceding_arg_ref;
                let preamble;
                let requires_await;
                let compiled_fun_resolver;
                let args;
                acc=[];
                fn_ref=(tokens && tokens["1"]);
                complex_ques_=false;
                args_ref=await gen_temp_name("apply_args");
                function_ref=await gen_temp_name("apply_fn");
                target_argument_ref=null;
                target_arg=null;
                ctype=null;
                preceding_arg_ref=null;
                preamble=await calling_preamble(ctx);
                requires_await=false;
                ctx=await new_ctx(ctx);
                compiled_fun_resolver=null;
                args=await tokens["slice"].call(tokens,2);
                ;
                await set_new_completion_scope(ctx);
                if (check_true ((args&& ((args && args.length)===1)))){
                    {
                        args=await first(args)
                    }
                };
                function_ref=await compile_wrapper_fn(fn_ref,ctx);
                if (check_true ((fn_ref && fn_ref["ref"]))){
                    {
                        ctype=await get_declaration_details(ctx,(fn_ref && fn_ref["name"]))
                    }
                };
                if (check_true ((ctype && ctype["value"]) instanceof Function)){
                    {
                        requires_await=true
                    }
                };
                if (check_true ((args instanceof Array))){
                    {
                        target_argument_ref=await gen_temp_name("target_arg");
                        target_arg=(args).pop();
                        await (async function() {
                            let __for_body__297=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__298=[],__elements__296=["let"," ",target_argument_ref,"=","[]",".concat","(",await (async function(){
                                 return await compile(target_arg,ctx) 
                            })(),")",";"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__295 in __elements__296) {
                                __array__298.push(await __for_body__297(__elements__296[__iter__295]));
                                if(__BREAK__FLAG__) {
                                     __array__298.pop();
                                    break;
                                    
                                }
                            }return __array__298;
                             
                        })();
                        await (async function() {
                            let __for_body__301=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__302=[],__elements__300=["if","(","!",target_argument_ref," ","instanceof"," ","Array",")","{","throw"," ","new"," ","TypeError","(","\"Invalid final argument to apply - an array is required\"",")","}"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__299 in __elements__300) {
                                __array__302.push(await __for_body__301(__elements__300[__iter__299]));
                                if(__BREAK__FLAG__) {
                                     __array__302.pop();
                                    break;
                                    
                                }
                            }return __array__302;
                             
                        })();
                        await (async function() {
                            let __for_body__305=async function(token) {
                                preceding_arg_ref=await gen_temp_name("pre_arg");
                                if (check_true (await (async function(){
                                    let __array_op_rval__307=is_form_ques_;
                                     if (__array_op_rval__307 instanceof Function){
                                        return await __array_op_rval__307(token) 
                                    } else {
                                        return [__array_op_rval__307,token]
                                    }
                                })())){
                                    {
                                        await (async function() {
                                            let __for_body__310=async function(t) {
                                                return (acc).push(t)
                                            };
                                            let __array__311=[],__elements__309=["let"," ",preceding_arg_ref,"=",await compile_wrapper_fn((token && token["val"]),ctx),";"];
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__308 in __elements__309) {
                                                __array__311.push(await __for_body__310(__elements__309[__iter__308]));
                                                if(__BREAK__FLAG__) {
                                                     __array__311.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__311;
                                             
                                        })()
                                    }
                                } else {
                                    preceding_arg_ref=await compile_wrapper_fn(token,ctx)
                                };
                                return (acc).push(await (async function(){
                                    let __array_op_rval__312=target_argument_ref;
                                     if (__array_op_rval__312 instanceof Function){
                                        return await __array_op_rval__312(".unshift","(",preceding_arg_ref,")",";") 
                                    } else {
                                        return [__array_op_rval__312,".unshift","(",preceding_arg_ref,")",";"]
                                    }
                                })())
                            };
                            let __array__306=[],__elements__304=args;
                            let __BREAK__FLAG__=false;
                            for(let __iter__303 in __elements__304) {
                                __array__306.push(await __for_body__305(__elements__304[__iter__303]));
                                if(__BREAK__FLAG__) {
                                     __array__306.pop();
                                    break;
                                    
                                }
                            }return __array__306;
                             
                        })();
                        await (async function() {
                            let __for_body__315=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__316=[],__elements__314=["return"," ","(",function_ref,")",".","apply","(","this",",",target_argument_ref,")"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__313 in __elements__314) {
                                __array__316.push(await __for_body__315(__elements__314[__iter__313]));
                                if(__BREAK__FLAG__) {
                                     __array__316.pop();
                                    break;
                                    
                                }
                            }return __array__316;
                             
                        })()
                    }
                } else {
                    {
                        if (check_true (await (async function(){
                            let __array_op_rval__317=is_form_ques_;
                             if (__array_op_rval__317 instanceof Function){
                                return await __array_op_rval__317(args) 
                            } else {
                                return [__array_op_rval__317,args]
                            }
                        })())){
                            {
                                await (async function() {
                                    let __for_body__320=async function(t) {
                                        return (acc).push(t)
                                    };
                                    let __array__321=[],__elements__319=["let"," ",args_ref,"=",await compile_wrapper_fn((args && args["val"]),ctx),";"];
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__318 in __elements__319) {
                                        __array__321.push(await __for_body__320(__elements__319[__iter__318]));
                                        if(__BREAK__FLAG__) {
                                             __array__321.pop();
                                            break;
                                            
                                        }
                                    }return __array__321;
                                     
                                })();
                                complex_ques_=true
                            }
                        };
                        await (async function() {
                            let __for_body__324=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__325=[],__elements__323=["return"," ","("," ",function_ref,")",".","apply","(","this"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__322 in __elements__323) {
                                __array__325.push(await __for_body__324(__elements__323[__iter__322]));
                                if(__BREAK__FLAG__) {
                                     __array__325.pop();
                                    break;
                                    
                                }
                            }return __array__325;
                             
                        })();
                        if (check_true (args)){
                            {
                                (acc).push(",");
                                if (check_true (complex_ques_)){
                                    (acc).push(args_ref)
                                } else {
                                    (acc).push(await compile_wrapper_fn(args,ctx))
                                }
                            }
                        };
                        (acc).push(")")
                    }
                };
                return [(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()","{",acc,"}",")","()"]
            };
            compile_call=async function(tokens,ctx) {
                let preamble;
                let simple_target_ques_;
                let simple_method_ques_;
                preamble=await calling_preamble(ctx);
                simple_target_ques_=await (async function(){
                    if (check_true (((tokens && tokens["1"] && tokens["1"]["ref"])===true))){
                        return true
                    } else {
                        return false
                    }
                })();
                simple_method_ques_=await (async function(){
                    if (check_true (((tokens && tokens["2"] && tokens["2"]["type"])==="literal"))){
                        return true
                    } else {
                        return false
                    }
                })();
                ctx=ctx;
                ;
                return await async function(){
                    if (check_true ((simple_target_ques_&& simple_method_ques_))) {
                        return await compile_call_inner(tokens,ctx,{
                            type:0,preamble:preamble
                        })
                    } else if (check_true (simple_target_ques_)) {
                        return await compile_call_inner(tokens,ctx,{
                            type:0,preamble:preamble
                        })
                    } else {
                        {
                            ctx=await new_ctx(ctx);
                            await set_new_completion_scope(ctx);
                            return [(preamble && preamble["2"]),(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()"," ","{",await compile_call_inner(tokens,ctx,{
                                type:2,preamble:preamble
                            })," ","}",")","()"]
                        }
                    }
                } ()
            };
            compile_call_inner=async function(tokens,ctx,opts) {
                let acc;
                let target;
                let idx;
                let preamble;
                let add_args;
                let method;
                acc=[];
                target=null;
                idx=-1;
                preamble=(opts && opts["preamble"]);
                add_args=async function() {
                    return await (async function() {
                        let __for_body__328=async function(token) {
                            (acc).push(",");
                            return (acc).push(await compile_wrapper_fn(token,ctx))
                        };
                        let __array__329=[],__elements__327=await tokens["slice"].call(tokens,3);
                        let __BREAK__FLAG__=false;
                        for(let __iter__326 in __elements__327) {
                            __array__329.push(await __for_body__328(__elements__327[__iter__326]));
                            if(__BREAK__FLAG__) {
                                 __array__329.pop();
                                break;
                                
                            }
                        }return __array__329;
                         
                    })()
                };
                method=null;
                if (check_true (((tokens && tokens.length)<3))){
                    {
                        throw new SyntaxError(("call: missing arguments, requires at least 2"));
                        
                    }
                };
                target=await compile_wrapper_fn((tokens && tokens["1"]),ctx);
                method=await compile_wrapper_fn((tokens && tokens["2"]),ctx);
                await async function(){
                    if (check_true ((((opts && opts["type"])===0)|| ((opts && opts["type"])===1)))) {
                        {
                            return await async function(){
                                if (check_true (((tokens && tokens.length)===3))) {
                                    return await (async function() {
                                        let __for_body__332=async function(t) {
                                            return (acc).push(t)
                                        };
                                        let __array__333=[],__elements__331=await (async function(){
                                            let __array_op_rval__334=(preamble && preamble["0"]);
                                             if (__array_op_rval__334 instanceof Function){
                                                return await __array_op_rval__334(" ",target,"[",method,"]","()") 
                                            } else {
                                                return [__array_op_rval__334," ",target,"[",method,"]","()"]
                                            }
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__330 in __elements__331) {
                                            __array__333.push(await __for_body__332(__elements__331[__iter__330]));
                                            if(__BREAK__FLAG__) {
                                                 __array__333.pop();
                                                break;
                                                
                                            }
                                        }return __array__333;
                                         
                                    })()
                                } else {
                                    {
                                        await (async function() {
                                            let __for_body__337=async function(t) {
                                                return (acc).push(t)
                                            };
                                            let __array__338=[],__elements__336=await (async function(){
                                                let __array_op_rval__339=(preamble && preamble["0"]);
                                                 if (__array_op_rval__339 instanceof Function){
                                                    return await __array_op_rval__339(" ",target,"[",method,"]",".call","(",target) 
                                                } else {
                                                    return [__array_op_rval__339," ",target,"[",method,"]",".call","(",target]
                                                }
                                            })();
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__335 in __elements__336) {
                                                __array__338.push(await __for_body__337(__elements__336[__iter__335]));
                                                if(__BREAK__FLAG__) {
                                                     __array__338.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__338;
                                             
                                        })();
                                        await add_args();
                                        return (acc).push(")")
                                    }
                                }
                            } ()
                        }
                    } else if (check_true (((opts && opts["type"])===2))) {
                        {
                            await (async function() {
                                let __for_body__342=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__343=[],__elements__341=["{"," ","let"," ","__call_target__","=",target,","," ","__call_method__","=",method,";"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__340 in __elements__341) {
                                    __array__343.push(await __for_body__342(__elements__341[__iter__340]));
                                    if(__BREAK__FLAG__) {
                                         __array__343.pop();
                                        break;
                                        
                                    }
                                }return __array__343;
                                 
                            })();
                            await async function(){
                                if (check_true (((tokens && tokens.length)===3))) {
                                    return await (async function() {
                                        let __for_body__346=async function(t) {
                                            return (acc).push(t)
                                        };
                                        let __array__347=[],__elements__345=["return"," ",(preamble && preamble["0"])," ","__call_target__","[","__call_method__","]","()"];
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__344 in __elements__345) {
                                            __array__347.push(await __for_body__346(__elements__345[__iter__344]));
                                            if(__BREAK__FLAG__) {
                                                 __array__347.pop();
                                                break;
                                                
                                            }
                                        }return __array__347;
                                         
                                    })()
                                } else {
                                    {
                                        await (async function() {
                                            let __for_body__350=async function(t) {
                                                return (acc).push(t)
                                            };
                                            let __array__351=[],__elements__349=["return"," ",(preamble && preamble["0"])," ","__call_target__","[","__call_method__","]",".","call","(","__call_target__"];
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__348 in __elements__349) {
                                                __array__351.push(await __for_body__350(__elements__349[__iter__348]));
                                                if(__BREAK__FLAG__) {
                                                     __array__351.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__351;
                                             
                                        })();
                                        await add_args();
                                        (acc).push(")")
                                    }
                                }
                            } ();
                            (acc).push("}")
                        }
                    }
                } ();
                return acc
            };
            check_needs_wrap=async function(stmts) {
                let fst;
                fst=(((stmts instanceof Array)&& await first(stmts)&& (await first(stmts) instanceof Object)&& await not(await (async function(){
                    let __targ__352=await first(stmts);
                    if (__targ__352){
                         return(__targ__352)["ctype"]
                    } 
                })() instanceof Function)&& await (async function(){
                    let __targ__353=await first(stmts);
                    if (__targ__353){
                         return(__targ__353)["ctype"]
                    } 
                })()&& await (async function(){
                     return await async function(){
                        if (check_true ((await (async function(){
                            let __targ__354=await first(stmts);
                            if (__targ__354){
                                 return(__targ__354)["ctype"]
                            } 
                        })() instanceof String || typeof await (async function(){
                            let __targ__354=await first(stmts);
                            if (__targ__354){
                                 return(__targ__354)["ctype"]
                            } 
                        })()==='string'))) {
                            return await (async function(){
                                let __targ__355=await first(stmts);
                                if (__targ__355){
                                     return(__targ__355)["ctype"]
                                } 
                            })()
                        } else {
                            return await sub_type(await (async function(){
                                let __targ__356=await first(stmts);
                                if (__targ__356){
                                     return(__targ__356)["ctype"]
                                } 
                            })())
                        }
                    } () 
                })())|| "");
                await console.warn("DEPRECATION: check_needs_wrap called: ",stmts);
                return await async function(){
                    if (check_true (await contains_ques_("block",fst))) {
                        return true
                    } else {
                        return false
                    }
                } ()
            };
            compile_import=async function(tokens,ctx) {
                let symbol_tokens;
                let __symbols__357= async function(){
                    return []
                };
                let from_tokens;
                let from_place;
                let acc;
                {
                    symbol_tokens=(tokens && tokens["1"]);
                    let symbols=await __symbols__357();
                    ;
                    from_tokens=null;
                    from_place=null;
                    acc=[];
                    if (check_true (((tokens && tokens.length)<3))){
                        throw new SyntaxError("import requires exactly two arguments");
                        
                    };
                    symbol_tokens=(tokens && tokens["1"]);
                    from_tokens=(tokens && tokens["2"]);
                    from_place=await (async function(){
                         return await compile(from_tokens,ctx) 
                    })();
                    (acc).push({
                        ctype:"statement",meta:{
                            imported_from:from_place
                        }
                    });
                    (acc).push("import");
                    (acc).push(" ");
                    await async function(){
                        if (check_true (((symbol_tokens && symbol_tokens["val"]) instanceof Array))) {
                            {
                                await (async function() {
                                    let __for_body__360=async function(s) {
                                        return (symbols).push((s && s.name))
                                    };
                                    let __array__361=[],__elements__359=(symbol_tokens && symbol_tokens["val"]);
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__358 in __elements__359) {
                                        __array__361.push(await __for_body__360(__elements__359[__iter__358]));
                                        if(__BREAK__FLAG__) {
                                             __array__361.pop();
                                            break;
                                            
                                        }
                                    }return __array__361;
                                     
                                })();
                                return await (async function() {
                                    let __for_body__364=async function(t) {
                                        return (acc).push(t)
                                    };
                                    let __array__365=[],__elements__363=await flatten(["{"," ",symbols," ","}"," ","from"," ",from_place]);
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__362 in __elements__363) {
                                        __array__365.push(await __for_body__364(__elements__363[__iter__362]));
                                        if(__BREAK__FLAG__) {
                                             __array__365.pop();
                                            break;
                                            
                                        }
                                    }return __array__365;
                                     
                                })()
                            }
                        } else {
                            throw new SyntaxError("import requires an array of imported symbols as a second argument");
                            
                        }
                    } ();
                    return acc
                }
            };
            compile_dynamic_import=async function(tokens,ctx) {
                let from_tokens;
                let preamble;
                let from_place;
                let can_be_static;
                let metaval;
                let imported_from;
                let acc;
                from_tokens=null;
                preamble=await calling_preamble(ctx);
                from_place=null;
                can_be_static=false;
                metaval=null;
                imported_from=null;
                acc=[];
                ;
                from_tokens=(tokens && tokens["1"]);
                from_place=await compile_wrapper_fn(from_tokens,ctx);
                imported_from=await (async function(){
                    if (check_true ((from_place instanceof Array))){
                        return (from_place && from_place["1"])
                    } else {
                        return from_place
                    }
                })();
                if (check_true (((imported_from instanceof String || typeof imported_from==='string')&& await starts_with_ques_("\"",imported_from)&& await (await Environment.get_global("ends_with?"))("\"",imported_from)))){
                    {
                        can_be_static=true;
                        imported_from=await imported_from["substr"].call(imported_from,1,((imported_from && imported_from.length)- 2))
                    }
                };
                await async function(){
                    external_dependencies[imported_from]=true;
                    return external_dependencies;
                    
                }();
                metaval=await (async function(){
                    if (check_true (can_be_static)){
                        return {
                            initializer:await (async function(){
                                 return ["=:javascript","undefined"] 
                            })()
                        }
                    } else {
                        return new Object()
                    }
                })();
                (acc).push({
                    ctype:"statement",meta:metaval
                });
                await (async function() {
                    let __for_body__369=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__370=[],__elements__368=await flatten([(preamble && preamble["0"])," ","import"," ","(",from_place,")"]);
                    let __BREAK__FLAG__=false;
                    for(let __iter__367 in __elements__368) {
                        __array__370.push(await __for_body__369(__elements__368[__iter__367]));
                        if(__BREAK__FLAG__) {
                             __array__370.pop();
                            break;
                            
                        }
                    }return __array__370;
                     
                })();
                return acc
            };
            compile_javascript=async function(tokens,ctx) {
                let acc;
                let text;
                acc=[];
                text=null;
                await (async function() {
                    let __for_body__373=async function(t) {
                        return await async function(){
                            if (check_true ((t && t["ref"]))) {
                                return (acc).push((t && t.name))
                            } else if (check_true (((t && t["val"]) instanceof Array))) {
                                return (acc).push(await (async function(){
                                     return await compile(t,ctx) 
                                })())
                            } else {
                                return (acc).push((t && t["val"]))
                            }
                        } ()
                    };
                    let __array__374=[],__elements__372=(await (await Environment.get_global("rest"))(tokens)|| []);
                    let __BREAK__FLAG__=false;
                    for(let __iter__371 in __elements__372) {
                        __array__374.push(await __for_body__373(__elements__372[__iter__371]));
                        if(__BREAK__FLAG__) {
                             __array__374.pop();
                            break;
                            
                        }
                    }return __array__374;
                     
                })();
                return acc
            };
            compile_set_global=async function(tokens,ctx,opts) {
                let target;
                let wrap_as_function_ques_;
                let preamble;
                let acc;
                let clog;
                let metavalue;
                let assignment_value;
                target=(tokens && tokens["1"] && tokens["1"]["name"]);
                wrap_as_function_ques_=null;
                preamble=await calling_preamble(ctx);
                acc=null;
                clog=await (async function(){
                    if (check_true ((opts && opts["quiet_mode"]))){
                        return log
                    } else {
                        return await defclog({
                            prefix:"compile_set_global",color:"blue",background:"#205020"
                        })
                    }
                })();
                metavalue=null;
                assignment_value=null;
                ;
                has_lisp_globals=true;
                await async function(){
                    let __target_obj__375=(root_ctx && root_ctx["defined_lisp_globals"]);
                    __target_obj__375[target]=AsyncFunction;
                    return __target_obj__375;
                    
                }();
                if (check_true ((tokens && tokens["3"]))){
                    {
                        metavalue=await (async function(){
                            if (check_true (await (async function(){
                                let __array_op_rval__376=is_complex_ques_;
                                 if (__array_op_rval__376 instanceof Function){
                                    return await __array_op_rval__376((tokens && tokens["3"])) 
                                } else {
                                    return [__array_op_rval__376,(tokens && tokens["3"])]
                                }
                            })())){
                                return await compile_wrapper_fn((tokens && tokens["3"]),ctx)
                            } else {
                                return await compile((tokens && tokens["3"]),ctx)
                            }
                        })()
                    }
                };
                assignment_value=await (async function(){
                    return await compile_wrapper_fn((tokens && tokens["2"]),ctx)
                })();
                await async function(){
                    if (check_true ((((assignment_value && assignment_value["0"]) instanceof Object)&& (assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])))) {
                        {
                            if (check_true ((assignment_value && assignment_value["0"] && assignment_value["0"]["meta"]))){
                                {
                                    if (check_true (await not(metavalue))){
                                        {
                                            metavalue=await quote_tree((assignment_value && assignment_value["0"] && assignment_value["0"]["meta"]),ctx)
                                        }
                                    }
                                }
                            };
                            return await async function(){
                                let __target_obj__377=(root_ctx && root_ctx["defined_lisp_globals"]);
                                __target_obj__377[target]=await (async function(){
                                     return await async function(){
                                        if (check_true (((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])==="Function"))) {
                                            return Function
                                        } else if (check_true (((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])==="AsyncFunction"))) {
                                            return AsyncFunction
                                        } else if (check_true (((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])==="Number"))) {
                                            return NumberType
                                        } else if (check_true (((assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])==="expression"))) {
                                            return Expression
                                        } else {
                                            return (assignment_value && assignment_value["0"] && assignment_value["0"]["ctype"])
                                        }
                                    } () 
                                })();
                                return __target_obj__377;
                                
                            }()
                        }
                    } else {
                        {
                            if (check_true (((assignment_value instanceof Array)&& ((assignment_value && assignment_value["0"])==="await")))){
                                {
                                    await async function(){
                                        let __target_obj__378=(root_ctx && root_ctx["defined_lisp_globals"]);
                                        __target_obj__378[target]=AsyncFunction;
                                        return __target_obj__378;
                                        
                                    }();
                                    await set_ambiguous(root_ctx,target)
                                }
                            } else {
                                await async function(){
                                    let __target_obj__379=(root_ctx && root_ctx["defined_lisp_globals"]);
                                    __target_obj__379[target]=assignment_value;
                                    return __target_obj__379;
                                    
                                }()
                            }
                        }
                    }
                } ();
                if (check_true (await verbosity(ctx))){
                    {
                        (clog)("target: ",await (await Environment.get_global("as_lisp"))(target));
                        (clog)("assignment_value: ",await (await Environment.get_global("as_lisp"))(assignment_value))
                    }
                };
                acc=await (async function(){
                     return [{
                        ctype:"statement"
                    },await (async function(){
                        if (check_true (((Function===await (async function(){
                            let __targ__380=(root_ctx && root_ctx["defined_lisp_globals"]);
                            if (__targ__380){
                                 return(__targ__380)[target]
                            } 
                        })())|| await (async function(){
                            let __array_op_rval__381=in_sync_ques_;
                             if (__array_op_rval__381 instanceof Function){
                                return await __array_op_rval__381(ctx) 
                            } else {
                                return [__array_op_rval__381,ctx]
                            }
                        })()))){
                            return ""
                        } else {
                            return "await"
                        }
                    })()," ","Environment",".","set_global","(","","\"",(tokens && tokens["1"] && tokens["1"]["name"]),"\"",",",assignment_value,await (async function(){
                        if (check_true ((metavalue|| (opts && opts["constant"])))){
                            return ","
                        } else {
                            return ""
                        }
                    })(),await (async function(){
                        if (check_true (metavalue)){
                            return metavalue
                        } else {
                            if (check_true ((opts && opts["constant"]))){
                                return "null"
                            } else {
                                return ""
                            }
                        }
                    })(),await (async function(){
                        if (check_true ((opts && opts["constant"]))){
                            return ","
                        } else {
                            return ""
                        }
                    })(),await (async function(){
                        if (check_true ((opts && opts["constant"]))){
                            return "true"
                        } else {
                            return ""
                        }
                    })(),")"] 
                })();
                return acc
            };
            is_token_ques_=async function(t) {
                return (((t instanceof Object)&& (t && t["__token__"]))|| ((t instanceof Array)&& ((t && t["0"]) instanceof Object)&& (t && t["0"] && t["0"]["__token__"])))
            };
            compile_quote=async function(lisp_struct,ctx) {
                let acc;
                acc=[];
                ctx=await new_ctx(ctx);
                acc=await compile_quotem(lisp_struct,ctx);
                return acc
            };
            compile_quotel=async function(lisp_struct,ctx) {
                let acc;
                acc=[];
                acc=await JSON.stringify((lisp_struct && lisp_struct["1"]));
                return await (async function(){
                    let __array_op_rval__382=acc;
                     if (__array_op_rval__382 instanceof Function){
                        return await __array_op_rval__382() 
                    } else {
                        return [__array_op_rval__382]
                    }
                })()
            };
            wrap_and_run=async function(js_code,ctx,run_opts) {
                let __assembly__383= async function(){
                    return null
                };
                let result;
                let fst;
                let ctype;
                let comp_meta;
                let needs_braces_ques_;
                let in_quotem;
                let run_log;
                let needs_return_ques_;
                let assembled;
                {
                    let assembly=await __assembly__383();
                    ;
                    result=null;
                    fst=null;
                    ctype=null;
                    comp_meta=null;
                    needs_braces_ques_=false;
                    in_quotem=await get_ctx(ctx,"__IN_QUOTEM__");
                    run_log=await (async function(){
                        if (check_true ((opts && opts["quiet_mode"]))){
                            return log
                        } else {
                            return await defclog({
                                prefix:"wrap_and_run",background:"#703030",color:"white"
                            })
                        }
                    })();
                    needs_return_ques_=await (async function(){
                        ctype=await (async function(){
                            if (check_true (((js_code instanceof Array)&& await first(js_code)&& (await first(js_code) instanceof Object)&& await (async function(){
                                let __targ__384=await first(js_code);
                                if (__targ__384){
                                     return(__targ__384)["ctype"]
                                } 
                            })()))){
                                return await (async function(){
                                    let __targ__385=await first(js_code);
                                    if (__targ__385){
                                         return(__targ__385)["ctype"]
                                    } 
                                })()
                            }
                        })();
                        if (check_true (((typeof ctype==="object")&& await not((ctype instanceof Object))))){
                            fst=""
                        } else {
                            fst=(""+ (ctype|| ""))
                        };
                        if (check_true (fst instanceof Function)){
                            {
                                fst=await sub_type(fst)
                            }
                        };
                        return await async function(){
                            if (check_true (await contains_ques_("block",fst))) {
                                {
                                    if (check_true ((fst==="ifblock"))){
                                        needs_braces_ques_=true
                                    } else {
                                        needs_braces_ques_=false
                                    };
                                    return false
                                }
                            } else if (check_true ((await first(js_code)==="throw"))) {
                                {
                                    needs_braces_ques_=false;
                                    return false
                                }
                            } else {
                                {
                                    needs_braces_ques_=true;
                                    return true
                                }
                            }
                        } ()
                    })();
                    assembled=null;
                    ;
                    if (check_true ((false&& await not((opts && opts["root_environment"]))&& ((first_level_setup && first_level_setup.length)===0)&& has_lisp_globals))){
                        (first_level_setup).push(["const __GG__=",env_ref,"get_global",";"])
                    };
                    assembled=js_code;
                    if (check_true ((target_namespace&& ((assembled && assembled["0"]) instanceof Object)&& await not((target_namespace===(Environment && Environment["namespace"])))))){
                        {
                            comp_meta=await first(assembled);
                            await async function(){
                                comp_meta["namespace"]=target_namespace;
                                return comp_meta;
                                
                            }();
                            if (check_true ((await verbosity(ctx)&& (comp_meta && comp_meta["namespace"])))){
                                {
                                    (run_log)("specified namespace: ",(comp_meta && comp_meta["namespace"]))
                                }
                            };
                            result=await Environment["evaluate_local"].call(Environment,await (async function(){
                                let __array_op_rval__387=comp_meta;
                                 if (__array_op_rval__387 instanceof Function){
                                    return await __array_op_rval__387(await assemble_output(assembled)) 
                                } else {
                                    return [__array_op_rval__387,await assemble_output(assembled)]
                                }
                            })(),ctx,{
                                compiled_source:true
                            });
                            if (check_true (await verbosity(ctx))){
                                {
                                    (run_log)("<- ",result)
                                }
                            };
                            return result
                        }
                    } else {
                        {
                            assembled=await assemble_output(assembled);
                            assembled=await add(await (async function(){
                                if (check_true (needs_braces_ques_)){
                                    return "{"
                                } else {
                                    return ""
                                }
                            })(),await (async function(){
                                if (check_true (needs_return_ques_)){
                                    return " return "
                                } else {
                                    return ""
                                }
                            })(),assembled,await (async function(){
                                if (check_true (needs_braces_ques_)){
                                    return "}"
                                } else {
                                    return ""
                                }
                            })());
                            if (check_true (await verbosity(ctx))){
                                {
                                    (run_log)("assembled: ",assembled)
                                }
                            };
                            try {
                                assembly=new AsyncFunction("Environment",assembled)
                            } catch (__exception__388) {
                                if (__exception__388 instanceof Error) {
                                    let e=__exception__388;
                                    {
                                        {
                                            throw e;
                                            
                                        }
                                    }
                                }
                            };
                            if (check_true ((run_opts && run_opts["bind_mode"]))){
                                {
                                    assembly=await (await Environment.get_global("bind_function"))(assembly,Environment)
                                }
                            };
                            result=await (async function(){
                                let __array_op_rval__389=assembly;
                                 if (__array_op_rval__389 instanceof Function){
                                    return await __array_op_rval__389(Environment) 
                                } else {
                                    return [__array_op_rval__389,Environment]
                                }
                            })();
                            if (check_true (await verbosity(ctx))){
                                {
                                    (run_log)("<- ",result)
                                }
                            };
                            return result
                        }
                    }
                }
            };
            quote_tree=async function(lisp_tree,ctx,_acc) {
                let acc;
                let mode;
                let in_concat;
                let in_lambda_ques_;
                acc=(_acc|| []);
                mode=0;
                in_concat=false;
                in_lambda_ques_=false;
                await async function(){
                    if (check_true ((lisp_tree instanceof Array))) {
                        {
                            (acc).push("[");
                            await map(async function(elem,i,t) {
                                if (check_true ((mode===1))){
                                    {
                                        return mode=0
                                    }
                                } else {
                                    {
                                        await async function(){
                                            if (check_true ((("=:##"===elem)|| ("=:unquotem"===elem)))) {
                                                {
                                                    if (check_true (in_concat)){
                                                        (acc).push(await compile_wrapper_fn(await tokenize(await (async function(){
                                                             return [lisp_tree[await add(i,1)]] 
                                                        })(),ctx),ctx))
                                                    } else {
                                                        (acc).push(await compile_wrapper_fn(await tokenize(lisp_tree[await add(i,1)],ctx),ctx))
                                                    };
                                                    return mode=1
                                                }
                                            } else if (check_true (("=$,@"===elem))) {
                                                {
                                                    if (check_true (await not(in_concat))){
                                                        (acc).push("].concat(")
                                                    };
                                                    (acc).push(await compile_wrapper_fn(await tokenize(lisp_tree[await add(i,1)],ctx),ctx));
                                                    in_concat=true;
                                                    return mode=1
                                                }
                                            } else {
                                                {
                                                    if (check_true (in_concat)){
                                                        return await quote_tree(await (async function(){
                                                            let __array_op_rval__390=elem;
                                                             if (__array_op_rval__390 instanceof Function){
                                                                return await __array_op_rval__390() 
                                                            } else {
                                                                return [__array_op_rval__390]
                                                            }
                                                        })(),ctx,acc)
                                                    } else {
                                                        return await quote_tree(elem,ctx,acc)
                                                    }
                                                }
                                            }
                                        } ();
                                        if (check_true ((i<(t- 1)))){
                                            return (acc).push(",")
                                        }
                                    }
                                }
                            },lisp_tree);
                            if (check_true ((","===await last(acc)))){
                                (acc).pop()
                            };
                            if (check_true (in_concat)){
                                return (acc).push(")")
                            } else {
                                return (acc).push("]")
                            }
                        }
                    } else if (check_true ((lisp_tree instanceof Object))) {
                        {
                            (acc).push("{ ");
                            await map(async function(k,i,t) {
                                (acc).push(await JSON.stringify(k));
                                (acc).push(":");
                                await quote_tree(lisp_tree[k],ctx,acc);
                                if (check_true ((i<(t- 1)))){
                                    return (acc).push(",")
                                }
                            },await (await Environment.get_global("keys"))(lisp_tree));
                            (acc).push("}")
                        }
                    } else if (check_true ((lisp_tree instanceof String || typeof lisp_tree==='string'))) {
                        (acc).push(await JSON.stringify(lisp_tree))
                    } else {
                        (acc).push(lisp_tree)
                    }
                } ();
                return acc
            };
            quotem_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"compile_quotem",background:"#503090",color:"white"
                    })
                }
            })();
            compile_quotem=async function(lisp_struct,ctx) {
                let acc;
                let quoted_js;
                acc=[];
                ctx=await new_ctx(ctx);
                quoted_js=null;
                await set_ctx(ctx,"__IN_QUOTEM__",true);
                if (check_true (await verbosity(ctx))){
                    {
                        (quotem_log)("->",await (async function(){
                            if (check_true (await get_ctx(ctx,"__IN_LAMBDA__"))){
                                return "[IN LAMBDA]"
                            } else {
                                return ""
                            }
                        })(),await JSON.stringify((lisp_struct && lisp_struct["1"])))
                    }
                };
                if (check_true (await get_ctx(ctx,"__IN_LAMBDA__"))){
                    {
                        quoted_js=await quote_tree((lisp_struct && lisp_struct["1"]),ctx)
                    }
                } else {
                    quoted_js=await quote_tree((lisp_struct && lisp_struct["1"]),ctx)
                };
                if (check_true (await verbosity(ctx))){
                    {
                        (quotem_log)("<-",await (await Environment.get_global("as_lisp"))(quoted_js))
                    }
                };
                return quoted_js
            };
            compile_unquotem=async function(lisp_struct,ctx) {
                let acc;
                acc=[];
                (acc).push(await (async function(){
                     return await compile((lisp_struct && lisp_struct["1"]),ctx) 
                })());
                return acc
            };
            eval_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"compile_eval",background:"#705030",color:"white"
                    })
                }
            })();
            compile_eval=async function(tokens,ctx) {
                let __assembly__391= async function(){
                    return null
                };
                let type_mark;
                let acc;
                let preamble;
                let result;
                {
                    let assembly=await __assembly__391();
                    ;
                    type_mark=null;
                    acc=[];
                    preamble=await calling_preamble(ctx);
                    result=null;
                    ctx=await new_ctx(ctx);
                    await set_new_completion_scope(ctx);
                    assembly=await (async function(){
                         return await compile((tokens && tokens["1"]),ctx) 
                    })();
                    if (check_true (await verbosity(ctx))){
                        {
                            (eval_log)("assembly:",await (async function(){
                                 return await clone(assembly) 
                            })())
                        }
                    };
                    has_lisp_globals=true;
                    result=["(","await"," ","Environment",".","eval","(",(preamble && preamble["0"])," ",(preamble && preamble["1"])," ","function","()",["{","return"," ",assembly,"}","()",")",")"]];
                    return result
                }
            };
            compile_debug=async function(tokens,ctx) {
                return [{
                    ctype:"statement"
                },"debugger",";"]
            };
            compile_for_each=async function(tokens,ctx) {
                let preamble;
                preamble=await calling_preamble(ctx);
                ctx=await new_ctx(ctx);
                ;
                await set_new_completion_scope(ctx);
                return await (async function(){
                    let __array_op_rval__392=(preamble && preamble["2"]);
                     if (__array_op_rval__392 instanceof Function){
                        return await __array_op_rval__392((preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()"," ","{",await compile_for_each_inner(tokens,ctx,preamble)," ","}",")","()") 
                    } else {
                        return [__array_op_rval__392,(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()"," ","{",await compile_for_each_inner(tokens,ctx,preamble)," ","}",")","()"]
                    }
                })()
            };
            compile_for_each_inner=async function(tokens,ctx,preamble) {
                let acc;
                let idx;
                let stmts;
                let idx_iter;
                let idx_iters;
                let element_list;
                let body_function_ref;
                let collector_ref;
                let prebuild;
                let for_args;
                let iterator_ref;
                let elements;
                let iter_count;
                let for_body;
                let body_is_block_ques_;
                acc=[];
                idx=0;
                stmts=[];
                idx_iter=await gen_temp_name("iter");
                idx_iters=[];
                element_list=await gen_temp_name("elements");
                body_function_ref=await gen_temp_name("for_body");
                collector_ref=await gen_temp_name("array");
                prebuild=[];
                for_args=(tokens && tokens["1"] && tokens["1"]["val"]);
                iterator_ref=(for_args && for_args["0"]);
                elements=await last(for_args);
                iter_count=await (async function(){
                    if (check_true (for_args)){
                        return ((for_args && for_args.length)- 1)
                    } else {
                        return 0
                    }
                })();
                for_body=(tokens && tokens["2"]);
                body_is_block_ques_=await (async function(){
                    let __array_op_rval__393=is_block_ques_;
                     if (__array_op_rval__393 instanceof Function){
                        return await __array_op_rval__393((for_body && for_body["val"])) 
                    } else {
                        return [__array_op_rval__393,(for_body && for_body["val"])]
                    }
                })();
                if (check_true ((iter_count<1))){
                    {
                        throw new SyntaxError("Invalid for_each arguments");
                        
                    }
                };
                await (async function() {
                    let __for_body__396=async function(iter_idx) {
                        (idx_iters).push(for_args[iter_idx]);
                        return await set_ctx(ctx,await clean_quoted_reference(await (async function(){
                            let __targ__398=await last(idx_iters);
                            if (__targ__398){
                                 return(__targ__398)["name"]
                            } 
                        })()),ArgumentType)
                    };
                    let __array__397=[],__elements__395=await (await Environment.get_global("range"))(iter_count);
                    let __BREAK__FLAG__=false;
                    for(let __iter__394 in __elements__395) {
                        __array__397.push(await __for_body__396(__elements__395[__iter__394]));
                        if(__BREAK__FLAG__) {
                             __array__397.pop();
                            break;
                            
                        }
                    }return __array__397;
                     
                })();
                await set_ctx(ctx,collector_ref,ArgumentType);
                await set_ctx(ctx,"__LAMBDA_STEP__",-1);
                await set_ctx(ctx,element_list,"arg");
                if (check_true (await not(body_is_block_ques_))){
                    {
                        for_body=await make_do_block(for_body)
                    }
                };
                prebuild=await build_fn_with_assignment(body_function_ref,(for_body && for_body["val"]),idx_iters,ctx);
                await async function(){
                    ctx["return_last_value"]=true;
                    return ctx;
                    
                }();
                (acc).push(await (async function(){
                     return await compile(prebuild,ctx) 
                })());
                await (async function() {
                    let __for_body__402=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__403=[],__elements__401=["let"," ",collector_ref,"=","[]",",",element_list,"=",await compile_wrapper_fn(elements,ctx),";"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__400 in __elements__401) {
                        __array__403.push(await __for_body__402(__elements__401[__iter__400]));
                        if(__BREAK__FLAG__) {
                             __array__403.pop();
                            break;
                            
                        }
                    }return __array__403;
                     
                })();
                await (async function() {
                    let __for_body__406=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__407=[],__elements__405=["let"," ",break_out,"=","false",";"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__404 in __elements__405) {
                        __array__407.push(await __for_body__406(__elements__405[__iter__404]));
                        if(__BREAK__FLAG__) {
                             __array__407.pop();
                            break;
                            
                        }
                    }return __array__407;
                     
                })();
                if (check_true (await (await Environment.get_global("blank?"))((preamble && preamble["0"])))){
                    await set_ctx(ctx,body_function_ref,Function)
                } else {
                    await set_ctx(ctx,body_function_ref,AsyncFunction)
                };
                await async function(){
                    if (check_true ((((for_args && for_args.length)===2)&& await not(((for_args && for_args["1"]) instanceof Array))))) {
                        {
                            await set_ctx(ctx,idx_iter,NumberType);
                            await (async function() {
                                let __for_body__410=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__411=[],__elements__409=["for","(","let"," ",idx_iter," ","in"," ",element_list,")"," ","{"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__408 in __elements__409) {
                                    __array__411.push(await __for_body__410(__elements__409[__iter__408]));
                                    if(__BREAK__FLAG__) {
                                         __array__411.pop();
                                        break;
                                        
                                    }
                                }return __array__411;
                                 
                            })();
                            await (async function() {
                                let __for_body__414=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__415=[],__elements__413=await (async function(){
                                    let __array_op_rval__416=collector_ref;
                                     if (__array_op_rval__416 instanceof Function){
                                        return await __array_op_rval__416(".","push","(",(preamble && preamble["0"])," ",body_function_ref,"(",element_list,"[",idx_iter,"]",")",")",";") 
                                    } else {
                                        return [__array_op_rval__416,".","push","(",(preamble && preamble["0"])," ",body_function_ref,"(",element_list,"[",idx_iter,"]",")",")",";"]
                                    }
                                })();
                                let __BREAK__FLAG__=false;
                                for(let __iter__412 in __elements__413) {
                                    __array__415.push(await __for_body__414(__elements__413[__iter__412]));
                                    if(__BREAK__FLAG__) {
                                         __array__415.pop();
                                        break;
                                        
                                    }
                                }return __array__415;
                                 
                            })();
                            await (async function() {
                                let __for_body__419=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__420=[],__elements__418=["if","(",break_out,")"," ","{"," ",collector_ref,".","pop","()",";","break",";","}"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__417 in __elements__418) {
                                    __array__420.push(await __for_body__419(__elements__418[__iter__417]));
                                    if(__BREAK__FLAG__) {
                                         __array__420.pop();
                                        break;
                                        
                                    }
                                }return __array__420;
                                 
                            })();
                            return (acc).push("}")
                        }
                    }
                } ();
                (acc).push("return");
                (acc).push(" ");
                (acc).push(collector_ref);
                (acc).push(";");
                return acc
            };
            compile_while=async function(tokens,ctx) {
                let acc;
                let idx;
                let preamble;
                let test_condition;
                let test_condition_ref;
                let body;
                let body_ref;
                let prebuild;
                acc=[];
                idx=0;
                ctx=await new_ctx(ctx);
                preamble=await calling_preamble(ctx);
                test_condition=(tokens && tokens["1"]);
                test_condition_ref=await gen_temp_name("test_condition");
                body=(tokens && tokens["2"]);
                body_ref=await gen_temp_name("body_ref");
                prebuild=[];
                ;
                await set_new_completion_scope(ctx);
                await set_ctx(ctx,break_out,true);
                if (check_true ((test_condition && test_condition["ref"]))){
                    (prebuild).push(await (async function(){
                         return await compile(await build_fn_with_assignment(test_condition_ref,(test_condition && test_condition["name"]),null,ctx),ctx) 
                    })())
                } else {
                    (prebuild).push(await (async function(){
                         return await compile(await build_fn_with_assignment(test_condition_ref,(test_condition && test_condition["val"]),null,ctx),ctx) 
                    })())
                };
                (prebuild).push(await (async function(){
                     return await compile(await build_fn_with_assignment(body_ref,(body && body["val"]),null,ctx),ctx) 
                })());
                await (async function() {
                    let __for_body__423=async function(t) {
                        return (prebuild).push(t)
                    };
                    let __array__424=[],__elements__422=["let"," ",break_out,"=","false",";"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__421 in __elements__422) {
                        __array__424.push(await __for_body__423(__elements__422[__iter__421]));
                        if(__BREAK__FLAG__) {
                             __array__424.pop();
                            break;
                            
                        }
                    }return __array__424;
                     
                })();
                await (async function() {
                    let __for_body__427=async function(t) {
                        return (prebuild).push(t)
                    };
                    let __array__428=[],__elements__426=["while","(",(preamble && preamble["0"])," ",test_condition_ref,"()",")"," ","{",(preamble && preamble["0"])," ",body_ref,"()",";"," ","if","(",break_out,")"," ","{"," ","break",";","}","}"," ","",";"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__425 in __elements__426) {
                        __array__428.push(await __for_body__427(__elements__426[__iter__425]));
                        if(__BREAK__FLAG__) {
                             __array__428.pop();
                            break;
                            
                        }
                    }return __array__428;
                     
                })();
                await (async function() {
                    let __for_body__431=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__432=[],__elements__430=[(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()","{"," ",prebuild,"}",")","()"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__429 in __elements__430) {
                        __array__432.push(await __for_body__431(__elements__430[__iter__429]));
                        if(__BREAK__FLAG__) {
                             __array__432.pop();
                            break;
                            
                        }
                    }return __array__432;
                     
                })();
                return acc
            };
            compile_for_with=async function(tokens,ctx,preamble) {
                preamble=await calling_preamble(ctx);
                ctx=await new_ctx(ctx);
                ;
                await set_new_completion_scope(ctx);
                return [(preamble && preamble["2"]),(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()"," ","{",await compile_for_with_inner(tokens,ctx,preamble)," ","}",")","()"]
            };
            compile_for_with_inner=async function(tokens,ctx,preamble) {
                let acc;
                let idx;
                let stmts;
                let iter_ref;
                let idx_iters;
                let generator_expression;
                let body_function_ref;
                let prebuild;
                let for_args;
                let iterator_ref;
                let elements;
                let iter_count;
                let for_body;
                let body_is_block_ques_;
                acc=[];
                idx=0;
                stmts=[];
                iter_ref=await gen_temp_name("iter");
                idx_iters=[];
                generator_expression=await gen_temp_name("elements");
                body_function_ref=await gen_temp_name("for_body");
                prebuild=[];
                for_args=(tokens && tokens["1"] && tokens["1"]["val"]);
                iterator_ref=(for_args && for_args["0"]);
                elements=await last(for_args);
                iter_count=await (async function(){
                    if (check_true (for_args)){
                        return ((for_args && for_args.length)- 1)
                    } else {
                        return 0
                    }
                })();
                for_body=(tokens && tokens["2"]);
                body_is_block_ques_=await (async function(){
                    let __array_op_rval__433=is_block_ques_;
                     if (__array_op_rval__433 instanceof Function){
                        return await __array_op_rval__433((for_body && for_body["val"])) 
                    } else {
                        return [__array_op_rval__433,(for_body && for_body["val"])]
                    }
                })();
                if (check_true ((iter_count<1))){
                    {
                        throw new SyntaxError("Invalid for_each arguments");
                        
                    }
                };
                await (async function() {
                    let __for_body__436=async function(iter_ref) {
                        (idx_iters).push(for_args[iter_ref]);
                        return await set_ctx(ctx,await clean_quoted_reference(await (async function(){
                            let __targ__438=await last(idx_iters);
                            if (__targ__438){
                                 return(__targ__438)["name"]
                            } 
                        })()),ArgumentType)
                    };
                    let __array__437=[],__elements__435=await (await Environment.get_global("range"))(iter_count);
                    let __BREAK__FLAG__=false;
                    for(let __iter__434 in __elements__435) {
                        __array__437.push(await __for_body__436(__elements__435[__iter__434]));
                        if(__BREAK__FLAG__) {
                             __array__437.pop();
                            break;
                            
                        }
                    }return __array__437;
                     
                })();
                await set_ctx(ctx,generator_expression,"arg");
                if (check_true (await not(body_is_block_ques_))){
                    {
                        for_body=await make_do_block(for_body)
                    }
                };
                prebuild=await build_fn_with_assignment(body_function_ref,(for_body && for_body["val"]),idx_iters,ctx);
                await async function(){
                    ctx["block_step"]=0;
                    return ctx;
                    
                }();
                await async function(){
                    ctx["return_last_value"]=true;
                    return ctx;
                    
                }();
                (acc).push(await (async function(){
                     return await compile(prebuild,ctx) 
                })());
                await (async function() {
                    let __for_body__443=async function(t) {
                        return (acc).push(t)
                    };
                    let __array__444=[],__elements__442=["let"," ",break_out,"=","false",";"];
                    let __BREAK__FLAG__=false;
                    for(let __iter__441 in __elements__442) {
                        __array__444.push(await __for_body__443(__elements__442[__iter__441]));
                        if(__BREAK__FLAG__) {
                             __array__444.pop();
                            break;
                            
                        }
                    }return __array__444;
                     
                })();
                await set_ctx(ctx,body_function_ref,AsyncFunction);
                await async function(){
                    if (check_true ((((for_args && for_args.length)===2)&& await not(((for_args && for_args["1"]) instanceof Array))))) {
                        {
                            await (async function() {
                                let __for_body__447=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__448=[],__elements__446=["for"," ",(preamble && preamble["0"])," ","(","const"," ",iter_ref," ","of"," ",await compile_wrapper_fn(elements,ctx),")"," ","{"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__445 in __elements__446) {
                                    __array__448.push(await __for_body__447(__elements__446[__iter__445]));
                                    if(__BREAK__FLAG__) {
                                         __array__448.pop();
                                        break;
                                        
                                    }
                                }return __array__448;
                                 
                            })();
                            await (async function() {
                                let __for_body__451=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__452=[],__elements__450=await (async function(){
                                    let __array_op_rval__453=(preamble && preamble["0"]);
                                     if (__array_op_rval__453 instanceof Function){
                                        return await __array_op_rval__453(" ",body_function_ref,"(",iter_ref,")",";") 
                                    } else {
                                        return [__array_op_rval__453," ",body_function_ref,"(",iter_ref,")",";"]
                                    }
                                })();
                                let __BREAK__FLAG__=false;
                                for(let __iter__449 in __elements__450) {
                                    __array__452.push(await __for_body__451(__elements__450[__iter__449]));
                                    if(__BREAK__FLAG__) {
                                         __array__452.pop();
                                        break;
                                        
                                    }
                                }return __array__452;
                                 
                            })();
                            await (async function() {
                                let __for_body__456=async function(t) {
                                    return (acc).push(t)
                                };
                                let __array__457=[],__elements__455=["if","(",break_out,")"," ","break",";"];
                                let __BREAK__FLAG__=false;
                                for(let __iter__454 in __elements__455) {
                                    __array__457.push(await __for_body__456(__elements__455[__iter__454]));
                                    if(__BREAK__FLAG__) {
                                         __array__457.pop();
                                        break;
                                        
                                    }
                                }return __array__457;
                                 
                            })();
                            return (acc).push("}")
                        }
                    }
                } ();
                return acc
            };
            silence=async function() {
                return false
            };
            verbosity=silence;
            check_verbosity=async function(ctx) {
                return await Environment["get_global"].call(Environment,"__VERBOSITY__")
            };
            declare_log=await (async function(){
                if (check_true ((opts && opts["quiet_mode"]))){
                    return log
                } else {
                    return await defclog({
                        prefix:"DECLARE",color:"white",background:"black"
                    })
                }
            })();
            compile_declare=async function(tokens,ctx) {
                let expressions;
                let targeted;
                let acc;
                let source;
                let details;
                let sanitized_name;
                let declaration;
                let dec_struct;
                expressions=await (await Environment.get_global("rest"))(tokens);
                targeted=null;
                acc=[];
                source=null;
                details=null;
                sanitized_name=null;
                declaration=null;
                dec_struct=null;
                await (async function() {
                    let __for_body__460=async function(exp) {
                        declaration=(exp && exp["val"] && exp["val"]["0"] && exp["val"]["0"]["name"]);
                        targeted=await (await Environment.get_global("rest"))((exp && exp["val"]));
                        if (check_true (await (async function(){
                            let __array_op_rval__462=verbosity;
                             if (__array_op_rval__462 instanceof Function){
                                return await __array_op_rval__462(ctx) 
                            } else {
                                return [__array_op_rval__462,ctx]
                            }
                        })())){
                            {
                                (declare_log)("declaration: ",declaration,"targeted: ",await (async function(){
                                     return await (await Environment.get_global("each"))(targeted,"name") 
                                })(),targeted)
                            }
                        };
                        return await async function(){
                            if (check_true ((declaration==="toplevel"))) {
                                {
                                    await async function(){
                                        opts["root_environment"]=(targeted && targeted["0"]);
                                        return opts;
                                        
                                    }();
                                    if (check_true ((opts && opts["root_environment"]))){
                                        return env_ref=""
                                    } else {
                                        return env_ref="Environment."
                                    }
                                }
                            } else if (check_true ((declaration==="include"))) {
                                {
                                    return await (async function() {
                                        let __for_body__466=async function(name) {
                                            sanitized_name=await sanitize_js_ref_name(name);
                                            dec_struct=await get_declaration_details(ctx,name);
                                            if (check_true (dec_struct)){
                                                {
                                                    await (async function() {
                                                        let __for_body__470=async function(t) {
                                                            return (acc).push(t)
                                                        };
                                                        let __array__471=[],__elements__469=["let"," ",sanitized_name,"="];
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__468 in __elements__469) {
                                                            __array__471.push(await __for_body__470(__elements__469[__iter__468]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__471.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__471;
                                                         
                                                    })();
                                                    await async function(){
                                                        if (check_true (((dec_struct && dec_struct["value"]) instanceof Function&& await (async function(){
                                                            let __targ__473=await (async function(){
                                                                let __targ__472=(Environment && Environment["definitions"]);
                                                                if (__targ__472){
                                                                     return(__targ__472)[name]
                                                                } 
                                                            })();
                                                            if (__targ__473){
                                                                 return(__targ__473)["fn_body"]
                                                            } 
                                                        })()))) {
                                                            {
                                                                details=await (async function(){
                                                                    let __targ__474=(Environment && Environment["definitions"]);
                                                                    if (__targ__474){
                                                                         return(__targ__474)[name]
                                                                    } 
                                                                })();
                                                                source=("(fn "+ (details && details["fn_args"])+ " "+ (details && details["fn_body"])+ ")");
                                                                source=await (async function(){
                                                                     return await compile(await tokenize(await (async function(){
                                                                         return await (await Environment.get_global("read_lisp"))(source) 
                                                                    })(),ctx),ctx,1000) 
                                                                })();
                                                                (acc).push(source);
                                                                return await set_ctx(ctx,name,AsyncFunction)
                                                            }
                                                        } else if (check_true ((dec_struct && dec_struct["value"]) instanceof Function)) {
                                                            {
                                                                (acc).push(await (async function() {
                                                                    {
                                                                         let __call_target__=await (dec_struct && dec_struct["value"])["toString"](), __call_method__="replace";
                                                                        return await __call_target__[__call_method__].call(__call_target__,"\n","")
                                                                    } 
                                                                })());
                                                                await set_ctx(ctx,name,AsyncFunction)
                                                            }
                                                        } else {
                                                            {
                                                                (acc).push(await (dec_struct && dec_struct["value"])["toString"]());
                                                                await set_ctx(ctx,name,ArgumentType)
                                                            }
                                                        }
                                                    } ();
                                                    (acc).push(";")
                                                }
                                            };
                                            await set_declaration(ctx,name,"inlined",true);
                                            if (check_true ((("undefined"===await (async function(){
                                                let __targ__475=await get_declarations(ctx,name);
                                                if (__targ__475){
                                                     return(__targ__475)["type"]
                                                } 
                                            })())&& (dec_struct && dec_struct["value"]) instanceof Function))){
                                                return await set_declaration(ctx,name,"type",Function)
                                            }
                                        };
                                        let __array__467=[],__elements__465=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__464 in __elements__465) {
                                            __array__467.push(await __for_body__466(__elements__465[__iter__464]));
                                            if(__BREAK__FLAG__) {
                                                 __array__467.pop();
                                                break;
                                                
                                            }
                                        }return __array__467;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="verbose"))) {
                                {
                                    let verbosity_level=await parseInt(await first(await (async function(){
                                         return await (await Environment.get_global("each"))(targeted,"name") 
                                    })()));
                                    ;
                                    if (check_true (await not(await isNaN(verbosity_level)))){
                                        {
                                            if (check_true ((verbosity_level>0))){
                                                await set_ctx(ctx,"__VERBOSITY__",verbosity_level)
                                            } else {
                                                {
                                                    (declare_log)("verbosity: turned off");
                                                    verbosity=silence;
                                                    await set_ctx(ctx,"__VERBOSITY__",null)
                                                }
                                            };
                                            verbosity=check_verbosity;
                                            return (declare_log)("compiler: verbosity set: ",await (async function(){
                                                let __array_op_rval__476=verbosity;
                                                 if (__array_op_rval__476 instanceof Function){
                                                    return await __array_op_rval__476(ctx) 
                                                } else {
                                                    return [__array_op_rval__476,ctx]
                                                }
                                            })())
                                        }
                                    } else {
                                        return (warnings).push("invalid verbosity declaration, expected number, received ")
                                    }
                                }
                            } else if (check_true ((declaration==="local"))) {
                                return await (async function() {
                                    let __for_body__479=async function(name) {
                                        dec_struct=await get_declaration_details(ctx,name);
                                        return await set_ctx(ctx,name,(dec_struct && dec_struct["value"]))
                                    };
                                    let __array__480=[],__elements__478=await (async function(){
                                         return await (await Environment.get_global("each"))(targeted,"name") 
                                    })();
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__477 in __elements__478) {
                                        __array__480.push(await __for_body__479(__elements__478[__iter__477]));
                                        if(__BREAK__FLAG__) {
                                             __array__480.pop();
                                            break;
                                            
                                        }
                                    }return __array__480;
                                     
                                })()
                            } else if (check_true ((declaration==="function"))) {
                                {
                                    return await (async function() {
                                        let __for_body__483=async function(name) {
                                            return await set_declaration(ctx,name,"type",Function)
                                        };
                                        let __array__484=[],__elements__482=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__481 in __elements__482) {
                                            __array__484.push(await __for_body__483(__elements__482[__iter__481]));
                                            if(__BREAK__FLAG__) {
                                                 __array__484.pop();
                                                break;
                                                
                                            }
                                        }return __array__484;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="fn"))) {
                                {
                                    return await (async function() {
                                        let __for_body__487=async function(name) {
                                            return await set_declaration(ctx,name,"type",AsyncFunction)
                                        };
                                        let __array__488=[],__elements__486=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__485 in __elements__486) {
                                            __array__488.push(await __for_body__487(__elements__486[__iter__485]));
                                            if(__BREAK__FLAG__) {
                                                 __array__488.pop();
                                                break;
                                                
                                            }
                                        }return __array__488;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="array"))) {
                                {
                                    return await (async function() {
                                        let __for_body__491=async function(name) {
                                            return await set_declaration(ctx,name,"type",Array)
                                        };
                                        let __array__492=[],__elements__490=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__489 in __elements__490) {
                                            __array__492.push(await __for_body__491(__elements__490[__iter__489]));
                                            if(__BREAK__FLAG__) {
                                                 __array__492.pop();
                                                break;
                                                
                                            }
                                        }return __array__492;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="number"))) {
                                {
                                    return await (async function() {
                                        let __for_body__495=async function(name) {
                                            return await set_declaration(ctx,name,"type",NumberType)
                                        };
                                        let __array__496=[],__elements__494=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__493 in __elements__494) {
                                            __array__496.push(await __for_body__495(__elements__494[__iter__493]));
                                            if(__BREAK__FLAG__) {
                                                 __array__496.pop();
                                                break;
                                                
                                            }
                                        }return __array__496;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="string"))) {
                                {
                                    return await (async function() {
                                        let __for_body__499=async function(name) {
                                            return await set_declaration(ctx,name,"type",StringType)
                                        };
                                        let __array__500=[],__elements__498=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__497 in __elements__498) {
                                            __array__500.push(await __for_body__499(__elements__498[__iter__497]));
                                            if(__BREAK__FLAG__) {
                                                 __array__500.pop();
                                                break;
                                                
                                            }
                                        }return __array__500;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="boolean"))) {
                                {
                                    return await (async function() {
                                        let __for_body__503=async function(name) {
                                            return await set_declaration(ctx,name,"type",Boolean)
                                        };
                                        let __array__504=[],__elements__502=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__501 in __elements__502) {
                                            __array__504.push(await __for_body__503(__elements__502[__iter__501]));
                                            if(__BREAK__FLAG__) {
                                                 __array__504.pop();
                                                break;
                                                
                                            }
                                        }return __array__504;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="regexp"))) {
                                {
                                    return await (async function() {
                                        let __for_body__507=async function(name) {
                                            return await set_declaration(ctx,name,"type",RegExp)
                                        };
                                        let __array__508=[],__elements__506=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__505 in __elements__506) {
                                            __array__508.push(await __for_body__507(__elements__506[__iter__505]));
                                            if(__BREAK__FLAG__) {
                                                 __array__508.pop();
                                                break;
                                                
                                            }
                                        }return __array__508;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="object"))) {
                                {
                                    return await (async function() {
                                        let __for_body__511=async function(name) {
                                            return await set_declaration(ctx,name,"type",Object)
                                        };
                                        let __array__512=[],__elements__510=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__509 in __elements__510) {
                                            __array__512.push(await __for_body__511(__elements__510[__iter__509]));
                                            if(__BREAK__FLAG__) {
                                                 __array__512.pop();
                                                break;
                                                
                                            }
                                        }return __array__512;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="global"))) {
                                {
                                    return await (async function() {
                                        let __for_body__515=async function(name) {
                                            return await set_declaration(ctx,name,"location","global")
                                        };
                                        let __array__516=[],__elements__514=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"name") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__513 in __elements__514) {
                                            __array__516.push(await __for_body__515(__elements__514[__iter__513]));
                                            if(__BREAK__FLAG__) {
                                                 __array__516.pop();
                                                break;
                                                
                                            }
                                        }return __array__516;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="optimize"))) {
                                {
                                    return await (async function() {
                                        let __for_body__519=async function(factor) {
                                            factor=await (async function(){
                                                 return await (await Environment.get_global("each"))(factor,"name") 
                                            })();
                                            return await async function(){
                                                if (check_true (((factor && factor["0"])==="safety"))) {
                                                    return await set_declaration(ctx,"__SAFETY__","level",(factor && factor["1"]))
                                                }
                                            } ()
                                        };
                                        let __array__520=[],__elements__518=await (async function(){
                                             return await (await Environment.get_global("each"))(targeted,"val") 
                                        })();
                                        let __BREAK__FLAG__=false;
                                        for(let __iter__517 in __elements__518) {
                                            __array__520.push(await __for_body__519(__elements__518[__iter__517]));
                                            if(__BREAK__FLAG__) {
                                                 __array__520.pop();
                                                break;
                                                
                                            }
                                        }return __array__520;
                                         
                                    })()
                                }
                            } else if (check_true ((declaration==="namespace"))) {
                                {
                                    if (check_true (await not(((targeted && targeted.length)===1)))){
                                        {
                                            throw new SyntaxError("namespace declaration requires exactly 1 value");
                                            
                                        }
                                    };
                                    if (check_true (await get_ctx(ctx,"__IN_LAMBDA__"))){
                                        {
                                            throw new SyntaxError("namespace compiler declaration must be toplevel");
                                            
                                        }
                                    };
                                    target_namespace=(targeted && targeted["0"] && targeted["0"]["name"]);
                                    return Environment=await Environment["get_namespace_handle"].call(Environment,(targeted && targeted["0"] && targeted["0"]["name"]))
                                }
                            } else {
                                {
                                    (warnings).push(("unknown declaration directive: "+ declaration));
                                    return await (await Environment.get_global("warn"))(("compiler: unknown declaration directive: "+ declaration))
                                }
                            }
                        } ()
                    };
                    let __array__461=[],__elements__459=expressions;
                    let __BREAK__FLAG__=false;
                    for(let __iter__458 in __elements__459) {
                        __array__461.push(await __for_body__460(__elements__459[__iter__458]));
                        if(__BREAK__FLAG__) {
                             __array__461.pop();
                            break;
                            
                        }
                    }return __array__461;
                     
                })();
                return acc
            };
            safety_level=async function(ctx) {
                if (check_true (ctx)){
                    {
                        let safety=await get_declarations(ctx,"__SAFETY__");
                        ;
                        if (check_true (safety)){
                            return (safety && safety["level"])
                        } else {
                            return default_safety_level
                        }
                    }
                }
            };
            get_scoped_type=async function(name) {
                let rtype;
                rtype=await get_ctx(ctx,name);
                if (check_true ((undefined===rtype))){
                    return await sub_type(await get_lisp_ctx(name))
                } else {
                    return await sub_type(rtype)
                }
            };
            compile_scoped_reference=async function(tokens,ctx) {
                let acc;
                let idx;
                let ref_type;
                let rval;
                let stmt;
                let preamble;
                let sr_log;
                let val;
                let call_type;
                let token;
                acc=[];
                idx=0;
                ref_type=null;
                rval=null;
                stmt=null;
                preamble=await calling_preamble(ctx);
                sr_log=await (async function(){
                     return await defclog({
                        prefix:("compile_scoped_reference ("+ ((ctx && ctx["block_id"])|| "-")+ "):"),background:"steelblue",color:"white"
                    }) 
                })();
                val=null;
                call_type=await (async function(){
                     return await async function(){
                        if (check_true (await not((tokens && tokens["0"] && tokens["0"]["ref"])))) {
                            return "literal"
                        } else if (check_true (await get_ctx_val(ctx,(tokens && tokens["0"] && tokens["0"]["name"])))) {
                            return "local"
                        } else if (check_true (await get_lisp_ctx((tokens && tokens["0"] && tokens["0"]["name"])))) {
                            return "lisp"
                        }
                    } () 
                })();
                token=null;
                ;
                await async function(){
                    if (check_true ((call_type==="lisp"))) {
                        return ref_type=await get_lisp_ctx((tokens && tokens["0"] && tokens["0"]["name"]))
                    } else if (check_true ((call_type==="local"))) {
                        ref_type=await get_ctx_val(ctx,(tokens && tokens["0"] && tokens["0"]["name"]))
                    } else {
                        ref_type=ArgumentType
                    }
                } ();
                await async function(){
                    if (check_true ((ref_type===AsyncFunction))) {
                        return ref_type="AsyncFunction"
                    } else if (check_true ((ref_type===Expression))) {
                        ref_type=ArgumentType
                    } else if (check_true ((ref_type===Function))) {
                        ref_type="Function"
                    } else if (check_true ((ref_type===Array))) {
                        ref_type="Array"
                    } else if (check_true ((ref_type===NilType))) {
                        ref_type="nil"
                    } else if (check_true ((ref_type===NumberType))) {
                        ref_type=ArgumentType
                    } else if (check_true ((ref_type===StringType))) {
                        ref_type="StringType"
                    } else if (check_true ((ref_type===ArgumentType))) {
                        true
                    } else {
                        ref_type=await sub_type(ref_type)
                    }
                } ();
                if (check_true (await (async function(){
                    let __array_op_rval__521=verbosity;
                     if (__array_op_rval__521 instanceof Function){
                        return await __array_op_rval__521(ctx) 
                    } else {
                        return [__array_op_rval__521,ctx]
                    }
                })())){
                    {
                        (sr_log)("SYMBOL: ",(tokens && tokens["0"] && tokens["0"]["name"]),"  found as:",call_type," of type:",ref_type,"sanitized as: ",await (async function(){
                            if (check_true (("local"===call_type))){
                                return (" local sanitized to: "+ await sanitize_js_ref_name((tokens && tokens["0"] && tokens["0"]["name"])))
                            }
                        })())
                    }
                };
                rval=await (async function(){
                     return await async function(){
                        if (check_true ((ref_type==="AsyncFunction"))) {
                            {
                                (acc).push((preamble && preamble["0"]));
                                (acc).push(" ");
                                (acc).push(await (async function(){
                                    if (check_true ((call_type==="lisp"))){
                                        return await compile_lisp_scoped_reference((tokens && tokens["0"] && tokens["0"]["name"]),ctx)
                                    } else {
                                        return await sanitize_js_ref_name((tokens && tokens["0"] && tokens["0"]["name"]))
                                    }
                                })());
                                (acc).push("(");
                                await (async function(){
                                     let __test_condition__522=async function() {
                                        return (idx<((tokens && tokens.length)- 1))
                                    };
                                    let __body_ref__523=async function() {
                                        idx+=1;
                                        token=tokens[idx];
                                        stmt=await compile_wrapper_fn(token,ctx,new Object());
                                        (acc).push(stmt);
                                        if (check_true ((idx<((tokens && tokens.length)- 1)))){
                                            {
                                                return (acc).push(",")
                                            }
                                        }
                                    };
                                    let __BREAK__FLAG__=false;
                                    while(await __test_condition__522()) {
                                        await __body_ref__523();
                                         if(__BREAK__FLAG__) {
                                             break;
                                            
                                        }
                                    } ;
                                    
                                })();
                                (acc).push(")");
                                return acc
                            }
                        } else if (check_true ((ref_type==="Function"))) {
                            {
                                (acc).push((preamble && preamble["0"]));
                                (acc).push(" ");
                                (acc).push(await (async function(){
                                    if (check_true ((call_type==="lisp"))){
                                        return await compile_lisp_scoped_reference((tokens && tokens["0"] && tokens["0"]["name"]),ctx)
                                    } else {
                                        return await sanitize_js_ref_name((tokens && tokens["0"] && tokens["0"]["name"]))
                                    }
                                })());
                                (acc).push("(");
                                await (async function(){
                                     let __test_condition__524=async function() {
                                        return (idx<((tokens && tokens.length)- 1))
                                    };
                                    let __body_ref__525=async function() {
                                        idx+=1;
                                        token=tokens[idx];
                                        stmt=await compile_wrapper_fn(token,ctx,new Object());
                                        (acc).push(stmt);
                                        if (check_true ((idx<((tokens && tokens.length)- 1)))){
                                            {
                                                return (acc).push(",")
                                            }
                                        }
                                    };
                                    let __BREAK__FLAG__=false;
                                    while(await __test_condition__524()) {
                                        await __body_ref__525();
                                         if(__BREAK__FLAG__) {
                                             break;
                                            
                                        }
                                    } ;
                                    
                                })();
                                (acc).push(")");
                                return acc
                            }
                        } else if (check_true (((call_type==="local")&& ((ref_type==="NumberType")|| (ref_type==="StringType")|| (ref_type==="Boolean"))))) {
                            {
                                (acc).push((tokens && tokens["0"] && tokens["0"]["name"]));
                                return acc
                            }
                        } else if (check_true (((call_type==="local")&& await not((ref_type===ArgumentType))&& (tokens instanceof Array)))) {
                            {
                                val=await get_ctx_val(ctx,(tokens && tokens["0"] && tokens["0"]["name"]));
                                (acc).push(val);
                                return acc
                            }
                        } else if (check_true (((ref_type===ArgumentType)&& (tokens instanceof Array)))) {
                            {
                                (acc).push("[");
                                await (async function(){
                                     let __test_condition__526=async function() {
                                        return (idx<(tokens && tokens.length))
                                    };
                                    let __body_ref__527=async function() {
                                        token=tokens[idx];
                                        (acc).push(await (async function(){
                                             return await compile(token,ctx) 
                                        })());
                                        if (check_true ((idx<((tokens && tokens.length)- 1)))){
                                            {
                                                (acc).push(",")
                                            }
                                        };
                                        return idx+=1
                                    };
                                    let __BREAK__FLAG__=false;
                                    while(await __test_condition__526()) {
                                        await __body_ref__527();
                                         if(__BREAK__FLAG__) {
                                             break;
                                            
                                        }
                                    } ;
                                    
                                })();
                                (acc).push("]");
                                return acc
                            }
                        } else if (check_true ((ref_type===ArgumentType))) {
                            {
                                (acc).push((tokens && tokens["0"] && tokens["0"]["name"]));
                                return acc
                            }
                        } else if (check_true ((ref_type==="undefined"))) {
                            {
                                throw new ReferenceError(("unknown reference: "+ (tokens && tokens["0"] && tokens["0"]["name"])));
                                
                            }
                        } else if (check_true ((call_type==="lisp"))) {
                            {
                                return await compile_lisp_scoped_reference((tokens && tokens["0"] && tokens["0"]["name"]),ctx)
                            }
                        } else {
                            {
                                (acc).push((tokens && tokens["0"] && tokens["0"]["name"]));
                                return acc
                            }
                        }
                    } () 
                })();
                if (check_true (false)){
                    {
                        await async function(){
                            if (check_true (((ref_type==="AsyncFunction")|| (ref_type==="Function")))) {
                                return (acc).unshift({
                                    ctype:ref_type
                                })
                            }
                        } ()
                    }
                };
                return acc
            };
            compile_lisp_scoped_reference=async function(refname,ctx,defer_not_found) {
                let refval;
                let reftype;
                let declarations;
                let preamble;
                let basename;
                refval=await get_lisp_ctx(refname);
                reftype=await sub_type(refval);
                declarations=null;
                preamble=await calling_preamble(ctx);
                basename=await (await Environment.get_global("get_object_path"))(refname);
                ;
                declarations=await add(new Object(),await get_declarations(ctx,refname),await get_declaration_details(ctx,refname));
                if (check_true ((declarations && declarations["inlined"]))){
                    {
                        refname=await sanitize_js_ref_name(refname)
                    }
                };
                if (check_true ((((reftype==="StringType")|| (reftype==="String"))&& await not((refval===undefined))))){
                    {
                        refval="text"
                    }
                };
                return await async function(){
                    if (check_true (await contains_ques_((basename && basename["0"]),standard_types))) {
                        return refname
                    } else if (check_true ((declarations && declarations["inlined"]))) {
                        return refname
                    } else if (check_true (await not((refval===undefined)))) {
                        {
                            has_lisp_globals=true;
                            return [{
                                ctype:await (async function(){
                                    if (check_true ((await not(refval instanceof Function)&& (refval instanceof Object)))){
                                        return "object"
                                    } else {
                                        return refval
                                    }
                                })()
                            },"(",(preamble && preamble["0"])," ",env_ref,"get_global","(\"",refname,"\")",")"]
                        }
                    } else if (check_true (defer_not_found)) {
                        return ["(",env_ref,"get_global","(\"",refname,"\", ReferenceError)",")"]
                    } else {
                        {
                            throw new ReferenceError(("unknown lisp reference: "+ refname));
                            
                        }
                    }
                } ()
            };
            standard_types=await (async function(){
                let all_vals;
                all_vals=await (await Environment.get_global("make_set"))(await (async function(){
                     return await uniq(await conj(["AsyncFunction","check_true","LispSyntaxError","dlisp_environment_count","clone","Environment","Expression","get_next_environment_id","subtype","lisp_writer","do_deferred_splice"],await (async function(){
                         return await object_methods(globalThis) 
                    })())) 
                })());
                await all_vals["delete"].call(all_vals,"length");
                return all_vals
            })();
            is_error=null;
            is_block_ques_=async function(tokens) {
                return (((tokens && tokens["0"] && tokens["0"]["type"])==="special")&& await contains_ques_((tokens && tokens["0"] && tokens["0"]["name"]),["do","progn"]))
            };
            is_complex_ques_=async function(tokens) {
                let rval;
                rval=(await (async function(){
                    let __array_op_rval__528=is_block_ques_;
                     if (__array_op_rval__528 instanceof Function){
                        return await __array_op_rval__528(tokens) 
                    } else {
                        return [__array_op_rval__528,tokens]
                    }
                })()|| (((tokens && tokens["type"])==="arr")&& await (async function(){
                    let __array_op_rval__529=is_block_ques_;
                     if (__array_op_rval__529 instanceof Function){
                        return await __array_op_rval__529((tokens && tokens["val"])) 
                    } else {
                        return [__array_op_rval__529,(tokens && tokens["val"])]
                    }
                })())|| (((tokens && tokens["0"] && tokens["0"]["type"])==="special")&& (((tokens && tokens["0"] && tokens["0"]["name"])==="let")|| ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["name"])==="if")|| ((tokens && tokens["val"] && tokens["val"]["0"] && tokens["val"]["0"]["name"])==="let"))));
                return rval
            };
            is_form_ques_=async function(token) {
                return (((token && token["val"]) instanceof Array)|| await (async function(){
                    let __array_op_rval__530=is_block_ques_;
                     if (__array_op_rval__530 instanceof Function){
                        return await __array_op_rval__530((token && token["val"])) 
                    } else {
                        return [__array_op_rval__530,(token && token["val"])]
                    }
                })())
            };
            op_lookup=await ( async function(){
                let __obj__531=new Object();
                __obj__531["+"]=infix_ops;
                __obj__531["*"]=infix_ops;
                __obj__531["/"]=infix_ops;
                __obj__531["-"]=infix_ops;
                __obj__531["**"]=infix_ops;
                __obj__531["%"]=infix_ops;
                __obj__531["<<"]=infix_ops;
                __obj__531[">>"]=infix_ops;
                __obj__531["and"]=infix_ops;
                __obj__531["or"]=infix_ops;
                __obj__531["apply"]=compile_apply;
                __obj__531["call"]=compile_call;
                __obj__531["->"]=compile_call;
                __obj__531["set_prop"]=compile_set_prop;
                __obj__531["prop"]=compile_prop;
                __obj__531["="]=compile_assignment;
                __obj__531["setq"]=compile_assignment;
                __obj__531["=="]=compile_compare;
                __obj__531["eq"]=compile_compare;
                __obj__531[">"]=compile_compare;
                __obj__531["<"]=compile_compare;
                __obj__531["<="]=compile_compare;
                __obj__531[">="]=compile_compare;
                __obj__531["return"]=compile_return;
                __obj__531["new"]=compile_new;
                __obj__531["do"]=compile_block;
                __obj__531["progn"]=compile_block;
                __obj__531["progl"]=async function(tokens,ctx) {
                    return await compile_block(tokens,ctx,{
                        no_scope_boundary:true,suppress_return:true,force_no_new_ctx:true
                    })
                };
                __obj__531["break"]=compile_break;
                __obj__531["inc"]=compile_val_mod;
                __obj__531["dec"]=compile_val_mod;
                __obj__531["try"]=compile_try;
                __obj__531["throw"]=compile_throw;
                __obj__531["let"]=compile_let;
                __obj__531["defvar"]=compile_defvar;
                __obj__531["defconst"]=async function(tokens,ctx) {
                    if (check_true (await get_ctx(ctx,"__LOCAL_SCOPE__"))){
                        return await compile_defvar(tokens,ctx,{
                            constant:true
                        })
                    } else {
                        return await compile_set_global(tokens,ctx,{
                            constant:true
                        })
                    }
                };
                __obj__531["while"]=compile_while;
                __obj__531["for_each"]=compile_for_each;
                __obj__531["if"]=compile_if;
                __obj__531["cond"]=compile_cond;
                __obj__531["fn"]=compile_fn;
                __obj__531["lambda"]=compile_fn;
                __obj__531["function*"]=async function(tokens,ctx) {
                    return await compile_fn(tokens,ctx,{
                        generator:true
                    })
                };
                __obj__531["defglobal"]=compile_set_global;
                __obj__531["list"]=compile_list;
                __obj__531["function"]=async function(tokens,ctx) {
                    return await compile_fn(tokens,ctx,{
                        synchronous:true
                    })
                };
                __obj__531["=>"]=async function(tokens,ctx) {
                    return await compile_fn(tokens,ctx,{
                        arrow:true
                    })
                };
                __obj__531["yield"]=compile_yield;
                __obj__531["for_with"]=compile_for_with;
                __obj__531["quotem"]=compile_quotem;
                __obj__531["quote"]=compile_quote;
                __obj__531["quotel"]=compile_quotel;
                __obj__531["eval"]=compile_eval;
                __obj__531["jslambda"]=compile_jslambda;
                __obj__531["javascript"]=compile_javascript;
                __obj__531["instanceof"]=compile_instanceof;
                __obj__531["typeof"]=compile_typeof;
                __obj__531["unquotem"]=compile_unquotem;
                __obj__531["debug"]=compile_debug;
                __obj__531["declare"]=compile_declare;
                __obj__531["static_import"]=compile_import;
                __obj__531["dynamic_import"]=compile_dynamic_import;
                return __obj__531;
                
            })();
            comp_log=await (async function(){
                if (check_true (quiet_mode)){
                    return log
                } else {
                    return await defclog({
                        background:"LightSkyblue",color:"#000000"
                    })
                }
            })();
            last_source=null;
            compile_obj_literal=async function(tokens,ctx) {
                let acc;
                let idx;
                let stmt;
                let has_valid_key_literals;
                let token;
                let preamble;
                let key;
                let tmp_name;
                let kvpair;
                let total_length;
                acc=[];
                idx=-1;
                stmt=null;
                has_valid_key_literals=true;
                token=null;
                preamble=await calling_preamble(ctx);
                key=null;
                tmp_name=null;
                ctx=await new_ctx(ctx);
                kvpair=null;
                total_length=((tokens && tokens["val"] && tokens["val"]["length"])- 1);
                ;
                await async function(){
                    ctx["in_obj_literal"]=true;
                    return ctx;
                    
                }();
                await (async function() {
                    let __for_body__535=async function(token) {
                        if (check_true ((((token && token["type"])==="keyval")&& await check_invalid_js_ref((token && token.name))))){
                            {
                                has_valid_key_literals=false;
                                return __BREAK__FLAG__=true;
                                return
                            }
                        }
                    };
                    let __array__536=[],__elements__534=((tokens && tokens["val"])|| []);
                    let __BREAK__FLAG__=false;
                    for(let __iter__533 in __elements__534) {
                        __array__536.push(await __for_body__535(__elements__534[__iter__533]));
                        if(__BREAK__FLAG__) {
                             __array__536.pop();
                            break;
                            
                        }
                    }return __array__536;
                     
                })();
                if (check_true (has_valid_key_literals)){
                    if (check_true (((tokens && tokens["val"] && tokens["val"]["name"])==="{}"))){
                        return [{
                            ctype:"objliteral"
                        },"new Object()"]
                    } else {
                        {
                            (acc).push("{");
                            await (async function(){
                                 let __test_condition__537=async function() {
                                    return (idx<total_length)
                                };
                                let __body_ref__538=async function() {
                                    idx+=1;
                                    kvpair=await (async function(){
                                        let __targ__539=(tokens && tokens["val"]);
                                        if (__targ__539){
                                             return(__targ__539)[idx]
                                        } 
                                    })();
                                    key=await get_val((kvpair && kvpair["val"] && kvpair["val"]["0"]),ctx);
                                    if (check_true ((((key && key.length)===1)&& (await key["charCodeAt"]()===34)))){
                                        {
                                            key="'\"'"
                                        }
                                    };
                                    (acc).push(key);
                                    (acc).push(":");
                                    await set_ctx(ctx,"__LAMBDA_STEP__",-1);
                                    stmt=await compile_wrapper_fn((kvpair && kvpair["val"] && kvpair["val"]["1"]),ctx);
                                    (acc).push(stmt);
                                    if (check_true ((idx<total_length))){
                                        {
                                            return (acc).push(",")
                                        }
                                    }
                                };
                                let __BREAK__FLAG__=false;
                                while(await __test_condition__537()) {
                                    await __body_ref__538();
                                     if(__BREAK__FLAG__) {
                                         break;
                                        
                                    }
                                } ;
                                
                            })();
                            (acc).push("}");
                            return [{
                                ctype:"objliteral"
                            },acc]
                        }
                    }
                } else {
                    {
                        tmp_name=await gen_temp_name("obj");
                        await (async function() {
                            let __for_body__542=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__543=[],__elements__541=await (async function(){
                                 return [{
                                    ctype:"statement"
                                },(preamble && preamble["0"])," ","("," ",(preamble && preamble["1"])," ","function","()","{","let"," ",tmp_name,"=","new"," ","Object","()",";"] 
                            })();
                            let __BREAK__FLAG__=false;
                            for(let __iter__540 in __elements__541) {
                                __array__543.push(await __for_body__542(__elements__541[__iter__540]));
                                if(__BREAK__FLAG__) {
                                     __array__543.pop();
                                    break;
                                    
                                }
                            }return __array__543;
                             
                        })();
                        await (async function(){
                             let __test_condition__544=async function() {
                                return (idx<total_length)
                            };
                            let __body_ref__545=async function() {
                                idx+=1;
                                kvpair=await (async function(){
                                    let __targ__546=(tokens && tokens["val"]);
                                    if (__targ__546){
                                         return(__targ__546)[idx]
                                    } 
                                })();
                                return await (async function() {
                                    let __for_body__549=async function(t) {
                                        return (acc).push(t)
                                    };
                                    let __array__550=[],__elements__548=await (async function(){
                                        let __array_op_rval__551=tmp_name;
                                         if (__array_op_rval__551 instanceof Function){
                                            return await __array_op_rval__551("[","\"",await (async function(){
                                                 return await cl_encode_string(await get_val((kvpair && kvpair["val"] && kvpair["val"]["0"]),ctx)) 
                                            })(),"\"","]","=",await compile_wrapper_fn((kvpair && kvpair["val"] && kvpair["val"]["1"]),ctx),";") 
                                        } else {
                                            return [__array_op_rval__551,"[","\"",await (async function(){
                                                 return await cl_encode_string(await get_val((kvpair && kvpair["val"] && kvpair["val"]["0"]),ctx)) 
                                            })(),"\"","]","=",await compile_wrapper_fn((kvpair && kvpair["val"] && kvpair["val"]["1"]),ctx),";"]
                                        }
                                    })();
                                    let __BREAK__FLAG__=false;
                                    for(let __iter__547 in __elements__548) {
                                        __array__550.push(await __for_body__549(__elements__548[__iter__547]));
                                        if(__BREAK__FLAG__) {
                                             __array__550.pop();
                                            break;
                                            
                                        }
                                    }return __array__550;
                                     
                                })()
                            };
                            let __BREAK__FLAG__=false;
                            while(await __test_condition__544()) {
                                await __body_ref__545();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                        await (async function() {
                            let __for_body__554=async function(t) {
                                return (acc).push(t)
                            };
                            let __array__555=[],__elements__553=["return"," ",tmp_name,";","}",")","()"];
                            let __BREAK__FLAG__=false;
                            for(let __iter__552 in __elements__553) {
                                __array__555.push(await __for_body__554(__elements__553[__iter__552]));
                                if(__BREAK__FLAG__) {
                                     __array__555.pop();
                                    break;
                                    
                                }
                            }return __array__555;
                             
                        })();
                        return acc
                    }
                }
            };
            is_literal_ques_=async function(val) {
                return (await is_number_ques_(val)|| (val instanceof String || typeof val==='string')|| (false===val)|| (true===val))
            };
            comp_warn=await (async function(){
                 return await defclog({
                    prefix:"compile: [warn]:",background:"#fcffc8",color:"brown"
                }) 
            })();
            let compile=await __compile__3();
            ;
            compile_inner=async function(tokens,ctx,_cdepth) {
                let operator_type;
                let op_token;
                let rcv;
                let __op__561= async function(){
                    return null
                };
                let acc;
                let preamble;
                let tmp_name;
                let refval;
                let ref;
                {
                    operator_type=null;
                    op_token=null;
                    rcv=null;
                    let op=await __op__561();
                    ;
                    _cdepth=(_cdepth|| 100);
                    acc=[];
                    preamble=await calling_preamble(ctx);
                    tmp_name=null;
                    refval=null;
                    ref=null;
                    ;
                    try {
                        if (check_true ((null==ctx))){
                            {
                                (error_log)("compile: nil ctx: ",tokens);
                                throw new Error("compile: nil ctx");
                                
                            }
                        } else {
                            return await async function(){
                                if (check_true ((await is_number_ques_(tokens)|| (tokens instanceof String || typeof tokens==='string')|| (await sub_type(tokens)==="Boolean")))) {
                                    return tokens
                                } else if (check_true (((tokens instanceof Array)&& (tokens && tokens["0"] && tokens["0"]["ref"])&& await not((await get_ctx(ctx,(tokens && tokens["0"] && tokens["0"]["name"]))===UnknownType))&& (op_lookup[(tokens && tokens["0"] && tokens["0"]["name"])]|| (Function===await get_ctx(ctx,(tokens && tokens["0"] && tokens["0"]["name"])))|| (AsyncFunction===await get_ctx(ctx,(tokens && tokens["0"] && tokens["0"]["name"])))|| ("function"===typeof await (async function(){
                                    let __targ__563=(root_ctx && root_ctx["defined_lisp_globals"]);
                                    if (__targ__563){
                                         return(__targ__563)[(tokens && tokens["0"] && tokens["0"]["name"])]
                                    } 
                                })())|| await get_lisp_ctx((tokens && tokens["0"] && tokens["0"]["name"])) instanceof Function)))) {
                                    {
                                        op_token=await first(tokens);
                                        operator=op_token["name"];
                                        operator_type=op_token["val"];
                                        ref=op_token["ref"];
                                        op=op_lookup[operator];
                                        return await async function(){
                                            if (check_true (op)) {
                                                return (op)(tokens,ctx)
                                            } else if (check_true (await (async function(){
                                                let __targ__564=(Environment && Environment["inlines"]);
                                                if (__targ__564){
                                                     return(__targ__564)[operator]
                                                } 
                                            })())) {
                                                return await compile_inline(tokens,ctx)
                                            } else {
                                                return await compile_scoped_reference(tokens,ctx)
                                            }
                                        } ()
                                    }
                                } else if (check_true (((tokens instanceof Object)&& ((tokens && tokens["type"])==="objlit")))) {
                                    {
                                        return await compile_obj_literal(tokens,ctx)
                                    }
                                } else if (check_true ((tokens instanceof Array))) {
                                    {
                                        return await async function(){
                                            if (check_true (((tokens && tokens.length)===0))) {
                                                return [{
                                                    ctype:"array",is_literal:true
                                                },"[]"]
                                            } else {
                                                {
                                                    let is_operation;
                                                    let declared_type;
                                                    let prefix;
                                                    let symbolic_replacements;
                                                    let compiled_values;
                                                    is_operation=false;
                                                    declared_type=null;
                                                    prefix="";
                                                    ctx=await new_ctx(ctx);
                                                    symbolic_replacements=[];
                                                    compiled_values=[];
                                                    await set_new_completion_scope(ctx);
                                                    if (check_true (((tokens && tokens["0"] && tokens["0"]["ref"])&& ((tokens && tokens["0"] && tokens["0"]["val"]) instanceof String || typeof (tokens && tokens["0"] && tokens["0"]["val"])==='string')))){
                                                        {
                                                            declared_type=await get_declarations(ctx,(tokens && tokens["0"] && tokens["0"]["name"]))
                                                        }
                                                    };
                                                    rcv=await (async function(){
                                                         return await compile((tokens && tokens["0"]),ctx,await add(_cdepth,1)) 
                                                    })();
                                                    if (check_true (await (async function(){
                                                        let __array_op_rval__565=verbosity;
                                                         if (__array_op_rval__565 instanceof Function){
                                                            return await __array_op_rval__565(ctx) 
                                                        } else {
                                                            return [__array_op_rval__565,ctx]
                                                        }
                                                    })())){
                                                        {
                                                            (comp_log)(("compile: "+ _cdepth+ " array: "),"potential operator: ",(tokens && tokens["0"] && tokens["0"]["name"]),"declarations: ",declared_type)
                                                        }
                                                    };
                                                    await (async function() {
                                                        let __for_body__568=async function(t) {
                                                            if (check_true (await not(await get_ctx_val(ctx,"__IN_LAMBDA__")))){
                                                                await set_ctx(ctx,"__LAMBDA_STEP__",0)
                                                            };
                                                            return (compiled_values).push(await compile_wrapper_fn(t,ctx))
                                                        };
                                                        let __array__569=[],__elements__567=await (await Environment.get_global("rest"))(tokens);
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__566 in __elements__567) {
                                                            __array__569.push(await __for_body__568(__elements__567[__iter__566]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__569.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__569;
                                                         
                                                    })();
                                                    await map(async function(compiled_element,idx) {
                                                        let inst;
                                                        inst=await (async function(){
                                                             return await async function(){
                                                                if (check_true ((((compiled_element && compiled_element["0"]) instanceof Object)&& await (async function(){
                                                                    let __targ__570=(compiled_element && compiled_element["0"]);
                                                                    if (__targ__570){
                                                                         return(__targ__570)["ctype"]
                                                                    } 
                                                                })()))) {
                                                                    return await (async function(){
                                                                        let __targ__571=(compiled_element && compiled_element["0"]);
                                                                        if (__targ__571){
                                                                             return(__targ__571)["ctype"]
                                                                        } 
                                                                    })()
                                                                } else if (check_true (((compiled_element && compiled_element["0"])==="{"))) {
                                                                    return "block"
                                                                } else {
                                                                    return null
                                                                }
                                                            } () 
                                                        })();
                                                        return await async function(){
                                                            if (check_true (((inst==="block")|| (inst==="letblock")))) {
                                                                {
                                                                    return (symbolic_replacements).push(await (async function(){
                                                                        let __array_op_rval__572=idx;
                                                                         if (__array_op_rval__572 instanceof Function){
                                                                            return await __array_op_rval__572(await gen_temp_name("array_arg"),[(preamble && preamble["2"]),"(",(preamble && preamble["1"])," ","function","()"," ",compiled_element," ",")"]) 
                                                                        } else {
                                                                            return [__array_op_rval__572,await gen_temp_name("array_arg"),[(preamble && preamble["2"]),"(",(preamble && preamble["1"])," ","function","()"," ",compiled_element," ",")"]]
                                                                        }
                                                                    })())
                                                                }
                                                            } else if (check_true ((inst==="ifblock"))) {
                                                                {
                                                                    return (symbolic_replacements).push(await (async function(){
                                                                        let __array_op_rval__573=idx;
                                                                         if (__array_op_rval__573 instanceof Function){
                                                                            return await __array_op_rval__573(await gen_temp_name("array_arg"),[(preamble && preamble["2"]),"(",(preamble && preamble["1"])," ","function","()"," ","{",compiled_element,"}"," ",")"]) 
                                                                        } else {
                                                                            return [__array_op_rval__573,await gen_temp_name("array_arg"),[(preamble && preamble["2"]),"(",(preamble && preamble["1"])," ","function","()"," ","{",compiled_element,"}"," ",")"]]
                                                                        }
                                                                    })())
                                                                }
                                                            }
                                                        } ()
                                                    },compiled_values);
                                                    await (async function() {
                                                        let __for_body__576=async function(elem) {
                                                            await (async function() {
                                                                let __for_body__580=async function(t) {
                                                                    return (acc).push(t)
                                                                };
                                                                let __array__581=[],__elements__579=["let"," ",(elem && elem["1"]),"=",(elem && elem["2"]),";"];
                                                                let __BREAK__FLAG__=false;
                                                                for(let __iter__578 in __elements__579) {
                                                                    __array__581.push(await __for_body__580(__elements__579[__iter__578]));
                                                                    if(__BREAK__FLAG__) {
                                                                         __array__581.pop();
                                                                        break;
                                                                        
                                                                    }
                                                                }return __array__581;
                                                                 
                                                            })();
                                                            return await compiled_values["splice"].call(compiled_values,(elem && elem["0"]),1,[(preamble && preamble["0"])," ",(elem && elem["1"]),"()"])
                                                        };
                                                        let __array__577=[],__elements__575=symbolic_replacements;
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__574 in __elements__575) {
                                                            __array__577.push(await __for_body__576(__elements__575[__iter__574]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__577.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__577;
                                                         
                                                    })();
                                                    if (check_true (((symbolic_replacements && symbolic_replacements.length)>0))){
                                                        {
                                                            (acc).unshift("{");
                                                            (acc).unshift({
                                                                ctype:"block"
                                                            })
                                                        }
                                                    };
                                                    await async function(){
                                                        if (check_true ((((declared_type && declared_type["type"])===Function)|| ((declared_type && declared_type["type"])===AsyncFunction)|| (((rcv && rcv["0"]) instanceof Object)&& (rcv && rcv["0"] && rcv["0"]["ctype"]) instanceof Function)|| (((rcv && rcv["0"]) instanceof Object)&& await not(((rcv && rcv["0"]) instanceof Array))&& ((rcv && rcv["0"] && rcv["0"]["ctype"]) instanceof String || typeof (rcv && rcv["0"] && rcv["0"]["ctype"])==='string')&& await contains_ques_("unction",(rcv && rcv["0"] && rcv["0"]["ctype"])))))) {
                                                            {
                                                                if (check_true (((declared_type && declared_type["type"])===AsyncFunction))){
                                                                    prefix="await "
                                                                } else {
                                                                    prefix=""
                                                                };
                                                                is_operation=true;
                                                                await (async function() {
                                                                    let __for_body__584=async function(t) {
                                                                        return (acc).push(t)
                                                                    };
                                                                    let __array__585=[],__elements__583=await (async function(){
                                                                        let __array_op_rval__586=prefix;
                                                                         if (__array_op_rval__586 instanceof Function){
                                                                            return await __array_op_rval__586("(",rcv,")","(") 
                                                                        } else {
                                                                            return [__array_op_rval__586,"(",rcv,")","("]
                                                                        }
                                                                    })();
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__582 in __elements__583) {
                                                                        __array__585.push(await __for_body__584(__elements__583[__iter__582]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__585.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__585;
                                                                     
                                                                })();
                                                                await push_as_arg_list(acc,compiled_values);
                                                                return (acc).push(")")
                                                            }
                                                        } else if (check_true (((null==(declared_type && declared_type["type"]))&& (((tokens && tokens["0"] && tokens["0"]["type"])==="arg")|| ((rcv instanceof String || typeof rcv==='string')&& await get_declaration_details(ctx,rcv))|| ((rcv instanceof Array)&& ((rcv && rcv["0"]) instanceof Object)&& ((rcv && rcv["0"] && rcv["0"]["ctype"]) instanceof String || typeof (rcv && rcv["0"] && rcv["0"]["ctype"])==='string')&& ((rcv && rcv["0"] && rcv["0"]["ctype"])&& (await not(await contains_ques_("unction",(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(await contains_ques_("block",(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("string"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("StringType"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("nil"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("NumberType"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("undefined"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("objliteral"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("Boolean"===(rcv && rcv["0"] && rcv["0"]["ctype"])))&& await not(("array"===(rcv && rcv["0"] && rcv["0"]["ctype"])))))))))) {
                                                            {
                                                                if (check_true (show_hints)){
                                                                    {
                                                                        (comp_warn)("value ambiguity - use declare to clarify: ",await source_from_tokens(tokens,expanded_tree,true)," ",await (await Environment.get_global("as_lisp"))(rcv))
                                                                    }
                                                                };
                                                                tmp_name=await gen_temp_name("array_op_rval");
                                                                if (check_true (((symbolic_replacements && symbolic_replacements.length)>0))){
                                                                    {
                                                                        (acc).push({
                                                                            ctype:"block"
                                                                        });
                                                                        (acc).push("return");
                                                                        (acc).push(" ")
                                                                    }
                                                                };
                                                                await (async function() {
                                                                    let __for_body__589=async function(t) {
                                                                        return (acc).push(t)
                                                                    };
                                                                    let __array__590=[],__elements__588=[(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","()","{","let"," ",tmp_name,"=",rcv,";"," ","if"," ","(",tmp_name," ","instanceof"," ","Function",")","{","return"," ",(preamble && preamble["0"])," ",tmp_name,"("];
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__587 in __elements__588) {
                                                                        __array__590.push(await __for_body__589(__elements__588[__iter__587]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__590.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__590;
                                                                     
                                                                })();
                                                                await push_as_arg_list(acc,compiled_values);
                                                                await (async function() {
                                                                    let __for_body__593=async function(t) {
                                                                        return (acc).push(t)
                                                                    };
                                                                    let __array__594=[],__elements__592=[")"," ","}"," ","else"," ","{","return"," ","[",tmp_name];
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__591 in __elements__592) {
                                                                        __array__594.push(await __for_body__593(__elements__592[__iter__591]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__594.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__594;
                                                                     
                                                                })();
                                                                if (check_true ((await length(await (await Environment.get_global("rest"))(tokens))>0))){
                                                                    {
                                                                        (acc).push(",");
                                                                        await push_as_arg_list(acc,compiled_values)
                                                                    }
                                                                };
                                                                return await (async function() {
                                                                    let __for_body__597=async function(t) {
                                                                        return (acc).push(t)
                                                                    };
                                                                    let __array__598=[],__elements__596=["]","}","}",")","()"];
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__595 in __elements__596) {
                                                                        __array__598.push(await __for_body__597(__elements__596[__iter__595]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__598.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__598;
                                                                     
                                                                })()
                                                            }
                                                        } else if (check_true (((null==(declared_type && declared_type["type"]))&& (((rcv instanceof Array)&& ((rcv && rcv["0"]) instanceof Object)&& ((rcv && rcv["0"] && rcv["0"]["ctype"]) instanceof String || typeof (rcv && rcv["0"] && rcv["0"]["ctype"])==='string')&& await contains_ques_("block",(rcv && rcv["0"] && rcv["0"]["ctype"]))))))) {
                                                            {
                                                                if (check_true (((symbolic_replacements && symbolic_replacements.length)>0))){
                                                                    {
                                                                        (acc).push("return");
                                                                        (acc).push(" ")
                                                                    }
                                                                };
                                                                (acc).push("[");
                                                                (acc).push(["(",(preamble && preamble["0"])," ","(",(preamble && preamble["1"])," ","function","() {",rcv,"})","()",")"]);
                                                                if (check_true ((await length(await (await Environment.get_global("rest"))(tokens))>0))){
                                                                    {
                                                                        (acc).push(",");
                                                                        await push_as_arg_list(acc,compiled_values)
                                                                    }
                                                                };
                                                                return (acc).push("]")
                                                            }
                                                        } else {
                                                            return [(await (async function() {if (check_true (((symbolic_replacements && symbolic_replacements.length)>0))){
                                                                {
                                                                    (acc).push("return");
                                                                    return (acc).push(" ")
                                                                }
                                                            }
                                                        })()),(acc).push("["),(acc).push(rcv),await (async function(){
                                                            if (check_true ((await length(await (await Environment.get_global("rest"))(tokens))>0))){
                                                                {
                                                                    (acc).push(",");
                                                                    return await push_as_arg_list(acc,compiled_values)
                                                                }
                                                            }
                                                        })(),(acc).push("]")]
                                                    }
                                                } ();
                                                if (check_true (((symbolic_replacements && symbolic_replacements.length)>0))){
                                                    {
                                                        (acc).push("}")
                                                    }
                                                };
                                                return acc
                                            }
                                        }
                                    } ()
                                }
                            } else if (check_true (((tokens instanceof Object)&& ((tokens && tokens["val"]) instanceof Array)&& (tokens && tokens["type"])))) {
                                {
                                    await async function(){
                                        ctx["source"]=(tokens && tokens["source"]);
                                        return ctx;
                                        
                                    }();
                                    rcv=await (async function(){
                                         return await compile((tokens && tokens["val"]),ctx,await add(_cdepth,1)) 
                                    })();
                                    return rcv
                                }
                            } else if (check_true ((((tokens instanceof Object)&& await not((undefined===(tokens && tokens["val"])))&& (tokens && tokens["type"]))|| ((tokens && tokens["type"])==="literal")|| ((tokens && tokens["type"])==="arg")|| ((tokens && tokens["type"])==="null")))) {
                                {
                                    let snt_name=null;
                                    ;
                                    let snt_value=null;
                                    ;
                                    return await async function(){
                                        if (check_true ((await not((tokens && tokens["ref"]))&& ((tokens && tokens["type"])==="arr")))) {
                                            return await compile((tokens && tokens["val"]),ctx,await add(_cdepth,1))
                                        } else if (check_true ((((tokens && tokens["type"])==="null")|| (((tokens && tokens["type"])==="literal")&& ((tokens && tokens.name)==="null")&& (tokens && tokens["ref"]))))) {
                                            return [{
                                                ctype:"nil"
                                            },"null"]
                                        } else if (check_true ((((tokens && tokens["type"])==="literal")&& ((tokens && tokens.name)==="undefined")&& (tokens && tokens["ref"])))) {
                                            return [{
                                                ctype:"undefined"
                                            },"undefined"]
                                        } else if (check_true (await not((tokens && tokens["ref"])))) {
                                            if (check_true ((((tokens && tokens["type"])==="literal")&& ((tokens && tokens["val"]) instanceof String || typeof (tokens && tokens["val"])==='string')))){
                                                return [{
                                                    ctype:"string"
                                                },("\""+ await (async function(){
                                                     return await cl_encode_string((tokens && tokens["val"])) 
                                                })()+ "\"")]
                                            } else {
                                                if (check_true (await is_number_ques_((tokens && tokens["val"])))){
                                                    return [{
                                                        ctype:"NumberType"
                                                    },(tokens && tokens["val"])]
                                                } else {
                                                    return [{
                                                        ctype:await sub_type((tokens && tokens["val"]))
                                                    },(tokens && tokens["val"])]
                                                }
                                            }
                                        } else if (check_true (((tokens && tokens["ref"])&& (opts && opts["root_environment"])))) {
                                            {
                                                return await (await Environment.get_global("path_to_js_syntax"))((await sanitize_js_ref_name((tokens && tokens.name))).split("."))
                                            }
                                        } else if (check_true (((tokens && tokens["ref"])&& op_lookup[(tokens && tokens.name)]))) {
                                            return (tokens && tokens.name)
                                        } else if (check_true (((tokens && tokens["ref"])&& await (async function(){
                                            snt_name=await sanitize_js_ref_name((tokens && tokens.name));
                                            snt_value=await get_ctx_val(ctx,snt_name);
                                            if (check_true (await (async function(){
                                                let __array_op_rval__600=verbosity;
                                                 if (__array_op_rval__600 instanceof Function){
                                                    return await __array_op_rval__600(ctx) 
                                                } else {
                                                    return [__array_op_rval__600,ctx]
                                                }
                                            })())){
                                                {
                                                    (comp_log)("compile: singleton: ","name: ",(tokens && tokens.name)," sanitized: ",snt_name,"found locally as:",snt_value)
                                                }
                                            };
                                            return await not((snt_value===undefined))
                                        })()))) {
                                            {
                                                refval=snt_value;
                                                if (check_true ((refval===ArgumentType))){
                                                    {
                                                        refval=snt_name
                                                    }
                                                };
                                                return await async function(){
                                                    if (check_true (((tokens && tokens["type"])==="literal"))) {
                                                        return refval
                                                    } else {
                                                        return await get_val(tokens,ctx)
                                                    }
                                                } ()
                                            }
                                        } else if (check_true (await contains_ques_((tokens && tokens.name),standard_types))) {
                                            return (tokens && tokens.name)
                                        } else if (check_true (await not((undefined===await get_lisp_ctx((tokens && tokens.name)))))) {
                                            {
                                                if (check_true (await (async function(){
                                                    let __array_op_rval__601=verbosity;
                                                     if (__array_op_rval__601 instanceof Function){
                                                        return await __array_op_rval__601(ctx) 
                                                    } else {
                                                        return [__array_op_rval__601,ctx]
                                                    }
                                                })())){
                                                    {
                                                        (comp_log)("compile: singleton: found global: ",(tokens && tokens.name))
                                                    }
                                                };
                                                return await compile_lisp_scoped_reference((tokens && tokens.name),ctx)
                                            }
                                        } else {
                                            {
                                                if (check_true (await (async function(){
                                                    let __array_op_rval__602=verbosity;
                                                     if (__array_op_rval__602 instanceof Function){
                                                        return await __array_op_rval__602() 
                                                    } else {
                                                        return [__array_op_rval__602]
                                                    }
                                                })())){
                                                    {
                                                        (comp_log)("compile: resolver fall through:",(tokens && tokens.name),"-  not found globally or in local context")
                                                    }
                                                };
                                                throw new ReferenceError(("compile: unknown/not found reference: "+ (tokens && tokens.name)));
                                                
                                            }
                                        }
                                    } ()
                                }
                            } else {
                                {
                                    throw new SyntaxError("compile passed invalid compilation structure");
                                    
                                }
                            }
                        } ()
                    }
                } catch (__exception__562) {
                    if (__exception__562 instanceof Error) {
                        let e=__exception__562;
                        {
                            {
                                if (check_true ((is_error&& (e && e["handled"])))){
                                    {
                                        throw e;
                                        
                                    }
                                };
                                is_error={
                                    error:(e && e.name),source_name:source_name,message:(e && e.message),form:await source_from_tokens(tokens,expanded_tree),parent_forms:await source_from_tokens(tokens,expanded_tree,true),invalid:true
                                };
                                if (check_true (await not((e && e["handled"])))){
                                    {
                                        (errors).push(is_error);
                                        await async function(){
                                            e["handled"]=true;
                                            return e;
                                            
                                        }()
                                    }
                                };
                                await async function(){
                                    e["details"]=is_error;
                                    return e;
                                    
                                }();
                                if (check_true ((opts && opts["throw_on_error"]))){
                                    throw e;
                                    
                                }
                            }
                        }
                    }
                }
            }
        };
        final_token_assembly=null;
        main_log=await (async function(){
            if (check_true ((opts && opts["quiet_mode"]))){
                return log
            } else {
                return await defclog({
                    prefix:"compiler:",background:"green",color:"black"
                })
            }
        })();
        assemble_output=async function(js_tree,suppress_join) {
            let text;
            let in_quotes;
            let escaped;
            let escape_char;
            let format_depth;
            let last_t;
            let insert_indent;
            let process_output_token;
            let assemble;
            text=[];
            in_quotes=false;
            escaped=0;
            escape_char=await String.fromCharCode(92);
            format_depth=[];
            last_t=null;
            insert_indent=async function() {
                (text).push("\n");
                return await (async function() {
                    let __for_body__607=async function(spacer) {
                        return (text).push(spacer)
                    };
                    let __array__608=[],__elements__606=format_depth;
                    let __BREAK__FLAG__=false;
                    for(let __iter__605 in __elements__606) {
                        __array__608.push(await __for_body__607(__elements__606[__iter__605]));
                        if(__BREAK__FLAG__) {
                             __array__608.pop();
                            break;
                            
                        }
                    }return __array__608;
                     
                })()
            };
            process_output_token=async function(t) {
                escaped=await Math.max(0,(escaped- 1));
                return await async function(){
                    if (check_true (((t==="\"")&& (escaped===0)&& in_quotes))) {
                        {
                            in_quotes=false;
                            return (text).push(t)
                        }
                    } else if (check_true (((t==="\"")&& (escaped===0)))) {
                        {
                            in_quotes=true;
                            return (text).push(t)
                        }
                    } else if (check_true ((t===escape_char))) {
                        {
                            (escaped===2);
                            return (text).push(t)
                        }
                    } else if (check_true ((await not(in_quotes)&& (t==="{")))) {
                        {
                            (text).push(t);
                            (format_depth).push("    ");
                            return await insert_indent()
                        }
                    } else if (check_true ((await not(in_quotes)&& await starts_with_ques_("}",t)))) {
                        {
                            (format_depth).pop();
                            await insert_indent();
                            return (text).push(t)
                        }
                    } else if (check_true ((await not(in_quotes)&& (t===";")))) {
                        {
                            (text).push(t);
                            return await insert_indent()
                        }
                    } else if (check_true ((false&& await not(in_quotes)&& await starts_with_ques_("/*",t)))) {
                        {
                            (text).push(t);
                            return await insert_indent()
                        }
                    } else {
                        {
                            return (text).push(t)
                        }
                    }
                } ()
            };
            assemble=async function(js_tokens) {
                return await (async function() {
                    let __for_body__611=async function(t) {
                        return await async function(){
                            if (check_true ((t instanceof Array))) {
                                {
                                    return await assemble(t)
                                }
                            } else if (check_true (("object"===typeof t))) {
                                {
                                    if (check_true (((t && t["comment"])&& (opts && opts["include_source"])))){
                                        {
                                            (text).push(("/* "+ (t && t["comment"])+ " */"));
                                            return await insert_indent()
                                        }
                                    }
                                }
                            } else if (check_true (t instanceof Function)) {
                                {
                                    return await async function(){
                                        if (check_true (((t && t.name)&& await contains_ques_((t && t.name),standard_types)))) {
                                            return (text).push((t && t.name))
                                        } else if (check_true (await (await Environment.get_global("ends_with?"))("{ [native code] }",await t["toString"]()))) {
                                            {
                                                throw new ReferenceError(("cannot capture source of: "+ (t && t.name)));
                                                
                                            }
                                        } else {
                                            return (text).push(t)
                                        }
                                    } ()
                                }
                            } else {
                                {
                                    if (check_true ((opts && opts["formatted_output"]))){
                                        return await process_output_token(t)
                                    } else {
                                        return (text).push(t)
                                    }
                                }
                            }
                        } ()
                    };
                    let __array__612=[],__elements__610=js_tokens;
                    let __BREAK__FLAG__=false;
                    for(let __iter__609 in __elements__610) {
                        __array__612.push(await __for_body__611(__elements__610[__iter__609]));
                        if(__BREAK__FLAG__) {
                             __array__612.pop();
                            break;
                            
                        }
                    }return __array__612;
                     
                })()
            };
            {
                await assemble(await flatten(await (async function(){
                    let __array_op_rval__613=js_tree;
                     if (__array_op_rval__613 instanceof Function){
                        return await __array_op_rval__613() 
                    } else {
                        return [__array_op_rval__613]
                    }
                })()));
                if (check_true (suppress_join)){
                    return text
                } else {
                    {
                        return (text).join("")
                    }
                }
            }
        };
        ;
        if (check_true ((null==Environment))){
            throw new EvalError("Compiler: No environment passed in options.");
            
        };
        if (check_true ((opts && opts["show_hints"]))){
            {
                show_hints=true
            }
        };
        if (check_true (await Environment["get_global"].call(Environment,"__VERBOSITY__"))){
            {
                {
                    let verbosity_level;
                    verbosity_level=await Environment["get_global"].call(Environment,"__VERBOSITY__");
                    await async function(){
                        if (check_true ((verbosity_level>4))) {
                            {
                                verbosity=check_verbosity;
                                return show_hints=true
                            }
                        } else if (check_true ((verbosity_level>3))) {
                            show_hints=true
                        }
                    } ()
                }
            }
        };
        if (check_true (await (async function(){
            let __array_op_rval__614=verbosity;
             if (__array_op_rval__614 instanceof Function){
                return await __array_op_rval__614(ctx) 
            } else {
                return [__array_op_rval__614,ctx]
            }
        })())){
            {
                await (async function(){
                    let __array_op_rval__615=main_log;
                     if (__array_op_rval__615 instanceof Function){
                        return await __array_op_rval__615("namespace set to: ",(Environment && Environment["namespace"])) 
                    } else {
                        return [__array_op_rval__615,"namespace set to: ",(Environment && Environment["namespace"])]
                    }
                })();
                if (check_true ((opts && opts["fully_qualified_globals"]))){
                    {
                        await (async function(){
                            let __array_op_rval__616=main_log;
                             if (__array_op_rval__616 instanceof Function){
                                return await __array_op_rval__616("fully qualified globals") 
                            } else {
                                return [__array_op_rval__616,"fully qualified globals"]
                            }
                        })()
                    }
                }
            }
        };
        await set_ctx(root_ctx,break_out,false);
        await async function(){
            root_ctx["defined_lisp_globals"]=new Object();
            return root_ctx;
            
        }();
        await set_ctx(root_ctx,"__COMPLETION_SCOPE__",{
            id:completion_scope_id,root_block_id:null,completion_records:[],is_top:true
        });
        await set_ctx(root_ctx,"__SOURCE_NAME__",source_name);
        await set_ctx(root_ctx,"__LAMBDA_STEP__",-1);
        output=await (async function(){
             return await async function(){
                if (check_true ((opts && opts["special_operators"]))) {
                    {
                        return await (await Environment.get_global("make_set"))(await (await Environment.get_global("keys"))(op_lookup))
                    }
                } else if (check_true ((opts && opts["only_tokens"]))) {
                    return await tokenize(tree,root_ctx)
                } else if (check_true (is_error)) {
                    return [{
                        ctype:"CompileError"
                    },is_error]
                } else {
                    {
                        try {
                            final_token_assembly=await tokenize(tree,root_ctx)
                        } catch (__exception__618) {
                            if (__exception__618 instanceof Error) {
                                let e=__exception__618;
                                {
                                    is_error=e
                                }
                            }
                        };
                        await async function(){
                            if (check_true ((is_error&& (opts && opts["throw_on_error"])))) {
                                throw is_error;
                                
                            } else if (check_true ((is_error instanceof SyntaxError))) {
                                {
                                    (errors).push(is_error);
                                    return is_error
                                }
                            } else if (check_true (is_error)) {
                                {
                                    (errors).push(is_error);
                                    return is_error
                                }
                            } else if (check_true ((null==final_token_assembly))) {
                                {
                                    is_error=new EvalError("Pre-Compilation Error");
                                    return (errors).push(is_error)
                                }
                            } else {
                                {
                                    assembly=await (async function(){
                                         return await compile(final_token_assembly,root_ctx,0) 
                                    })();
                                    if (check_true ((is_error&& (opts && opts["throw_on_error"])))){
                                        {
                                            throw is_error;
                                            
                                        }
                                    };
                                    if (check_true (await not(is_error))){
                                        {
                                            if (check_true ((assembly instanceof Array))){
                                                {
                                                    await check_statement_completion(root_ctx,assembly)
                                                }
                                            }
                                        }
                                    };
                                    if (check_true ((false&& await not((opts && opts["root_environment"]))&& ((first_level_setup && first_level_setup.length)===0)&& has_lisp_globals))){
                                        (first_level_setup).push(["const __GG__=",env_ref,"get_global",";"])
                                    };
                                    return assembly
                                }
                            }
                        } ();
                        if (check_true ((opts && opts["root_environment"]))){
                            {
                                has_lisp_globals=false
                            }
                        };
                        if (check_true (((assembly && assembly["0"] && assembly["0"]["ctype"])&& (assembly && assembly["0"] && assembly["0"]["ctype"]) instanceof Function))){
                            {
                                await async function(){
                                    let __target_obj__619=(assembly && assembly["0"]);
                                    __target_obj__619["ctype"]=await map_value_to_ctype((assembly && assembly["0"] && assembly["0"]["ctype"]));
                                    return __target_obj__619;
                                    
                                }()
                            }
                        };
                        await async function(){
                            if (check_true ((await not(is_error)&& assembly&& (await first(assembly) instanceof Object)&& await (async function(){
                                let __targ__620=await first(assembly);
                                if (__targ__620){
                                     return(__targ__620)["ctype"]
                                } 
                            })()&& (await not((await (async function(){
                                let __targ__621=await first(assembly);
                                if (__targ__621){
                                     return(__targ__621)["ctype"]
                                } 
                            })() instanceof String || typeof await (async function(){
                                let __targ__621=await first(assembly);
                                if (__targ__621){
                                     return(__targ__621)["ctype"]
                                } 
                            })()==='string'))|| await (async function(){
                                let val;
                                val=await (async function(){
                                    let __targ__622=await first(assembly);
                                    if (__targ__622){
                                         return(__targ__622)["ctype"]
                                    } 
                                })();
                                return (await not((val==="assignment"))&& await not(await contains_ques_("block",val))&& await not(await contains_ques_("unction",val)))
                            })())))) {
                                return await async function(){
                                    let __target_obj__623=(assembly && assembly["0"]);
                                    __target_obj__623["ctype"]="statement";
                                    return __target_obj__623;
                                    
                                }()
                            } else if (check_true ((assembly&& (await first(assembly) instanceof String || typeof await first(assembly)==='string')&& (await first(assembly)==="throw")))) {
                                return assembly=await (async function(){
                                     return [{
                                        ctype:"block"
                                    },assembly] 
                                })()
                            } else if (check_true ((await not(is_error)&& assembly&& (await not((await first(assembly) instanceof Object))|| await not(await (async function(){
                                let __targ__624=await first(assembly);
                                if (__targ__624){
                                     return(__targ__624)["ctype"]
                                } 
                            })()))))) {
                                return assembly=await (async function(){
                                     return [{
                                        ctype:"statement"
                                    },assembly] 
                                })()
                            } else if (check_true (is_error)) {
                                return is_error
                            } else if (check_true ((null==assembly))) {
                                return assembly=[]
                            }
                        } ();
                        if (check_true (is_error)){
                            {
                                return [{
                                    ctype:"FAIL"
                                },errors]
                            }
                        } else {
                            if (check_true ((await first(assembly) instanceof Object))){
                                return [await add({
                                    has_lisp_globals:has_lisp_globals
                                },(assembly).shift()),await assemble_output(assembly)]
                            } else {
                                return [{
                                    has_lisp_globals:has_lisp_globals
                                },await assemble_output(assembly)]
                            }
                        }
                    }
                }
            } () 
        })();
        if (check_true (((await first(output) instanceof Object)&& target_namespace))){
            {
                await async function(){
                    let __target_obj__625=await first(output);
                    __target_obj__625["namespace"]=target_namespace;
                    return __target_obj__625;
                    
                }()
            }
        };
        if (check_true ((opts && opts["error_report"]))){
            {
                ((opts && opts["error_report"]))({
                    errors:errors,warnings:warnings
                })
            }
        };
        return output
    }
}
};__obj__1["set_repl"]=async function(key,value) {
    return await (await Environment.get_global("set_path"))(["repl",key],(await Environment.get_global("*env_config*")),value)
};__obj__1["repl_config"]=async function() {
    return await (await Environment.get_global("add"))({
        backtrace:false,raw_mode:false,output_processor:false
    },(await (await Environment.get_global("resolve_path"))(["repl"],(await Environment.get_global("*env_config*")))|| new Object()))
};__obj__1["if_undefined"]=async function(value,replacer) {
        return ["=:if",["=:==","=:undefined",value],replacer,value]
    };__obj__1["str"]=async function(...args) {
    return (args).join(" ")
};__obj__1["COPY_DATA"]=null;__obj__1["on_nil"]=async function(nil_form,value) {
    return ["=:let",[["=:v",value]],["=:if",["=:eq","=:v","=:nil"],nil_form,"=:v"]]
};__obj__1["on_empty"]=async function(on_empty_form,value) {
    return ["=:let",[["=:v",value]],["=:if",["=:or",["=:eq","=:v","=:nil"],["=:and",["=:is_array?","=:v"],["=:==",0,["=:length","=:v"]]],["=:and",["=:is_object?","=:v"],["=:==",["=:length","=:v"],0]]],on_empty_form,"=:v"]]
};__obj__1["sum"]=async function(vals) {
    return ["=:apply","=:add",vals]
};__obj__1["options_and_args"]=async function(arg_array) {
    return await async function(){
        if (check_true ((arg_array&& (arg_array instanceof Array)))) {
            {
                if (check_true ((await (await Environment.get_global("type"))((arg_array && arg_array["0"]))==="object"))){
                    return await (async function(){
                        let __array_op_rval__1=(arg_array && arg_array["0"]);
                         if (__array_op_rval__1 instanceof Function){
                            return await __array_op_rval__1(await (await Environment.get_global("slice"))(arg_array,1)) 
                        } else {
                            return [__array_op_rval__1,await (await Environment.get_global("slice"))(arg_array,1)]
                        }
                    })()
                } else {
                    return [null,arg_array]
                }
            }
        } else {
            return [null,arg_array]
        }
    } ()
};__obj__1["enum"]=async function(value_list) {
    let e=new Object();
    ;
    let i=-1;
    ;
    await (await Environment.get_global("assert"))((value_list instanceof Array),"Value_list must be an array");
    await (async function() {
        let __for_body__4=async function(v) {
            return await async function(){
                e[v]=i+=1;
                return e;
                
            }()
        };
        let __array__5=[],__elements__3=value_list;
        let __BREAK__FLAG__=false;
        for(let __iter__2 in __elements__3) {
            __array__5.push(await __for_body__4(__elements__3[__iter__2]));
            if(__BREAK__FLAG__) {
                 __array__5.pop();
                break;
                
            }
        }return __array__5;
         
    })();
    return e
};__obj__1["gen_id"]=async function(prefix) {
    return (""+ prefix+ "_"+ await Date.now())
};__obj__1["macros"]=async function() {
    let __collector;
    let __result;
    let __action;
    __collector=[];
    __result=null;
    __action=async function(v) {
        if (check_true ((v && v["1"] && v["1"]["macro"]))){
            return (v && v["0"])
        }
    };
    ;
    await (async function() {
        let __for_body__9=async function(__item) {
            __result=await __action(__item);
            if (check_true (__result)){
                return (__collector).push(__result)
            }
        };
        let __array__10=[],__elements__8=await (await Environment.get_global("pairs"))(Environment.definitions);
        let __BREAK__FLAG__=false;
        for(let __iter__7 in __elements__8) {
            __array__10.push(await __for_body__9(__elements__8[__iter__7]));
            if(__BREAK__FLAG__) {
                 __array__10.pop();
                break;
                
            }
        }return __array__10;
         
    })();
    return __collector
};__obj__1["pluck"]=async function(fields,data) {
    return ["=:each",data,fields]
};__obj__1["objects_from_list"]=async function(key_path,objects) {
    let obj;
    let path;
    obj=new Object();
    path=await (async function(){
        if (check_true ((key_path instanceof Array))){
            return key_path
        } else {
            return await (async function(){
                let __array_op_rval__11=key_path;
                 if (__array_op_rval__11 instanceof Function){
                    return await __array_op_rval__11() 
                } else {
                    return [__array_op_rval__11]
                }
            })()
        }
    })();
    await (async function() {
        let __for_body__14=async function(o) {
            return await async function(){
                obj[await (await Environment.get_global("resolve_path"))(path,o)]=o;
                return obj;
                
            }()
        };
        let __array__15=[],__elements__13=objects;
        let __BREAK__FLAG__=false;
        for(let __iter__12 in __elements__13) {
            __array__15.push(await __for_body__14(__elements__13[__iter__12]));
            if(__BREAK__FLAG__) {
                 __array__15.pop();
                break;
                
            }
        }return __array__15;
         
    })();
    return obj
};__obj__1["pairs_from_list"]=async function(value_list,size) {
    let container;
    let mod_size;
    let pset;
    let count;
    container=[];
    size=(size|| 2);
    mod_size=(size- 1);
    pset=[];
    count=0;
    await (async function() {
        let __for_body__19=async function(item) {
            (pset).push(item);
            if (check_true ((mod_size===(count% size)))){
                {
                    (container).push(pset);
                    pset=[]
                }
            };
            return count+=1
        };
        let __array__20=[],__elements__18=value_list;
        let __BREAK__FLAG__=false;
        for(let __iter__17 in __elements__18) {
            __array__20.push(await __for_body__19(__elements__18[__iter__17]));
            if(__BREAK__FLAG__) {
                 __array__20.pop();
                break;
                
            }
        }return __array__20;
         
    })();
    if (check_true ((await (await Environment.get_global("length"))(pset)>0))){
        (container).push(pset)
    };
    return container
};__obj__1["reorder_keys"]=async function(key_list,obj) {
    let objkeys;
    let rval;
    let __values__21= async function(){
        return await (async function(){
             return await (await Environment.get_global("nth"))(key_list,obj) 
        })()
    };
    {
        objkeys=await (await Environment.get_global("keys"))(obj);
        rval=new Object();
        let values=await __values__21();
        ;
        return await (await Environment.get_global("to_object"))(await (await Environment.get_global("pairs_from_list"))(await (async function(){
             return await (await Environment.get_global("interlace"))(key_list,values) 
        })()))
    }
};__obj__1["only"]=async function(fields,data) {
    return await async function(){
        if (check_true ((data instanceof Array))) {
            return await (await Environment.get_global("map"))(async function(v) {
                return await (await Environment.get_global("reorder_keys"))(fields,v)
            },data)
        } else if (check_true ((data instanceof Object))) {
            return await (await Environment.get_global("reorder_keys"))(fields,data)
        } else {
            return data
        }
    } ()
};__obj__1["sleep"]=async function(seconds) {
    return new Promise(async function(resolve) {
        return await setTimeout(async function() {
            return await (async function(){
                let __array_op_rval__22=resolve;
                 if (__array_op_rval__22 instanceof Function){
                    return await __array_op_rval__22(true) 
                } else {
                    return [__array_op_rval__22,true]
                }
            })()
        },(seconds* 1000))
    })
};__obj__1["from_universal_time"]=async function(seconds) {
    let d;
    let ue;
    d=new Date(0);
    ue=(seconds- 2208988800);
    await d["setUTCSeconds"].call(d,ue);
    return d
};__obj__1["+="]=async function(symbol,...args) {
    return ["=:=",].concat(symbol,[["=:+",symbol,].concat(args)])
};__obj__1["minmax_index"]=async function(container) {
    let value_found=false;
    ;
    let idx_small=null;
    ;
    let idx_largest=null;
    ;
    let idx=0;
    ;
    let smallest=(await Environment.get_global("MAX_SAFE_INTEGER"));
    ;
    let biggest=(-1* (await Environment.get_global("MAX_SAFE_INTEGER")));
    ;
    if (check_true ((container&& (container instanceof Array)&& (await (await Environment.get_global("length"))(container)>0)))){
        {
            await (async function() {
                let __for_body__30=async function(value) {
                    return (await (await Environment.get_global("is_number?"))(value)&& await (async function(){
                        value_found=true;
                        if (check_true ((value<smallest))){
                            {
                                smallest=value;
                                idx_small=idx
                            }
                        };
                        if (check_true ((value>biggest))){
                            {
                                biggest=value;
                                idx_largest=idx
                            }
                        };
                        return (idx=idx+1)
                    })())
                };
                let __array__31=[],__elements__29=container;
                let __BREAK__FLAG__=false;
                for(let __iter__28 in __elements__29) {
                    __array__31.push(await __for_body__30(__elements__29[__iter__28]));
                    if(__BREAK__FLAG__) {
                         __array__31.pop();
                        break;
                        
                    }
                }return __array__31;
                 
            })();
            if (check_true (value_found)){
                return await (async function(){
                    let __array_op_rval__32=idx_small;
                     if (__array_op_rval__32 instanceof Function){
                        return await __array_op_rval__32(idx_largest) 
                    } else {
                        return [__array_op_rval__32,idx_largest]
                    }
                })()
            } else {
                return null
            }
        }
    } else {
        return null
    }
};__obj__1["invert_pairs"]=async function(value) {
    if (check_true ((value instanceof Array))){
        return await (await Environment.get_global("map"))(async function(v) {
            return await (async function(){
                let __array_op_rval__33=(v && v["1"]);
                 if (__array_op_rval__33 instanceof Function){
                    return await __array_op_rval__33((v && v["0"])) 
                } else {
                    return [__array_op_rval__33,(v && v["0"])]
                }
            })()
        },value)
    } else {
        throw new Error("invert_pairs passed a non-array value");
        
    }
};__obj__1["noop"]=async function(val) {
    return val
};__obj__1["apply_list_to_list"]=async function(operator,list1,list2) {
    return await (await Environment.get_global("map"))(async function(val,idx) {
        return await (async function(){
            let __array_op_rval__34=operator;
             if (__array_op_rval__34 instanceof Function){
                return await __array_op_rval__34(val,list1[(idx% await (await Environment.get_global("length"))(list1))]) 
            } else {
                return [__array_op_rval__34,val,list1[(idx% await (await Environment.get_global("length"))(list1))]]
            }
        })()
    },list2)
};__obj__1["apply_operator_list"]=async function(modifier_list,target_list) {
    return await (await Environment.get_global("map"))(async function(val,idx) {
        let op=await Environment["eval"].call(Environment,("=:"+ modifier_list[(idx% await (await Environment.get_global("length"))(modifier_list))]));
        ;
        return await (async function(){
            let __array_op_rval__35=op;
             if (__array_op_rval__35 instanceof Function){
                return await __array_op_rval__35(val) 
            } else {
                return [__array_op_rval__35,val]
            }
        })()
    },target_list)
};__obj__1["range_overlap?"]=async function(range_a,range_b) {
    return (((range_a && range_a["0"])<=(range_a && range_a["1"]))&& ((range_b && range_b["0"])<=(range_b && range_b["1"]))&& await (async function(){
        if (check_true (((((range_a && range_a["0"])<=(range_b && range_b["0"]))&& ((range_b && range_b["0"])<=(range_a && range_a["1"])))|| (((range_a && range_a["0"])>=(range_b && range_b["0"]))&& ((range_a && range_a["0"])<=(range_b && range_b["1"])))))){
            return true
        } else {
            return false
        }
    })())
};__obj__1["remaining_in_range"]=async function(value,check_range) {
    return await async function(){
        if (check_true (((value<=(check_range && check_range["1"]))&& (value>=(check_range && check_range["0"]))))) {
            return ((check_range && check_range["1"])- value)
        } else {
            return null
        }
    } ()
};__obj__1["form_id"]=async function(name) {
    return await (await Environment.get_global("replace"))(new RegExp("W","g"),"_",await (async function(){
         return await (await Environment.get_global("replace"))(new RegExp("[+?':]","g"),"sssymss1",await (async function(){
             return await (await Environment.get_global("replace"))("!","sexcs1",await (async function(){
                 return await (await Environment.get_global("replace"))("<","slts1",await (async function(){
                     return await (await Environment.get_global("replace"))(">","sgts1",(await (await Environment.get_global("split"))((name).toLowerCase()," ")).join("_")) 
                })()) 
            })()) 
        })()) 
    })())
};__obj__1["from_key"]=async function(value,sep_ques_,ignore_ques_) {
    if (check_true ((value instanceof String || typeof value==='string'))){
        {
            if (check_true (ignore_ques_)){
                return value;
                
            };
            sep_ques_=(sep_ques_|| "_");
            return await (await Environment.get_global("dtext"))((await (async function(){
                 return await (await Environment.get_global("map"))(async function(v) {
                    return (""+ await (async function() {
                        {
                             let __call_target__=await v["charAt"].call(v,0), __call_method__="toUpperCase";
                            return await __call_target__[__call_method__]()
                        } 
                    })()+ await v["slice"].call(v,1))
                },(value).split(sep_ques_)) 
            })()).join(" "))
        }
    } else {
        return value
    }
};__obj__1["from_key1"]=async function(v) {
    return await (await Environment.get_global("from_key"))(v)
};__obj__1["to_key"]=async function(value,sep_ques_,ignore_ques_) {
    if (check_true ((value instanceof String || typeof value==='string'))){
        {
            if (check_true (ignore_ques_)){
                return value;
                
            };
            sep_ques_="_";
            let tokens=await (async function(){
                 return await (await Environment.get_global("map"))(async function(v) {
                    return (""+ (v).toLowerCase())
                },(value).split(" ")) 
            })();
            ;
            let rv=(tokens).join(sep_ques_);
            ;
            return rv
        }
    } else {
        {
            return value
        }
    }
};__obj__1["is_object_or_function?"]=function anonymous(obj
) {
var type = typeof obj; return type === 'function' || type === 'object' && !!obj;
};__obj__1["extend"]=async function(target_object,source_object) {
    if (check_true (((target_object instanceof Object)&& (source_object instanceof Object)))){
        {
            await (async function() {
                let __for_body__40=async function(pset) {
                    return await async function(){
                        target_object[(pset && pset["0"])]=(pset && pset["1"]);
                        return target_object;
                        
                    }()
                };
                let __array__41=[],__elements__39=await (await Environment.get_global("pairs"))(source_object);
                let __BREAK__FLAG__=false;
                for(let __iter__38 in __elements__39) {
                    __array__41.push(await __for_body__40(__elements__39[__iter__38]));
                    if(__BREAK__FLAG__) {
                         __array__41.pop();
                        break;
                        
                    }
                }return __array__41;
                 
            })();
            return target_object
        }
    } else {
        return target_object
    }
};__obj__1["no_empties"]=async function(items) {
    let item_type=await (await Environment.get_global("sub_type"))(items);
    ;
    if (check_true (await (await Environment.get_global("not"))((item_type=="array")))){
        items=[items]
    };
    {
        let __collector;
        let __result;
        let __action;
        __collector=[];
        __result=null;
        __action=async function(value) {
            return await async function(){
                if (check_true ((null==value))) {
                    return false
                } else if (check_true ((""==value))) {
                    return false
                } else {
                    return value
                }
            } ()
        };
        ;
        await (async function() {
            let __for_body__45=async function(__item) {
                __result=await __action(__item);
                if (check_true (__result)){
                    return (__collector).push(__result)
                }
            };
            let __array__46=[],__elements__44=items;
            let __BREAK__FLAG__=false;
            for(let __iter__43 in __elements__44) {
                __array__46.push(await __for_body__45(__elements__44[__iter__43]));
                if(__BREAK__FLAG__) {
                     __array__46.pop();
                    break;
                    
                }
            }return __array__46;
             
        })();
        return __collector
    }
};__obj__1["first_with"]=async function(prop_list,data_value) {
    let rval;
    let found;
    rval=null;
    found=false;
    await (async function() {
        let __for_body__49=async function(p) {
            rval=data_value[p];
            if (check_true (await (await Environment.get_global("not"))((null==rval)))){
                {
                    found=true;
                    return __BREAK__FLAG__=true;
                    return
                }
            }
        };
        let __array__50=[],__elements__48=prop_list;
        let __BREAK__FLAG__=false;
        for(let __iter__47 in __elements__48) {
            __array__50.push(await __for_body__49(__elements__48[__iter__47]));
            if(__BREAK__FLAG__) {
                 __array__50.pop();
                break;
                
            }
        }return __array__50;
         
    })();
    if (check_true (found)){
        return rval
    } else {
        return null
    }
};__obj__1["fixed"]=async function(v,p) {
    if (check_true (p)){
        return await (async function() {
            {
                 let __call_target__=await parseFloat(v), __call_method__="toFixed";
                return await __call_target__[__call_method__].call(__call_target__,p)
            } 
        })()
    } else {
        return await (async function() {
            {
                 let __call_target__=await parseFloat(v), __call_method__="toFixed";
                return await __call_target__[__call_method__].call(__call_target__,3)
            } 
        })()
    }
};__obj__1["hide"]=async function(value) {
    return undefined
};__obj__1["array_to_object"]=async function(input_array) {
    let count;
    let output;
    let working_array;
    count=0;
    output=await (async function(){
         return await clone(new Object()) 
    })();
    working_array=await (async function(){
         return await clone(input_array) 
    })();
    await (async function(){
         let __test_condition__55=async function() {
            return (await (await Environment.get_global("length"))(working_array)>0)
        };
        let __body_ref__56=async function() {
            let v1=(working_array).shift();
            ;
            let v1t=await (async function(){
                 return await (await Environment.get_global("type"))(v1) 
            })();
            ;
            return await async function(){
                if (check_true ((v1t==="object"))) {
                    return output=await (await Environment.get_global("add"))(await (async function(){
                        let __array_op_rval__57=output;
                         if (__array_op_rval__57 instanceof Function){
                            return await __array_op_rval__57(v1) 
                        } else {
                            return [__array_op_rval__57,v1]
                        }
                    })())
                } else {
                    return await async function(){
                        output[v1]=(working_array).shift();
                        return output;
                        
                    }()
                }
            } ()
        };
        let __BREAK__FLAG__=false;
        while(await __test_condition__55()) {
            await __body_ref__56();
             if(__BREAK__FLAG__) {
                 break;
                
            }
        } ;
        
    })();
    return output
};__obj__1["split_text_in_array"]=async function(split_element,input_array) {
    let output=[];
    ;
    await (async function() {
        let __for_body__61=async function(item) {
            return await async function(){
                if (check_true ((item instanceof String || typeof item==='string'))) {
                    return (output).push(await (await Environment.get_global("split"))(item,split_element))
                } else {
                    return (output).push(await (async function(){
                         return [null,item] 
                    })())
                }
            } ()
        };
        let __array__62=[],__elements__60=input_array;
        let __BREAK__FLAG__=false;
        for(let __iter__59 in __elements__60) {
            __array__62.push(await __for_body__61(__elements__60[__iter__59]));
            if(__BREAK__FLAG__) {
                 __array__62.pop();
                break;
                
            }
        }return __array__62;
         
    })();
    return output
};__obj__1["words_and_quotes"]=async function(text) {
    if (check_true (await (await Environment.get_global("not"))((text==null)))){
        return await (await Environment.get_global("map"))(async function(x,i) {
            if (check_true ((0===(i% 2)))){
                return (await (await Environment.get_global("no_empties"))(((x).trim()).split(" "))).join(" ")
            } else {
                return x
            }
        },(text).split("\""))
    } else {
        return []
    }
};__obj__1["split_words"]=async function(text_string) {
    return await (await Environment.get_global("no_empties"))(await (async function(){
         return await (await Environment.get_global("map"))(async function(x,i) {
            if (check_true ((0===(i% 2)))){
                return await (await Environment.get_global("no_empties"))(((x).trim()).split(" "))
            } else {
                return await (async function(){
                    let __array_op_rval__63=x;
                     if (__array_op_rval__63 instanceof Function){
                        return await __array_op_rval__63() 
                    } else {
                        return [__array_op_rval__63]
                    }
                })()
            }
        },await (await Environment.get_global("words_and_quotes"))(text_string)) 
    })())
};__obj__1["from_style_text"]=async function(text) {
    let semi_reg;
    let colon_reg;
    semi_reg=await RegExp(";\n ","g");
    colon_reg=await RegExp(": ","g");
    return await (await Environment.get_global("no_empties"))(await (async function(){
         return await (await Environment.get_global("map"))(async function(x) {
            return [((x && x["0"])).trim(),(x && x["1"])]
        },await (async function(){
             return await (await Environment.get_global("map"))(async function(v) {
                return (await (async function(){
                     return await (await Environment.get_global("replace"))(colon_reg,":",v) 
                })()).split(":")
            },await (await Environment.get_global("flatten"))(await (async function(){
                 return await (await Environment.get_global("map"))(async function(v) {
                    return (await (async function(){
                         return await (await Environment.get_global("replace"))(semi_reg,";",v) 
                    })()).split(";")
                },await (await Environment.get_global("words_and_quotes"))(text)) 
            })())) 
        })()) 
    })())
};__obj__1["remove_if"]=async function(f,container) {
    let __collector;
    let __result;
    let __action;
    __collector=[];
    __result=null;
    __action=async function(v) {
        if (check_true (await (await Environment.get_global("not"))(await (async function(){
            let __array_op_rval__64=f;
             if (__array_op_rval__64 instanceof Function){
                return await __array_op_rval__64(v) 
            } else {
                return [__array_op_rval__64,v]
            }
        })()))){
            return v
        }
    };
    ;
    await (async function() {
        let __for_body__67=async function(__item) {
            __result=await __action(__item);
            if (check_true (__result)){
                return (__collector).push(__result)
            }
        };
        let __array__68=[],__elements__66=container;
        let __BREAK__FLAG__=false;
        for(let __iter__65 in __elements__66) {
            __array__68.push(await __for_body__67(__elements__66[__iter__65]));
            if(__BREAK__FLAG__) {
                 __array__68.pop();
                break;
                
            }
        }return __array__68;
         
    })();
    return __collector
};__obj__1["filter"]=async function(f,container) {
    let __collector;
    let __result;
    let __action;
    __collector=[];
    __result=null;
    __action=async function(v) {
        if (check_true (await (async function(){
            let __array_op_rval__69=f;
             if (__array_op_rval__69 instanceof Function){
                return await __array_op_rval__69(v) 
            } else {
                return [__array_op_rval__69,v]
            }
        })())){
            return v
        }
    };
    ;
    await (async function() {
        let __for_body__72=async function(__item) {
            __result=await __action(__item);
            if (check_true (__result)){
                return (__collector).push(__result)
            }
        };
        let __array__73=[],__elements__71=container;
        let __BREAK__FLAG__=false;
        for(let __iter__70 in __elements__71) {
            __array__73.push(await __for_body__72(__elements__71[__iter__70]));
            if(__BREAK__FLAG__) {
                 __array__73.pop();
                break;
                
            }
        }return __array__73;
         
    })();
    return __collector
};__obj__1["add_days"]=async function(date_obj,num_days) {
    await date_obj["setDate"].call(date_obj,await (await Environment.get_global("add"))(await date_obj["getDate"](),num_days));
    return date_obj
};__obj__1["day_of_week"]=async function(dval) {
    return await dval["getDay"]()
};__obj__1["add_hours"]=async function(date_obj,hours) {
    await date_obj["setHours"].call(date_obj,hours);
    return date_obj
};__obj__1["clear_time"]=async function(date_obj) {
    await date_obj["setHours"].call(date_obj,0,0,0,0);
    return date_obj
};__obj__1["yesterday"]=async function() {
    let d1;
    let d2;
    d1=new Date();
    d2=new Date();
    return [await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(d1,-1)),await (await Environment.get_global("add_hours"))(await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(d2,-1)),24)]
};__obj__1["next_sunday"]=async function(dval) {
    let dv=(dval|| new Date());
    ;
    return await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(dv,(7- await (await Environment.get_global("day_of_week"))(dv))))
};__obj__1["last_sunday"]=async function(dval) {
    let dv=(dval|| new Date());
    ;
    return await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(dv,(-1* await (await Environment.get_global("day_of_week"))(dv))))
};__obj__1["day_before_yesterday"]=async function() {
    let d1;
    let d2;
    d1=await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(new Date(),-2));
    d2=await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(new Date(),-1));
    return await (async function(){
        let __array_op_rval__82=d1;
         if (__array_op_rval__82 instanceof Function){
            return await __array_op_rval__82(d2) 
        } else {
            return [__array_op_rval__82,d2]
        }
    })()
};__obj__1["last_week"]=async function() {
    let d1;
    let d2;
    d1=new Date();
    d2=new Date();
    return [await (await Environment.get_global("clear_time"))(await (await Environment.get_global("add_days"))(await (await Environment.get_global("next_sunday"))(),-14)),await (await Environment.get_global("last_sunday"))()]
};__obj__1["midnight-to-midnight"]=async function(dval) {
    let d1;
    let d2;
    d1=await (await Environment.get_global("clear_time"))(new Date(dval));
    d2=await (await Environment.get_global("clear_time"))(new Date(dval));
    return await (async function(){
        let __array_op_rval__83=d1;
         if (__array_op_rval__83 instanceof Function){
            return await __array_op_rval__83(await (await Environment.get_global("add_hours"))(d2,24)) 
        } else {
            return [__array_op_rval__83,await (await Environment.get_global("add_hours"))(d2,24)]
        }
    })()
};__obj__1["date_to_string"]=async function(date_val,str_layout) {
    let split_regex;
    let comps;
    let t_flag;
    let construction;
    let t_sep;
    let acc;
    let date_comps;
    let formatter;
    let add_formatter;
    let format_desc;
    split_regex=new RegExp("([\.:\ T/, \-]+)","g");
    comps=(((str_layout instanceof String || typeof str_layout==='string')&& (str_layout).split(split_regex))|| []);
    t_flag=null;
    construction=[];
    t_sep=null;
    acc=[];
    date_comps=null;
    formatter=null;
    add_formatter=async function(key,value) {
        await async function(){
            if (check_true ((key==="fractionalSecondDigits"))) {
                return (construction).push("fractionalSecond")
            } else if (check_true ((key==="hour24"))) {
                {
                    (construction).push("hour");
                    await async function(){
                        format_desc["hourCycle"]="h24";
                        return format_desc;
                        
                    }();
                    key="hour"
                }
            } else {
                (construction).push(key)
            }
        } ();
        return await async function(){
            format_desc[key]=value;
            return format_desc;
            
        }()
    };
    format_desc=new Object();
    await (async function() {
        let __for_body__88=async function(c) {
            return await async function(){
                if (check_true ((c==="yyyy"))) {
                    return await add_formatter("year","numeric")
                } else if (check_true ((c==="yy"))) {
                    return await add_formatter("year","2-digit")
                } else if (check_true ((c==="dd"))) {
                    return await add_formatter("day","2-digit")
                } else if (check_true ((c==="d"))) {
                    return await add_formatter("day","numeric")
                } else if (check_true ((c==="MM"))) {
                    return await add_formatter("month","2-digit")
                } else if (check_true ((c==="M"))) {
                    return await add_formatter("month","numeric")
                } else if (check_true ((c==="HH"))) {
                    return await add_formatter("hour24","2-digit")
                } else if (check_true ((c==="H"))) {
                    return await add_formatter("hour24","numeric")
                } else if (check_true ((c==="h"))) {
                    return await add_formatter("hour","2-digit")
                } else if (check_true ((c==="h"))) {
                    return await add_formatter("hour","numeric")
                } else if (check_true ((c==="mm"))) {
                    return await add_formatter("minute","2-digit")
                } else if (check_true ((c==="m"))) {
                    return await add_formatter("minute","numeric")
                } else if (check_true ((c==="s"))) {
                    return await add_formatter("second","numeric")
                } else if (check_true ((c==="ss"))) {
                    return await add_formatter("second","2-digit")
                } else if (check_true ((c==="sss"))) {
                    return await add_formatter("fractionalSecondDigits",3)
                } else if (check_true ((c==="TZ"))) {
                    return await add_formatter("timeZoneName","short")
                } else if (check_true ((c==="D"))) {
                    return await add_formatter("weekday","narrow")
                } else if (check_true ((c==="DD"))) {
                    return await add_formatter("weekday","short")
                } else if (check_true ((c==="DDD"))) {
                    return await add_formatter("weekday","long")
                } else {
                    return (construction).push(c)
                }
            } ()
        };
        let __array__89=[],__elements__87=comps;
        let __BREAK__FLAG__=false;
        for(let __iter__86 in __elements__87) {
            __array__89.push(await __for_body__88(__elements__87[__iter__86]));
            if(__BREAK__FLAG__) {
                 __array__89.pop();
                break;
                
            }
        }return __array__89;
         
    })();
    formatter=new Intl.DateTimeFormat([],format_desc);
    date_comps=await (async function(){
         return await (await Environment.get_global("date_components"))(date_val,formatter) 
    })();
    return (await (async function() {
        let __for_body__92=async function(key) {
            return (date_comps[key]|| key)
        };
        let __array__93=[],__elements__91=construction;
        let __BREAK__FLAG__=false;
        for(let __iter__90 in __elements__91) {
            __array__93.push(await __for_body__92(__elements__91[__iter__90]));
            if(__BREAK__FLAG__) {
                 __array__93.pop();
                break;
                
            }
        }return __array__93;
         
    })()).join("")
};__obj__1["is_even?"]=async function(x) {
    return (0===(x% 2))
};__obj__1["is_odd?"]=async function(x) {
    return (1===(x% 2))
};__obj__1["set_path_value"]=async function(root,path,value) {
    if (check_true ((path instanceof Array))){
        {
            let idx;
            let parent;
            idx=await (await Environment.get_global("last"))(path);
            parent=await (await Environment.get_global("resolve_path"))(await (await Environment.get_global("chop"))(path),root);
            if (check_true (parent)){
                await async function(){
                    parent[idx]=value;
                    return parent;
                    
                }()
            };
            return parent
        }
    } else {
        {
            return root
        }
    }
};__obj__1["has_items?"]=async function(value) {
    if (check_true ((await (await Environment.get_global("not"))((null===value))&& (await (await Environment.get_global("length"))(value)>0)))){
        return true
    } else {
        return false
    }
};__obj__1["match_all_js"]=function anonymous(regex_str,search_string
) {
let rval=[];let regex=new RegExp(regex_str,'g'); while ((m = regex.exec(search_string)) !== null) {rval.push(m);  if (m.index === regex.lastIndex) {  regex.lastIndex++; }  } return rval;
};__obj__1["match_all"]=async function(regex_str,search_string) {
    return await (await Environment.get_global("match_all_js"))(regex_str,search_string)
};__obj__1["chop_front"]=async function(container,amount) {
    amount=(amount|| 1);
    return await async function(){
        if (check_true ((container instanceof String || typeof container==='string'))) {
            return await container["substr"].call(container,amount)
        } else if (check_true ((container instanceof Array))) {
            return await container["slice"].call(container,amount)
        } else {
            throw new Error("chop: container must be a string or array");
            
        }
    } ()
};__obj__1["compile_lisp"]=async function(text) {
    if (check_true (text)){
        return await (await Environment.get_global("reader"))(text)
    } else {
        return text
    }
};__obj__1["has_the_keys?"]=async function(key_list,obj) {
    let is_fit;
    is_fit=true;
    {
        await (async function() {
            let __for_body__97=async function(item) {
                return is_fit=((await (await Environment.get_global("resolve_path"))(item,obj)|| false)&& is_fit)
            };
            let __array__98=[],__elements__96=key_list;
            let __BREAK__FLAG__=false;
            for(let __iter__95 in __elements__96) {
                __array__98.push(await __for_body__97(__elements__96[__iter__95]));
                if(__BREAK__FLAG__) {
                     __array__98.pop();
                    break;
                    
                }
            }return __array__98;
             
        })();
        return is_fit
    }
};__obj__1["demarked_number"]=async function(value,separator,precision,no_show_sign) {
    let abs_value;
    let vf;
    let comps;
    let l;
    let sep;
    let prec;
    let sign;
    abs_value=await Math.abs(value);
    vf=await Math.floor(abs_value);
    comps=(await (await Environment.get_global("split"))((""+ vf),"")).slice(0).reverse();
    l=await (await Environment.get_global("length"))(comps);
    sep=(separator|| ",");
    prec=(await (async function(){
        if (check_true ((null==precision))){
            return 2
        }
    })()|| precision);
    sign=await (async function(){
        if (check_true (((value<0)&& await (await Environment.get_global("not"))(no_show_sign)))){
            return "-"
        } else {
            return ""
        }
    })();
    if (check_true ((l>3))){
        await (async function() {
            let __for_body__101=async function(p) {
                return await comps["splice"].call(comps,p,0,sep)
            };
            let __array__102=[],__elements__100=(await (await Environment.get_global("range"))(3,l,3)).slice(0).reverse();
            let __BREAK__FLAG__=false;
            for(let __iter__99 in __elements__100) {
                __array__102.push(await __for_body__101(__elements__100[__iter__99]));
                if(__BREAK__FLAG__) {
                     __array__102.pop();
                    break;
                    
                }
            }return __array__102;
             
        })()
    };
    return (sign+ ((comps).slice(0).reverse()).join("")+ await (await Environment.get_global("chop_front"))(await (async function() {
        {
             let __call_target__=(abs_value% vf), __call_method__="toFixed";
            return await __call_target__[__call_method__].call(__call_target__,prec)
        } 
    })()))
};__obj__1["measure_time"]=async function(...forms) {
    return ["=:let",[["=:end","=:nil"],["=:rval","=:nil"],["=:start",["=:time_in_millis"]]],["=:=","=:rval",["=:do",].concat(forms)],{ "time":["=:-",["=:time_in_millis"],"=:start"],"result":"=:rval"
}]
};__obj__1["compare_list_ends"]=async function(l1,l2) {
    let long_short;
    let long;
    let short;
    let match_count;
    let idx;
    let matcher;
    long_short=await (async function(){
        if (check_true ((await (await Environment.get_global("length"))(l1)>await (await Environment.get_global("length"))(l2)))){
            return [l1,l2]
        } else {
            return [l2,l1]
        }
    })();
    long=((long_short && long_short["0"])).slice(0).reverse();
    short=((long_short && long_short["1"])).slice(0).reverse();
    match_count=0;
    idx=0;
    matcher=async function(val) {
        if (check_true ((val===long[idx]))){
            match_count+=1
        };
        return idx=(idx+ 1)
    };
    await (await Environment.get_global("map"))(matcher,short);
    if (check_true ((match_count===await (await Environment.get_global("length"))(short)))){
        return true
    } else {
        return false
    }
};__obj__1["hsv_to_rgb"]=function anonymous(h,s,v
) {
{
        var r, g, b, i, f, p, q, t;
        if (arguments.length === 1) {
            s = h.s, v = h.v, h = h.h;
        }
        i = Math.floor(h * 6);
        f = h * 6 - i;
        p = v * (1 - s);
        q = v * (1 - f * s);
        t = v * (1 - (1 - f) * s);
        switch (i % 6) {
            case 0: r = v, g = t, b = p; break;
            case 1: r = q, g = v, b = p; break;
            case 2: r = p, g = v, b = t; break;
            case 3: r = p, g = q, b = v; break;
            case 4: r = t, g = p, b = v; break;
            case 5: r = v, g = p, b = q; break;
        }
        return {
            r: r,
            g: g,
            b: b
        }
    }
};__obj__1["rgb_to_text"]=async function(rgb) {
    return (await (async function() {
        let __for_body__105=async function(v) {
            let vs=await (async function() {
                {
                     let __call_target__=await Math.round((v* 255)), __call_method__="toString";
                    return await __call_target__[__call_method__].call(__call_target__,16)
                } 
            })();
            ;
            if (check_true ((await (await Environment.get_global("length"))(vs)===1))){
                return ("0"+ vs)
            } else {
                return vs
            }
        };
        let __array__106=[],__elements__104=rgb;
        let __BREAK__FLAG__=false;
        for(let __iter__103 in __elements__104) {
            __array__106.push(await __for_body__105(__elements__104[__iter__103]));
            if(__BREAK__FLAG__) {
                 __array__106.pop();
                break;
                
            }
        }return __array__106;
         
    })()).join("")
};__obj__1["text_to_rgb"]=async function(rgb_string) {
    if (check_true (rgb_string)){
        return await (async function(){
            let __array_op_rval__107=(await parseInt((await (async function(){
                 return await (await Environment.get_global("nth"))([0,1],rgb_string) 
            })()).join(''),16)/ 255);
             if (__array_op_rval__107 instanceof Function){
                return await __array_op_rval__107((await parseInt((await (async function(){
                     return await (await Environment.get_global("nth"))([2,3],rgb_string) 
                })()).join(''),16)/ 255),(await parseInt((await (async function(){
                     return await (await Environment.get_global("nth"))([4,5],rgb_string) 
                })()).join(''),16)/ 255)) 
            } else {
                return [__array_op_rval__107,(await parseInt((await (async function(){
                     return await (await Environment.get_global("nth"))([2,3],rgb_string) 
                })()).join(''),16)/ 255),(await parseInt((await (async function(){
                     return await (await Environment.get_global("nth"))([4,5],rgb_string) 
                })()).join(''),16)/ 255)]
            }
        })()
    } else {
        return null
    }
};__obj__1["rgb_to_hsv"]=async function(rgb) {
    if (check_true (rgb)){
        {
            let computedH;
            let computedS;
            let computedV;
            let r;
            let g;
            let b;
            let minRGB;
            let maxRGB;
            let d;
            let h;
            computedH=0;
            computedS=0;
            computedV=0;
            r=(rgb && rgb["0"]);
            g=(rgb && rgb["1"]);
            b=(rgb && rgb["2"]);
            minRGB=await Math.min(r,await Math.min(g,b));
            maxRGB=await Math.max(r,await Math.max(g,b));
            d=null;
            h=null;
            if (check_true ((minRGB===maxRGB))){
                return [0,0,minRGB];
                
            };
            d=await (async function(){
                 return await async function(){
                    if (check_true ((r===minRGB))) {
                        return (g- b)
                    } else if (check_true ((b===minRGB))) {
                        return (r- g)
                    } else {
                        return (b- r)
                    }
                } () 
            })();
            h=await (async function(){
                 return await async function(){
                    if (check_true ((r===minRGB))) {
                        return 3
                    } else if (check_true ((b===minRGB))) {
                        return 1
                    } else {
                        return 5
                    }
                } () 
            })();
            await console.log("");
            computedH=((60* (h- (d/ (maxRGB- minRGB))))/ 360);
            computedS=((maxRGB- minRGB)/ maxRGB);
            computedV=maxRGB;
            return await (async function(){
                let __array_op_rval__109=computedH;
                 if (__array_op_rval__109 instanceof Function){
                    return await __array_op_rval__109(computedS,computedV) 
                } else {
                    return [__array_op_rval__109,computedS,computedV]
                }
            })()
        }
    }
};__obj__1["tint_rgb"]=async function(rgb,tint_factor) {
    if (check_true ((rgb&& tint_factor))){
        return await (async function() {
            let __for_body__112=async function(c) {
                c=(255* c);
                return (await (await Environment.get_global("add"))(c,((255- c)* tint_factor))/ 255)
            };
            let __array__113=[],__elements__111=rgb;
            let __BREAK__FLAG__=false;
            for(let __iter__110 in __elements__111) {
                __array__113.push(await __for_body__112(__elements__111[__iter__110]));
                if(__BREAK__FLAG__) {
                     __array__113.pop();
                    break;
                    
                }
            }return __array__113;
             
        })()
    } else {
        return rgb
    }
};__obj__1["shade_rgb"]=async function(rgb,shade_factor) {
    if (check_true ((rgb&& shade_factor))){
        return await (async function() {
            let __for_body__116=async function(c) {
                c=(255* c);
                return ((c* (1- shade_factor))/ 255)
            };
            let __array__117=[],__elements__115=rgb;
            let __BREAK__FLAG__=false;
            for(let __iter__114 in __elements__115) {
                __array__117.push(await __for_body__116(__elements__115[__iter__114]));
                if(__BREAK__FLAG__) {
                     __array__117.pop();
                    break;
                    
                }
            }return __array__117;
             
        })()
    } else {
        return rgb
    }
};__obj__1["modify_color_ts"]=async function(rgb,factor) {
    if (check_true ((0<=factor))){
        return await (await Environment.get_global("tint_rgb"))(rgb,await Math.abs(factor))
    } else {
        return await (await Environment.get_global("shade_rgb"))(rgb,await Math.abs(factor))
    }
};__obj__1["is_lower?"]=async function(v) {
    let c=await v["charCodeAt"].call(v,0);
    ;
    return ((c>96)&& (c<123))
};__obj__1["is_upper?"]=async function(v) {
    let c=await v["charCodeAt"].call(v,0);
    ;
    return ((c>64)&& (c<91))
};__obj__1["camel_case_to_lower"]=async function(val) {
    let last_upper=0;
    ;
    return (await (async function(){
         return await (await Environment.get_global("map"))(async function(v,i) {
            return await async function(){
                if (check_true (((i>0)&& await (await Environment.get_global("is_upper?"))(v)&& (0===last_upper)))) {
                    {
                        last_upper=1;
                        return ("_"+ (v).toLowerCase())
                    }
                } else if (check_true (((i>0)&& await (await Environment.get_global("is_upper?"))(v)&& (last_upper>0)))) {
                    {
                        last_upper=2;
                        return (v).toLowerCase()
                    }
                } else if (check_true (((i===0)&& await (await Environment.get_global("is_upper?"))(v)))) {
                    return (v).toLowerCase()
                } else if (check_true (await (await Environment.get_global("is_lower?"))(v))) {
                    {
                        return await async function(){
                            if (check_true ((last_upper===2))) {
                                {
                                    last_upper=0;
                                    return ("_"+ (v).toLowerCase())
                                }
                            } else {
                                {
                                    last_upper=0;
                                    return (v).toLowerCase()
                                }
                            }
                        } ()
                    }
                } else {
                    {
                        last_upper=0;
                        return v
                    }
                }
            } ()
        },await (await Environment.get_global("split"))(val,"")) 
    })()).join("")
};__obj__1["scan_list"]=async function(regex,container) {
    let expr=regex;
    ;
    if (check_true (await (await Environment.get_global("not"))((await (await Environment.get_global("sub_type"))(regex)==="RegExp")))){
        {
            expr=new RegExp(regex)
        }
    };
    let cnt=0;
    ;
    let results=[];
    ;
    let r=null;
    ;
    await (async function() {
        let __for_body__120=async function(item) {
            r=await (async function(){
                if (check_true ((item instanceof String || typeof item==='string'))){
                    return await item["match"].call(item,expr)
                } else {
                    return await (async function() {
                        {
                             let __call_target__=(""+ item), __call_method__="match";
                            return await __call_target__[__call_method__].call(__call_target__,expr)
                        } 
                    })()
                }
            })();
            if (check_true (r)){
                (results).push(cnt)
            };
            return cnt+=1
        };
        let __array__121=[],__elements__119=(container|| []);
        let __BREAK__FLAG__=false;
        for(let __iter__118 in __elements__119) {
            __array__121.push(await __for_body__120(__elements__119[__iter__118]));
            if(__BREAK__FLAG__) {
                 __array__121.pop();
                break;
                
            }
        }return __array__121;
         
    })();
    return results
};__obj__1["gather_up_prop"]=async function(key,values) {
    return await async function(){
        if (check_true ((values instanceof Array))) {
            return await (await Environment.get_global("no_empties"))(await (async function(){
                 return await (await Environment.get_global("map"))(async function(v) {
                    return await async function(){
                        if (check_true ((v instanceof Array))) {
                            return await (await Environment.get_global("gather_up_prop"))(key,v)
                        } else if (check_true ((v instanceof Object))) {
                            return v[key]
                        }
                    } ()
                },values) 
            })())
        } else if (check_true ((values instanceof Object))) {
            return values[key]
        }
    } ()
};__obj__1["sum_up_prop"]=async function(key,values) {
    return await (await Environment.get_global("sum"))(await (await Environment.get_global("flatten"))(await (await Environment.get_global("gather_up_prop"))(key,values)))
};__obj__1["scan_for"]=async function(non_nil_prop,list_of_objects) {
    let rval=null;
    ;
    await (async function() {
        let __for_body__124=async function(val) {
            if (check_true ((val&& val[non_nil_prop]))){
                {
                    rval=val[non_nil_prop];
                    return __BREAK__FLAG__=true;
                    return
                }
            }
        };
        let __array__125=[],__elements__123=(list_of_objects|| []);
        let __BREAK__FLAG__=false;
        for(let __iter__122 in __elements__123) {
            __array__125.push(await __for_body__124(__elements__123[__iter__122]));
            if(__BREAK__FLAG__) {
                 __array__125.pop();
                break;
                
            }
        }return __array__125;
         
    })();
    return rval
};__obj__1["make_sort_buckets"]=async function() {
    let buckets;
    let push_to;
    buckets=new Object();
    push_to=async function(category,thing) {
        let place;
        place=null;
        if (check_true ((null==category))){
            return buckets
        } else {
            {
                place=buckets[category];
                if (check_true (place)){
                    (place).push(thing)
                } else {
                    await async function(){
                        buckets[category]=await (async function(){
                            let __array_op_rval__127=thing;
                             if (__array_op_rval__127 instanceof Function){
                                return await __array_op_rval__127() 
                            } else {
                                return [__array_op_rval__127]
                            }
                        })();
                        return buckets;
                        
                    }()
                };
                return thing
            }
        }
    };
    return push_to
};__obj__1["bytes_from_int_16"]=function anonymous(x
) {
{ let bytes = []; let i = 2; do { bytes[(1 - --i)] = x & (255); x = x>>8; } while ( i ) return bytes;}
};__obj__1["int_16_from_bytes"]=function anonymous(x,y
) {
 { let val = 0;  val +=y; val = val << 8; val +=x; return val; }
};__obj__1["truncate"]=async function(len,value,trailer) {
    trailer=(trailer|| "");
    return await async function(){
        if (check_true ((value instanceof String || typeof value==='string'))) {
            if (check_true (((value && value.length)>len))){
                return await (await Environment.get_global("add"))(await value["substr"].call(value,0,len),trailer)
            } else {
                return value
            }
        } else if (check_true ((value instanceof Array))) {
            return await value["slice"].call(value,0,len)
        } else {
            return value
        }
    } ()
};__obj__1["parse_csv"]=async function(csv_data,options) {
    let lbuffer;
    let sepval;
    let sepval_r;
    let fixer_r;
    let interruptions;
    let line;
    let count;
    let tmp;
    let rval;
    let match_list;
    let lines;
    let total_lines;
    lbuffer=null;
    sepval=((options && options["separator"])|| ",");
    sepval_r=new RegExp(sepval,"g");
    fixer_r=new RegExp("!SEPVAL!","g");
    interruptions=((options && options["interruptions"])|| false);
    line=null;
    count=0;
    tmp=null;
    rval=null;
    match_list=null;
    lines=await (async function(){
         return await async function(){
            if (check_true ((csv_data instanceof Array))) {
                return csv_data
            } else if (check_true ((csv_data instanceof String || typeof csv_data==='string'))) {
                return (await (async function(){
                     return await (await Environment.get_global("replace"))(new RegExp("[\r]+","g"),"",csv_data) 
                })()).split("\n")
            }
        } () 
    })();
    total_lines=(lines && lines.length);
    if (check_true (interruptions)){
        await (await Environment.get_global("sleep"))(0.1)
    };
    return await (async function() {
        let __for_body__130=async function(v) {
            if (check_true (interruptions)){
                {
                    count+=1;
                    if (check_true (((count% 1000)===0))){
                        {
                            await (await Environment.get_global("sleep"))(0.1);
                            if (check_true ((options && options["notifier"]))){
                                await (async function(){
                                    let __array_op_rval__132=(options && options["notifier"]);
                                     if (__array_op_rval__132 instanceof Function){
                                        return await __array_op_rval__132((count/ total_lines),count,total_lines) 
                                    } else {
                                        return [__array_op_rval__132,(count/ total_lines),count,total_lines]
                                    }
                                })()
                            }
                        }
                    }
                }
            };
            match_list=(await (async function(){
                 return await (await Environment.get_global("scan_str"))(new RegExp("\"([A-Za-z0-9, .  :;]+)\"","g"),v) 
            })()).slice(0).reverse();
            line=await (async function(){
                if (check_true (((match_list && match_list.length)>0))){
                    {
                        rval=[];
                        await (async function() {
                            let __for_body__135=async function(m) {
                                return (rval).push(await (async function(){
                                    let __array_op_rval__137=(m && m["index"]);
                                     if (__array_op_rval__137 instanceof Function){
                                        return await __array_op_rval__137(await (async function(){
                                             return await (await Environment.get_global("replace"))(sepval_r,"!SEPVAL!",m["1"]) 
                                        })(),m["1"]) 
                                    } else {
                                        return [__array_op_rval__137,await (async function(){
                                             return await (await Environment.get_global("replace"))(sepval_r,"!SEPVAL!",m["1"]) 
                                        })(),m["1"]]
                                    }
                                })())
                            };
                            let __array__136=[],__elements__134=match_list;
                            let __BREAK__FLAG__=false;
                            for(let __iter__133 in __elements__134) {
                                __array__136.push(await __for_body__135(__elements__134[__iter__133]));
                                if(__BREAK__FLAG__) {
                                     __array__136.pop();
                                    break;
                                    
                                }
                            }return __array__136;
                             
                        })();
                        tmp=v;
                        await (async function() {
                            let __for_body__140=async function(r) {
                                return tmp=(""+ await tmp["substr"].call(tmp,0,(r && r["0"]))+ (r && r["1"])+ await tmp["substr"].call(tmp,(2+ (r && r["0"])+ await (await Environment.get_global("length"))((r && r["2"])))))
                            };
                            let __array__141=[],__elements__139=rval;
                            let __BREAK__FLAG__=false;
                            for(let __iter__138 in __elements__139) {
                                __array__141.push(await __for_body__140(__elements__139[__iter__138]));
                                if(__BREAK__FLAG__) {
                                     __array__141.pop();
                                    break;
                                    
                                }
                            }return __array__141;
                             
                        })();
                        return tmp
                    }
                } else {
                    return v
                }
            })();
            return await (async function() {
                let __for_body__144=async function(segment) {
                    return await (await Environment.get_global("replace"))(fixer_r,sepval,segment)
                };
                let __array__145=[],__elements__143=(line).split(sepval);
                let __BREAK__FLAG__=false;
                for(let __iter__142 in __elements__143) {
                    __array__145.push(await __for_body__144(__elements__143[__iter__142]));
                    if(__BREAK__FLAG__) {
                         __array__145.pop();
                        break;
                        
                    }
                }return __array__145;
                 
            })()
        };
        let __array__131=[],__elements__129=lines;
        let __BREAK__FLAG__=false;
        for(let __iter__128 in __elements__129) {
            __array__131.push(await __for_body__130(__elements__129[__iter__128]));
            if(__BREAK__FLAG__) {
                 __array__131.pop();
                break;
                
            }
        }return __array__131;
         
    })()
};__obj__1["to_csv"]=async function(rows,delimiter) {
    let quote_quoter=new RegExp("\"","g");
    ;
    return (await (async function() {
        let __for_body__148=async function(row) {
            return (await (async function(){
                 return await (await Environment.get_global("map"))(async function(v) {
                    if (check_true (((v instanceof String || typeof v==='string')&& (await (await Environment.get_global("contains?"))(" ",(""+ v+ ""))|| await (await Environment.get_global("contains?"))(delimiter,v)|| await (await Environment.get_global("contains?"))("\"",v))))){
                        return ("\""+ await (async function(){
                             return await (await Environment.get_global("replace"))(quote_quoter,"\"\"",v) 
                        })()+ "\"")
                    } else {
                        return (""+ v+ "")
                    }
                },row) 
            })()).join(await (async function(){
                if (check_true (delimiter)){
                    return delimiter
                } else {
                    return ","
                }
            })())
        };
        let __array__149=[],__elements__147=rows;
        let __BREAK__FLAG__=false;
        for(let __iter__146 in __elements__147) {
            __array__149.push(await __for_body__148(__elements__147[__iter__146]));
            if(__BREAK__FLAG__) {
                 __array__149.pop();
                break;
                
            }
        }return __array__149;
         
    })()).join("\n")
};__obj__1["squeeze"]=async function(s) {
    return await (await Environment.get_global("replace"))(new RegExp(" ","g"),"",s)
};__obj__1["ensure_keys"]=async function(keylist,obj,default_value) {
    default_value=await (async function(){
        if (check_true ((undefined===default_value))){
            return null
        } else {
            return default_value
        }
    })();
    if (check_true ((null==obj))){
        {
            obj=new Object()
        }
    };
    await (async function() {
        let __for_body__152=async function(key) {
            if (check_true ((undefined===obj[key]))){
                {
                    return await async function(){
                        obj[key]=default_value;
                        return obj;
                        
                    }()
                }
            }
        };
        let __array__153=[],__elements__151=keylist;
        let __BREAK__FLAG__=false;
        for(let __iter__150 in __elements__151) {
            __array__153.push(await __for_body__152(__elements__151[__iter__150]));
            if(__BREAK__FLAG__) {
                 __array__153.pop();
                break;
                
            }
        }return __array__153;
         
    })();
    return obj
};__obj__1["show_time_in_words"]=function anonymous(seconds,options
) {
options=options||{}
        if (options['longForm']==null) {
            if (seconds<2) return "now";
            if (seconds<61) return parseInt(seconds)+" secs";
            if ((seconds>61)&&(seconds<120)) return "1 min";
            if (seconds<3601) {
                // less than an hour
                return parseInt(seconds/60)+" mins";
            }
        } else if (options['longForm']==true) {
            if (seconds<61) return parseInt(seconds)+" seconds";
            if ((seconds>61)&&(seconds<120)) return "1 minute";
            if (seconds<3601) {
                // less than an hour
                return parseInt(seconds / 60) + " minutes";
            }
        }

        if (seconds<86400) {
            return parseInt(seconds/3600)+" hours";
        }
        if (seconds<172801) {
            return parseInt(seconds/86400)+" day";
        }
        if (seconds < 31536000) {
            return parseInt(seconds/86400)+" days";
        }
        if (seconds < (2 * 31536000)) {
            return "1 year";
        }
        return parseInt(seconds/31536000)+" years";
 
};__obj__1["ago"]=async function(dval) {
    return await (await Environment.get_global("show_time_in_words"))(((await (async function() {
        {
             let __call_target__=new Date(), __call_method__="getTime";
            return await __call_target__[__call_method__]()
        } 
    })()- await dval["getTime"]())/ 1000))
};__obj__1["lifespan"]=async function(dval) {
    return await (await Environment.get_global("show_time_in_words"))(((await dval["getTime"]()- await (async function() {
        {
             let __call_target__=new Date(), __call_method__="getTime";
            return await __call_target__[__call_method__]()
        } 
    })())/ 1000))
};__obj__1["juno_logo"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAArCAYAAAA9iMeyAAABoWlDQ1BJQ0MgUHJvZmlsZQAAKJF9kL9LQlEUx79qqaQRkUODw4OsSUNsaUwNRDAQM0hr6Pn8Cfp6PZ9U0Bi0NAgFZQ2VDS3NtTq0BkFRBNHYH2A/lpDXuT5DLerA5Xz43nPOPfcL6Ld5Scr3uIGCqMiRgI+bj8U50wvMMMICO2y8UJS84XAIFN+5Oz7uoWP51sVmOeOHK1VLNV4fNO7a8hXxd31X9CdTRQHQccRTgiQrxEvEI6uKxHiT2CbTUsT7jDManzNOaFxr1kQjfuI7Yk7I8kniN2KnkJULgJ7NdyQLSdL10xqLjLOMEx29mQ4u5EtCa0/2Q2tKnJtl9XTsCCCIGYTBIYEScshDgYuySEoREbr3Kak1hTX7l6V1OZfJKpyXHEpxQVEYd3Iet8cDML9/+tjWlo+ByXfAUG5riT3gcgsYfmxrjiNggLy6uJJ4mW9KBjr6dBqon5HNMWDoBuhbKKYnPNqPrD6g91lVX0cB0w7QKKvq54mqNqrU/ATURM271iycPgDRDSB0DVQOgLEMvbn4h0fmpkctH/6tafn4BTJpfiFP7xAAAAAAhGVYSWZNTQAqAAAACAAGAQYAAwAAAAEAAgAAARIAAwAAAAEAAQAAARoABQAAAAEAAABWARsABQAAAAEAAABeASgAAwAAAAEAAgAAh2kABAAAAAEAAABmAAAAAAAAAEgAAAABAAAASAAAAAEAAqACAAQAAAABAAAAyKADAAQAAAABAAAAKwAAAABnD8GIAAAACXBIWXMAAAsTAAALEwEAmpwYAAADF2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj4xPC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzI8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NDA4PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjg3PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+ChRLZm0AAC/BSURBVHgB7Z17sF1XedjX3uecq5eF3za2wTaOgcQmHcABJkaSLzA20ODJJK47aUnbSUszQ9Im6TRth5Z0TqdTWtqBpqVPmtLyyiRVHVJoalJjc/EDg4kggG0eAfmJbVl+ybakq3vO2bu/37fWPjq6urKupWvRP1j2uXvvtdf61vf+vrX22lsp/aj8iAM/4sAROVAd8c4Lf+P5jN0eAZ3VwjhS/yOAXZNqcfthjLsmyP8ISObAahVsrfnFuNfWKe3meCZK5PG5ysJ4hbv0uayf0uYZJXxmBTiL1K2nzQ5hzLRdAeKxVxVcHKsrjjl73dWf2aS0Ej3X9mjhj/LsDJxcc/DvScBd6f5++uwG9l1LB9se75k47R6kdADY647Auw2l/nrHPUKbI+IB3E4PlF3Hr0tKh7vL0evuXL4+V+n0Qb3abtvZ9rPnzwXkh3lviGEcU4GB0zJ7Pq1cxcmx9nsO0MdMzyzMNcQrDG0W9rGeH6ucjjYecOfXp/T2dRxxcC9kkReO4e/SuZR+ekP+rX7cNRTMagi9DG+0Y5Tmtl6S2upv02Mzv2f5dRFigsF7XqWqWsL216e2fTyN1/3blD63h3rKEAYPm7Txjeempd67abkhVS39KrxDiwelV1M1qU4yf5KatAisp9Oo+gie27EUvO3WoMhoosH6bS9Lk+rqwLdqD4BCDX29wKutGA/cqjQCvZOovytNbv50Gbzjf5v6829L1eRi2j5D2zGwgN3CL+HVA+oWA2aivmr3xhgJHkVpqzSpmzSYfD0t3rozK9/19DvmIl7w8w0vYriT0voKhe43qapHaf+Bg15406BJe5fg5Qb4f+OT9DkKX1XSI0Y4+PR26H0Upe5De59xFoF7Fr+n6Tfg+oDn/LrofC26MmTYa8F3O/XPp6iLF4Hvc/cDkRNZNptCjFLTnoUivAOhn4oY9nBEACguql0UveJ8Qj3KX+1OGxY/mvbTjpsoZFbw8dyp6P9fp25TGESIFMPoShPpyohLlez+tKF3HTAwkHn6Lxxs17U/puMBYKPM4/Yiju89SI/GoYKDj3ZradMSCnYG178PZZ2BcMMUAyFVzc+RYf0yOvYsbeFT22IQGkAND3pc0i5gySfp4hpIUckgdXsSRvIF6Lsmpeuf4ghPFxa5fwxlHu9O37kNV2HU/wwKXwR+wGowwl7Hu15aato06KOkS/vT6PKrUvriowwWkjh80BnjGGx9LehvAfUfg5YL6aGjZMy94LxJnqonwN3Eby+/HvWMnQacnwbNMnUTTW7kehvj7YIX2zivuNfiiOR1womE893PcULdo/DzG6lX3ZOWFsjXcNRpB32NZEdOD0+wgZR8ta4fB+HvgPhp0PoEx5P44SUrvR7Mkcd4zFBuFK3p40GiwJh5GLWAg1l6Mo17dwJnXW4eHlvhwaiW9qGZKhJeOz2WmkWNcI1Ll5fX+xjuHoA/Bg0YssoMPvlItYaCeab2JVw8vDIS7bdRAn5JfoCrwk4oeoUAMZaUCg9CCWBQpeysl2Z5xnVzdupP/iYc+FfwCOOap24BfhxjmUz2pxqZVIno0AIvxlZ5SVWCv+IKfjX4iO6KhXvhBHK06239GVr9IvDO4XgusAdQIS0K3Z/0aCRGSq6tCjp1CBRwkOq4ETjYvvChFY4/6yxNaYuTSY8Dbw/O+ck0uOIuun8sjRb+FONQ52KQ6LHsj8BOYHEiGQWhVacg9xeDmsoMk4MoGB/Idt6R9jCpbWRYKXdlGG0Pr4qBJbxbViCNwSI828g0jAzYOQUrtK40kbfbcZRqgkBqxjOdaqGlKspsuqgQNZgQuoJbmectaVQiCpiKZcPSqFQii0oJTUGX18LpaPRaY3SsjQz33tTf1qTxzR9gAcQ2jt0pjG1XX/oYeSNNAcOjOGgJKnuhkbPUMv7czLV1XRnSZzhJvSveDoveh1TO5KdM8PBGfA1Q4xN2OBbhz0Ub7SNkK2+DhxkTYmuB7pH0NVJrIoepYPDF27YyC+lH69Yo1RLBK0JPZWT8Bfj0Jeo+kMa33IYRQ8Ph6dbKwhL8C1K6CNLflybj74H8Poh6hqE0AJkFkk1Wqor8uw0G7k31OHufwOlSmLI9pf3tYurXD8IcjKQaA0tPkHN/jSoUkXAbHi49kurevuh+yKpXrjn2v90KTh9BTJ5EloxnFIy5g/SMQnhNeF4VnrlFRVTgTAHOFucYKf2AauYg0N1Aj/MofWDdGYiRhF8D3KAxUjB5V5QX+HUoyeuSacxo+1fTMaVaha5J/TTj3JPHYtxag9GAwxGoyIwbRovMevJ6WRlyfwgfyPfr9ipumvp8G4qQJw4yy8gUyL7Com3Hm3AsS6mua7y+vFJXSc/hRaTkGmU4Ivlsv/WgshtcjTDy0ghEG0olT6ZOk4qGiNKeTN2bYSMGczXp7Xb1Qz4Ka1pOsIGUcaslCO6djqxfBrGE6S6N0BN0Hgvh5xC7LjVz5qjLCh6zas+m8nR+qFE3UY9YrwJCbI0Qg0l98nMYkh5I6QWIIAqjVeAV8yIUPIxSAfNzei42qVIRzuKcqDCP4JalPm2zCRlCC/S7OFF5xNAPmlI541ApxACqMDkJz+sNxosc/DWAuTitv/yatLhwX165ud3xV1lKpG8nmzCKC+mk8uZFgsqxgqc6JOgIz46CL2ZlpLIU8Bk2ad2WV6CPn6TuDH7OUc4EY/WO+6Znyivw1+B0hN4zJdJoVHYNQgOxeLQfbXSmGkZEH8cm+zAqUaqYoNAmorJ9XOwRrlEOp4VjzvLYxflPp/6eT6Tx1l9N6ZaHuX9IsdMJLI8qULw/EWTQPgByzg8ep0ZGyRA8kd4/PAPXhNaqRenG3i9lWI4YSFvt4gKmhGFx2gmrY6hGozfXk6uwL1CpJvtQgoehByUSH/FvFKT0doqzl/t6UFd7Di9V0PID+j+FeuDxQFdDUWnM0SMVjf56X6KItKm4YSwYEvMuDSe8rZ6UqDzuvTOl+X+JMWIcZQWRG0cvJYJUPXCePMj4zBGNVnhyoyAXjKPRGCFJcUNRrZ8pQ+gfYrD1q4oMdnLTaGc7iNOrt0ZTrsORwbNIT3UwjsUhFNp68A/HKU/VEwvnrY5TpddYjQDoSeDpNfcbjxoTvIk5lEC5Dmcq79T/p2i5DSiXM+p1XDuGJRA4wQZyEYPvcAGinw6E978AdPDsocQqM/fFz5CqQqv47SaqVZRlZRMpy+KZVJ5FWxla+gogctLSXmVlmbcdFVq7h1HLwB3TZedpGwRQvQQQm0GbSboeLISuElP0dtCRWvLvCnx3K5xSykPSlhW9lC4Ge1K1uJWdiafZ4+Y+cU/2hGHII+ul3YiDAqtIQb+LHr+V5pjXLKV/mFdt5uHBwjJFjrGW/Sl01ZOTwfdCbqJ4kT52E2SGC4cDrE42sWjQwQGfYYke6f20ccxz+YmrclBGHMOxofARBZCxMMIYUOyQv3yzXgeZ6Q9jkOZaODjYcAwaAlmE801X2yIFLcZYeeRXqyNyD5jKIwzVaE3kBnab/l5Kr19I6Q4dNvjl4iAnsPikl7IXTzuXvhHnTYXlU13FJJOJd+SKMkNiOEJM1ehpumI9pQfT2z9DUNzDI+T1CnJwvJDPQXJ/IQzC29YhUKqP9iRW2KstM562IX2rqheBNXl7RECev0gYfw3vRg+XHav2EbKMzIcYxie+lCrh9aEn1buBgXLH/AnlUfFRqohO7QboWQ9UFU7ZkaOrACxiRMDSUVgf3pY5TPVdxr4gDbZclka34plmDZOWRywFv6aHsjR/xphOmk2PPIILCt3GSpbzKpyAc6z1KmkpQw2EKTJpdGp3UklUpUfGWYWlmHLKpzAOcYYn4dlZ2o8Jte1VZI+mhxqNTtQoQX0YglFZJ2RUIS2lacu8qcbw1CMfG6j82QHTRFBhMBhRWUypYin4FG6ckwbrzweSBjItJ9hAZvL/Jl0C8pfDFxAKiw7qqJNRegiRJI1qT0HxLuT86/wsWjdt9ysY8tt0ETX7o9a700ASF84BMDCMsAkPTeVZAdi7x1+6VbkJOXPvHAYnv3aZN1IkBQmu4dUV7AFwOw18vC/fVXLKTvGRFpe6fxLBu1SsEhUjsn+kMwibYyyJ6ilNKSBWCiU+FMHzKJlHbYMiV6/HXsizr3hnGn/h9rSqSXsxpJYUpk4/DlS9+HlAdlyKqVWkS3EBHtCyqJcvZZjxqJq/wvjKGacR7cUV5VZI0QQaY1WM2+EQGCccyWPc9qGufHsSQ5+DG068cQBErLx4wT14qONp5ZcKH8Y2pq2rgT5CICprNYzZRpYir7uHrhs5N/V6gv60758OKj9P3df4WYKHJ9hAfHK5g7E34BH2fhGC9CxGB5kL4+I5CMyOSTv3YGRVn4p31Ht1JTM/LRDut90AGS/hRue9oCe8kG1ghsuDURbJeB7Lp2UeVG4c36FExBpvOElfBpbLrKRzoQxMGl2ejomiyk5EQeFavHrsmepGLjxpJvejCJ+mvd5Nz6lsxF9+ACssX0+q6IwUCD/o1rCsd9VPgWts9NOYIu3RhFCK5jKWMu9gtQb4R5uPdHTVLKA0twEbXBq9NEcVPNK4rKDhDFTeAQY7LZnvFauMbfoSfZl3EV2zwkOPso70Cr60KGplJDiLtsi8+gy37ocPzNcm0MkOgbbWMOnncrpOoecqlAqsgVBfE4km4mXE1Rg2oDOnowHztPlJugBfXYsxxQ2nyX805h6pb8A+g0xDQ7Zk/DlRCCewdJsS78crnn4J+F3J4K5iqRCUWOIVcS1dJUC4LOPW7R9y3pWwbC4k4jX88LoRfqmPHLO7bxOFkRWt6RUYaxlBzhRP0B6gwJMrwMgoUiJiKDT3G2kDV4TXhpIw5zoTgQZ9HEoEqesLaHUVIsNhRC4+FRKNFD60xAPQR4DzHs5/g/q3IvhdHPXwRhhppxhxKHEVxoJiwevBrleTQrwrz0eey0g6upqz4P3lQAKeqbCGH8YhZA3En7RgIPu7CFL4P89zLnYHVD6nYotKBETnDcEXadNpWKzj//Y/pNEtv52r1ujvJH0qrX/zBWk8/jAQWSxgLhq6FnqmsTl3lFfqiauIOJHpE/+gQ+U5gaXk28k9NJ//MghyJCWRXbXzCMJtxcOu7BncMmB6RN7b3DuD5EHFqaoFYDzCz9UhPYReE2UNz4rSuI8pvOgo9Sa7gg2Rms1AO67TZ1QQVB2jmEv/i7HO4gpvHkqk0urhimeNHJsFh/QQEVRvbIGWEkGMLFX7WapcVXGVyn7k+zX0hOKjnKGoi6xO7WTf1b+gnnkLy6/ZIxe+xByOqq5EXxXgFH6jNJjHSHyCHLteizJ3bbtjoavX3gsm/4dxMOqa1SUNVC8cSm5fnZg6xNibxcNS8NjMvT3IuKJvS7pUE+nsF05MWuAdfNIBsvZOoLjBziW6iS9thxz8WYbxN//pzlc6Rh04DO1PYnbTfam/9UaGLnvcXBwIo6CNJCSuw9BJs9zVUZxDocObP4QC4mnbpSD9M+BIzg3jfByW5x9ibVqgh/F3MvTcxtHcrCu5TWqIHtVbqHwmt+8iURBMG7dAmHvChHF9K8fvxHn2GJwebynRaH2zIU3aLUC7iN8exlQIOXJISS4Yazz5/ypZZfbwIaESQarmPC6vpI3bcDjV82sQEQ2k1yhiv8U0WPook+6vpN782SjWh6h7Kt+L1Mx+3U88OFepYyKrV786zW37tbS08Aczymj7mVLoasCpqq8AhkaKwUqTCi5fG2DXKLLHWDXCIUj7kHvDNs09dTHypW8YBA6B1bQ4t20opTjJo1NB8RNp6ba7Up4faXTiw2/IoSvD7mTmuLxuei0OwJ9nzAX2ttXfxAH/Eh1xODG3IaqJV/CGtjjmWMrWGfWNhBo79SFIDiesxP78PJrev4KhjRMrVzMooTbhZWSiCuF2kuURxJYykFLdihAe4+jqlU9cs1eK7SXeRzF8Kk0jNql9P8wmFe/o7eMuLhRQFvGQ/fp6+G2ahKflr/hk/jJpVLEadgSYYrVEkFNUDgt0dBGkdy9Z0meo0pBKCUU0EilM61FGaOyxUiOHJulWxvk3nL0W5sGHSHdoY8oVAlaBwTGWRKmih89LWpekr4Xn2+H9SqkWKbClchWrvT3GDOE4X3BkZRQpH2MxP0jm7oslUg7tSfVkT5r0b/aM++LEzxQnsgaVEBxDXE6qb+GacqZUdbyJmmP8U/TjmczLHAn/iLHhfxi5+Ktf6gZjMsmvpM2IPM4y5cKxRfxEl7BM+PBTKM4vIkaY5mQWJchRQ0Z2SCqMs+Dxd0CScB3F/hYJeCMH8vDKHbBO6KkzYoTX1dxcBbPlHGL6GtffXNtVrA0wmTHW9zalyeRq9OYnIANvDl+DvZHu5NUnn9U0LF/WFZ7y0Y/QphhCF0HaV1D3l6EdpQzPCp3h5aRXQbqQ7RIo23Sa36PuHrzjU6jrb7P57uPc/2vUsWM1VnBidGCpbKYxwsh8y6tf16a5XW9LS1vpcwtKMc27aWaZzkHOBd+3Q5cKpGdXX4RJUUaRblmHnDa+nyPOIbaew5XexYx4NXXKkrFDptAcaHjNz8l13McxWHw5K67j6vj/lN3jTvJT82bocCeDDlmcNFxoMUWNKLeZuicRizhZRDQsO65O0J8iOIc35YHpsXKhpxQhI4BpAoLNO3v3gjtLp63K3ZWDMJrmU7Rzb4+EWo+wPIRiCrOcw4C2QTEtxevni+P8exIemrLYZ4do8wnOyPN9IBVFWqSJX0QAlkbZTpLqR8jX95Y2HK6m3Q6b3M7T+PfRxsk87brIGlGRuVg8gPRBI4uc/V0RQabev/0g3HsEh8P8p9lPGxwCY+an3So0TAklKAmf8zoUcR34HvD5y10ouArTKX83B+nhmJrfB3Yf2Hp/PT80i5NGHEd4rvz25xW2/BYfd6v7GeOT4GKEcXxoZMzYyg8N8X6MD1SBbVshHrK65/XxlkJHn2dL4+YmxkQ+saCjE1VRup+6onHCByfwUbwXHiFfnrC/1yIIdk1OWtfH/yrDlrAbAlKZCiahXHqcs/mZPtwxg6KNSGPqKzm+gx/twktyGrf4o7xDMHp5hNTbxfHrTJC97pjA6fGUu4WFaMcbGOovYJeXMiZeVCTCe3ssA0TqZIr1fWTBxDeeh3DzM8IwOryOw69z/iTGoLBQ7IiE3G8ghlUk34/R643TDdy/F0Oz7yiNbv4amxOJoNVHaIcHZOwWZXZml5WYZjqNUApgldW9Jv0a/d7L6tF/sgE/mca43Xs7kwvo9vO0d1kUOTm+96UtnJBKBA7S1vw7ziklgkyqC6HjmnyvVj4uUIiPHty9UShj0Mn2HFawopwPDsWP5Yrj/NvNpQ6cBJqvZrwXMzbj+3Q+lsblq3wBPx9OulJ3kry3yI8THkEYczoP+RoofAwcisfV42nBeltDn8wMIbCdoF7ONQVjs8+QSn4P4ajwCCr6ShhFECpvbPlAeZovWwED1sg4hHUJ8EVtjkWCff+eqMiEk5eIwmuKgNHQ8anLO3nnSI8exaD22psCHV0EmYBf/QFowMDMj0OZEJwe2AdhKmWsIh3AG0KzJXL2rNSjJ+5Mg9P/NeO8Cr78II9Lk3jiDT+r2JfEeOyOzQ/NOG9OxvmDTxTgzxMNFmRc5lFv8D0ef3wIGOTn8laHKg4qj6CA24SCgcNGlYxS5Nub3Ifc/iDXxTyI5zQseVcxoaca43fFsWLyX/f35Ii4ls+oHLlkCwcGj/NC5Gcx/zMD78AfAuKha0QxJ+UYvzxa7DIA6V0pgpiPnodAHqfB6TDCl4Ieoum5/Hx5vyvevwiAh++h71qsfCwepmoByLpzE8uUMF4vb9HLBRMVlKRg9a1CvDWu488QPIa0672ey5+jkcJRqagPo7IVAkBJ4yk0E8LWSWW6m/9th9KuRelgTVgirN8Fg1HOeJIOD0EvG6z04MvDc/FmHisqaCE/nxSD70JW8NS/hD5/hx95cNBCv3AU4msbAeL54Neg+VMU6mFAyDdoD8Veou6jqX/Fe6j7uwxN6sTEs+r4EXm3MB1VePLqABx6dxps+/uB/9LCnRlWibLj8SsxoF+hJfrgHqko4mNhZ4D8jWV0+Dn+j9TtORhBeqyAtT9LHcrnald4aeaECd6EOSjfM+DLLsgEvmUt98kFQPkzZkn8fMZ9K2MZAZU9tIfu5/sRZWM3NjwbdPTZ5rAIAuN8Z3il94bJkw8r1q38oslhTacV5X0On4732jsRANtAYvlSBZaR4ODGImWIENwuMGnum3aPk6HKQtOYePvOuR5AYqnHW0fBc+et2QASVv0nub7z+vnq+P52sPbx9Lz/cZTsdOCpSIZw8AlcFD7PQ0i93JBYu9pUVlcC3/DYNKkwnOafcyItpjRuLwdOrBzJFwQXKzATVsweyh63m08tdEInw59cx0NlFgmIzDEh7wzENC0ig7y1PTBR7oqNli2T5d4SkcuyQL1pMKXf/w4R5MPgYRRjDgUF8eov91wdjMjCdpbYLbCf9MRSIkifCDKu/ycVjBUrVzoNZaMCesS48N6tqeMIGJbZPWq55vj+ljnIqHkk9XufY3hwAO+a1ayGtK+OFE9ehIKAEbTvz4454xhKNYtDk/pb30rFW1Bc0wCeTJDb2z02AEaYZUmVjw80rFgMBh9L+7f/YOWlwlmwRzhv46Gge2NUbIdjJBXCSV/MKXxB5hwu7z3U55d5TK85HULfRF92wLKGXaNEsWlPeMog/iAQGFFNpIc5SPc039vHW8oKVFq3Dp5cyTjsW6qe4FiUIPYIQZgRBApCIXzyvfl6Rna1izIPzQsNq2B661+izVO0JR2R/m4pMrfkb1bUcUU65rstZbUp0yksdkkvfJfjfwHCB6m4kFsYnIowm3528zVauKJTobiT3i8TfT6axme9P6WdwTxwOh98ruHHuD7sQ1/y5r/M33hWE5NwnMJJ/1loKQ3zL+8ueAMXwiJ11jCMoiihG0g10jZ2OD/NoxRkblntZsrc+uh/L4KHOPF+/XLQ2ML4jMsqYF52Nz10ywpjh16z2VGe+tQ/Cn0PjyC0ZctDal4H8g/nZgjJDFory/t8AFwDjNWSCRsJ4y24VW/fgFl3aW4UkYrJJ55WHoZncePZ4yg64xFJGrxxRWrkV0kOKV0U6j0CDMPY4/zYfyPjA1eJFAY/07WYuJJerXUpzzDSAdKcwRchAwarkFGcNOOd+Jnzm3vH1mxpsX1Xyu6CuncfLPkjYGg45se+rASvpxER2pxL4JhGSw+V3nq/mYKhRVl4JFXb/hAYb+QHTsiQtS/YnYVfu/1FJwRsHZ9fYmmdPzm2z0ZK6VUP8LUWc3ccJe2mT9KBGgXDrxt3TxM9JoWmYb7VGxExjYqWME6Ximmjs4jFB/Wgj6yZg/SMupS13GktvGLoNQs0DSuhebcGizuNO6JH0GX01PjFRfyI7tMSNJqWLCuTHbQnV1aQCsewCDOr2FNkW82FfihuzfOHKF2oz1er+luzi7dlM1vsVdJTMnmM8ViqbMLTnAockYSpsx5P6AsShMD40kVsVmRjWmyX52o6l4lzlxG7/ub2XwpvDfKcBwM4HkfpIkhfR/Hn4Nl54ESqEpEQmmIcPHRJId3G3bb3skPD8Q8tLe9epOpV/Ix0ejOXROF1KCbGYWjU4BDmAGMc+XpuNweagoInQ3gzbNLSzf+D98DZwsG8psXRmBBlXuN4gnwdhyekY+XaZyj9rewH40smo9u+RGp7LvdfE20yv8CH1KRFwaSx4uFnQxpYGV360nuwxIc2+IhEXrLWcKVG3cEAlbc1rLS1GE/TvpSre9d4DgJR5SNybWMkewM8MJrqFEi1wIW47SFKTve+gWxIsw6WWQMJLuUIkl5PRxQqJmBCgMDwOBCmkCLHXiQ/vT2Dej6hsXtBCMvNyi1MlYIi45hz+E5FTVg3J4z0yygwW7p3KBBM27sX9Ig04QUhPPJKaAk8C75uh2juyRDmUSDz7LUoXQThVc1q6+3g/WLGxRuGR2IAWRfPCjia96MQtXOUuSIVcehWfYjYTbtAIC24OUG3mY4jRGN/DIXrHg8jgyMr5exDlTE7kDk8+Ki9kX44ElO/eDAHsIjcQIgIC490hD0Hg9tuJ48vzeBT6508WF6gOZv6QrmEq5LLX8aJQ57DLMvd+YTV3tSvmPRP5x80JoLlUTw6YaYOXvWask/ufK7vonpNCiN1r1ewqOEr3jqDyjkTRhk7n+OZk86IZ0c4r0ixilEVFGYNRNRNdL6Sxm4wmyCo8OwSIdO5P90+nvvlZTJuRWikXZDPYcXifcqMMbXNA8DEw8ZET1NQgci/9Xh6XUOh1h4PyXL3+FtSrLphq0q8UZjHNpemEz8nt7YUd3GlrveyNHjT7jT6PCmZe3QUuIYmLMsw/q7uj223A3ensPeluW1/EYZfzTk8iwd7KHIgwHXwjHaRXpwGJsyD1s0YfPfcoM9T3mYb7cAr+C4I8GaFJ4TpHIYHiG6nmcQWdO7P8JKrmUI/tpDsX3iQ44fS3KbfApsrcZ5OxLNi1nDajz+o8k6yfamr1SGxCtfU70z9bb/Ld6++hcN8C/rEZLqkR8FLnWWEnQl+0wgCPc3vzIzP6ZgFlsFrgQmvQ3/kAfyIyHiwqe/hN+nlyORX+AQPjvIqov4SzsAt913KNau0ndLP1h0El43ClN+Pzd32TFq/5SLSxH8AjucGfXlfmZkHcofP8UUUMpbYbl9tn3GeoVMKuCtZycasxLihreqZmiggBotQLFNs6x/Ba3mmMF9lIqTAg9UoGu2GXPqzDP1jn+iMh8g5bkukqKtXUk14rhkH5c6pG/lsyW0lQE/TRMQSzrLCR8zainlIeEIViL5xDjygxcfGPIKaE9/eUkkJ2cA2LfDkeZehPaSj0IKnTQ3pG4bt11XyC0bmtgha4xQHwzkKHnOCeeoWqLJ0EYR32pvm87QRJnKJB2rytAgTT+tqk95u1Dxsz4PPYfLVoX93ODZlB5NS3ptJzW6CD7yyaLTxTMKlcHCLlBD+ea6Y2DPWm9wDGt+FhOuCHlcbW+YbORWWHnCMiTb9YvdAmUcI33IKyr4PevTMpp2099NG+WMM6E88T3E4YULzSJgM/n9LNsHV8RX0l7I4eiwN1n0WmshYOkevPuuE1G2dmvPfyDxIsaZFRkjktERFGvUeIAP4OF8BAelxnzCZ6wMM4X2iJwlgHJiH9Oe3pPHSd8tX9QA2zO2zYUyB55UuLtdvegle8DIYRN5e3cxPHEBQ/qA3bUQU3iALz8S6eb2ZzXllo2GAA/4wTtKB+h6eCbAdBS9kmhAvJIWHFBAeJHab5rYyp+nx5Hgb4/GRtpZl3179KEblq7FSh3r7WU0+p4nLieuNJuso075IP6Iq7q0bbGSF51wqtjDmjzM2hhkw9MJFMSOSZDhhI5EUEZk1piFjdKWLIMDzDUs3NSZ3lQYclCcY4wG4RkMcwGCO1MlXYA+bg3RAPTqGCgBmN99ERHBT4G9G/6g3dYuIaxsn8fBHBVUnOEz47likXpHeUqG3RTa2yi+BQZsvUenEfFCrEmK80+ID2b2vAntX9qwnqsKTvDpX6I+5GSDQp0GPd0e2saLVfhmZ3E+d2cFu+gEHB+qKWatC9xhXcXFdUR/wwilybZt4C9KXn9ipEStX8pDxwxg4lT6fm8nLcPzoSfDYZ2X/xAYU5SYvbDwtuXL9gZMxjncjDyfhfgcptwkl4g2vTJMKTXhlObNtNjJpvCelrRDmfqB6TxA0JcJIBB/9LE6VXorYL+X8AkaF6Hj41CkUTAtPBvXAzp/88U2zU3hQfsYUy4x8uSTFaM/gaTDe0Il9I+EKK9IU11787haCtQ7hSq8rKEaans9XmBMEIyYKmhij9x6XFIe2SzxPqIDFG9/Axb9GDo1xQHMv1tIfpj/0dqtCBa3MXMbzc5lgAQJUgRueOe+pmjY8GEF6D7HxlvRPgw2Dow0yiklu8IX+Gk2PSMhqExiv4rkB4w5RqiFktd9iTvG/AUgUYg7TBj3iR9ERMPepFdqEQXFO7YR2GodKBy9gHH5DRVtifO7HeyrgI1s1trnOOOhv4QFyve2PUdRvFji0ca5jehbKIUzqLIwhDx3Ju9ygjiSQV5RhAEM4Z7GOXdljnHS0L63lsSoq3sCta5ZtgVVX36LH94EHXsDymY1b3SfIolcMKvDAOCsXhngVoT/hu8kO71i5CLkruXLx1nvTui1/C56VPJ3XFyVAxF1xiK8I9rmCqWHRIgsz24HKZz0I64G1dBSpGp/Gtmcn23iw5iFwfRBAoBGeh7amV7wuqRB6vpJqGDYUEp0y5fvSaN9XOiTFIp+H4BHW/O+CylsDv3zLnB0Dpsa0Kn/8AFwUBrlyt3bvXrBcJziFRz9Tj0OYBwzwiS3j4ORWCeEq6IlCFs+oEwY0dX1D8MCKVMZ70uMzhKf5ghEp6WwZcuHvAPf7L84wHQNFijREg44t2QhZuhiv6d1OB0qXj+erlf8OGdst7ezaHaUPE0F/Fbh/HnwwkvhiiHKGljBmoy4oMH5455LuZQNBYUNuKCaKGrI3AoFqrCDu+zRwSnoUsmGNiChQV3+DcYjypsnQlDcpKg95aX8dJTCn8xruxR3umVng6afPXuCxW1swk8xb+dpFwogGLotDa1gMDqVGr5DJ9LEBhlDHg1ccoc5dQ2eZOb+7/nVE8EmHpoiD4wcgj5auEsJ676DTtSBDzloMRFyij55Yj6NCqAD2i3Bc+qvYnPrkWCWPT7EYzlhJMo+NsBxjqTR0d/8LhMhkkc2TUqSkcPTwRpm5L9DQNKaMwVm6y3Oaj01bXg5qj3FbJO2rlLnPr52ugDkBNTp0hHiqd+FaRZcXwRP+BFmZtvwiV6FVmOIQ6Y79HI4/KpfKEmMCR0WOcbhvIxXLXNv6veAWRVjcG5YrIlXT3kebLLyMUx5PxxRKrHIwN1kasyJluYhxCTpHLfFvo5RWLc4GPjQ9+BVGYb00FTz5AIXOrY2VLVSR1CQerJke4eh6E2XCMxWMqhfpMX2dfPe7CAK4ofiC8dy302B0Hf2fxfkReTFRvxKZP0JhGwwjDADZdCmQfENmcqyHd/e9+m6rvUYUmYxyRV75iyYBhvaZR71wrNaZOgFL2uBtcDKjlWFIL3O6muzB7KZtvpfSzdARpTQ81ECmlWm88XfSuv2fRlaE2D6eSyIcmE/gk3dkpQjFyIhGPaEvNsExca7cnEbJ+/BFEKvGCMhNMFwQ91qCVKgQTLF6+kZh7oMkQHpd2tDckUa3F4UIJuQmsQeMbS6j7TvSOnPXtBV4edzwTsJVyOa+nVEUD5xzWgzzEE+P8YTugpOKo0eK//Mx42oDcQQu1XHUsMKLSYNtpQslD2Aai804UkaL/5XXWpywRmXUpSEHfg3vlLR+K0yHoDe1BH/yacDFO7qSNccWnSX3Yu0Un0JzabbyQT4Acx5+LdyR5rbxfGTyG9QZPVRs7tkk5MSJ8kNc8rGp/LKJCR3Rgfp4gY0dELVLpBiJc8RwhvtvoA087GgbgtuQfVZvug/2/yZtTZdNVolPOBijewyqJw+jEAEHRc849bOhTfBSJyc/wIn6vF3eE9Om0p67scDDMfehPlgooGwoeQEIWCEb0j/k1uIMjMp+LX88+Uv0ttiRfrlkwXVX05tveDY1N/1T8HWZTuUkpxNhjKBySTAmPb41pyfBK4xBAs8XEzgnbsKXKPNcCXa7c+SfBm8IDYJtRNuy0zM8pm2AU/XYhxTKcDL2uJN2TEhXKmW5tyE1S+mnIPZx+j/N+Ho5YEc08xyFVQimK+IjE7yESfl7XFQZGTWwqdFS57ltJchUUC9ndAoCPRRaNCgXNdzK0HllhRvtVCRyaeFM3+zjsivDfFLj5drAfQ/skS/APKTIGyCixH3mEFFWG0GiMf3ngbmAj5t7KK1b4qk9KzuNW1vCYdlIeck3Iy3zrImfbGWfmXzQCQSdOjhSnXgJCTUD5MR55rMah0W6KcOM/7i+M801H6GaSOQ8DJVrY56DLsCzdkzqZRf5GwbKEd7F0j/8jm8NE52VWywcWUdqmFfOeJWartUEp8O/KRIrq46BDlZ9+DnGAZjq1z7nYOCQn4Np2IzNp1WVW13xzO9s5pJRCv75gs5HKjwrWMeDL6PBItsI1g9gDAYSHCnRI7py3i6iaNb5G0MgNGscrVHDYr9y3cZXCDMSfr4FqmFMwUNrtg9zF7cHxO7SAOD9QxCP2vzn4D0/kFZVL6NatsEQlVlF1Wj1Nj4oM2pEGsO5RhPPYDIOmcEKSD9nfyf4KHgYDf3DOLrxOEYqp1FJpz/HpahMKFp8YM2JOc8tlm75RtyiE8dZWmzLQvb8hbDuGm6rDOJsri8jgRs4g5c4cbeufw/efDvPLWKJnerVlnlgLGQ8B1vfBbit/EzrXDnrirSDQ6Se8s5reSSuGd/YlRuk6HTYrl7/OnCL4XZgZmjtb/tH1F7Oj6Xw4C+dwzDhXxTnuii3JcYBxxhTmaHE4ODePTc3ZrxwfNPiP5hkJBAh8QNfeBo/U19LRArTbKOIY7LV3i3q1fvS6Av/LZpwwbG0zzUCWl5KI54VNFfwVLv6x+wiwO+7fdpdonygQKMJ7ytjx7QnDROZVkUxo+G93lAwJt/+S1GxghMeAqRRntiLo8cOTyJTCPPdxkXnIX4EunHSd+dy5Fa4lqCMcxu7ad/IlZNFtzA4AcOz1VwrDJuam0ZzPWWhNeYPWQHjX4SKyMB9PE6s09vMThqvxhKpm1XSLbOpU6FibmId7Xh7sMFD1/Dr0HKIAKa35Ol0e09EM1eVxJH2wTvGCUcy5jla8XbPK4KUoYpxeFW3N+OfTIEeZ2wdgTwSj2AUDRjfBRiUK3inA8ShVT29LhtJR6Zopt/I75kyQS/D5MNBWsf9/8585AboMaK6KqmyPss1sP3+lan5iPFwmvHdqzHnofQaJ6fKxOdAZhzyIYyrOCS+rh+ZiLgAN9qKQJfu67TXlZSKtNLo1I9vfrHG1Z/NTg7ia3eKIx+lbFFZB2kDX3toEHbNFoL9G1G6AwzqP5Pl9uAN/Nw+0e0x6rZSdO+SzA7hP6+1mXExrI0THgISmdoDPjFfn0aje8jRSZEOKcGdQ2pWvljW7o2bibqvRhgKUUphnNHCowqH8uf9W/AzohaKbX14TmHhvUPpFRRFgWjQplJ6qBASgmHZVVg14zjZi417Y5YTR3eU77xGb/4sw6+r7uq3npPmqjdFO6NspHwRQYqnDKPUi7La1/9UOnDT91OaB4+FoiRTeKs8Ke+hz237CWC+B+PwuRTOKpa+4QOeLry2+El7fNPKeulAqeVjnOuJn+Cp+y/wyg6pStTBp0PKobT3t7wN3/KzyObHaA2tfjtr2g+awhodCzgRRXQyOh6vqXfZXsMKPICto9PJxZF2RKD80pqwMEQdTcBkusCyc8t7M+NbbqTuqEUAz1UYOIgG7hYe2feuwbovxxNgNPHPYhFh2Opt+pRfdhGe58IsdZsMwR2BBdEl8j+QXsLjVmMiU/8u2t/KP3X3GLGkMxD6B1HLmS3slYrt6DP0BxP9N+140t9r3kxseyW6fj5MO48WzFciZVHoGU4EEvltcdiudCh010VGcdmhRc7bksP6vas23cs4dwP3cwffsOsEG7R0gGaOZet+P70CPD/I+AjfpWWunKi6oBy7YEUM5fDTSJPxV7mPgWiooagcnm8p+7iWTr4vze3ZRW+Ule975X+6TmDm7WQCESWVMc6AB6+xnQe5xc7kuA9eftVkxP0oHWPK5SF1maHjW/84pfk/wQQvhqSLGPOlRCR2cLj93RLb0oULHyJSmGHgSBvnmmYAjqVTYl6j8keKC5/YepT/WQPOWcaQb/EuPSucTfsgz7nu5uMrD5adHzEQf1bC13tRRPhopWuTAW3E0y3VF+NsLwA0/2KPrzGaV/nUGoHlyRB4SgQeuIml1Oy5KxTJ7dr+YzN+GLnHZ/r94MH0H+gMVDITj4bVc99fAcY8yjTCUEcweLAuzQ1OIxKb0xopeiwp8l65cxQ/rBDFVMA5ALfdESwjg+EIiyjiQyf/2YOlORYGnmKSeDVeYajXmy0r4DF7e/bcF898Q/B+xjm/8NxzFXmBXzxx75RwtuPxnD8P/I5nmP/v+q6a7iKIVRGwaqCrgnZYoyHueagR+lurIkxgHaa4awV/ORx4FBFBQ1lLOpaPs5bXR9KB2fqOlueqW+4cjoZjgTXkWJ5pHdbDVcohteEcxKHDo2vp9SxOnNu2K+4c777mGXveVoLRNV7x+P8A1Hk3kuBuLMYAAAAASUVORK5CYII=";__obj__1["html_package"]=await (async function(){ return ";; Juno HTML Pakage\n\n;; For browser based DOM utilization and manipulation\n\n;; Initializes and loads the html namespace \n;; (c) 2022 Kina\n;; Author: Alex Nygren\n\n(when (contains? \"html\" (namespaces))\n  (delete_namespace `html))\n(create_namespace `html { `serialize_with_image: false })\n\n\n(declare (namespace `html))\n\n\n;; Tag component names sourced from\n;; https://developer.mozilla.org/en-US/docs/Web/HTML/Element\n\n\n(defglobal *DOM_TAGS* [`html `base `head `link `meta `style `title\n                       `body `address `article `aside `footer `header\n                       `h1 `h2 `h3 `h4 `h5 `h6\n                       `main `nav `section\n                       `blockquote `dd `div `dl `dt `figcaption `figure\n                       `hr `li `menu `ol `p `pre `ul\n                       `a `abbr `b `bdi `bdo `br `cite `code `data `dfn `em\n                       `i `kbd `mark `q `rp `rt `ruby `s `samp `small `span\n                       `strong `sub `time `u `var `wbr\n                       `area `audio `img  `track `video\n                       `embed `iframe `object `picture `portal `source\n                       `svg `math `canvas `noscript `script\n                       `del `ins\n                       `caption `col `colgroup `table `tbody `td `tfoot\n                       `th `thead `tr\n                       `button `datalist `fieldset `form `input `label `legend\n                       `meter `optgroup `option `output `progress `select `textarea\n                       `details `dialog `summary\n                       `slot `template ])\n\n\n(defmacro get_by_id (id)\n  `(-> document `getElementById ,#id)\n  {\n   `description: \"Given an id, this macro is shorthand for calling document.getElementById with the passed id\"\n   `usage: [\"id:string\"]\n   `tags: [\"html\" \"DOM\" \"id\" \"find\" ]\n   })\n\n(defun get_by_tag (tagname)\n  (if tagname\n    (-> document `querySelectorAll tagname)\n    (throw \"get_by_tag: invalid tagname provided\"))\n  {\n   `description: \"Deprecated: use query_all: Returns all tags in the document matching the provided tagname\"\n   `usage: [\"tagname:string\"]\n   `tags: [\"html\" \"DOM\" \"id\" \"find\" ]\n   })\n\n(defun query_all (query)\n  (if (is_string? query)\n    (-> document `querySelectorAll query)\n    (throw ReferenceError \"query_all: argument must be a string\"))\n  {\n   `description: \"Returns all tags in the document matching the provided tagname\"\n   `usage: [\"tagname:string\"]\n   `tags: [\"html\" \"DOM\" \"id\" \"find\" ]\n   })\n\n(defun append_children (parent children)\n  (when (and (is_element? parent)\n             (is_array? children))\n    (for_each (child children)\n              (-> parent `appendChild child)))\n  parent)\n\n\n;(defbinding (html/create_element (document.createElement document.createElement)))\n\n;(defglobal html/create_element (-> document.createElement `bind document)\n ;  {\n  ;  `description: \"Binding for document.createElement\"\n   ; `initializer: (quote  (-> document.createElement `bind document))\n    ;})\n\n(defun create_element (element_name)\n  (-> document.createElement element_name))\n\n;; first create the base constructor function which will be called\n;; with the tag to create\n\n\n(defun_sync create_dom_element (element_name `& args)\n  (let\n      ((opts (if (and (is_object? args.0)\n                      (not (is_array? args.0))\n                      (not (is_element? args.0)))\n               args.0\n               nil))\n       (content (if opts\n                  (if (> args.length 0)\n                    (rest args)\n                    [])\n                  (or args\n                      [])))\n       (append_children (fn (parent children)\n                          (do\n                            (for_each (child children)\n                                      (if (is_array? child)\n                                        (append_children parent child)\n                                        (-> parent `appendChild child)))\n                            parent)))\n       (elem (-> document `createElement element_name)))\n    \n    (when opts\n      (for_each (pset (pairs opts))\n                (do\n                  (cond\n                    (is_function? pset.1)\n                    (set_prop elem\n                              pset.0\n                              pset.1)\n                    else\n                    (-> elem `setAttribute pset.0 pset.1)))))\n    (when (> content.length 0)\n      (for_each (child content)\n                (cond\n                  (is_element? child)\n                  (-> elem `appendChild child)\n                  (is_array? child)\n                  (append_children elem child)\n                  (is_string? child)\n                  (-> elem `appendChild (-> document `createTextNode child))\n                  else\n                  (-> elem `appendChild (-> document `createTextNode (+ \"\" child))))))\n    elem))\n\n\n\n;; next create the individual pointers to the create_dom_element function\n;; for every tag name in the *DOM_TAG* list create the construction function\n\n(for_each (tagname *DOM_TAGS*)\n          (let\n              ((bound_fn (-> create_dom_element `bind create_dom_element tagname)))\n            ;; use the set_global function directly since we are dynamically creating the symbol names\n            (-> Environment `set_global\n                tagname\n                bound_fn\n                {\n                 `initializer: `((quote quote) (-> create_element `bind create_dom_element ,#tagname))\n                 })))\n\n\n;; various helper functions \n\n(defun set_style (style_attributes elem)\n  (when (is_element? elem)\n    (let ((`current_style (-> elem `getAttribute \"style\"))\n          (`attribs       (or (no_empties (from_style_text current_style)) []))\n          (`combined      (pairs\n                           (to_object\n                            (conj attribs style_attributes))))\n          (`newtext\n           (join \";\"\n                 (for_each (`atr combined)\n                           (join \": \" atr)))))\n\n      (-> elem `setAttribute \"style\" newtext)\n      elem))\n  {\n   `tags:[\"ui\" \"html\" \"css\" \"element\" \"style\"]\n   `description:\"Given a set of style attributes in the [[attribute value]] form, and an element, sets the element style attribute to contain the specified values. Returns the element.\"\n   `usage:[\"style_attributes:list\" \"element:Element\"]\n   })\n\n(defun has_class? (classname elem)\n  (if (and elem\n           (is_element? elem))\n    (-> elem.classList `contains classname)\n    false)\n  {\n   `usage: [\"classname:string\" \"element:Element\"]\n   `description: \"If the provided element has the specified CSS class, returns true, otherwise the function returns false\"\n   `tags: [\"css\" \"DOM\" \"class\" \"ui\" \"element\" \"html\"]\n   })\n\n(defun add_class (class_name `& elems)\n  (do\n    (defvar `effected [])\n    (= elems (flatten elems))\n    (when (not (eq nil elems))\n      (= elems (if (or (instanceof elems.0 NodeList)\n                       (instanceof elems.0 HTMLCollection)\n                       (is_array? elems.0))\n                 elems.0\n                 elems))\n      (for_each (`e elems)\n                (do\n                  (when e.classList\n                    (push effected e)\n                    (-> e.classList `add class_name)))))\n    effected)\n  {\n   `usage: [\"class_name:string\" \"element:Element\" \"element?:Element\"]\n   `description: \"Removes the designated CSS class from the provided element or elements. Returns the list of nodes.\"\n   `tags: [\"ui\" \"html\" \"css\" \"class\"]\n   })\n\n(defun remove_class (class_name `& elems)\n  (do\n    (defvar `effected [])\n    (= elems (flatten elems))\n    (when (not (eq nil elems))\n      (= elems (if (or (instanceof elems.0 NodeList)\n                       (instanceof elems.0 HTMLCollection)\n                       (is_array? elems.0))\n                 elems.0\n                 elems))\n      (for_each (`e elems)\n                (do\n                  (when e.classList\n                    (push effected e)\n                    (-> e.classList `remove class_name)))))\n    effected)\n  {\n   `usage: [\"class_name:string\" \"element:Element\" \"element?:Element\"]\n   `description: \"Removes the designated CSS class from the provided element or elements. Returns the list of nodes.\"\n   `tags: [\"ui\" \"html\" \"css\" \"class\"]\n   })\n\n(defun set_disabled (`& args)\n  (when (and args (> (length args) 0))\n    (for_each (`elem (flatten args))\n              (if elem (-> elem `setAttribute `disabled \"true\"))))\n  { `description: \"Given an arbitrary list of Elements, set them to disabled.\"\n   `tags: [\"ui\" \"html\" \"css\"]\n   `usage: [\"element:Element\" \"element?:Element\"]\n   } )\n\n(defun set_enabled (`& args)\n  (when (and args (> (length args) 0))\n    (for_each (`elem (flatten args))\n              (if elem (-> elem `removeAttribute `disabled))))\n  { `description: \"Given an arbitrary list of Elements, set them to enabled (removes the disabled property from the Element).\"\n   `tags: [\"ui\" \"html\" \"css\"]\n   `usage: [\"element:Element\" \"element?:Element\"]\n   } )\n\n(defun remove_attribute (elem `& attribs)\n  (when (and elem\n             (is_element? elem)\n             attribs\n             (> attribs.length 0))\n    (for_each (attrib (flatten attribs))\n              (-> elem `removeAttribute attrib)))\n  {\n   `description: \"Provided a target DOM element and 1 or more attributes, removes each attribute from the targeted DOM element.\"\n   `usage: [\"element:Element\" \"attrib0:string\" \"attribN:string\"]\n   `tags: [ `ui `html `attribute `delete ]\n   })\n\n(defun attach_event_listener (elem event_type handler_function)\n  (when elem\n    ((jslambda (`elem `event `f) \"return elem.addEventListener(event,f);\")  elem event_type handler_function))\n  {\n   `usage:[\"element:Element\" \"event_type:string\" \"handler:function\"]\n   `description:\"Given an element, an event type such as `click, and a function, attaches the provided function as an event handler to the HTML Element.\"\n   `tags:[\"ui\" \"events\" \"HTML\" \"events\" \"\"]\n   })\n\n(defun remove_css_entry (entry_name)\n  (do\n    (if (get_by_id (+ \"class_\" entry_name))\n      (-> (get_by_id (+ \"class_\" entry_name)) `remove)))\n  {\n   `usage:[\"entry_name:string\"]\n   `description:\"If a class has been created by create_css_entry, use this function to remove the class from the document.\"\n   `tags: [\"html\" \"css\" \"ui\"]\n   })\n\n(defun create_css_entry (entry_name css_attribute_list)\n  (let\n      ((style (create_element \"style\"))\n       (css_attributes (map (fn (v)\n                              (+ v.0 \": \" v.1))\n                            css_attribute_list))\n       (head_elem (-> document `querySelector \"head\"))\n       (new_style nil))\n    \n    (when head_elem\n      (remove_css_entry entry_name)\n      (-> head_elem `appendChild\n          (= new_style\n             (style { `id: (+ \"class_\" entry_name ) `type: \"text/css\" }\n                    (+ \"\" entry_name \"{\\n  \" (join \";\\n\" css_attributes) \" }\")))))\n    new_style)\n  { `usage: [\"entry_name:string\" \"css_attribute_list:array\"]\n   `description: \" Given a name for the class and a list of formatted css attributes\n                         create and load the CSS object into the DOM.<br> Example: <br><code>\n                          (create_css_entry 'FilteredSelect:focus-within'\n                                    [['box-shadow' '0px 0px 10px 0px rgba(0,0,0,0.75);']])<br>\n                           </code> \"\n   `tags: [\"html\" \"css\" \"ui\"]\n   } )\n\n(defun css_entry_to_css_format (entry_name css_attribute_list)\n  (let\n      ((`style (create_element \"style\"))\n       (`css_attributes (map (fn (v)\n                               (+ v.0 \": \" v.1))\n                             css_attribute_list)))\n    (+ \"\" entry_name \" {\\n   \" (join \";\\n   \" css_attributes) \";\\n}\")\n    )\n\n  { `usage: [\"entry_name:string\" \"css_attribute_list:array\"]\n   `description: (+ \"Given a name for the class and a list of formatted css attributes returns a formatted string in CSS syntax.<br> Example: <br><code>\"\n                    \"(create_css_entry 'FilteredSelect:focus-within'\n                                    [['box-shadow' '0px 0px 10px 0px rgba(0,0,0,0.75);']])<br>\"\n                    \"</code>\")\n   `tags: [\"html\" \"css\" \"ui\" \"convert\"]\n   } )\n\n(defun_sync handle_event (e)\n  (progn\n   (-> e `preventDefault)\n   (-> e `stopPropagation)))\n\n\n\n(defun file_picker_button (button_text on_selection)\n  (let\n      ((elem (html/input { type: \"file\" \n                          value: (or button_text \"Open\")\n                          onchange: (fn (e)\n                                      (let\n                                          ((items e.srcElement.files)\n                                           (status nil))\n                                        (when on_selection\n                                          (on_selection items)))) })))\n    (declare (fn on_selection html/input)\n             (global html/input))\n    (when (eq nil on_selection)\n      (throw \"on_selection is required for file_picker_button\"))\n    elem))\n\n(defun notify (text type on_click)\n        (let\n            ((type (or type \"info\"))\n             (timer nil)\n             (view (div { `style: (+ \"z-index: 5; padding: 5px; position: relative; opacity: 0; cursor: pointer; background: #FFFFFF; border: 1px solid #404040; display: inline-block; width: 250px; overflow: auto; height: 50px; text-overflow: ellipses; font-size: 0.9em;\" \n                                     (cond\n                                         (== type \"error\")\n                                         \"border-left: 5px solid #bf0a0a;\"\n                                         (== type \"success\")\n                                         \"border-left: 5px solid #95dc95;\"\n                                         else\n                                         \"border-left: 5px solid #5489da;\")) }\n                         (or text \"-\"))))\n            (when (eq nil (get_by_id \"lower_right_corner\"))\n                  (-> (get_by_id \"body\")\n                      `appendChild (div { `id: \"lower_right_corner\" `style: \"position: absolute; right: 50px; bottom: 5px; width: 255px;\" } )))\n            \n            (-> (get_by_id \"lower_right_corner\") `appendChild view)\n            (-> view `animate [{ `background: \"#FFFFFF\"  `easing: `ease-in }\n                               { `background: \"#FFF18830\"  `opacity: 1    `easing: `ease-out  `offset: 0.1 }\n                               { `background: \"#FFFFFF\" `opacity: 1 `easing: `ease-out } ] \n                           { `duration: 3000 })\n            \n            (= timer (setTimeout (fn ()\n                                   (do \n                                     (-> view `animate [{ `opacity: 0  `easing: `ease-in } ] { `duration: 250 })\n                                     (setTimeout (fn () (do\n                                                          (-> view `remove)\n                                                          (= timer nil)\n                                                          (= view nil)))\n                                                 250)))                                                   \n                            10000))\n            (setTimeout (fn ()\n                            (set_style [[\"opacity\" 1]] view))\n                        200)\n            (attach_event_listener view\n                 `click\n                 (fn (e)\n                     (do\n                         (when timer (clearTimeout timer))\n                         (when view (-> view `remove))\n                         (= view nil)\n                         (= timer nil)\n                         (when on_click\n                               (on_click type text)))))\n            true)\n        {\n         `usage: [\"text:string\" \"type?:string\" \"on_click?:function\"]\n         `description: (+ \"Given a obligatory text string, and an optional type, and on_click function, \" \n                          \"show an alert for 10 seconds in the lower right hand corner.\"\n                          \"<br><br>\"\n                          \"Types are as follows: <br>\"\n                          \"error<br>\"\n                          \"success<br>\"\n                          \"info (default)<br>\"\n                          \"<br>Returns true, but is of no significance.\")\n         `tags: [\"ui\" \"alerts\" \"alerting\" \"message\" \"notify\"]\n         })\n\n(defun read_file (file options)\n    (new Promise\n         (fn (resolve reject)\n           (let\n               ((reader (new FileReader))                \n                (options (+ {}                          \n                            {\n                             `read_as: \"binary\"\n                             `details: false\n                             }\n                            options))\n                (read_as options.read_as))\n             (set_prop reader\n                       `onload\n                       (function (e)\n                                 (progn\n                                  (resolve\n                                   (cond\n                                     options.details\n                                     {\n                                      `name: file.name\n                                      `type: file.type\n                                      `size: file.size\n                                      `data: reader.result                                     \n                                      }\n                                     else\n                                     reader.result))))\n                       `error\n                       (function (e)\n                                 (reject e)))\n             \n             (cond\n               (or (== read_as \"binary\")\n                   (== read_as \"ArrayBuffer\"))\n               (-> reader `readAsArrayBuffer file)\n               (== read_as \"text\")\n               (-> reader `readAsText file)\n               (== read_as \"binaryString\")\n               (-> reader `readAsBinaryString file)\n               (== read_as \"dataURL\")\n               (-> reader `readAsDataURL file))))))\n                   \n(defun tabs (tab_list)\n  (let\n      ((view nil)       \n       (add_tab (fn (name content closable)\n                  true))\n       (header nil)\n       (head_tabs [])\n       (body_tabs [])       \n       (remove_tab (fn (name)\n                     true)))\n       \n    ;; setup the initial view\n    (setq view\n          (div { `class: \"tabWrap\" }\n               ;; tab headers\n               (setq header\n                     (ul { `class: \"tabHead\" }\n                         (map (fn (entry idx)                      \n                                (progn\n                                 (push head_tabs\n                                       (li { `idx: idx }\n                                           entry.0\n                                           (if entry.2\n                                             (span { `style: \"float: right\" } \"x\")\n                                             [])))\n                                 (last head_tabs)))\n                              tab_list)))\n               (map (fn (entry idx)                      \n                      (progn\n                       (-> entry.1.classList `add \"tabBody\")\n                       (-> entry.1 `setAttribute \"idx\" idx)\n                       (push body_tabs entry.1)\n                       (last body_tabs)))\n                    tab_list)))\n    (attach_event_listener header\n                           `click\n                           (fn (e)\n                             (let\n                                 ((src e.srcElement)\n                                  (btab nil)\n                                  (idx (-> src `getAttribute \"idx\")))\n                               (for_each (elem header.children)\n                                         (cond\n                                           (and (== e.srcElement.tagName \"LI\")\n                                                (== elem e.srcElement))\n                                           (progn\n                                            (-> elem.classList `add \"open\")\n                                            (= btab (prop body_tabs (parseInt (-> src `getAttribute `idx))))\n                                            (when btab\n                                              (-> btab.classList `add \"open\")))\n                                           (and (== e.srcElement.tagName \"LI\")\n                                                (is_element? elem))\n                                           (progn\n                                            (-> elem.classList `remove \"open\")\n                                            (= btab (prop body_tabs (parseInt (-> elem `getAttribute `idx))))\n                                            (when btab\n                                              (-> btab.classList `remove \"open\"))))))))\n                                  \n    {\n     `view: view\n     `add_tab: add_tab\n     `remove_tab: remove_tab\n     }))\n          \n ;; (defglobal tabview (tabs [[\"Tab 1\" (div \"Hi this is tab 1\") true ] [\"Tab 2\" (div \"This is tab 2\") ]]))                \n\n\n(set_prop (get_by_id \"juno-css\")\n          `textContent\n          style_css)\n    \n(console.log \"html is loaded\");\n(register_feature \"html\")\n(load_pends \"html\")\ntrue\n" })();__obj__1["style_css"]=await (async function(){ return "\n/* Seedling Default CSS */\n\n/* Variables */\n\n:root {\n  --main-bg-color: #F8F6F6;\n  --main-mono-space: ui-monospace,\n    \"Cascadia Mono\", \"Segoe UI Mono\",    \n    \"Roboto Mono\",\n    \"Ubuntu Mono\",\n    Menlo, Monaco, Consolas,\n    monospace;\n}\n\n\n/*!\nPure v2.1.0\nCopyright 2013 Yahoo!\nLicensed under the BSD License.\nhttps://github.com/pure-css/pure/blob/master/LICENSE\n*/\n/*!\nnormalize.css v | MIT License | git.io/normalize\nCopyright (c) Nicolas Gallagher and Jonathan Neal\n*/\n/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */\n\n/* Document\n   ========================================================================== */\n\n/**\n * 1. Correct the line height in all browsers.\n * 2. Prevent adjustments of font size after orientation changes in iOS.\n */\n\nhtml {\n  line-height: 1.15; /* 1 */\n  -webkit-text-size-adjust: 100%; /* 2 */\n}\n\n/* Sections\n   ========================================================================== */\n\n/**\n * Remove the margin in all browsers.\n */\n\nbody {\n  margin: 0;\n  background: var(--main-bg-color, #F8F6F6);\n}\n\n/**\n * Render the `main` element consistently in IE.\n */\n\nmain {\n  display: block;\n}\n\n/**\n * Correct the font size and margin on `h1` elements within `section` and\n * `article` contexts in Chrome, Firefox, and Safari.\n */\n\nh1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n/* Grouping content\n   ========================================================================== */\n\n/**\n * 1. Add the correct box sizing in Firefox.\n * 2. Show the overflow in Edge and IE.\n */\n\nhr {\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box; /* 1 */\n  height: 0; /* 1 */\n  overflow: visible; /* 2 */\n}\n\n/**\n * 1. Correct the inheritance and scaling of font size in all browsers.\n * 2. Correct the odd `em` font sizing in all browsers.\n */\n\npre {\n  font-family: var(--main-mono-space, monospace, monospace); /* 1 */\n  font-size: 1em; /* 2 */\n}\n\n/* Text-level semantics\n   ========================================================================== */\n\n/**\n * Remove the gray background on active links in IE 10.\n */\n\na {\n  background-color: transparent;\n}\n\n/**\n * 1. Remove the bottom border in Chrome 57-\n * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.\n */\n\nabbr[title] {\n  border-bottom: none; /* 1 */\n  text-decoration: underline; /* 2 */\n  -webkit-text-decoration: underline dotted;\n          text-decoration: underline dotted; /* 2 */\n}\n\n/**\n * Add the correct font weight in Chrome, Edge, and Safari.\n */\n\nb,\nstrong {\n  font-weight: bolder;\n}\n\n/**\n * 1. Correct the inheritance and scaling of font size in all browsers.\n * 2. Correct the odd `em` font sizing in all browsers.\n */\n\ncode,\nkbd,\nsamp {\n  font-family: var(--main-mono-space, monospace, monospace); /* 1 */\n  font-size: 1em; /* 2 */\n}\n\n/**\n * Add the correct font size in all browsers.\n */\n\nsmall {\n  font-size: 80%;\n}\n\n/**\n * Prevent `sub` and `sup` elements from affecting the line height in\n * all browsers.\n */\n\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n\nsub {\n  bottom: -0.25em;\n}\n\nsup {\n  top: -0.5em;\n}\n\n/* Embedded content\n   ========================================================================== */\n\n/**\n * Remove the border on images inside links in IE 10.\n */\n\nimg {\n  border-style: none;\n}\n\n/* Forms\n   ========================================================================== */\n\n/**\n * 1. Change the font styles in all browsers.\n * 2. Remove the margin in Firefox and Safari.\n */\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit; /* 1 */\n  font-size: 100%; /* 1 */\n  line-height: 1.15; /* 1 */\n  margin: 0; /* 2 */\n}\n\n/**\n * Show the overflow in IE.\n * 1. Show the overflow in Edge.\n */\n\nbutton,\ninput { /* 1 */\n  overflow: visible;\n}\n\n/**\n * Remove the inheritance of text transform in Edge, Firefox, and IE.\n * 1. Remove the inheritance of text transform in Firefox.\n */\n\nbutton,\nselect { /* 1 */\n  text-transform: none;\n}\n\n/**\n * Correct the inability to style clickable types in iOS and Safari.\n */\n\nbutton,\n[type=\"button\"],\n[type=\"reset\"],\n[type=\"submit\"] {\n  -webkit-appearance: button;\n}\n\n/**\n * Remove the inner border and padding in Firefox.\n */\n\nbutton::-moz-focus-inner,\n[type=\"button\"]::-moz-focus-inner,\n[type=\"reset\"]::-moz-focus-inner,\n[type=\"submit\"]::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n\n/**\n * Restore the focus styles unset by the previous rule.\n */\n\nbutton:-moz-focusring,\n[type=\"button\"]:-moz-focusring,\n[type=\"reset\"]:-moz-focusring,\n[type=\"submit\"]:-moz-focusring {\n  outline: 1px dotted ButtonText;\n}\n\n/**\n * Correct the padding in Firefox.\n */\n\nfieldset {\n  padding: 0.35em 0.75em 0.625em;\n}\n\n/**\n * 1. Correct the text wrapping in Edge and IE.\n * 2. Correct the color inheritance from `fieldset` elements in IE.\n * 3. Remove the padding so developers are not caught out when they zero out\n *    `fieldset` elements in all browsers.\n */\n\nlegend {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box; /* 1 */\n  color: inherit; /* 2 */\n  display: table; /* 1 */\n  max-width: 100%; /* 1 */\n  padding: 0; /* 3 */\n  white-space: normal; /* 1 */\n}\n\n/**\n * Add the correct vertical alignment in Chrome, Firefox, and Opera.\n */\n\nprogress {\n  vertical-align: baseline;\n}\n\n/**\n * Remove the default vertical scrollbar in IE 10+.\n */\n\ntextarea {\n  overflow: auto;\n}\n\n/**\n * 1. Add the correct box sizing in IE 10.\n * 2. Remove the padding in IE 10.\n */\n\n[type=\"checkbox\"],\n[type=\"radio\"] {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Correct the cursor style of increment and decrement buttons in Chrome.\n */\n\n[type=\"number\"]::-webkit-inner-spin-button,\n[type=\"number\"]::-webkit-outer-spin-button {\n  height: auto;\n}\n\n/**\n * 1. Correct the odd appearance in Chrome and Safari.\n * 2. Correct the outline style in Safari.\n */\n\n[type=\"search\"] {\n  -webkit-appearance: textfield; /* 1 */\n  outline-offset: -2px; /* 2 */\n}\n\n/**\n * Remove the inner padding in Chrome and Safari on macOS.\n */\n\n[type=\"search\"]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n\n/**\n * 1. Correct the inability to style clickable types in iOS and Safari.\n * 2. Change font properties to `inherit` in Safari.\n */\n\n::-webkit-file-upload-button {\n  -webkit-appearance: button; /* 1 */\n  font: inherit; /* 2 */\n}\n\n/* Interactive\n   ========================================================================== */\n\n/*\n * Add the correct display in Edge, IE 10+, and Firefox.\n */\n\ndetails {\n  display: block;\n}\n\n/*\n * Add the correct display in all browsers.\n */\n\nsummary {\n  display: list-item;\n}\n\n/* Misc\n   ========================================================================== */\n\n/**\n * Add the correct display in IE 10+.\n */\n\ntemplate {\n  display: none;\n}\n\n/**\n * Add the correct display in IE 10.\n */\n\n[hidden] {\n  display: none;\n}\n\n/*csslint important:false*/\n\n/* ==========================================================================\n   Pure Base Extras\n   ========================================================================== */\n\n/**\n * Extra rules that Pure adds on top of Normalize.css\n */\n\nhtml {\n  font-family: FreeSans, Arimo, \"Droid Sans\", Helvetica, Arial, sans-serif;\n}\n\n/**\n * Always hide an element when it has the `hidden` HTML attribute.\n */\n\n.hidden,\n[hidden] {\n    display: none !important;\n}\n\n/**\n * Add this class to an image to make it fit within it's fluid parent wrapper while maintaining\n * aspect ratio.\n */\n.pure-img {\n    max-width: 100%;\n    height: auto;\n    display: block;\n}\n\n/*csslint regex-selectors:false, known-properties:false, duplicate-properties:false*/\n\n.pure-g {\n    letter-spacing: -0.31em; /* Webkit: collapse white-space between units */\n    text-rendering: optimizespeed; /* Webkit: fixes text-rendering: optimizeLegibility */\n\n    /*\n    Sets the font stack to fonts known to work properly with the above letter\n    and word spacings. See: https://github.com/pure-css/pure/issues/41/\n\n    The following font stack makes Pure Grids work on all known environments.\n\n    * FreeSans: Ships with many Linux distros, including Ubuntu\n\n    * Arimo: Ships with Chrome OS. Arimo has to be defined before Helvetica and\n      Arial to get picked up by the browser, even though neither is available\n      in Chrome OS.\n\n    * Droid Sans: Ships with all versions of Android.\n\n    * Helvetica, Arial, sans-serif: Common font stack on OS X and Windows.\n    */\n    font-family: FreeSans, Arimo, \"Droid Sans\", Helvetica, Arial, sans-serif;\n\n    /* Use flexbox when possible to avoid `letter-spacing` side-effects. */\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: horizontal;\n    -webkit-box-direction: normal;\n        -ms-flex-flow: row wrap;\n            flex-flow: row wrap;\n\n    /* Prevents distributing space between rows */\n    -ms-flex-line-pack: start;\n        align-content: flex-start;\n}\n\n/* IE10 display: -ms-flexbox (and display: flex in IE 11) does not work inside a table; fall back to block and rely on font hack */\n@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {\n\ttable .pure-g {\n\t\tdisplay: block;\n\t}\n}\n\n/* Opera as of 12 on Windows needs word-spacing.\n   The \".opera-only\" selector is used to prevent actual prefocus styling\n   and is not required in markup.\n*/\n.opera-only :-o-prefocus,\n.pure-g {\n    word-spacing: -0.43em;\n}\n\n.pure-u {\n    display: inline-block;\n    letter-spacing: normal;\n    word-spacing: normal;\n    vertical-align: top;\n    text-rendering: auto;\n}\n\n/*\nResets the font family back to the OS/browser's default sans-serif font,\nthis the same font stack that Normalize.css sets for the `body`.\n*/\n.pure-g [class *= \"pure-u\"] {\n    font-family: sans-serif;\n}\n\n.pure-u-1,\n.pure-u-1-1,\n.pure-u-1-2,\n.pure-u-1-3,\n.pure-u-2-3,\n.pure-u-1-4,\n.pure-u-3-4,\n.pure-u-1-5,\n.pure-u-2-5,\n.pure-u-3-5,\n.pure-u-4-5,\n.pure-u-5-5,\n.pure-u-1-6,\n.pure-u-5-6,\n.pure-u-1-8,\n.pure-u-3-8,\n.pure-u-5-8,\n.pure-u-7-8,\n.pure-u-1-12,\n.pure-u-5-12,\n.pure-u-7-12,\n.pure-u-11-12,\n.pure-u-1-24,\n.pure-u-2-24,\n.pure-u-3-24,\n.pure-u-4-24,\n.pure-u-5-24,\n.pure-u-6-24,\n.pure-u-7-24,\n.pure-u-8-24,\n.pure-u-9-24,\n.pure-u-10-24,\n.pure-u-11-24,\n.pure-u-12-24,\n.pure-u-13-24,\n.pure-u-14-24,\n.pure-u-15-24,\n.pure-u-16-24,\n.pure-u-17-24,\n.pure-u-18-24,\n.pure-u-19-24,\n.pure-u-20-24,\n.pure-u-21-24,\n.pure-u-22-24,\n.pure-u-23-24,\n.pure-u-24-24 {\n    display: inline-block;\n    letter-spacing: normal;\n    word-spacing: normal;\n    vertical-align: top;\n    text-rendering: auto;\n}\n\n.pure-u-1-24 {\n    width: 4.1667%;\n}\n\n.pure-u-1-12,\n.pure-u-2-24 {\n    width: 8.3333%;\n}\n\n.pure-u-1-8,\n.pure-u-3-24 {\n    width: 12.5000%;\n}\n\n.pure-u-1-6,\n.pure-u-4-24 {\n    width: 16.6667%;\n}\n\n.pure-u-1-5 {\n    width: 20%;\n}\n\n.pure-u-5-24 {\n    width: 20.8333%;\n}\n\n.pure-u-1-4,\n.pure-u-6-24 {\n    width: 25%;\n}\n\n.pure-u-7-24 {\n    width: 29.1667%;\n}\n\n.pure-u-1-3,\n.pure-u-8-24 {\n    width: 33.3333%;\n}\n\n.pure-u-3-8,\n.pure-u-9-24 {\n    width: 37.5000%;\n}\n\n.pure-u-2-5 {\n    width: 40%;\n}\n\n.pure-u-5-12,\n.pure-u-10-24 {\n    width: 41.6667%;\n}\n\n.pure-u-11-24 {\n    width: 45.8333%;\n}\n\n.pure-u-1-2,\n.pure-u-12-24 {\n    width: 50%;\n}\n\n.pure-u-13-24 {\n    width: 54.1667%;\n}\n\n.pure-u-7-12,\n.pure-u-14-24 {\n    width: 58.3333%;\n}\n\n.pure-u-3-5 {\n    width: 60%;\n}\n\n.pure-u-5-8,\n.pure-u-15-24 {\n    width: 62.5000%;\n}\n\n.pure-u-2-3,\n.pure-u-16-24 {\n    width: 66.6667%;\n}\n\n.pure-u-17-24 {\n    width: 70.8333%;\n}\n\n.pure-u-3-4,\n.pure-u-18-24 {\n    width: 75%;\n}\n\n.pure-u-19-24 {\n    width: 79.1667%;\n}\n\n.pure-u-4-5 {\n    width: 80%;\n}\n\n.pure-u-5-6,\n.pure-u-20-24 {\n    width: 83.3333%;\n}\n\n.pure-u-7-8,\n.pure-u-21-24 {\n    width: 87.5000%;\n}\n\n.pure-u-11-12,\n.pure-u-22-24 {\n    width: 91.6667%;\n}\n\n.pure-u-23-24 {\n    width: 95.8333%;\n}\n\n.pure-u-1,\n.pure-u-1-1,\n.pure-u-5-5,\n.pure-u-24-24 {\n    width: 100%;\n}\n.pure-button {\n    /* Structure */\n    display: inline-block;\n    line-height: normal;\n    white-space: nowrap;\n    vertical-align: middle;\n    text-align: center;\n    cursor: pointer;\n    -webkit-user-drag: none;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n/* Firefox: Get rid of the inner focus border */\n.pure-button::-moz-focus-inner {\n    padding: 0;\n    border: 0;\n}\n\n/* Inherit .pure-g styles */\n.pure-button-group {\n    letter-spacing: -0.31em; /* Webkit: collapse white-space between units */\n    text-rendering: optimizespeed; /* Webkit: fixes text-rendering: optimizeLegibility */\n}\n\n.opera-only :-o-prefocus,\n.pure-button-group {\n    word-spacing: -0.43em;\n}\n\n.pure-button-group .pure-button {\n    letter-spacing: normal;\n    word-spacing: normal;\n    vertical-align: top;\n    text-rendering: auto;\n}\n\n/*csslint outline-none:false*/\n\n.pure-button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 0.5em 1em;\n    color: rgba(0, 0, 0, 0.80);\n    border: none rgba(0, 0, 0, 0);\n    background-color: #E6E6E6;\n    text-decoration: none;\n    border-radius: 2px;\n}\n\n.pure-button-hover,\n.pure-button:hover,\n.pure-button:focus,\nbutton:hover {\n    background-image: -webkit-gradient(linear, left top, left bottom, from(transparent), color-stop(40%, rgba(0,0,0, 0.05)), to(rgba(0,0,0, 0.10)));\n    background-image: linear-gradient(transparent, rgba(0,0,0, 0.05) 40%, rgba(0,0,0, 0.10));\n}\n.pure-button:focus {\n    outline: 0;\n}\n.pure-button-active,\n.pure-button:active {\n    -webkit-box-shadow: 0 0 0 1px rgba(0,0,0, 0.15) inset, 0 0 6px rgba(0,0,0, 0.20) inset;\n            box-shadow: 0 0 0 1px rgba(0,0,0, 0.15) inset, 0 0 6px rgba(0,0,0, 0.20) inset;\n    border-color: #000;\n}\n\n.pure-button[disabled],\n.pure-button-disabled,\n.pure-button-disabled:hover,\n.pure-button-disabled:focus,\n.pure-button-disabled:active,\nbutton:disabled {\n    border: none;\n    background-image: none;\n    opacity: 0.40;\n    cursor: not-allowed;\n    -webkit-box-shadow: none;\n            box-shadow: none;\n    pointer-events: none;\n}\n\n.pure-button-hidden {\n    display: none;\n}\n\n.pure-button-primary,\n.pure-button-selected,\na.pure-button-primary,\na.pure-button-selected {\n    background-color: rgb(0, 120, 231);\n    color: #fff;\n}\n\n/* Button Groups */\n.pure-button-group .pure-button {\n    margin: 0;\n    border-radius: 0;\n    border-right: 1px solid rgba(0, 0, 0, 0.2);\n\n}\n\n.pure-button-group .pure-button:first-child {\n    border-top-left-radius: 2px;\n    border-bottom-left-radius: 2px;\n}\n.pure-button-group .pure-button:last-child {\n    border-top-right-radius: 2px;\n    border-bottom-right-radius: 2px;\n    border-right: none;\n}\n\n/*csslint box-model:false*/\n/*\nBox-model set to false because we're setting a height on select elements, which\nalso have border and padding. This is done because some browsers don't render\nthe padding. We explicitly set the box-model for select elements to border-box,\nso we can ignore the csslint warning.\n*/\n\n.pure-form input[type=\"text\"],\n.pure-form input[type=\"password\"],\n.pure-form input[type=\"email\"],\n.pure-form input[type=\"url\"],\n.pure-form input[type=\"date\"],\n.pure-form input[type=\"month\"],\n.pure-form input[type=\"time\"],\n.pure-form input[type=\"datetime\"],\n.pure-form input[type=\"datetime-local\"],\n.pure-form input[type=\"week\"],\n.pure-form input[type=\"number\"],\n.pure-form input[type=\"search\"],\n.pure-form input[type=\"tel\"],\n.pure-form input[type=\"color\"],\n.pure-form select,\n.pure-form textarea {\n    padding: 0.5em 0.6em;\n    display: inline-block;\n    border: 1px solid #ccc;\n    -webkit-box-shadow: inset 0 1px 3px #ddd;\n            box-shadow: inset 0 1px 3px #ddd;\n    border-radius: 4px;\n    vertical-align: middle;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n/*\nNeed to separate out the :not() selector from the rest of the CSS 2.1 selectors\nsince IE8 won't execute CSS that contains a CSS3 selector.\n*/\n.pure-form input:not([type]) {\n    padding: 0.5em 0.6em;\n    display: inline-block;\n    border: 1px solid #ccc;\n    -webkit-box-shadow: inset 0 1px 3px #ddd;\n            box-shadow: inset 0 1px 3px #ddd;\n    border-radius: 4px;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n\n/* Chrome (as of v.32/34 on OS X) needs additional room for color to display. */\n/* May be able to remove this tweak as color inputs become more standardized across browsers. */\n.pure-form input[type=\"color\"] {\n    padding: 0.2em 0.5em;\n}\n\n\n.pure-form input[type=\"text\"]:focus,\n.pure-form input[type=\"password\"]:focus,\n.pure-form input[type=\"email\"]:focus,\n.pure-form input[type=\"url\"]:focus,\n.pure-form input[type=\"date\"]:focus,\n.pure-form input[type=\"month\"]:focus,\n.pure-form input[type=\"time\"]:focus,\n.pure-form input[type=\"datetime\"]:focus,\n.pure-form input[type=\"datetime-local\"]:focus,\n.pure-form input[type=\"week\"]:focus,\n.pure-form input[type=\"number\"]:focus,\n.pure-form input[type=\"search\"]:focus,\n.pure-form input[type=\"tel\"]:focus,\n.pure-form input[type=\"color\"]:focus,\n.pure-form select:focus,\n.pure-form textarea:focus {\n    outline: 0;\n    border-color: #129FEA;\n}\n\n/*\nNeed to separate out the :not() selector from the rest of the CSS 2.1 selectors\nsince IE8 won't execute CSS that contains a CSS3 selector.\n*/\n.pure-form input:not([type]):focus {\n    outline: 0;\n    border-color: #129FEA;\n}\n\n.pure-form input[type=\"file\"]:focus,\n.pure-form input[type=\"radio\"]:focus,\n.pure-form input[type=\"checkbox\"]:focus {\n    outline: thin solid #129FEA;\n    outline: 1px auto #129FEA;\n}\n.pure-form .pure-checkbox,\n.pure-form .pure-radio {\n    margin: 0.5em 0;\n    display: block;\n}\n\n.pure-form input[type=\"text\"][disabled],\n.pure-form input[type=\"password\"][disabled],\n.pure-form input[type=\"email\"][disabled],\n.pure-form input[type=\"url\"][disabled],\n.pure-form input[type=\"date\"][disabled],\n.pure-form input[type=\"month\"][disabled],\n.pure-form input[type=\"time\"][disabled],\n.pure-form input[type=\"datetime\"][disabled],\n.pure-form input[type=\"datetime-local\"][disabled],\n.pure-form input[type=\"week\"][disabled],\n.pure-form input[type=\"number\"][disabled],\n.pure-form input[type=\"search\"][disabled],\n.pure-form input[type=\"tel\"][disabled],\n.pure-form input[type=\"color\"][disabled],\n.pure-form select[disabled],\n.pure-form textarea[disabled] {\n    cursor: not-allowed;\n    background-color: #eaeded;\n    color: #cad2d3;\n}\n\n/*\nNeed to separate out the :not() selector from the rest of the CSS 2.1 selectors\nsince IE8 won't execute CSS that contains a CSS3 selector.\n*/\n.pure-form input:not([type])[disabled] {\n    cursor: not-allowed;\n    background-color: #eaeded;\n    color: #cad2d3;\n}\n.pure-form input[readonly],\n.pure-form select[readonly],\n.pure-form textarea[readonly] {\n    background-color: #eee; /* menu hover bg color */\n    color: #777; /* menu text color */\n    border-color: #ccc;\n}\n\n.pure-form input:focus:invalid,\n.pure-form textarea:focus:invalid,\n.pure-form select:focus:invalid {\n    color: #b94a48;\n    border-color: #e9322d;\n}\n.pure-form input[type=\"file\"]:focus:invalid:focus,\n.pure-form input[type=\"radio\"]:focus:invalid:focus,\n.pure-form input[type=\"checkbox\"]:focus:invalid:focus {\n    outline-color: #e9322d;\n}\n.pure-form select {\n    /* Normalizes the height; padding is not sufficient. */\n    height: 2.25em;\n    border: 1px solid #ccc;\n    background-color: white;\n}\n.pure-form select[multiple] {\n    height: auto;\n}\n.pure-form label {\n    margin: 0.5em 0 0.2em;\n}\n.pure-form fieldset {\n    margin: 0;\n    padding: 0.35em 0 0.75em;\n    border: 0;\n}\n.pure-form legend {\n    display: block;\n    width: 100%;\n    padding: 0.3em 0;\n    margin-bottom: 0.3em;\n    color: #333;\n    border-bottom: 1px solid #e5e5e5;\n}\n\n.pure-form-stacked input[type=\"text\"],\n.pure-form-stacked input[type=\"password\"],\n.pure-form-stacked input[type=\"email\"],\n.pure-form-stacked input[type=\"url\"],\n.pure-form-stacked input[type=\"date\"],\n.pure-form-stacked input[type=\"month\"],\n.pure-form-stacked input[type=\"time\"],\n.pure-form-stacked input[type=\"datetime\"],\n.pure-form-stacked input[type=\"datetime-local\"],\n.pure-form-stacked input[type=\"week\"],\n.pure-form-stacked input[type=\"number\"],\n.pure-form-stacked input[type=\"search\"],\n.pure-form-stacked input[type=\"tel\"],\n.pure-form-stacked input[type=\"color\"],\n.pure-form-stacked input[type=\"file\"],\n.pure-form-stacked select,\n.pure-form-stacked label,\n.pure-form-stacked textarea {\n    display: block;\n    margin: 0.25em 0;\n}\n\n/*\nNeed to separate out the :not() selector from the rest of the CSS 2.1 selectors\nsince IE8 won't execute CSS that contains a CSS3 selector.\n*/\n.pure-form-stacked input:not([type]) {\n    display: block;\n    margin: 0.25em 0;\n}\n.pure-form-aligned input,\n.pure-form-aligned textarea,\n.pure-form-aligned select,\n.pure-form-message-inline {\n    display: inline-block;\n    vertical-align: middle;\n}\n.pure-form-aligned textarea {\n    vertical-align: top;\n}\n\n/* Aligned Forms */\n.pure-form-aligned .pure-control-group {\n    margin-bottom: 0.5em;\n}\n.pure-form-aligned .pure-control-group label {\n    text-align: right;\n    display: inline-block;\n    vertical-align: middle;\n    width: 10em;\n    margin: 0 1em 0 0;\n}\n.pure-form-aligned .pure-controls {\n    margin: 1.5em 0 0 11em;\n}\n\n/* Rounded Inputs */\n.pure-form input.pure-input-rounded,\n.pure-form .pure-input-rounded {\n    border-radius: 2em;\n    padding: 0.5em 1em;\n}\n\n/* Grouped Inputs */\n.pure-form .pure-group fieldset {\n    margin-bottom: 10px;\n}\n.pure-form .pure-group input,\n.pure-form .pure-group textarea {\n    display: block;\n    padding: 10px;\n    margin: 0 0 -1px;\n    border-radius: 0;\n    position: relative;\n    top: -1px;\n}\n.pure-form .pure-group input:focus,\n.pure-form .pure-group textarea:focus {\n    z-index: 3;\n}\n.pure-form .pure-group input:first-child,\n.pure-form .pure-group textarea:first-child {\n    top: 1px;\n    border-radius: 4px 4px 0 0;\n    margin: 0;\n}\n.pure-form .pure-group input:first-child:last-child,\n.pure-form .pure-group textarea:first-child:last-child {\n    top: 1px;\n    border-radius: 4px;\n    margin: 0;\n}\n.pure-form .pure-group input:last-child,\n.pure-form .pure-group textarea:last-child {\n    top: -2px;\n    border-radius: 0 0 4px 4px;\n    margin: 0;\n}\n.pure-form .pure-group button {\n    margin: 0.35em 0;\n}\n\n.pure-form .pure-input-1 {\n    width: 100%;\n}\n.pure-form .pure-input-3-4 {\n    width: 75%;\n}\n.pure-form .pure-input-2-3 {\n    width: 66%;\n}\n.pure-form .pure-input-1-2 {\n    width: 50%;\n}\n.pure-form .pure-input-1-3 {\n    width: 33%;\n}\n.pure-form .pure-input-1-4 {\n    width: 25%;\n}\n\n/* Inline help for forms */\n.pure-form-message-inline {\n    display: inline-block;\n    padding-left: 0.3em;\n    color: #666;\n    vertical-align: middle;\n    font-size: 0.875em;\n}\n\n/* Block help for forms */\n.pure-form-message {\n    display: block;\n    color: #666;\n    font-size: 0.875em;\n}\n\n@media only screen and (max-width : 480px) {\n    .pure-form button[type=\"submit\"] {\n        margin: 0.7em 0 0;\n    }\n\n    .pure-form input:not([type]),\n    .pure-form input[type=\"text\"],\n    .pure-form input[type=\"password\"],\n    .pure-form input[type=\"email\"],\n    .pure-form input[type=\"url\"],\n    .pure-form input[type=\"date\"],\n    .pure-form input[type=\"month\"],\n    .pure-form input[type=\"time\"],\n    .pure-form input[type=\"datetime\"],\n    .pure-form input[type=\"datetime-local\"],\n    .pure-form input[type=\"week\"],\n    .pure-form input[type=\"number\"],\n    .pure-form input[type=\"search\"],\n    .pure-form input[type=\"tel\"],\n    .pure-form input[type=\"color\"],\n    .pure-form label {\n        margin-bottom: 0.3em;\n        display: block;\n    }\n\n    .pure-group input:not([type]),\n    .pure-group input[type=\"text\"],\n    .pure-group input[type=\"password\"],\n    .pure-group input[type=\"email\"],\n    .pure-group input[type=\"url\"],\n    .pure-group input[type=\"date\"],\n    .pure-group input[type=\"month\"],\n    .pure-group input[type=\"time\"],\n    .pure-group input[type=\"datetime\"],\n    .pure-group input[type=\"datetime-local\"],\n    .pure-group input[type=\"week\"],\n    .pure-group input[type=\"number\"],\n    .pure-group input[type=\"search\"],\n    .pure-group input[type=\"tel\"],\n    .pure-group input[type=\"color\"] {\n        margin-bottom: 0;\n    }\n\n    .pure-form-aligned .pure-control-group label {\n        margin-bottom: 0.3em;\n        text-align: left;\n        display: block;\n        width: 100%;\n    }\n\n    .pure-form-aligned .pure-controls {\n        margin: 1.5em 0 0 0;\n    }\n\n    .pure-form-message-inline,\n    .pure-form-message {\n        display: block;\n        font-size: 0.75em;\n        /* Increased bottom padding to make it group with its related input element. */\n        padding: 0.2em 0 0.8em;\n    }\n}\n\n/*csslint adjoining-classes: false, box-model:false*/\n.pure-menu {\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n.pure-menu-fixed {\n    position: fixed;\n    left: 0;\n    top: 0;\n    z-index: 3;\n}\n\n.pure-menu-list,\n.pure-menu-item {\n    position: relative;\n}\n\n.pure-menu-list {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    font-size: 0.9em;\n    background: #F8F6F6;\n}\n\n.pure-menu-item {\n    padding: 0;\n    margin: 0;\n    height: 100%;\n}\n\n.pure-menu-link,\n.pure-menu-heading {\n    display: block;\n    text-decoration: none;\n    white-space: nowrap;\n}\n\n/* HORIZONTAL MENU */\n.pure-menu-horizontal {\n    width: 100%;\n    white-space: nowrap;\n}\n\n.pure-menu-horizontal .pure-menu-list {\n    display: inline-block;\n}\n\n/* Initial menus should be inline-block so that they are horizontal */\n.pure-menu-horizontal .pure-menu-item,\n.pure-menu-horizontal .pure-menu-heading,\n.pure-menu-horizontal .pure-menu-separator {\n    display: inline-block;\n    vertical-align: middle;\n}\n\n/* Submenus should still be display: block; */\n.pure-menu-item .pure-menu-item {\n    display: block;\n}\n\n.pure-menu-children {\n    display: none;\n    position: absolute;\n    left: 100%;\n    top: 0;\n    margin: 0;\n    padding: 0;\n    z-index: 3;\n}\n\n.pure-menu-horizontal .pure-menu-children {\n    left: 0;\n    top: auto;\n    width: inherit;\n}\n\n.pure-menu-allow-hover:hover > .pure-menu-children,\n.pure-menu-active > .pure-menu-children {\n    display: block;\n    position: absolute;\n}\n\n/* Vertical Menus - show the dropdown arrow */\n.pure-menu-has-children > .pure-menu-link:after {\n    padding-left: 0.5em;\n    content: \"▸\";\n    font-size: small;\n}\n\n/* Horizontal Menus - show the dropdown arrow */\n.pure-menu-horizontal .pure-menu-has-children > .pure-menu-link:after {\n    content: \"▾\";\n}\n\n/* scrollable menus */\n.pure-menu-scrollable {\n    overflow-y: scroll;\n    overflow-x: hidden;\n}\n\n.pure-menu-scrollable .pure-menu-list {\n    display: block;\n}\n\n.pure-menu-horizontal.pure-menu-scrollable .pure-menu-list {\n    display: inline-block;\n}\n\n.pure-menu-horizontal.pure-menu-scrollable {\n    white-space: nowrap;\n    overflow-y: hidden;\n    overflow-x: auto;\n    /* a little extra padding for this style to allow for scrollbars */\n    padding: .5em 0;\n}\n\n/* misc default styling */\n\n.pure-menu-separator,\n.pure-menu-horizontal .pure-menu-children .pure-menu-separator {\n    background-color: #ccc;\n    height: 1px;\n    margin: .3em 0;\n}\n\n.pure-menu-horizontal .pure-menu-separator {\n    width: 1px;\n    height: 1.3em;\n    margin: 0 .3em ;\n}\n\n/* Need to reset the separator since submenu is vertical */\n.pure-menu-horizontal .pure-menu-children .pure-menu-separator {\n    display: block;\n    width: auto;\n}\n\n.pure-menu-heading {\n    text-transform: uppercase;\n    color: #565d64;\n}\n\n.pure-menu-link {\n  color: #505050;\n}\n\n.pure-menu-children {\n    background-color: #fff;\n}\n\n.pure-menu-link,\n.pure-menu-heading {\n    padding: 0.3em 1em;\n}\n\n.pure-menu-disabled {\n    opacity: .5;\n}\n\n.pure-menu-disabled .pure-menu-link:hover {\n    background-color: transparent;\n    cursor: default;\n}\n\n.pure-menu-active > .pure-menu-link,\n.pure-menu-link:hover,\n.pure-menu-link:focus {\n    background-color: #eee;\n}\n\n.pure-menu-selected > .pure-menu-link,\n.pure-menu-selected > .pure-menu-link:visited {\n    color: #000;\n}\n\n.pure-table {\n    /* Remove spacing between table cells (from Normalize.css) */\n    border-collapse: collapse;\n    border-spacing: 0;\n    empty-cells: show;\n    border: 1px solid #cbcbcb;\n}\n\n.pure-table caption {\n    color: #000;\n    font: italic 85%/1 arial, sans-serif;\n    padding: 1em 0;\n    text-align: center;\n}\n\n.pure-table td,\n.pure-table th {\n    border-left: 1px solid #cbcbcb;/*  inner column border */\n    border-width: 0 0 0 1px;\n    font-size: inherit;\n    margin: 0;\n    overflow: visible; /*to make ths where the title is really long work*/\n    padding: 0.5em 1em; /* cell padding */\n}\n\n.pure-table thead {\n    background-color: #e0e0e0;\n    color: #000;\n    text-align: left;\n    vertical-align: bottom;\n}\n\n/*\nstriping:\n   even - #fff (white)\n   odd  - #f2f2f2 (light gray)\n*/\n.pure-table td {\n    background-color: transparent;\n}\n.pure-table-odd td {\n    background-color: #f2f2f2;\n}\n\n/* nth-child selector for modern browsers */\n.pure-table-striped tr:nth-child(2n-1) td {\n    background-color: #f2f2f2;\n}\n\n/* BORDERED TABLES */\n.pure-table-bordered td {\n    border-bottom: 1px solid #cbcbcb;\n}\n.pure-table-bordered tbody > tr:last-child > td {\n    border-bottom-width: 0;\n}\n\n\n/* HORIZONTAL BORDERED TABLES */\n\n.pure-table-horizontal td,\n.pure-table-horizontal th {\n    border-width: 0 0 1px 0;\n    border-bottom: 1px solid #cbcbcb;\n}\n.pure-table-horizontal tbody > tr:last-child > td {\n    border-bottom-width: 0;\n}\n\n\n/* ----- Specific Juno Styles ----- */\n\n\n\n\n.juno-vertical-split-container {\n  overflow: hidden;\n  margin: 0px;\n  padding: 0px;\n  position: relative;\n  display: flex\n}\n\n.juno-view-container {\n  display: inline-block;\n  width: inherit;\n  height: inherit;\n}\n\n.juno-vertical-dragger {\n  z-index: 8;\n  width: 7px;\n  height: 100%;\n  cursor: col-resize;\n  display: inline-block;\n  background: #F8F6F6;\n}\n\n.juno-vertical-dragger:hover {\n  box-shadow: 0px 1px 3px 0px #00000042;\n  /* background: #00000040; */\n  \n}\n\n.juno-buffer-bar {  \n  font-size: 0.9em;\n  background: #00000010;\n  width: 100%;\n  cursor: default;\n  white-space: nowrap;\n  padding-top: 2px;\n  padding-bottom: 2px;\n}\n\n.juno-buffer-bar button {\n  margin-left: 5px;\n  margin-right: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border: none;\n  border-radius: 0px;\n  font-weight: bold;\n  background: #00000019;\n}\n\n.juno-buffer-bar button:hover {\n  background: #00000030;\n}\n\n.juno-title {\n  color: black;\n  padding-left: 10px;\n  padding-right: 10px;\n  font-weight: bold;\n}\n\nspan.juno-namespace {\n  font-family: var(--main-mono-space);\n  color: #976464;\n}\n\nspan.juno-focused {\n  background: #FFFFFFA0;\n}\n\nspan.juno-needs-save {\n  color: #016783;\n}\n\n.juno-menu {\n  position: absolute;\n  z-index: 20;\n  animation: slide-in 0.2s ease-out;\n  box-shadow: 1px 1px 4px 0px #00000082;\n}\n\n.juno-header {\n  color: #026783;\n  padding: 4px;\n  margin-left: 5px;\n  margin-right: 10px;\n  font-weight: bold;\n  display: inline-block;\n  cursor: default;\n}\n\n@keyframes slide-in {\n    0% {\n        margin-left:-6px;\n        opacity: 0\n    }\n    100% {\n        margin-left:-0px;\n        opacity: 1\n    }\n}\n" })();__obj__1["browser_initializer"]=await (async function(){ return "\n;; main browser initialization file - initializes the user browser environment\n;; after the browser_workspace has setup the underlying environment\n\n(defglobal main_menu_button nil) ;; placeholders \n(defglobal resource_loader_button nil)\n(defglobal juno_container nil)\n(defglobal repl_editor nil)\n(defglobal *scratch* \";; *scratch* buffer\\n\\n\")\n(defglobal $controls nil)\n\n(defun make_menu (for_element menu_items)\n  (let\n      ((menu_items menu_items)\n       (for_element for_element)\n       (pos nil)\n       (disappear_timer nil)\n       (view nil))\n    (aif (get_by_id \"cmenu\")\n         (-> it `remove))\n    (setq view\n          (div { `id: `cmenu `class: \"juno-menu\"  }\n               (div {  `class: \"pure-menu pure-menu-horizontal\"  }               \n                    (ul { `class: \"pure-menu-list\" }                 \n                        (map (fn (item idx)                     \n                               (li { `idx: idx `class: \"pure-list-item\" } (a { `idx: idx  `href: \"#\" `class: \"pure-menu-link\" } item.0)))\n                             (or menu_items []))))))\n    (when for_element\n      (setq pos\n            (-> for_element `getBoundingClientRect))\n      (set_style [[\"top\" (+ \"\" (Math.max 0 pos.bottom) \"px\") ]\n                  [\"left\" (+ \"\" (Math.max pos.left 0) \"px\") ]] view))\n    \n    (attach_event_listener view\n                           `click\n                           (fn (e)\n                             (progn\n                              (defvar idx (-> e.srcElement `getAttribute `idx))\n                              (defvar item (prop menu_items idx))\n                             \n                              (console.log \"clicked item: \" idx item item.1)\n                               (when item\n                                 (item.1 e))\n                               (-> view `remove))))\n\n    (attach_event_listener view\n                           `mouseleave\n                           (function (e)\n                                     (progn\n                                      (when disappear_timer\n                                        (clearTimeout disappear_timer))\n                                      (= disappear_timer (setTimeout (fn ()\n                                                                       (progn\n                                                                        (-> view `remove)\n                                                                        (= disappear_timer nil)))\n                                                                     500)))))\n    (attach_event_listener view\n                           `mouseenter\n                           (function (e)\n                                     (when disappear_timer\n                                       (clearTimeout disappear_timer)\n                                       (= disappear_timer nil))))\n\n    \n                                      \n                                      \n    \n    (-> (get_by_id \"body\") `appendChild view) \n    view))\n\n(defun request_user_input (prompt type)\n  (new Promise (fn (resolve reject)                 \n                 (let\n                     ((user_input  (input { `type: (or type \"text\") }))\n                      (ok_button (button { `class: \"pure-button-primary\" `style: \"float:right\" } \"OK\"))\n                      (cancel_button (button  \"Cancel\"))\n                      (dwin (dialog prompt                                    \n                                    (br)\n                                    user_input\n                                    (br)\n                                    (div { `class: \"pure-button-group\" `role: \"group\" }\n                                         cancel_button\n                                         ok_button))))\n                   (attach_event_listener ok_button\n                                          `click\n                                          (fn (e)\n                                            (do                                              \n                                              (resolve user_input.value)\n                                              (-> dwin `remove))))\n                   (attach_event_listener cancel_button\n                                          `click\n                                          (fn (e)\n                                            (do\n                                              (-> dwin `remove)\n                                              (resolve nil))))\n                   (-> juno_container\n                       `appendChild dwin)\n                   (when (is_function? dwin.showModal)\n                     (-> dwin `showModal))))))\n                                           \n    \n                     \n(defun message (text)\n  (rlog (div { `style: \"border-left: 5px solid darkblue; padding: 5px;\" } text)))\n\n(defun error_message (text)\n  (rlog (div { `style: \"border-left: 5px solid red; padding: 5px;\" } text)))\n\n(defun log_error (message error_instance)\n  (progn\n   (error_message message)\n   (console.error message)\n   (when error_instance\n     (when error_instance.messasge\n       (error_message error_instance.message))\n     (console.error error_instance))))\n     \n\n(defun load_js_file (file)\n  (let\n      ((fdata (try\n                (read_file file { `read_as: \"text\" })\n                (catch Error (e)\n                  e)))\n       (assignment_to nil)\n       (error nil))\n    (message (+ \"found and read JS \" file.name \", size: \" file.size))\n    (cond\n      (and fdata\n           (not (instanceof fdata Error)))\n      (progn\n       (aif (request_user_input \"Enter a name for a reference to the loaded Javascript\" \"text\")\n            (do\n              (= assignment_to it)              \n              (try\n                (progn\n                 (debug)\n                 (cond\n                   (or (== assignment_to \"global\")\n                       (== assignment_to \"script\"))\n                   (-> (page_header) `append (script { `type: \"text/javascript\" `charset: \"utf-8\" }\n                                                     (javascript fdata)))\n                   else\n                   (eval `(defglobal ,#assignment_to (javascript ,#fdata)))))\n                (catch Error (e)\n                  (do\n                    (= error true)\n                    (error_message (+ \"Unable to create \" assignment_to \": \" e.message))\n                    (console.error \"ERROR: \" e))))                                                    \n              (when (not error)\n                (message (+ \"Loaded JS to \" assignment_to ))))\n            (notify \"Entry Cancelled\")))\n      else\n      (progn\n       (rlog \"Unable to read the file\")\n       (console.error fdata)))))\n\n(defun embed_js_orig (name js_text) \n  (progn\n   (debug)\n   (-> (page_header) `append (html/script { `id: name `type: \"text/javascript\" `charset: \"utf-8\" }\n                                     (javascript js_text)))   \n   (eval `(defglobal ,#name (html/get_by_id ,#name)\n            {\n             `embedded_script: true\n             }))))\n\n(defun embed_js (name js_text) \n  (progn\n   (debug)\n   (eval `(-> (page_header) `append (html/script { `id: name `type: \"text/javascript\" `charset: \"utf-8\" }\n                                     (javascript ,#js_text))))\n   (eval `(defglobal ,#name (html/get_by_id ,#name)\n            {\n             `embedded_script: true\n             }))))\n\n(defun embed_js_file (file)\n  (let\n      ((fdata (try\n                (read_file file { `read_as: \"text\" })\n                (catch Error (e)\n                  e)))\n       (assignment_to nil)\n       (error nil))\n    (message (+ \"found and read JS \" file.name \", size: \" file.size))\n    (cond\n      (and fdata\n           (not (instanceof fdata Error)))\n      (progn\n       (aif (request_user_input \"Enter a name for a reference to the loaded Javascript\" \"text\")\n            (do\n              (= assignment_to it)              \n              (try\n                (embed_js_orig assignment_to fdata)                   \n                (catch Error (e)\n                  (do\n                    (= error true)\n                    (error_message (+ \"Unable to create \" assignment_to \": \" e.message))\n                    (console.error \"ERROR: \" e))))                                                    \n              (when (not error)\n                (message (+ \"Loaded JS to \" assignment_to ))))\n            (notify \"Entry Cancelled\")))\n      else\n      (progn\n       (rlog \"Unable to read the file\")\n       (console.error fdata)))))\n\n(defun load_files (files)\n  (when (> files.length 0)\n    (for_each (file files)\n       (do\n         (cond\n           (== file.type \"text/javascript\")\n           (embed_js_file file)\n           (== file.type \"text/plain\")\n           (notify \"Text Resource\")\n           (or (ends_with? file.name \".lisp\")\n               (ends_with? file.name \".juno\"))\n           (notify \"Loading lisp file\"))))))\n\n\n(defun make_editor (content options)\n  (let\n      ((options (or options {\n                             `type: \"juno\"\n                             }))\n       (resize_observer nil)\n       (intf {})\n       (content (or content \"\"))\n       (controls (div { `style: \"display: flex; \" }))\n       (editor_div (div { `style: \"height: calc(100% - 15px); width: 100%;\" }))\n       (view (div { `style: \"overflow: hidden; height: calc(100% - 5px); display: inline-block; width: inherit;\" }                  \n                  controls\n                  editor_div))\n       (perform_resize (fn ()\n                         (when view.parentElement\n                          ;(console.log \"editor: main resize: \" (prop view.parentElement `offsetWidth) (prop view.parentElement `offsetHeight))\n                          (html/set_style [[\"width\" (+ \"\" (- (prop view.parentElement `offsetWidth) 2) \"px\")]\n                                           [\"height\" (+ \"\" (- (prop view.parentElement `offsetHeight) 2) \"px\")]]\n                                          view)\n                          (-> editor `resize)\n                          )))\n       (editor nil)\n       (initialize_editor (fn ()\n                            (progn\n                             (setq editor\n                                   (ace.edit editor_div))\n                             (when options.evaluator\n                               (-> editor.commands `addCommand\n                                   {\n                                    `name: \"execute\"\n                                    `bindKey: { `win: \"Shift-Enter\" `mac: \"Shift-Enter\" }\n                                    `exec: (function (editor)\n                                                     (let\n                                                         ((val nil)\n                                                          (copytext (-> editor `getCopyText)))\n                                                       (if (blank? copytext)\n                                                         (notify (dtext \"Please highlight text to evaluate\"))\n                                                         (try\n                                                           (options.evaluator val)\n                                                           (catch Error (e)\n                                                             (progn\n                                                              (notify (+ (dtext \"Unhandled error\") \": \" e.message ))\n                                                              (console.error e)))))))\n                                    }))\n                             (when options.on_save\n                               (-> editor.commands `addCommand\n                                   {\n                                    `name: \"save\"\n                                    `bindKey: { `win: \"Ctrl-s\" `mac: \"Command-s\" }\n                                    `exec: (function (editor)\n                                                     (options.on_save (-> editor `getValue)))\n                                    }))\n\n                             \n                             \n                             (when (is_array? options.commands)\n                               (for_each (command options.commands)\n                                  (do\n                                    (-> editor.commands `addCommand\n                                        command))))\n                                              \n                             (when options.on_focus\n                               (-> editor `on `focus options.on_focus))\n                             (when options.on_blur\n                               (-> editor `on `blur options.on_blur))\n                             (when options.read_only\n                               (-> editor `setReadOnly true))\n                             (-> editor.session `setUseSoftTabs true)\n                             (-> editor `setOptions {\n                                   `enableBasicAutocompletion: true\n                                   `enableLiveAutocompletion: true\n                                   `showFoldWidgets: true\n                                   `fontFamily: \"Roboto Mono\"                  \n                                   })\n                             (-> editor.session `setUseWorker true)\n                             (-> editor `setShowFoldWidgets true)\n                             (cond\n                               (== options.type \"juno\")\n                               (-> editor.session `setMode \"ace/mode/juno\")\n                               (== options.type \"javascript\")\n                               (-> editor.session `setMode \"ace/mode/javascript\")\n                               (== options.type \"css\")\n                               (-> editor.session `setMode \"ace/mode/css\"))\n                             (console.log \"editor initialized: content: \" (subtype content) content)\n                             \n                             \n                             (-> editor `setValue content -1)\n\n                             (when options.on_change\n                               (-> editor `on `change (function (val)\n                                                                (options.on_change editor val))))\n                             \n                             (-> editor `resize true)                             \n                             (set_prop intf `editor editor)                             \n                             ))))\n       \n    \n    (if (not (is_symbol? `$ace_editor))\n      (throw TypeError \"$ace_editor symbol not found, and is required for this editor.\"))\n    \n    (when (is_element? options.command_bar)\n      (-> controls `prepend options.command_bar))\n      \n    (= resize_observer (new ResizeObserver perform_resize))\n    (= intf\n       {\n        `view: view\n        `editor: editor\n        `options: options\n        `initialize: (fn ()\n                       (when view.parentElement\n                         (console.log \"editor: performing initialization\")\n                         (-> resize_observer `observe view.parentElement)\n                         (initialize_editor)\n                         ))\n        })))\n\n\n(defun split_view_vertical (content_a content_b options)\n  (let\n      ((center_divider (div { `draggable: true`class: \"juno-vertical-dragger\" } \"\"))\n       (left_container (div { `class: \"juno-view-container\" `style: \"border-right: solid 3px transparent\" }\n                           (if content_a.view\n                             content_a.view\n                             content_a)))\n       (right_container (div { `class: \"juno-view-container\" }\n                           (if content_b.view\n                             content_b.view\n                             content_b)))\n       (view (div { `class: \"juno-vertical-split-container\"  `style: \"height: calc(100% - 5px); width: 100%;\" } \n                  left_container\n                  center_divider\n                  right_container))\n       (left_content content_a)      \n       (drag_status nil)\n       (body_element (-> document `querySelector \"body\"))\n       (right_content content_b)\n       (split_size_left \"50%\")\n       (resize_observer nil)\n       (perform_resize (fn ()\n                         (when view.parentElement\n                           (let\n                               ((new_height (- (prop view.parentElement `offsetHeight) 5))\n                                (new_width (- (prop view.parentElement `offsetWidth) 2))\n                                (center center_divider.offsetLeft))\n                             (set_style [[\"width\" (+ \"\" new_width \"px\")]\n                                         [\"height\" (+ \"\" new_height \"px\")]]\n                                        view)\n                             (set_style [[\"width\" (+ \"\" center \"px\")]\n                                         [\"height\" (+ \"\" new_height \"px\")]] left_container)\n                             (set_style [[\"width\" (+ \"\" (- new_width center 4) \"px\")]\n                                         [\"height\" (+ \"\" new_height \"px\")]] right_container)\n                             (console.log \"split_view: performed resize\" center)))))\n       (initial_style [[\"display\" \"inline-block\"]\n                       [ \"width\" split_size_left]\n                       [ \"height\" \"100%\"]]))\n    (set_style initial_style left_content)\n    (set_style initial_style right_content)\n    \n    (= resize_observer (new ResizeObserver perform_resize))\n    (attach_event_listener center_divider\n                           `dragstart\n                           (function (e)\n                                     (progn\n                                      ;(-> e `preventDefault)\n                                      (= drag_status {\n                                                      `start: left_container.offsetWidth\n                                                      `deltaX: 0\n                                                      })\n                                      (= e.dataTransfer.dropEffect \"move\")\n                                      (set_style [[\"border-right\" \"solid 3px #F0F0F0\"]] left_container)\n                                      (set_style [[\"opacity\" 0 ]] center_divider))))\n    (attach_event_listener center_divider\n                           `drag\n                           (function (e)\n                                     (progn\n                                      (-> e `preventDefault)                                    \n                                       (set_prop drag_status\n                                                 `deltaX\n                                                 (+ e.offsetX drag_status.deltaX)\n                                                 `pct\n                                                 (Math.max 5 (Math.min 95  (* 100 (/ (+ drag_status.start drag_status.deltaX) view.offsetWidth)))))                                       \n                                       (set_style [[\"width\" (+ \"\" (- 100 drag_status.pct)\n                                                               \"%\") ]] right_container)\n                                       (set_style [[\"width\" (+ \"\" drag_status.pct  \"%\") ]] left_container)\n                                       (= split_size_left (+ \"\" drag_status.pct \"%\"))\n                                       (set_style [[\"left\" (+ \"\" left_container.offsetWidth \"px\") ]] center_divider))))\n    \n    (attach_event_listener view\n                           `dragover\n                           (function (e)\n                                     (-> e `preventDefault)))\n    (attach_event_listener view\n                           `drop\n                           (function (e)\n                                     (progn\n                                      (-> e `preventDefault)\n                                      (console.log \"view.drop: \" e)\n                                      (set_style [[\"border-right\" \"solid 3px transparent\"]] left_container)\n                                      (set_style [[\"opacity\" 1]] center_divider))))\n                                      \n                                     \n    (attach_event_listener center_divider\n                           `dragend\n                           (function (e)\n                                     (progn                                      \n                                      (-> e `preventDefault)                                      \n                                      (console.log \"center_divider: drag end: \" e.offsetX ))))\n    {\n     `view: view\n     `initialize: (fn ()\n                    (progn\n                     (console.log \"split_view_vertical: initializing\" center_divider.offsetLeft)                     \n                     (-> resize_observer `observe view.parentElement)\n                     (set_style [[ \"left\" (+ \"\" left_container.offsetWidth \"px\") ]] center_divider)\n                     (= split_size_left (+ \"\" center_divider.offsetLeft \"px\"))\n                     \n                     ;; and cascade..\n                     (when left_content.initialize\n                       (-> left_content `initialize))\n                     (when right_content.initialize\n                       (-> right_content `initialize))))\n                     \n     `set_left_pane_content: (fn (content)\n                               (when (or (is_element? content)\n                                         (is_element? content.view))\n                                 (-> left_content `replaceWith\n                                     content)\n                                 (setq left_content\n                                       content)))\n     }))\n    \n                  \n\n(defun show_main_menu ()\n  (let\n      ((view nil))\n    \n    (setq view\n          (make_menu main_menu_button\n                     [[\"Save Image\" (fn (e) (save_image)) ]\n                      [\"Load Resource\" (fn (e) (-> resource_loader_button `click)) ]\n                      [\"Style CSS\" (fn (e) (notify \"View Site CSS\"))]\n                      ]))))   \n    \n\n(defun buffer_editor (title namespace path_to_value mode options)\n  (let\n      ((nseval (if (not (blank? namespace))\n                 (-> Environment `get_namespace_handle namespace)\n                 Environment))\n       (title_span (span { `class: \"juno-title\" } title))\n       (buffer_commands_button (button { `title: \"Buffer Commands\" } \"▸\"))\n       (is_dirty? false)\n       (command_bar (or options.command_bar\n                        (div { `class: \"juno-buffer-bar\" }\n                             buffer_commands_button\n                             title_span                                                             \n                             (span { `title: \"Namespace\" `class: \"juno-namespace\" `style: \"display:inline-block; padding-left: 30px; padding-right: 5px;\" } nseval.namespace)\n                             (if options.read_only\n                               (span { `title: \"This buffer doesn't allow editing\" `style: \"padding-left: 5px; padding-right: 5px;\" } (dtext \"Locked\"))\n                               ())\n                             (span { `class: \"juno-mode\" `title: \"Current Editing Mode\" `style: \"float: right; margin-right: 15px; display: inline-block; padding-left: 5px; padding-right: 5px;\" } mode))))      \n       (init_value (resolve_path path_to_value nseval.global_ctx.scope))\n       (on_save (fn (value)\n                  (progn\n                   (try\n                     (progn\n                      (set_path path_to_value nseval.global_ctx.scope\n                                value)\n                      (remove_class \"juno-needs-save\" title_span)\n                      (= is_dirty? false)\n                      (notify (+ \"Set \" title)))\n                     (catch Error (`e)\n                       (progn\n                        (log_error (+ (dtext \"Unable to save buffer\")\n                                      \" \"\n                                      title)\n                                   e)))))))\n                                                                        \n                     \n       (edit_control (make_editor (if (is_string? init_value)\n                                    init_value\n                                    \"\")                                  \n                                  {\n                                   type: mode\n                                   command_bar: command_bar\n                                   on_focus: (fn ()\n                                               (progn\n                                                (console.log \"focused editor.\")\n                                                (add_class \"juno-focused\" title_span)))\n                                   on_blur: (fn ()\n                                              (remove_class \"juno-focused\" title_span))\n                                   on_save: on_save\n                                   read_only: options.read_only\n                                   on_change: (function (editor val)\n                                                        (progn\n                                                         (when (not is_dirty?)\n                                                           (= is_dirty true)\n                                                           (add_class \"juno-needs-save\" title_span))\n                                                         (when options.on_change\n                                                           (-> options.on_change editor val))))\n                                    evaluator: options.evaluator\n                                   })))\n    (console.log \"buffer_editor: init_value: \" init_value path_to_value nseval)\n    edit_control))\n    \n\n\n\n(defun user/*initializer* ()\n  (let\n      ((header nil)       \n       (scripts (-> (page_header) `querySelectorAll \"script[id]\"))        \n       (embeds  nil)\n       (initial_split nil))\n                                                               \n    (console.log \"user/*initializer is running.\" )\n   \n    (defglobal main_menu_button (button { `class: \"pure-button\" `style: \"margin-top: -5px\" }\n                                             (span { `style: \"margin-top: -2px; font-weight: bold;\" } \"λ\")))\n\n    (defglobal resource_loader_button (file_picker_button \"\" load_files))    \n    (set_style [[\"position\" \"absolute\"]\n                [\"top\" \"-100px\"]\n                [\"left\" \"-100px\"]\n                [\"width\" \"1px\"]\n                [\"height\" \"1px\"]] resource_loader_button)\n    \n    (-> (get_by_id \"body\") `appendChild resource_loader_button)\n\n    (defglobal juno_container (get_by_id \"juno_container\"))\n    (defglobal $controls [])\n      \n    (setq header (-> document `querySelector \"header\"))\n    \n    (-> header `appendChild main_menu_button)\n    (-> header `appendChild (span { `class: \"juno-header\" } \"Seedling\" ))\n    ;(-> header `appendChild (img { `style: \"margin-left: 5px;margin-right: 10px;margin-top: 5px; \" src: core/juno_logo height: \"15\" }))\n\n    (attach_event_listener juno_container `click\n                           (fn (e)\n                             (progn\n                              (defvar menu (get_by_id `cmenu))\n                              (when menu (-> menu `remove)))))\n    \n    (set_prop *env_config*.export\n\t      `save_path\n\t      nil)\n        \n    (attach_event_listener main_menu_button\n\t\t\t      `click\n\t\t\t      (fn (e)\n\t\t\t\t(show_main_menu)))\n\n    ;; make the repl more sophisticated\n    (when (and (is_symbol? `$ace_editor)\n               repl)\n      (defglobal repl_editor (ace.edit repl.input_container)\n         {\n          `serialize_with_image: false\n          })\n      (-> repl_editor.commands `addCommand\n          {\n           `name: \"execute\"\n           `bindKey: { `win: \"Shift-Enter\" `mac: \"Shift-Enter\" }\n           `exec: (function (editor)\n                            (let\n                                ((val (-> editor `getValue)))\n                              (-> repl `evaluate val)\n                              (-> editor `setValue \"\", -1)))\n                                 \n           })\n      (-> repl_editor.session `setUseSoftTabs true)\n      (-> repl_editor.session `setMode \"ace/mode/juno\")\n            \n      (-> repl_editor `setOptions {\n                                   `enableBasicAutocompletion: true\n                                   `enableLiveAutocompletion: true\n                                   `showFoldWidgets: true\n                                   })\n      (-> repl_editor.session `setUseWorker true)\n      (-> repl_editor `setShowFoldWidgets true))\n\n    (push $controls\n          (buffer_editor \"*scratch*\" \"user\" [ `*scratch* ] `juno))\n    \n    (when (is_symbol? `repl)\n      (-> repl.view `remove)      \n      (setq initial_split\n            (split_view_vertical $controls.0\n                                 repl))\n      (-> (get_by_id \"body\") `appendChild initial_split.view)    \n      (-> initial_split `initialize))\n  (notify (+ \"Hello \" *namespace* ))\n  true))\n\n\n\n\n\n" })();__obj__1["browser_repl_package"]=await (async function(){ return ";; Browser Based Workspace\n;; Sets up the basic environment\n;; Initialize a simple REPL from which to start working\n\n\n\n(declare (namespace core))\n(console.log \"browser_workspace: running\")\n\n\n(defun core/*initializer* ()\n  (let\n      ((scripts (-> (page_header) `querySelectorAll \"script[id]\")))\n    (console.log \"core/*initializer* running: \" *namespace*)\n    (if (> scripts.length 0)\n      (map (fn (idx)\n             (when (not (== (-> (prop scripts idx) `getAttribute `id) \"juno-core\"))\n               (eval `(defglobal ,#(+ \"$\" (-> (prop scripts idx) `getAttribute `id)) ,#(prop scripts idx)))))\n           (range scripts.length)))))\n\n\n(defun line_reader (options)\n  (let\n      ((entry_area (html/textarea { `style: \"font-family: monospace;  height: calc(100% - 20px); width: calc(100% - 10px);\" } ))\n       (result nil)\n       (output_container options.output_container)\n       (handle_text_input_events (fn (e)\n                                   (let\n                                       ((lisp_source nil))\n                                   \n                                     (= lisp_source (prop entry_area `value))\n                                     (when (and (== e.key \"Enter\")\n                                                e.shiftKey)\n                                         (html/handle_event e)\n                                       (console.log \"lisp_source: -> \" lisp_source)\n                                       (options.evaluator lisp_source)\n                                       (setTimeout (fn () (set_prop entry_area `value \"\")) 200)\n                                       )))))\n    (html/attach_event_listener entry_area\n                           `keydown\n                           handle_text_input_events)\n    entry_area))\n\n\n\n(defun browser_repl ()\n  (let\n      ((body_element (-> document `querySelector \"body\"))\n       (output_container (html/div { `id: \"output-container\"  `style: \"font-size: 0.9em; height: 80%; overflow: scroll; display: flex; flex-direction: column-reverse; width: 100%; vertical-align:bottom; \" } ))\n       (resize_observer nil)                                                      \n                                        ;(result nil)\n       (current_env Environment)\n       (error_state nil)\n       (initialized false)\n       (evaluator (fn (lisp_text no_eval)\n                    (let\n                        ((result nil))\n                      (setq error_state nil)\n                      (setq current_env (-> Environment `get_namespace_handle (current_namespace)))                      \n                      (try\n                        (= result (if no_eval\n                                    lisp_text\n                                    (-> current_env `evaluate lisp_text)))\n                        (catch Error (ex)\n                          (do\n                            (= error_state true)\n                            (= result ex))))\n                      (console.log \"<-\" result)\n                      (when (not no_eval)                        \n                        (-> output_container\n                            `prepend\n                            (html/div { style:\"border-top: 1px solid #C0C0C0; padding: 5px; margin-top: 1px; background: #F8F6F6; width: calc(100% - 10px); display: inline-block; \" }\n                                      (html/code { `style: \"font-style: italic; color: darkblue;\" }\n                                                 lisp_text))))\n                      (-> output_container\n                          `prepend\n                          (html/div { `style: \"padding: 5px; margin-top: 0px; background: #F8F6F6; width: calc(100% - 10px); display: inline-block; \" }\n                                    (cond\n                                      (is_element? result)\n                                      result\n                                      (is_number? result)\n                                      (html/code { `style: \" color: green;\" }\n                                                 result)\n                                      (or (== true result)\n                                          (== false result))\n                                      (html/code { `style: \" color: orange;\" }\n                                                 result)\n                                      (is_function? result)\n                                      (html/code { `style: \" color: darkblue;\" } \"Function: \"\n                                                 (if result.name result.name \"anonymous\"))\n                                      \n                                      (and (is_array? result)\n                                           (instanceof result.0 Error))\n                                      (html/pre { `style: \" color: darkred;\" } \"ERROR: \"\n                                                (subtype result.0)\n                                                \"\\n\"\n                                                result.0.message)\n                                      (or error_state\n                                          (instanceof result Error))\n                                      (html/pre { `style: \" color: darkred;\" } \"ERROR: \"\n                                                (subtype result)\n                                                \"\\n\"\n                                                result.message)\n                                      (and (is_array? result)\n                                           result.0.error)\n                                      (html/pre { `style: \" color: darkred;\" }                                                 \n                                                (JSON.stringify result nil 3 ))\n                                           \n                                      else\n                                      (html/pre { `style: \"\" } (JSON.stringify result nil 3 )))))\n                      (set_prop output_container\n                                `scrollTop\n                                output_container.offsetHeight)\n                      result)))\n       (reader (line_reader { `output_container: output_container `evaluator: evaluator}))\n       (input_container (html/div { `id: \"input-container\" `style: \"height: calc(20% - 15px); overflow: hidden; \" }\n                                  reader))\n       (juno_container (html/div { `id: \"juno_container\" `style: \"height: inherit; max-height: 100%; overflow: hidden;\" }\n                                 output_container\n                                 input_container))\n       (perform_resize (fn ()\n                         (progn\n                          ;(console.log \"repl: resize: \" (prop juno_container.parentElement `offsetWidth))\n                          (html/set_style [[\"width\" (+ \"\" (- (prop juno_container.parentElement `offsetWidth) 2) \"px\")]] juno_container)\n                          )))\n       (initialize (fn ()\n                     (progn\n                      (if initialized\n                        (evaluator (html/div { `style: \"display: flex padding: 5px\" } \"WARNING: REPL already initialized\") true)\n                        (progn\n                         (= initialized true)\n                         (= resize_observer (new ResizeObserver perform_resize))\n                         (-> resize_observer `observe juno_container.parentElement)\n                         (evaluator (html/div { `style: \"display: flex padding: 5px\" }                \n                                              (html/span { `style: \"font-weight: bold; display: inline-block;\" } \"Browser REPL\")\n                                              (html/span { `style: \"display: inline-block; margin-left: 10px;\" }\n                                                         \"Version: \" Environment.build_version   )) true)\n                         (evaluator (html/div \"Namespace: \" (current_namespace)) true)))))))\n    \n    \n    \n    {\n     `view: juno_container\n     `input_container: input_container\n     `initialize: initialize\n     `output_container: output_container\n     `log: (fn (val)\n             (evaluator val true))\n     `evaluate: (fn (lisp_text)\n                  (evaluator lisp_text))\n     }))\n     \n;(html/set_style [[ \"font-family\" \"-apple-system,BlinkMacSystemFont,'Segoe UI','Helvetica Neue',Helvetica,sans-serif;\"]]\n ;               (-> document `querySelector \"body\"))\n\n\n\n;; ez page header access\n\n(defun core/page_header ()\n  (first (html/query_all \"head\")))\n\n(defglobal core/*env_skeleton* (reader (atob (clone *env_template*))))\n\n(defun core/read_text_file (file)\n  (console.log \"reading text file stub called\"))\n\n(defun core/save_image (options)\n   (let\n       ((js_resource (save_env { `want_buffer: true\n                                `do_not_include: (conj  [ `browser_repl `line_reader  ])}))\n        (scripts (-> (page_header) `querySelectorAll \"script[id]\"))        \n        (additional_embeds (let\n                               ((acc [])\n                                (deduper (new Set)))\n                             (map (fn (idx)\n                                    (when (and (not (== (-> (prop scripts idx) `getAttribute `id) \"juno-core\"))\n                                               (not (-> deduper `has (-> (prop scripts idx) `getAttribute `id))))\n                                      (-> deduper `add (-> (prop scripts idx) `getAttribute `id))\n                                      (push acc (prop scripts idx))))\n                                  (range scripts.length))\n                             acc))\n        ;;(boot_up core/browser_boot_code)\n        (dcomps (date_components (new Date)))\n        (file_version_tag (if (not (blank? options.version_tag))\n                              options.version_tag\n                              (join \".\" [ dcomps.year dcomps.month dcomps.day dcomps.hour dcomps.minute ])))\n        (scaffold_1 (prop\n                     (html/head { `title: \"Seedling\" }\n                                (html/meta { `charset: \"utf-8\" })\n                                (html/style { `id: \"juno-css\" } \"\")\n                                (html/script { `id: \"juno-core\" `type: \"module\" }\n                                             js_resource\n                                             \"\\n\\n\"                               \n                                             ;; boot_up\n                                             \"\\n\\n\"\n                                             )\n                                (for_each (scr (or additional_embeds []))                                       \n                                     scr))\n                                        \n                          `outerHTML))\n        (scaffold_2 (prop\n                          \n                          (html/body { style: \"height: 98vh; overflow: hidden;\" `id: \"body\" }\n                                     (html/header {  `id: \"page-header\" style: \"height: 28px; display: flex;\" } )\n                                     (html/div { `id: \"lower_right_corner\" style: \"position: absolute; right: 50px; bottom: 5px; width: 255px;\" } )\n                                     )\n                          `outerHTML)))               \n     (setTimeout (fn ()\n                   (do\n                     (save_locally (or options.save_as\n                                      (+ \"juno_image-\" file_version_tag \".html\"))\n                                   (+ \"<!DOCTYPE html><html>\\n\"\n                                      scaffold_1\n                                      scaffold_2\n                                      \"</html>\")\n                                   \"text/html\" )\n                     ;(-> (first (html/query_all \"body\"))\n                                        ;`prepend storage)\n                     ))\n                 100)\n   true))\n\n(defglobal `repl (core/browser_repl))\n(defun rlog (val)\n  (progn\n   (console.log \"rlog:\" val)\n   (-> repl `log val)))\n\n(-> (-> document `querySelector \"body\")\n    `appendChild (prop repl\n                       `view))\n\n\n\n(setTimeout (fn ()\n              (rlog (if (prop globalThis `in_starter)\n                      (progn\n                       (-> repl `initialize)\n                       (html/div \"In starter mode\"))\n                      (html/div \"Ready\"))))\n            10)\n      \n\n\n\n(setTimeout (fn ()\n              (progn\n               (when (prop globalThis `in_starter)\n                 (rlog (html/div \"Bootstrapping new image..\"))                 \n                 (-> repl `evaluate |\n                     (use_unique_symbols \"html\")\n                     (evaluate browser_initializer)\n                     | )\n                 (-> repl `evaluate | (save_image) | )\n                 (rlog (html/div \"Complete..Open the newly created html file to use.\")))))\n            100)\n            \n\n\n                                    \n                                    \n           \n                                    \n" })();__obj__1["load"]=async function(filename) {
        let fname;
        let js_mod;
        let comps;
        fname=filename;
        js_mod=null;
        comps=await (await Environment.get_global("path.parse"))(fname);
        return await async function(){
            if (check_true (((comps && comps["ext"])===".lisp"))) {
                return await (await Environment.get_global("evaluate"))(await (async function(){
                     return await (await Environment.get_global("read_text_file"))(fname) 
                })(),null,{
                    source_name:fname
                })
            } else if (check_true (((comps && comps["ext"])===".js"))) {
                {
                    js_mod=await import (fname);
                    if (check_true ((js_mod && js_mod["initializer"]))){
                        return await (async function(){
                            let __array_op_rval__2=(js_mod && js_mod["initializer"]);
                             if (__array_op_rval__2 instanceof Function){
                                return await __array_op_rval__2(Environment) 
                            } else {
                                return [__array_op_rval__2,Environment]
                            }
                        })()
                    } else {
                        throw new EvalError("load: unable to find function named initializer in export, use dynamic_import for this.");
                        
                    }
                }
            } else if (check_true (((comps && comps["ext"])===".json"))) {
                return await (await Environment.get_global("evaluate"))(await JSON.parse(await (async function(){
                     return await (await Environment.get_global("read_text_file"))(fname) 
                })()),null,{
                    json_in:true
                })
            }
        } ()
    };__obj__1["with_fs_events"]=async function(...args) {
    let event_binding;
    let location;
    let body;
    event_binding=(args && args["0"] && args["0"]["0"]);
    location=(args && args["0"] && args["0"]["1"]);
    body=(args && args["1"]);
    return ["=:let",[["=:watcher",["=:->","=:Deno","watchFs",location]]],["=:declare",["=:object","=:watcher"]],["=:for_with",[event_binding,"=:watcher"],["=:progn",body]]]
};__obj__1["compile_buffer"]=async function(input_buffer,export_function_name,options) {
    let output_filename;
    let opts;
    let segments;
    let export_segment;
    let include_boilerplate;
    let start_time;
    let compile_time;
    let write_file;
    let import_headers;
    let include_source;
    let compiled;
    let invalid_js_ref_chars;
    let invalid_js_ref_chars_regex;
    let boilerplate;
    let compiled_js;
    output_filename=(options && options["output_file"]);
    opts=await (await Environment.get_global("add"))(new Object(),(options|| new Object()),{
        want_buffer:await (async function(){
            if (check_true (((options && options["want_buffer"])|| (null==output_filename)))){
                return true
            } else {
                return false
            }
        })()
    });
    export_function_name=(export_function_name|| "initializer");
    segments=[];
    export_segment=[];
    include_boilerplate=await (async function(){
        if (check_true ((false===(opts && opts["include_boilerplate"])))){
            return false
        } else {
            return true
        }
    })();
    start_time=await Date.now();
    compile_time=null;
    write_file=true;
    import_headers=await (async function(){
        if (check_true (((options && options["imports"]) instanceof Object))){
            return await (await Environment.get_global("map"))(async function(import_set,idx) {
                let target;
                let imp_details;
                target=(import_set && import_set["1"] && import_set["1"]["symbol"]);
                imp_details=(import_set && import_set["1"] && import_set["1"]["location"]);
                return await (async function(){
                    let __array_op_rval__1=("import * as "+ (target+ "_module")+ " from '"+ imp_details+ "'\n"+ "export const "+ target+ "="+ (target+ "_module")+ ";");
                     if (__array_op_rval__1 instanceof Function){
                        return await __array_op_rval__1() 
                    } else {
                        return [__array_op_rval__1]
                    }
                })()
            },await (await Environment.get_global("pairs"))((options && options["imports"])))
        } else {
            return []
        }
    })();
    include_source=await (async function(){
        if (check_true ((opts && opts["include_source"]))){
            return true
        } else {
            return false
        }
    })();
    compiled=null;
    invalid_js_ref_chars="+?-%&^#!*[]~{}|";
    invalid_js_ref_chars_regex=new RegExp("[\%\+\[\>\?\<\\}\{&\#\^\=\~\*\!\)\(\-]+");
    boilerplate="var { get_next_environment_id, check_true, get_outside_global, subtype, lisp_writer, clone, LispSyntaxError } = await import(\"./lisp_writer.js\");";
    compiled_js=null;
    if (check_true ((await (await Environment.get_global("length"))(await (async function(){
         return await (await Environment.get_global("scan_str"))(invalid_js_ref_chars_regex,export_function_name) 
    })())>0))){
        {
            throw new SyntaxError(("export function name contains an invalid JS character: "+ export_function_name+ ", cannot contain: "+ invalid_js_ref_chars));
            
        }
    };
    (segments).push(("// Source: "+ (options && options["input_filename"])+ "  "));
    if (check_true (((import_headers && import_headers.length)>0))){
        {
            await (async function() {
                let __for_body__4=async function(static_import) {
                    return (segments).push(static_import)
                };
                let __array__5=[],__elements__3=import_headers;
                let __BREAK__FLAG__=false;
                for(let __iter__2 in __elements__3) {
                    __array__5.push(await __for_body__4(__elements__3[__iter__2]));
                    if(__BREAK__FLAG__) {
                         __array__5.pop();
                        break;
                        
                    }
                }return __array__5;
                 
            })();
            (segments).push("\n")
        }
    };
    if (check_true (((opts && opts["build_headers"]) instanceof Array))){
        {
            await (async function() {
                let __for_body__8=async function(header) {
                    return (segments).push(header)
                };
                let __array__9=[],__elements__7=(opts && opts["build_headers"]);
                let __BREAK__FLAG__=false;
                for(let __iter__6 in __elements__7) {
                    __array__9.push(await __for_body__8(__elements__7[__iter__6]));
                    if(__BREAK__FLAG__) {
                         __array__9.pop();
                        break;
                        
                    }
                }return __array__9;
                 
            })();
            (segments).push("\n")
        }
    };
    (segments).push("\n");
    if (check_true (include_boilerplate)){
        (segments).push(boilerplate)
    };
    if (check_true (((opts && opts["js_headers"]) instanceof Array))){
        {
            await (async function() {
                let __for_body__12=async function(header) {
                    return (segments).push(header)
                };
                let __array__13=[],__elements__11=(opts && opts["js_headers"]);
                let __BREAK__FLAG__=false;
                for(let __iter__10 in __elements__11) {
                    __array__13.push(await __for_body__12(__elements__11[__iter__10]));
                    if(__BREAK__FLAG__) {
                         __array__13.pop();
                        break;
                        
                    }
                }return __array__13;
                 
            })();
            (segments).push("\n")
        }
    };
    if (check_true (((export_function_name==="init_dlisp")|| (opts && opts["toplevel"])))){
        {
            (segments).push("if (typeof AsyncFunction === \"undefined\") {\n  globalThis.AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;\n}")
        }
    };
    if (check_true (((input_buffer instanceof Array)&& ((input_buffer && input_buffer["0"])==="=:iprogn")))){
        await async function(){
            input_buffer[0]=await (async function(){
                 return "=:progn" 
            })();
            return input_buffer;
            
        }()
    };
    if (check_true ((opts && opts["verbose"]))){
        {
            await console.log("input_buffer: ",input_buffer)
        }
    };
    compiled=await (async function(){
         return await (await Environment.get_global("compiler"))(input_buffer,await (await Environment.get_global("add"))({
            env:Environment,formatted_output:true,include_source:include_source,source_name:((opts && opts["input_filename"])|| "anonymous")
        },opts)) 
    })();
    compile_time=await (await Environment.get_global("add"))(await (async function() {
        {
             let __call_target__=((await Date.now()- start_time)/ 1000), __call_method__="toFixed";
            return await __call_target__[__call_method__].call(__call_target__,3)
        } 
    })(),"s");
    await async function(){
        if (check_true ((compiled && compiled["error"]))) {
            throw new Error((await Environment.get_global("indirect_new"))(compiled.error,(compiled && compiled["message"])));
            
        } else if (check_true (((compiled && compiled["0"] && compiled["0"]["ctype"])&& ((compiled && compiled["0"] && compiled["0"]["ctype"])==="FAIL")))) {
            {
                write_file=false;
                await (await Environment.get_global("warn"))((compiled && compiled["1"]))
            }
        } else if (check_true (((compiled && compiled["0"] && compiled["0"]["ctype"])&& (await (await Environment.get_global("contains?"))("block",(compiled && compiled["0"] && compiled["0"]["ctype"]))|| ((compiled && compiled["0"] && compiled["0"]["ctype"])==="assignment")|| ((compiled && compiled["0"] && compiled["0"]["ctype"])==="__!NOT_FOUND!__"))))) {
            if (check_true (await (async function(){
                let __array_op_rval__15=(compiled && compiled["0"] && compiled["0"]["has_lisp_globals"]);
                 if (__array_op_rval__15 instanceof Function){
                    return await __array_op_rval__15() 
                } else {
                    return [__array_op_rval__15]
                }
            })())){
                {
                    (segments).push(("export async function "+ export_function_name+ "(Environment)  {"));
                    (segments).push((compiled && compiled["1"]));
                    (segments).push("}")
                }
            } else {
                {
                    (segments).push(("export async function "+ export_function_name+ "() {"));
                    (segments).push((compiled && compiled["1"]));
                    (segments).push("}")
                }
            }
        } else if (check_true (((compiled && compiled["0"] && compiled["0"]["ctype"])&& (("AsyncFunction"===(compiled && compiled["0"] && compiled["0"]["ctype"]))|| ("statement"===(compiled && compiled["0"] && compiled["0"]["ctype"]))|| ("objliteral"===(compiled && compiled["0"] && compiled["0"]["ctype"])))))) {
            {
                if (check_true (await (async function(){
                    let __array_op_rval__16=(compiled && compiled["0"] && compiled["0"]["has_lisp_globals"]);
                     if (__array_op_rval__16 instanceof Function){
                        return await __array_op_rval__16() 
                    } else {
                        return [__array_op_rval__16]
                    }
                })())){
                    {
                        (segments).push(("export async function "+ export_function_name+ "(Environment) {"));
                        (segments).push(("  return "+ (compiled && compiled["1"])+ "} "))
                    }
                } else {
                    {
                        (segments).push(("export async function "+ export_function_name+ "() {"));
                        (segments).push(("  return "+ (compiled && compiled["1"])+ "} "))
                    }
                }
            }
        } else if (check_true (((compiled && compiled["0"] && compiled["0"]["ctype"])&& ("Function"===(compiled && compiled["0"] && compiled["0"]["ctype"]))))) {
            {
                if (check_true (await (async function(){
                    let __array_op_rval__17=(compiled && compiled["0"] && compiled["0"]["has_lisp_globals"]);
                     if (__array_op_rval__17 instanceof Function){
                        return await __array_op_rval__17() 
                    } else {
                        return [__array_op_rval__17]
                    }
                })())){
                    {
                        (segments).push(("export function "+ export_function_name+ "(Environment) {"));
                        (segments).push(("  return "+ (compiled && compiled["1"])+ "}"))
                    }
                } else {
                    {
                        (segments).push(("export function "+ export_function_name+ "() {"));
                        (segments).push(("  return "+ (compiled && compiled["1"])+ " } "))
                    }
                }
            }
        } else {
            {
                await console.log("warning: unhandled return: ",compiled);
                write_file=false
            }
        }
    } ();
    if (check_true ((opts && opts["bundle"]))){
        {
            (segments).push(("await init_dlisp();"));
            (segments).push(("let env = await dlisp_env("+ await (async function(){
                if (check_true ((opts && opts["bundle_options"]))){
                    return await JSON.stringify((opts && opts["bundle_options"]))
                } else {
                    return ""
                }
            })()+ ");"))
        }
    };
    if (check_true (((opts && opts["exports"]) instanceof Array))){
        {
            (export_segment).push("export { ");
            await (await Environment.get_global("map"))(async function(exp,i,len) {
                await async function(){
                    if (check_true (((exp instanceof Array)&& ((exp && exp.length)===2)))) {
                        {
                            (export_segment).push((exp && exp["0"]));
                            (export_segment).push(" as ");
                            return (export_segment).push((exp && exp["1"]))
                        }
                    } else if (check_true ((exp instanceof String || typeof exp==='string'))) {
                        (export_segment).push(exp)
                    } else {
                        throw new SyntaxError(("Invalid export format: "+ exp));
                        
                    }
                } ();
                if (check_true ((i<(len- 1)))){
                    {
                        return (export_segment).push(",")
                    }
                }
            },(opts && opts["exports"]));
            (segments).push((export_segment).join(""))
        }
    };
    return await async function(){
        if (check_true ((write_file&& await (await Environment.get_global("not"))((opts && opts["want_buffer"]))))) {
            {
                await (await Environment.get_global("write_text_file"))(output_filename,(segments).join("\n"));
                await (await Environment.get_global("success"))(("["+ compile_time+ "] compiled: "),((opts && opts["input_filename"])|| (opts && opts["namespace"])|| "anonymous"),"->",output_filename);
                return output_filename
            }
        } else if (check_true ((write_file&& (opts && opts["want_buffer"])))) {
            return (segments).join("\n")
        } else {
            {
                await (await Environment.get_global("warn"))("cannot compile: ",((opts && opts["input_filename"])|| (opts && opts["namespace"])|| "anonymous"));
                return null
            }
        }
    } ()
};__obj__1["compile_file"]=async function(lisp_file,export_function_name,options) {
    let input_components;
    let input_filename;
    let input_buffer;
    input_components=await (await Environment.get_global("path.parse"))(lisp_file);
    input_filename=await (await Environment.get_global("path.basename"))(lisp_file);
    input_buffer=null;
    input_buffer=await (async function(){
         return await (await Environment.get_global("read_text_file"))(lisp_file) 
    })();
    if (check_true (((input_components && input_components["ext"])===".lisp"))){
        input_buffer=await (async function(){
             return await (await Environment.get_global("read_lisp"))(input_buffer,{
                implicit_progn:false,source_name:input_filename
            }) 
        })()
    };
    return await (await Environment.get_global("compile_buffer"))(input_buffer,export_function_name,await (await Environment.get_global("add"))(new Object(),{
        input_filename:input_filename
    },await (async function(){
        if (check_true (options)){
            return options
        } else {
            return new Object()
        }
    })()))
};__obj__1["rebuild_env"]=async function(opts) {
    let issues;
    let source_dir;
    let output_dir;
    let dcomps;
    let version_tag;
    let build_time;
    let build_headers;
    let include_source;
    let source_path;
    let output_path;
    issues=[];
    source_dir=((opts && opts["source_dir"])|| "./src");
    output_dir=((opts && opts["output_dir"])|| "./js");
    dcomps=await (async function(){
         return await (await Environment.get_global("date_components"))(new Date()) 
    })();
    version_tag=await (async function(){
        if (check_true (await (await Environment.get_global("not"))(await (await Environment.get_global("blank?"))((opts && opts["version_tag"]))))){
            return (opts && opts["version_tag"])
        } else {
            return (await (async function(){
                let __array_op_rval__18=(dcomps && dcomps["year"]);
                 if (__array_op_rval__18 instanceof Function){
                    return await __array_op_rval__18((dcomps && dcomps["month"]),(dcomps && dcomps["day"]),(dcomps && dcomps["hour"]),(dcomps && dcomps["minute"])) 
                } else {
                    return [__array_op_rval__18,(dcomps && dcomps["month"]),(dcomps && dcomps["day"]),(dcomps && dcomps["hour"]),(dcomps && dcomps["minute"])]
                }
            })()).join(".")
        }
    })();
    build_time=await (async function(){
         return await (await Environment.get_global("formatted_date"))(new Date()) 
    })();
    build_headers=[];
    include_source=((opts && opts["include_source"])|| false);
    source_path=async function(filename) {
        return (await (async function(){
            let __array_op_rval__19=source_dir;
             if (__array_op_rval__19 instanceof Function){
                return await __array_op_rval__19(filename) 
            } else {
                return [__array_op_rval__19,filename]
            }
        })()).join((await Environment.get_global("path.sep")))
    };
    output_path=async function(filename) {
        return (await (async function(){
            let __array_op_rval__20=output_dir;
             if (__array_op_rval__20 instanceof Function){
                return await __array_op_rval__20(filename) 
            } else {
                return [__array_op_rval__20,filename]
            }
        })()).join((await Environment.get_global("path.sep")))
    };
    await console.log("Environment Build Time: ",build_time);
    await console.log("Version Tag: ",version_tag);
    await console.log("Source Directory: ",source_dir);
    await console.log("Output Directory: ",output_dir);
    (build_headers).push(("// Build Time: "+ build_time));
    (build_headers).push(("// Version: "+ version_tag));
    (build_headers).push(("export const DLISP_ENV_VERSION='"+ version_tag+ "';"));
    await (await Environment.get_global("load"))(await source_path("reader.lisp"));
    await (await Environment.get_global("success"))("reloaded reader");
    await (await Environment.get_global("compile_file"))(await source_path("compiler.lisp"),"init_compiler",{
        output_file:await output_path("compiler.js"),include_source:include_source,build_headers:build_headers
    });
    await (await Environment.get_global("compile_file"))(await source_path("reader.lisp"),null,{
        output_file:await output_path("reader.js"),include_source:include_source,build_headers:build_headers
    });
    await (await Environment.get_global("compile_file"))(await source_path("environment.lisp"),"init_dlisp",{
        output_file:await output_path("environment.js"),include_source:include_source,toplevel:true,build_headers:build_headers
    });
    await (await Environment.get_global("compile_file"))(await source_path("core.lisp"),"environment_boot",{
        output_file:await output_path("core.js"),include_source:include_source,build_headers:build_headers
    });
    await (await Environment.get_global("compile_file"))(await source_path("core-ext.lisp"),"load_core",{
        output_file:await output_path("core-ext.js"),include_source:include_source,build_headers:build_headers
    });
    await (await Environment.get_global("compile_file"))(await source_path("base-io.lisp"),null,{
        output_file:await output_path("base-io.js"),include_source:include_source,build_headers:build_headers
    });
    await (await Environment.get_global("success"))("complete");
    return true
};__obj__1["*system_initializer*"]=async function() {
    let pkg;
    pkg=await Environment["evaluate"].call(Environment,"core/html_package");
    await Environment["evaluate"].call(Environment,pkg);
    await console.log("initializing browser_repl_package");
    (await Environment.eval(await async function(){
        return await (await Environment.get_global("reader"))(await (async function(){
             return await clone((await Environment.get_global("browser_repl_package"))) 
        })())
    }()));
    await async function(){
        globalThis["env"]=Environment;
        return globalThis;
        
    }();
    return await console.log("system initializer Complete")
};__obj__1["*env_template*"]="OzsgRW52aXJvbm1lbnQgLS0gRmFjaWxpdGF0ZXMgYW5kIG9yZ2FuaXplcyB0aGUgbGlzcCB0b3AgbGV2ZWwgYW5kIHJlc291cmNlcwo7OyBBdXRob3I6IEFsZXggTnlncmVuCgo7OyBDb3B5cmlnaHQgKGMpIDIwMjIsIEtpbmEsIExMQwoKOzsgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQo7OyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAo7OyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCjs7IHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKOzsgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCjs7IGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Cgo7OyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKOzsgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCjs7IFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCjs7IElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAo7OyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKOzsgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgo7OyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAo7OyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQo7OyBTT0ZUV0FSRS4KCjs7ID09PT09PQoKOzsgVGhlICJ3b3JsZCIgdGhhdCBpcyB0aGUgc2NvcGUgb2YgdGhlIGNvbXBpbGVyIGFuZCB0aGUgY29tcGlsZWQgY29kZS4KOzsgRmFjaWxpYXRlcyBkeW5hbWljIHNjb3BlLCBsaXNwIGdsb2JhbHMsIGRlZmluaXRpb25zIGFuZCBvdGhlciBwcm9wZXJ0aWVzLgo7OyBJdCBpcyB0aGUgaW50ZXJmYWNlIHRoZSB0b3AgbGV2ZWwgZnVuY3Rpb24gY2FsbHMgaW50byBhcyB0aGUgY29tcGlsZXIKOzsgaXMgYWNjZXNzZWQgdmlhIGFuIGVudmlyb25tZW50IG9iamVjdC4gIAoKOzsgVXNlIGV2YWx1YXRlKGxpc3BfdGV4dCkgdG8gY29tcGlsZSBhbmQgZXZhbHVhdGUgbGlzcCB0ZXh0IGFuZCBmb3JtcyBmcm9tCjs7IGphdmFzY3JpcHQuCgo7OyBPcHRpb25zIGFyZSBhcyBmb2xsb3dzOgo7OyBwYXJlbnRfZW52aXJvbm1lbnQgLSBpZiB0aGlzIGluc3RhbmNlIGlzIHRvIGJlIGEgbmFtZXNwYWNlIG90aGVyIHRoYW4gImNvcmUiCjs7ICAgICAgICAgICAgICAgICAgICAgIHRoaXMgc2hvdWxkIGJlIHNldCB3aXRoIHRoZSBjYWxsaW5nIGVudmlyb25tZW50IG9iamVjdC4KCjs7IG5hbWVzcGFjZSAtIGlmIGdpdmVuIGEgcGFyZW50X2Vudmlyb25tZW50IHdlIG5lZWQgdG8gaGF2ZSBhbiBhZGRyZXNzYWJsZQo7OyAgICAgICAgICAgICBuYW1lLiAgVGhpcyBtdXN0IGJlIHNldCBpZiB1c2luZyB0aGUgcGFyZW50X2Vudmlyb25tZW50IG9wdGlvbi4KCjs7IGVudiAtIGlmIGdpdmVuIGFuIGVudmlyb25tZW50IG9iamVjdCB1c2luZyB0aGUgZW52IGtleSwgdGhlIHJldHVybmVkCjs7ICAgICAgIGVudmlyb25tZW50IGluc3RhbmNlIHdpbGwgaGF2ZSBiZSBhIGNsb25lIG9mIHRoZSBwcm92aWRlZCBlbnZpcm9ubWVudC4KOzsgICAgICAgVGhpcyBpcyB1c2VkIHdoZW4gZXhwb3J0aW5nIGFuIGVudmlyb25tZW50IGltYWdlLgoKOzsgaW5saW5lcyAtIG9iamVjdCB0aGF0IGNvbnRhaW5zIG9wZXJhdG9yIGtleXMgYW5kIGZ1bmN0aW9uIHZhbHVlcyB0aGF0Cjs7ICAgICAgICAgICByZXR1cm4gYXJyYXlzOiAoZm4gKGFyZ3MpIFtgamF2YXNjcmlwdCBgdG9rZW5zIF0uLiBzZWUgaW5saW5lcwo7OyAgICAgICAgICAgYmVsb3cgZm9yIHRoZSBzcGVjaWZpY3MuCgo7OyBsb2dfZXJyb3JzIC0gYm9vbGVhbiAoZGVmYXVsdCBmYWxzZSkgaWYgdHJ1ZSwgdGhlIGVudmlyb25tZW50IGl0c2VsZgo7OyAgICAgICAgICAgd2lsbCBsb2cgYW55IGVycm9ycyB0byB0aGUgY29uc29sZSwgb3RoZXJ3aXNlIGl0IHdpbGwgZWl0aGVyCjs7ICAgICAgICAgICByZS10aHJvdyB0aGUgZXJyb3Igb3IgcmV0dXJuIGl0IGRlcGVuZGluZyBvbiBjYXRjaF9lcnJvcnMuCgo7OyBjYXRjaF9lcnJvcnMgLSBib29sZWFuIChkZWZhdWx0IGlzIGZhbHNlKSAtIGlmIHRydWUsIGVycm9ycyB3aWxsIGJlCjs7ICAgICAgICAgICBjYXVnaHQgYW5kIHJldHVybmVkLCBhbmQgbm90IHRocm93biwgb3RoZXJ3aXNlIHRoZSBlcnJvcgo7OyAgICAgICAgICAgd2lsbCBiZSByZS10aHJvd24uCgo7OyBXZSBuZWVkIHNvbWUgZ2xvYmFsIHR5cGVzIHNpbmNlIEphdmFzY3JpcHQgZXZhbCgpIGlzbid0IHVzZWQgaW4gSnVubwoKKHNldF9wcm9wIGdsb2JhbFRoaXMKICAgICAgICAgIGBzdWJ0eXBlIHN1YnR5cGUKICAgICAgICAgIGBjaGVja190cnVlIGNoZWNrX3RydWUKICAgICAgICAgIGBjbG9uZSBjbG9uZQogICAgICAgICAgYGxpc3Bfd3JpdGVyIGxpc3Bfd3JpdGVyCiAgICAgICAgICBgTGlzcFN5bnRheEVycm9yIExpc3BTeW50YXhFcnJvcikKCihpZiAoPT0gInVuZGVmaW5lZCIgKHR5cGVvZiBkbGlzcF9lbnZpcm9ubWVudF9jb3VudCkpCiAgKHNldF9wcm9wIGdsb2JhbFRoaXMKICAgICAgICAgICAgYGRsaXNwX2Vudmlyb25tZW50X2NvdW50CiAgICAgICAgICAgIDApKQoKCjs7IFdlIGNhbid0IGltbWVkaWF0ZWx5IGRlZmluZSBhIG1hY3JvIGZvciB0aGUgYmVsb3cgYmVjYXVzZSB3ZSBkb24ndCBoYXZlCjs7IGFuIGVudmlyb25tZW50IHlldCB0byBwbGFjZSBpdC4gIFNvIHdoZW4gd2Ugd2FudCB0byBzYXZlIHRoZSBjdXJyZW50Cjs7IGVudmlyb25tZW50LCB3ZSB3aWxsIHNwbGljZSBkaXJlY3RseSBpbnRvIHRoZSBKU09OIHJlcHJlc2VudGF0aW9uCjs7IG9mIHRoaXMgZmlsZS4KOzsgZGVmZXh0ZXJuYWwgcGxhY2VzIHRoZSBzeW1ib2wgYW5kIHRoZSBhc3NvY2lhdGVkIHZhbHVlIG9uIG9uIGdsb2JhbFRoaXMsCjs7IGluc3RlYWQgb2YgaW5zaWRlIHRoZSBlbnZpcm9ubWVudCAod2hpY2ggZG9lc24ndCBleGlzdCBhdCB0aGlzIHBvaW50KS4KCihkZWZleHRlcm5hbCBkbGlzcF9lbnYKICAoZm4gKG9wdHMpCiAgICAocHJvZ24KICAgICA7KGNvbnNvbGUubG9nICJkbGlzcF9lbnY6IGluaXRpYWxpemluZzogIiAoY2xvbmUgb3B0cykpCiAgICAgOzsgU3RhdGUgdG8gdGhlIGNvbXBpbGVyIHRoYXQgd2UgZG8gbm90IHdhbnQgdG8gYmUgcGFzc2VkIGFuIEVudmlyb25tZW50CiAgICAgOzsgYnkgZGVjbGFyaW5nIHRoYXQgdGhpcyBpcyB0b3BsZXZlbC4KICAgICAKICAgICAoZGVjbGFyZSAodG9wbGV2ZWwgdHJ1ZSkKICAgICAgICAgICAgICAoaW5jbHVkZSBzdWJ0eXBlIGdldF9vYmplY3RfcGF0aCBnZXRfb3V0c2lkZV9nbG9iYWwpCiAgICAgICAgICAgICAgKGxvY2FsIGNsb25lIGdldF9uZXh0X2Vudmlyb25tZW50X2lkIGNoZWNrX3RydWUpKQoKICAgICA7OyBOT1RJQ0U6CiAgICAgOzsgV2UgZG8gbm90IGhhdmUgYWNjZXNzIHRvIHRoZSBFbnZpcm9ubWVudCB0aGluZ3MgYXQgdGhpcyBwb2ludCwgc28gd2UgYXJlCiAgICAgOzsgdmVyeSBsaW1pdGVkIHVudGlsIGFmdGVyIChkZWZpbmVfZW52KS4uLgogICAgIDs7IC0tLS0tLSBTdGFydCBMaW1pdGVkIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKD0gb3B0cwogICAgICAgKGlmICg9PSBvcHRzIHVuZGVmaW5lZCkKICAgICAgICAge30KICAgICAgICAgb3B0cykpCiAgICAgICAgICAKICAgICA7OyBDb25zdHJ1Y3QgdGhlIGVudmlyb25tZW50CiAgICAgOzsgQXJlIHdlIHRoZSBjb3JlLCBvciBhcmUgd2UgYSBuYW1lc3BhY2Ugb2ZmIG9mIHRoZSBjb3JlPwogICAgIAogICAgIChkZWZ2YXIgbmFtZXNwYWNlIChvciBvcHRzLm5hbWVzcGFjZSAiY29yZSIpKQogICAgIChkZWZ2YXIgaW5fYm9vdCB0cnVlKSAgOzsgdGhpcyBpcyB0cnVlIHdoaWxlIHdlIGFyZSBpbml0aWFsaXppbmcgdGhlIGVudmlyb25tZW50CiAgICAgCiAgICAgOzsgRGVmaW5lIGEgaG9sZGluZyB0YW5rIGZvciBzeW1ib2xzIHRoYXQgcmVmZXJlbmNlIHlldCB1bmxvYWRlZCBuYW1lc3BhY2VzLi4uCiAgICAgOzsgd2hpbGUgaW4gYm9vdCBtb2RlCiAgICAgOzsgb25jZSB0aGUgbmFtZXNwYWNlIGlzIGxvYWRlZCB0aGUgc3ltYm9scyBhcmUgaW5pdGlhaWx6ZWQKICAgICA7OyBrZXktPmFycmF5IG9mIHN5bWJvbHMgcGVyIG5hbWVzcGFjZSAKICAgICAoZGVmdmFyIHBlbmRpbmdfbG9hZHMge30pIAogICAgCiAgICAgKGRlZnZhciBwYXJlbnRfZW52aXJvbm1lbnQgKGlmICg9PSBuYW1lc3BhY2UgImNvcmUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLnBhcmVudF9lbnZpcm9ubWVudCkpCiAgICAgCiAgICAgOzsgVGhlIGN1cnJlbnRseSBhY3RpdmUgbmFtZXNwYWNlCiAgICAgOzsgSWYgd2UgYXJlIGEgY2hpbGQgZW52LCBpdCBzaG91bGQgYWx3YXlzIGVxdWFsIG91ciBuYW1lCiAgICAgOzsgb3RoZXJ3aXNlIGlmIHdlIGFyZSB0aGUgY29yZSwgdGhlbiB0aGlzIHBvaW50cyB0byB0aGUKICAgICA7OyBjdXJyZW50IG5hbWVzcGFjZSBhY2Nlc3NlZCBieSBjdXJyZW50X25hbWVzcGFjZQogICAgIDs7IGluIHRoZSBjb3JlIGVudmlyb25tZW50LgogICAgIAogICAgIChkZWZ2YXIgYWN0aXZlX25hbWVzcGFjZSBuYW1lc3BhY2UpCgogICAgIChkZWZ2YXIgY29udGFpbmVkIChvciBvcHRzLmNvbnRhaW5lZCBmYWxzZSkpCiAgICAgCiAgICAgOzsgU2V0IHVwIG91ciBpbml0aWFsIHNrZWxldG9uLi4KCiAgICAgKGRlZnZhciBFbnZpcm9ubWVudCAgICAgICAgICAgICAgICAgCiAgICAgICB7IDs7IG9uY2Ugd2UgaGF2ZSBidWlsdCB0aGUgZW52aXJvbm1lbnQsIGlmIHRoZXJlIGFyZSBhbnkgaW5jbHVzaW9ucyB3ZSB3aWxsIG1lcmdlIHRoZW0gaW4KICAgICAgICA7OyB0byBnbG9iYWxfY3R4IHNpbmNlIHRoZXkgd2lsbCBoYXZlIHRoZSBwb3RlbnRpYWwgdG8gcmVmZXIgdG8gdGhpbmdzIHRoYXQgaGF2ZSB5ZXQKICAgICAgICA7OyB0byBiZSBkZWZpbmVkIHRvIHRoZSBjb21waWxlci4uCiAgICAgICAgCiAgICAgICAgICBgZ2xvYmFsX2N0eDogewogICAgICAgICAgICAgICAgICAgICAgICAgYHNjb3BlOiB7fQogICAgICAgICAgICAgICAgICAgICAgICAgYG5hbWU6ICBuYW1lc3BhY2UgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgYGJ1aWxkX3ZlcnNpb246IChqYXZhc2NyaXB0IERMSVNQX0VOVl9WRVJTSU9OKQogICAgICAgICAgYGRlZmluaXRpb25zOiAob3Igb3B0cy5kZWZpbml0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgICAgICAgICAgCiAgICAgICAgICBgZGVjbGFyYXRpb25zOiAob3Igb3B0cy5kZWNsYXJhdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgc2FmZXR5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbGV2ZWw6IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgICAgICAgICAgCiAgICAgICAgICB9KQogICAgICAgICAgCiAgICAgCiAgICAgKGRlZnZhciBpZCAgKGdldF9uZXh0X2Vudmlyb25tZW50X2lkKSkKCiAgICAgOzsgaWYgd2UgaGF2ZSBhIG5hbWVzcGFjZSBvdGhlciB0aGFuIGNvcmUgd2Ugc2hvdWxkCiAgICAgOzsgaGF2ZSBhIHBhcmVudCBlbnZpcm9ubWVudAogICAgICAgICAgICAgIAogICAgIChzZXRfcHJvcCBFbnZpcm9ubWVudAogICAgICAgICAgICAgICBgY29udGV4dAogICAgICAgICAgICAgICBFbnZpcm9ubWVudC5nbG9iYWxfY3R4KQoKICAgICA7OyBubyBjb21waWxlciB1bnRpbCBpdCBpcyBwcm92aWRlZC4KICAgICAoZGVmdmFyIHVuc2V0X2NvbXBpbGVyICAoZm4gKCkgKHRocm93IEV2YWxFcnJvciAoKyAiY29tcGlsZXIgbXVzdCBiZSBzZXQgZm9yICIgIG5hbWVzcGFjZSApKSkpCiAgICAgKGRlZnZhciBjb21waWxlciB1bnNldF9jb21waWxlcikKICAgICAKICAgICAKICAgICAoZGVmdmFyIGNvbXBpbGVyX29wZXJhdG9ycyAobmV3IFNldCkpCiAgICAgKGRlZnZhciBzcGVjaWFsX2lkZW50aXR5IChmbiAodikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2KSkKCiAgICAgOzsgLS0tLS0tLSBFbmQgTGltaXRlZCBab25lIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgCiAgICAgOzsgdGhlIGRlZmluZV9lbnYgbWFjcm8gcG9wdWxhdGVzIGdsb2JhbF9jdHggc2NvcGUgb2JqZWN0IHRvIGxvY2FsIHZhbHVlcyBpbiBvdXIKICAgICA7OyBjbG9zdXJlCiAgICAgCiAgICAgCiAgICAgKGRlZmluZV9lbnYgCiAgICAgICAgIChNQVhfU0FGRV9JTlRFR0VSIDkwMDcxOTkyNTQ3NDA5OTEpCiAgICAgICAgIChMaXNwU3ludGF4RXJyb3IgZ2xvYmFsVGhpcy5MaXNwU3ludGF4RXJyb3IpCiAgICAgICAgIChzdWJfdHlwZSBzdWJ0eXBlCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJSZXR1cm5zIGEgc3RyaW5nIHRoZSBkZXRlcm1pbmVkIGFjdHVhbCB0eXBlIG9mIHRoZSBwcm92aWRlZCB2YWx1ZS4iCiAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJ2YWx1ZToqIl0KICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsidHlwZSIgImNsYXNzIiAicHJvdG90eXBlIiAidHlwZW9mIiAiaW5zdGFuY2VvZiJdCiAgICAgICAgICAgICAgICAgIH0pICAgICAgICAKICAgICAgICAgKF9fVkVSQk9TSVRZX18gMAogICAgICAgICAgICAgICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiU2V0IF9fVkVSQk9TSVRZX18gdG8gYSBwb3NpdGl2ZSBpbnRlZ2VyIGZvciB2ZXJib3NlIGNvbnNvbGUgb3V0cHV0IG9mIHN5c3RlbSBhY3Rpdml0eS4iCiAgICAgICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJkZWJ1ZyIgImNvbXBpbGVyIiAiZW52aXJvbm1lbnQiICJnbG9iYWwiXQogICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChpbnQgcGFyc2VJbnQKICAgICAgICAgICAgICB7IGB1c2FnZTogInZhbHVlOnN0cmluZ3xudW1iZXIiIAogICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJDb252ZW5pZW5jZSBtZXRob2QgZm9yIHBhcnNlSW50LCBzaG91bGQgYmUgdXNlZCBpbiBtYXAgdnMuIGRpcmVjdGx5IGNhbGxpbmcgcGFyc2VJbnQsIHdoaWNoIHdpbGwgbm90IHdvcmsgZGlyZWN0bHkiCiAgICAgICAgICAgICAgIGB0YWdzOiBbImNvbnZlcnNpb24iICJudW1iZXIiXQogICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGZsb2F0IHBhcnNlRmxvYXQKICAgICAgICAgICAgICAgIHsgYHVzYWdlOiAidmFsdWU6c3RyaW5nfG51bWJlciIgCiAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiQ29udmVuaWVuY2UgbWV0aG9kIGZvciBwYXJzZUZsb2F0LCBzaG91bGQgYmUgdXNlZCBpbiBtYXAgdnMuIGRpcmVjdGx5IGNhbGxpbmcgcGFyc2VGbG9hdCwgd2hpY2ggd2lsbCBub3Qgd29yayBkaXJlY3RseSIKICAgICAgICAgICAgICAgICBgdGFnczogWyJjb252ZXJzaW9uIiAibnVtYmVyIl0KICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKHZhbHVlcyAobmV3IEZ1bmN0aW9uICIuLi5hcmdzIgogICAgICAgICAgICAgICAgICAgICAgInsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWNjID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgX2kgaW4gYXJncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBhcmdzW19pXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUgPSBzdWJ0eXBlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU2V0KSAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gYWNjLmNvbmNhdChBcnJheS5mcm9tKHZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZT09PSdhcnJheScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IGFjYy5jb25jYXQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGU9PT0nb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjID0gYWNjLmNvbmNhdChPYmplY3QudmFsdWVzKHZhbHVlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IGFjYy5jb25jYXQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IikKICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkdpdmVuIGEgY29udGFpbmVyLCByZXR1cm5zIGEgbGlzdCBjb250YWluaW5nIHRoZSB2YWx1ZXMgb2YgZWFjaCBzdXBwbGllZCBhcmd1bWVudC4gTm90ZSB0aGF0IGZvciBvYmplY3RzLCBvbmx5IHRoZSB2YWx1ZXMgYXJlIHJldHVybmVkLCBub3QgdGhlIGtleXMuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiSWYgZ2l2ZW4gbXVsdGlwbGUgdmFsdWVzLCB0aGUgcmV0dXJuZWQgdmFsdWUgaXMgYSBjb25jYXRlbnRhdGlvbiBvZiBhbGwgY29udGFpbmVycyBwcm92aWRlZCBpbiB0aGUgYXJndW1lbnRzLiIpCiAgICAgICAgICAgICAgICAgIGB1c2FnZTpbICJhcmcwOioiICJhcmduOioiXQogICAgICAgICAgICAgICAgICBgdGFnczogWyBgYXJyYXkgYGNvbnRhaW5lciBgb2JqZWN0IGBrZXlzIGBlbGVtZW50cyBdCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAocGFpcnMgKG5ldyBGdW5jdGlvbiAib2JqIgogICAgICAgICAgICAgICAgICAgICAiewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VidHlwZShvYmopPT09J2FycmF5JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJ2YWwgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgaSs9MikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ2YWwucHVzaChbb2JqW2ldLG9ialtpKzFdXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBydmFsID0ga2V5cy5yZWR1Y2UoZnVuY3Rpb24oYWNjLHgsaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKFt4LG9ialt4XV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sW10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJ2YWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhIHBhc3NlZCBvYmplY3Qgb3IgYXJyYXksIHJldHVybnMgYSBsaXN0IGNvbnRhaW5pbmcgYSAyIGVsZW1lbnQgbGlzdCBmb3IgZWFjaCBrZXkvdmFsdWUgcGFpciBvZiB0aGUgc3VwcGxpZWQgb2JqZWN0LiIKICAgICAgICAgICAgICAgICBgdGFnczogWyJhcnJheSIgImNvbnRhaW5lciIgIm9iamVjdCIgXQogICAgICAgICAgICAgICAgIGB1c2FnZTogWyJvYmo6b2JqZWN0Il0KICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGtleXMgKG5ldyBGdW5jdGlvbiAib2JqIgogICAgICAgICAgICAgICAgICAgICJ7ICByZXR1cm4gT2JqZWN0LmtleXMob2JqKTsgIH0iKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhbiBvYmplY3QsIHJldHVybnMgdGhlIGtleXMgb2YgdGhlIG9iamVjdC4iCiAgICAgICAgICAgICAgICBgdGFnczogWyJvYmplY3QiICJ2YWx1ZXMiICJrZXlzIiAiaW5kZXhlcyIgImNvbnRhaW5lciIgXQogICAgICAgICAgICAgICAgYHVzYWdlOiBbIm9iajpvYmplY3QiXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgICh0YWtlIChuZXcgRnVuY3Rpb24gInBsYWNlIiAieyByZXR1cm4gcGxhY2Uuc2hpZnQoKSB9IikKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJUYWtlcyB0aGUgZmlyc3QgdmFsdWUgb2ZmIHRoZSBsaXN0LCBhbmQgcmV0dXJucyB0aGUgdmFsdWUuIgogICAgICAgICAgICAgIGB0YWdzOiBbImFycmF5IiAiY29udGFpbmVyIiAibXV0YXRlIiAiZmlyc3QiXQogICAgICAgICAgICAgIGB1c2FnZTogWyJwbGFjZTpjb250YWluZXIiXQogICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAocHJlcGVuZCAobmV3IEZ1bmN0aW9uICJwbGFjZSIgInRoaW5nIiAieyByZXR1cm4gcGxhY2UudW5zaGlmdCh0aGluZykgfSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiUGxhY2VzIHRoZSB2YWx1ZSBhcmd1bWVudCBvbnRvIHRoZSBmaXJzdCBvZiB0aGUgbGlzdCAodW5zaGlmdCkgYW5kIHJldHVybnMgdGhlIGxpc3QuIgogICAgICAgICAgICAgICAgIGB0YWdzOiBbImFycmF5IiAibXV0YXRlIiAiY29udGFpbmVyIiBdCiAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInBsYWNlOmFycmF5IiAidGhpbmc6KiJdCiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChmaXJzdCAobmV3IEZ1bmN0aW9uICJ4IiAieyByZXR1cm4geFswXSB9IikKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIkdpdmVuIGFuIGFycmF5LCByZXR1cm5zIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4iCiAgICAgICAgICAgICAgIGB1c2FnZTogWyJ4OmFycmF5Il0KICAgICAgICAgICAgICAgYHRhZ3M6IFsiYXJyYXkiICJjb250YWluZXIiICJlbGVtZW50cyIgXQogICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGxhc3QgKG5ldyBGdW5jdGlvbiAieCIgInsgcmV0dXJuIHhbeC5sZW5ndGggLSAxXSB9IikKICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYW4gYXJyYXksIHJldHVybnMgdGhlIGxhc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuIgogICAgICAgICAgICAgICBgdXNhZ2U6IFsieDphcnJheSJdCiAgICAgICAgICAgICAgIGB0YWdzOiBbImFycmF5IiAiY29udGFpbmVyIiAiZWxlbWVudHMiICJlbmQiXQogICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGxlbmd0aCAobmV3IEZ1bmN0aW9uICJvYmoiCiAgICAgICAgICAgICAgICAgICAgICAiewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9iaiBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmoubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouc2l6ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChvYmogPT09IHVuZGVmaW5lZCl8fChvYmo9PT1udWxsKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmo9PT0nb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqPT09J3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iai5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0iKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiUmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBzdXBwbGllZCB0eXBlIChhcnJheSwgb2JqZWN0LCBzZXQsIHN0cmluZywgbnVtYmVyKS4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJZiB0aGUgc3VwcGxpZWQgdmFsdWUgaXMgbmlsIG9yIGEgbm9uLWNvbnRhaW5lciB0eXBlLCByZXR1cm5zIDAuIikKICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsic2l6ZSIgImVsZW1lbnRzIiAiY29udGFpbmVyIiAiZGltZW5zaW9uIiAiYXJyYXkiICJzZXQiICJzdHJpbmciICJudW1iZXIiIF0KICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInRoaW5nOmNvbnRhaW5lciJdCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoY29uaiAobmV3IEZ1bmN0aW9uICIuLi5hcmdzIgogICAgICAgICAgICAgICAgICAgICJ7ICAgbGV0IGxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnc1swXSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBbYXJnc1swXV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3Muc2xpY2UoMSkubWFwKGZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCA9IGxpc3QuY29uY2F0KHgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaXN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSIpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkNvbmpvaW5zIG9yIGNvbmNhdGVuYXRlcyB0aGluZ3MgKHR5cGljYWxseSBhcnJheXMpIHRvZ2V0aGVyIGFuZCByZXR1cm5zIGFuIGFycmF5LiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFeGFtcGxlczo8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKGNvbmogWyAxIDIgXSBbIDMgNCBdKSA9PiBbIDEgMiAzIDQgXTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoY29uaiBbIDEgMiBdIDMgNCApID0+IFsgMSAyIDMgNCBdPGJyPiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihjb25qIDEgMiBbIDMgNCBdKSA9PiBbIDEgMiAzIDQgXTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoY29uaiB7IGBhYmM6IDEyMyB9IFsgMiAzXSkgPT4gWyB7IGFiYzogMTIzIH0sIDIsIDMgXTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoY29uaiBbIDEgMiAzIFsgNCBdXSBbIDUgNiBbIDcgXV0pID0+IFsgMSAyIDMgWyA0IF0gNSA2IFsgNyBdIF0iKQogICAgICAgICAgICAgICAgYHRhZ3M6IFtgZWxlbWVudHMgYGNvbmNhdCBgYXJyYXkgYGNvbmpvaW4gYGFwcGVuZF0KICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmcwOioiICJhcmdOOioiXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIAogICAgICAgICAKICAgICAgICAgKHJldmVyc2UgKG5ldyBGdW5jdGlvbiAiY29udGFpbmVyIiAieyByZXR1cm4gY29udGFpbmVyLnNsaWNlKDApLnJldmVyc2UgfSIpCiAgICAgICAgICAgICAgICAgIHsgInVzYWdlIjogWyJjb250YWluZXI6bGlzdCJdIAogICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlJldHVybnMgYSBjb3B5IG9mIHRoZSBwYXNzZWQgbGlzdCBhcyByZXZlcnNlZC4gIFRoZSBvcmlnaW5hbCBpcyBub3QgY2hhbmdlZC4iIAogICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsibGlzdCIgInNvcnQiICJvcmRlciJdIAogICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChtYXAgKG5ldyBBc3luY0Z1bmN0aW9uICJsYW1iZGEiICJhcnJheV92YWx1ZXMiIAogICAgICAgICAgICAgICAgICAgInsgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBydmFsID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRsID0gYXJyYXlfdmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXlfdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnZhbC5wdXNoKGF3YWl0IGxhbWJkYS5hcHBseSh0aGlzLFthcnJheV92YWx1ZXNbaV0sIGksIHRsXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBydmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgeyAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFtYmRhID09PSB1bmRlZmluZWQgfHwgbGFtYmRhID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJtYXA6IGxhbWJkYSBhcmd1bWVudCAocG9zaXRpb24gMCkgaXMgdW5kZWZpbmVkIG9yIG5pbFwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhcnJheV92YWx1ZXMgPT09IHVuZGVmaW5lZCB8fCBhcnJheV92YWx1ZXMgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcIm1hcDogY29udGFpbmVyIGFyZ3VtZW50IChwb3NpdGlvbiAxKSBpcyB1bmRlZmluZWQgb3IgbmlsXCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCEobGFtYmRhIGluc3RhbmNlb2YgRnVuY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJtYXA6IGxhbWJkYSBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb246IHJlY2VpdmVkOiBcIisgdHlwZW9mIGxhbWJkYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIShhcnJheV92YWx1ZXMgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcIm1hcDogaW52YWxpZCBhcnJheSBhcmd1bWVudCwgcmVjZWl2ZWQ6IFwiICsgdHlwZW9mIGFycmF5X3ZhbHVlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzb21ldGhpbmcgZWxzZSBqdXN0IHBhc3Mgb24gdGhlIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0iKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiUHJvdmlkZWQgYSBmdW5jdGlvbiBhcyBhIGZpcnN0IGFyZ3VtZW50LCBtYXAgY2FsbHMgdGhlIGZ1bmN0aW9uICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKGl0ZW0sIGN1cnJlbnRfaW5kZXgsIHRvdGFsX2xlbmd0aCkgd2l0aCBlYWNoIGVsZW1lbnQgZnJvbSB0aGUgc2Vjb25kIGFyZ3VtZW50LCB3aGljaCBzaG91bGQgYmUgYSBsaXN0LiBSZXR1cm5zIGEgbmV3IGxpc3QgY29udGFpbmluZyB0aGUgcmV0dXJuIHZhbHVlcyByZXN1bHRpbmcgZnJvbSBldmFsdWF0aW5nLiIpCiAgICAgICAgICAgICAgIGB0YWdzOiBbYGFycmF5IGBjb250YWluZXIgYGVsZW1lbnRzIGBpdGVyYXRpb24gXQogICAgICAgICAgICAgICBgdXNhZ2U6IFsgImxhbWJkYTpmdW5jdGlvbiIgImVsZW1lbnRzOmFycmF5Il0gCiAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoYmluZCAobmV3IEZ1bmN0aW9uICJmdW5jLHRoaXNfYXJnIgogICAgICAgICAgICAgICAgICAgICJ7IHJldHVybiBmdW5jLmJpbmQodGhpc19hcmcpIH0iKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhIGZ1bmN0aW9uIGFuZCBhIHRoaXMgdmFsdWUsIHRoZSBiaW5kIGZ1bmN0aW9uIHJldHVybnMgYSBuZXcgZnVuY3Rpb24gdGhhdCBoYXMgaXRzIHRoaXMga2V5d29yZCBzZXQgdG8gdGhlIHByb3ZpZGVkIHZhbHVlIGluIHRoaXNfYXJnLiIKICAgICAgICAgICAgICAgIGB1c2FnZTogWyAiZnVuYzpmdW5jdGlvbiIgInRoaXNfYXJnOioiIF0KICAgICAgICAgICAgICAgIGB0YWdzOiBbIGBiaW5kIGB0aGlzIGBmdW5jdGlvbiBdCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgICAgICAgICAgCiAgICAgICAgICh0b19vYmplY3QgKG5ldyBGdW5jdGlvbiAiYXJyYXlfdmFsdWVzIgogICAgICAgICAgICAgICAgICAgICAgICAgInsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgb2JqPXt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfdmFsdWVzLmZvckVhY2goKHBhaXIpPT57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtwYWlyWzBdXT1wYWlyWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSIpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhbiBhcnJheSBvZiBwYWlycyBpbiB0aGUgZm9ybSBvZiBbW2tleSB2YWx1ZV0gW2tleSB2YWx1ZV0gLi4uXSwgY29uc3RydWN0cyBhbiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm9iamVjdCB3aXRoIHRoZSBmaXJzdCBhcnJheSBlbGVtZW50IG9mIHRoZSBwYWlyIGFzIHRoZSBrZXkgYW5kIHRoZSBzZWNvbmQgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJlbGVtZW50IGFzIHRoZSB2YWx1ZS4gQSBzaW5nbGUgb2JqZWN0IGlzIHJldHVybmVkLiIpCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJwYWlyZWRfYXJyYXk6YXJyYXkiXQogICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJjb252ZXJzaW9uIiAib2JqZWN0IiAiYXJyYXkiICJsaXN0IiAicGFpcnMiXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKHRvX2FycmF5IChmbiAoY29udGFpbmVyKQogICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgIChpc19hcnJheT8gY29udGFpbmVyKQogICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgICAgIChpc19zZXQ/IGNvbnRhaW5lcikKICAgICAgICAgICAgICAgICAgICAgICAoZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmdmFyIGFjYyBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgICgtPiBjb250YWluZXIgYGZvckVhY2ggKGZuICh2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwdXNoIGFjYyB2KSkpCiAgICAgICAgICAgICAgICAgICAgICAgICBhY2MpCiAgICAgICAgICAgICAgICAgICAgICAgKGlzX3N0cmluZz8gY29udGFpbmVyKQogICAgICAgICAgICAgICAgICAgICAgIChzcGxpdF9ieSAiIiBjb250YWluZXIpCiAgICAgICAgICAgICAgICAgICAgICAgKGlzX29iamVjdD8gY29udGFpbmVyKQogICAgICAgICAgICAgICAgICAgICAgIChwYWlycyBjb250YWluZXIpCiAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgIFtjb250YWluZXJdKSkKICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhIGNvbnRhaW5lciBvZiB0eXBlIEFycmF5LCBTZXQsIE9iamVjdCwgb3IgYSBzdHJpbmcsICIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXQgd2lsbCBjb252ZXJ0IHRoZSBtZW1iZXJzIG9mIHRoZSBjb250YWluZXIgdG8gYW4gYXJyYXkgZm9ybSwgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFuZCByZXR1cm4gYSBuZXcgYXJyYXkgd2l0aCB0aGUgdmFsdWVzIG9mIHRoZSBwcm92aWRlZCBjb250YWluZXIuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJbiB0aGUgY2FzZSBvZiBhbiBvYmplY3QsIHRoZSBrZXlzIGFuZCB2YWx1ZXMgd2lsbCBiZSBjb250YWluZWQgaW4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBhaXJlZCBhcnJheXMgaW4gdGhlIHJldHVybmVkIGFycmF5LiAgQSBzdHJpbmcgd2lsbCBiZSBzcGxpdCBpbnRvICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmRpdmlkdWFsIGNoYXJhY3RlcnMuIElmIHByb3ZpZGVkIGEgZGlmZmVyZW50ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIG90aGVyIHRoYW4gdGhlIGxpc3RlZCB2YWx1ZXMgYWJvdmUsIHRoZSB2YWx1ZSB3aWxsIGJlIHBsYWNlZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW4gYW4gYXJyYXkgYXMgYSBzaW5nbGUgZWxlbWVudC4iKQogICAgICAgICAgICAgICAgICAgIGB1c2FnZTpbImNvbnRhaW5lcjoqIl0KICAgICAgICAgICAgICAgICAgICBgdGFnczogWyAiYXJyYXkiICJjb252ZXJzaW9uIiAic2V0IiAib2JqZWN0IiAic3RyaW5nIiAicGFpcnMiXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoc2xpY2UgKGZ1bmN0aW9uICh0YXJnZXQgZnJvbSB0bykKICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiB0YXJnZXQgYHNsaWNlIGZyb20gdG8pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gdGFyZ2V0IGBzbGljZSBmcm9tKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IFN5bnRheEVycm9yICJzbGljZSByZXF1aXJlcyAyIG9yIDMgYXJndW1lbnRzIikpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIkdpdmVuIGFuIGFycmF5LCB3aXRoIGEgc3RhcnRpbmcgaW5kZXggYW5kIGFuIG9wdGlvbmFsIGVuZGluZyBpbmRleCwgc2xpY2UgcmV0dXJucyBhIG5ldyBhcnJheSBjb250YWluaW5nIHRoZSBlbGVtZW50cyBpbiB0aGUgcmFuZ2Ugb2YgcHJvdmlkZWQgaW5kaWNlcy4iCiAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInRhcmdldDphcnJheSIgImZyb206bnVtYmVyIiAidG86bnVtYmVyIl0KICAgICAgICAgICAgICAgICBgdGFnczogWyJhcnJheSIgInNsaWNpbmciICJkaW1lbnNpb25zIiAic3Vic2V0Il0KICAgICAgICAgICAgICAgICB9KQogICAgICAgCiAgICAgICAgIChyZXN0IChmdW5jdGlvbiAoeCkKICAgICAgICAgICAgICAgICAgICAgICAgIChjb25kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAoaW5zdGFuY2VvZiB4IEFycmF5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4geCBgc2xpY2UgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlzX3N0cmluZz8geCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IHggYHN1YnN0ciAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgIG5pbCkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIlJldHVybnMgYSBuZXcgYXJyYXkgY29udGFpbmluZyB0aGUgZWxlbWVudHMgaW4gdGhlIDJuZCB0aHJvdWdoIGxhc3QgcG9zaXRpb24gKHRoZSB0YWlsKSBvZiB0aGUgcHJvdmlkZWQgYXJyYXkuIgogICAgICAgICAgICAgICAgYHVzYWdlOiBbIng6YXJyYXkiXQogICAgICAgICAgICAgICAgYHRhZ3M6IFsiYXJyYXkiICJzdWJzZXQiICJzbGljZSIgInRhaWwiICJlbmQiXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChzZWNvbmQgIChuZXcgRnVuY3Rpb24gIngiICJ7IHJldHVybiB4WzFdIH0iKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIlJldHVybnMgdGhlIHNlY29uZCBlbGVtZW50IGluIHRoZSBwcm92aWRlZCBhcnJheSAodGhlIGVsZW1lbnQgYXQgaW5kZXggMSkiCiAgICAgICAgICAgICAgICAgYHRhZ3M6IFsiYXJyYXkiICJzdWJzZXQiICJlbGVtZW50IiAiZmlyc3QiIF0KICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsieDphcnJheSJdCiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgKHRoaXJkIChuZXcgRnVuY3Rpb24gIngiICJ7IHJldHVybiB4WzJdIH0iKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJSZXR1cm5zIHRoZSB0aGlyZCBlbGVtZW50IGluIHRoZSBwcm92aWRlZCBhcnJheSAodGhlIGVsZW1lbnQgYXQgaW5kZXggMikiCiAgICAgICAgICAgICAgICAgYHRhZ3M6IFsiYXJyYXkiICJzdWJzZXQiICJlbGVtZW50IiAiZmlyc3QiIF0KICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsieDphcnJheSJdCiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChjaG9wICAobmV3IEZ1bmN0aW9uICJ4IiAieyBpZiAoeCBpbnN0YW5jZW9mIEFycmF5KSB7IHJldHVybiB4LnNsaWNlKDAsIHgubGVuZ3RoLTEpIH0gZWxzZSB7IHJldHVybiB4LnN1YnN0cigwLHgubGVuZ3RoLTEpIH0gfSIpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJSZXR1cm5zIGEgbmV3IGNvbnRhaW5lciBjb250YWluaW5nIGFsbCBpdGVtcyBleGNlcHQgdGhlIGxhc3QgaXRlbS4gIFRoaXMgZnVuY3Rpb24gdGFrZXMgZWl0aGVyIGFuIGFycmF5IG9yIGEgc3RyaW5nLiIKICAgICAgICAgICAgICAgYHVzYWdlOiBbImNvbnRhaW5lcjphcnJheXxzdHJpbmciXQogICAgICAgICAgICAgICBgdGFnczogWyJhcnJheSIgInNsaWNlIiAic3Vic2V0IiAiZmlyc3QiICJzdHJpbmciXQogICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGNob21wIChuZXcgRnVuY3Rpb24gIngiICJ7IHJldHVybiB4LnN1YnN0cih4Lmxlbmd0aC0xKSB9IikKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIkdpdmVuIGEgc3RyaW5nIHJldHVybnMgYSBuZXcgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIGNoYXJhY3RlcnMgZXhjZXB0IHRoZSBsYXN0IGNoYXJhY3Rlci4iCiAgICAgICAgICAgICAgIGB1c2FnZTogWyJ4OnN0cmluZyJdCiAgICAgICAgICAgICAgIGB0YWdzOiBbYHNsaWNlIGBzdWJzZXQgYHN0cmluZyBdCiAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAobm90IChuZXcgRnVuY3Rpb24gIngiICJ7IGlmIChjaGVja190cnVlKHgpKSB7IHJldHVybiBmYWxzZSB9IGVsc2UgeyByZXR1cm4gdHJ1ZSB9IH0iKQogICAgICAgICAgICB7CiAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJSZXR1cm5zIHRoZSBsb2dpY2FsIG9wcG9zaXRlIG9mIHRoZSBnaXZlbiB2YWx1ZS4gIElmIGdpdmVuIGEgdHJ1dGh5IHZhbHVlLCBhIGZhbHNlIGlzIHJldHVybmVkLiAgSWYgZ2l2ZW4gYSBmYWxzZXkgdmFsdWUsIHRydWUgaXMgcmV0dXJuZWQuIgogICAgICAgICAgICAgYHVzYWdlOiBbIng6KiJdCiAgICAgICAgICAgICBgdGFnczogWyJsb2dpYyIgIm5vdCIgImludmVyc2UiXQogICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChwdXNoICAobmV3IEZ1bmN0aW9uICJwbGFjZSIgInRoaW5nIiAieyByZXR1cm4gcGxhY2UucHVzaCh0aGluZykgfSIpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhbiBhcnJheSBhcyBhIHBsYWNlLCBhbmQgYW4gYXJiaXRyYXJ5IHZhbHVlLCBhcHBlbmRzIChwdXNoZXMpIHRoZSB2YWx1ZSB0byB0aGUgZW5kIG9mIHRoZSBhcnJheS4iCiAgICAgICAgICAgICAgIGB1c2FnZTogWyJwbGFjZTphcnJheSIgInRoaW5nOioiXQogICAgICAgICAgICAgICBgdGFnczogWyJhcnJheSIgIm11dGF0ZSIgImFwcGVuZCIgImNvbmNhdCIgInBvcCJdCiAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAocG9wICAobmV3IEZ1bmN0aW9uICJwbGFjZSIgInsgcmV0dXJuIHBsYWNlLnBvcCgpIH0iKQogICAgICAgICAgICAgewogICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIkdpdmVuIGFuIGFycmF5IGFzIGFuIGFyZ3VtZW50cywgcmVtb3ZlcyB0aGUgbGFzdCB2YWx1ZSBmcm9tIHRoZSBnaXZlbiBhcnJheSBhbmQgcmV0dXJucyBpdC4iCiAgICAgICAgICAgICAgYHVzYWdlOiBbInBsYWNlOmFycmF5Il0KICAgICAgICAgICAgICBgdGFnczogWyJhcnJheSIgIm11dGF0ZSIgInRha2UiICJyZW1vdmUiICJwdXNoIl0KICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGxpc3QgIChmbiAoYCYgYXJncykgYXJncykKICAgICAgICAgICAgICAgIHsgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYSBzZXQgb2YgYXJiaXRyYXJ5IGFyZ3VtZW50cywgcmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuIElmIG5vIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQsIHJldHVybnMgYW4gZW1wdHkgYXJyYXkuIgogICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnMDoqIiAiYXJnTjoqIl0KICAgICAgICAgICAgICAgICBgdGFnczogWyAiYXJyYXkiICJjb250YWluZXIiICJlbGVtZW50cyIgXQogICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAgKGZsYXR0ZW4gKG5ldyBGdW5jdGlvbiAieCIgInsgcmV0dXJuIHguZmxhdCg5OTk5OTk5OTk5OTkpIH0gIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhIG5lc3RlZCBhcnJheSBzdHJ1Y3R1cmUsIHJldHVybnMgYSBmbGF0dGVuZWQgdmVyc2lvbiBvZiB0aGUgYXJyYXkiCiAgICAgICAgICAgICAgICAgYHVzYWdlOiBbIng6YXJyYXkiXQogICAgICAgICAgICAgICAgIGB0YWdzOiBbIGBhcnJheSBgY29udGFpbmVyIGBmbGF0IGB0cmVlIF0KICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGpzbGFtYmRhIChmdW5jdGlvbiAoYCYgYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYXBwbHkgRnVuY3Rpb24gKGZsYXR0ZW4gYXJncykpKQogICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIlByb3h5IGZvciBKYXZhc2NyaXB0IEZ1bmN0aW9uLiAgR2l2ZW4gYSBzZXQgb2Ygc3RyaW5nIGJhc2VkIGFyZ3VtZW50cywgYWxsIGJ1dCB0aGUgbGFzdCBhcmUgY29uc2lkZXJlZCBhcmd1bWVudHMgdG8gdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmdW5jdGlvbiB0byBiZSBkZWZpbmVkLiAgVGhlIGxhc3QgYXJndW1lbnQgaXMgY29uc2lkZXJlZCB0aGUgYm9keSBvZiB0aGUgZnVuY3Rpb24gYW5kIHNob3VsZCBiZSBwcm92aWRlZCBhcyBhIHN0cmluZyBvZiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiamF2YXNjcmlwdC4gUmV0dXJucyBhIGphdmFzY3JpcHQgZnVuY3Rpb24uIDxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKGpzbGFtYmRhIChgYSBgYikgXCJ7IHJldHVybiBhK2IgfVwiKTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKGpzbGFtYmRhICgpIFwieyByZXR1cm4gbmV3IERhdGUoKSB9XCIpIiApCiAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImFyZ3VtZW50X2xpc3Q6YXJyYXkiICJhcmduOnN0cmluZyJdCiAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGphdmFzY3JpcHQgYGVtYmVkIGBmdW5jdGlvbiBdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChqb2luIChmdW5jdGlvbiAoYCYgYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBhcmdzLmxlbmd0aCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gYXJncy4wIGBqb2luICIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiBhcmdzLjEgYGpvaW4gYXJncy4wKSkpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkdpdmVuIGFuIG9wdGlvbmFsIGpvaW5pbmcgc3RyaW5nIGFuZCBhbiBhcnJheSBvZiBzdHJpbmdzLCByZXR1cm5zIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImVsZW1lbnRzIG9mIHRoZSBhcnJheSBpbnRlcmxhY2VkIHdpdGggdGhlIG9wdGlvbmFsIGpvaW5pbmcgc3RyaW5nLjxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoam9pbiBcIixcIiBbIFwicmVkXCIgXCJmb3hcIiBdKSAtPiBcInJlZCxmb3hcIjxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoam9pbiBbXCJyZWRcIiBcImZveFwiXSkgLT4gcmVkZm94IikKICAgICAgICAgICAgICAgIGB0YWdzOiBbImFycmF5IiAiY29tYmluZSIgInNwbGl0IiAic3RyaW5nIiAidGV4dCIgXQogICAgICAgICAgICAgICAgYHVzYWdlOiBbImpvaW5pbmdfc3RyaW5nPzpzdHJpbmciICJjb250YWluZXI6YXJyYXkiXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgKGxvd2VyY2FzZSAoZnVuY3Rpb24gKHgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiB4IGB0b0xvd2VyQ2FzZSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJHaXZlbiBhIHN0cmluZywgY29udmVydHMgYWxsIGNhcGl0YWwgY2hhcmFjdGVycyB0byBsb3dlcmNhc2UgY2hhcmFjdGVycy4iCiAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbInN0cmluZyIgInRleHQiICJ1cHBlcmNhc2UiICJjYXNlIiAiY29udmVydCIgXQogICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsidGV4dDpzdHJpbmciXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKHVwcGVyY2FzZSAoZnVuY3Rpb24gKHgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiB4IGB0b1VwcGVyQ2FzZSkpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYSBzdHJpbmcsIGNvbnZlcnRzIGFsbCBjYXBpdGFsIGNoYXJhY3RlcnMgdG8gdXBwZXJjYXNlIGNoYXJhY3RlcnMuIgogICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsic3RyaW5nIiAidGV4dCIgImxvd2VyY2FzZSIgImNhc2UiICJjb252ZXJ0IiBdCiAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsidGV4dDpzdHJpbmciXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGxvZyAoZnVuY3Rpb24gKGAmIGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgIChhcHBseSBjb25zb2xlLmxvZyBhcmdzKSkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgImxvZyBpcyBhIHNob3J0aGFuZCBjYWxsIGZvciBjb25zb2xlLmxvZyBieSBkZWZhdWx0LCBhbmQgc2VydmVzIHRvIHByb3ZpZGUgYSBiYXNlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYWJzdHJhY3Rpb24gZm9yIGxvZ2dpbmcuICBMb2cgYmVoYXZpb3IgY2FuIGJlIGNoYW5nZWQgYnkgcmVkZWZpbmluZyBsb2cgdG8gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJiZXR0ZXIgc3VpdCB0aGUgZW52aXJvbm1lbnRhbCBjb250ZXh0LiAgRm9yIGV4YW1wbGUsIHdyaXRpbmcgbG9nIG91dHB1dCB0byBhIGZpbGUgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvciBIVE1MIGNvbnRhaW5lci4iKQogICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnczA6KiIgImFyZ3NOOioiXQogICAgICAgICAgICAgICBgdGFnczogWyJsb2dnaW5nIiAiY29uc29sZSIgIm91dHB1dCIgXQogICAgICAgICAgICAgICB9KQogICAgICAgCiAgICAgICAgIChzcGxpdCAobmV3IEZ1bmN0aW9uICJjb250YWluZXIiICJ0b2tlbiIgInsgcmV0dXJuIGNvbnRhaW5lci5zcGxpdCh0b2tlbikgfSIpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhIHN0cmluZyB0byBwYXJ0aXRpb24gYW5kIGEgc3RyaW5nIGZvciBhIHNwbGl0dGluZyB0b2tlbiwgcmV0dXJuIGFuIGFycmF5IHdob3NlIGVsZW1lbnRzICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJlIHRoZSB0ZXh0IGZvdW5kIGJldHdlZW4gZWFjaCBzcGxpdHRpbmcgdG9rZW4uIDxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihzcGxpdCBcInJlZCxmb3hcIiBcIixcIikgPT4gWyBcInJlZFwiIFwiZm94XCIgXSIpCiAgICAgICAgICAgICAgIGB0YWdzOiBbInBhcnRpdGlvbiIgImpvaW4iICJzZXBhcmF0ZSIgInN0cmluZyIgImFycmF5IiBdCiAgICAgICAgICAgICAgIGB1c2FnZTogWyJzdHJpbmdfdG9fc3BsaXQ6c3RyaW5nIiAic3BsaXRfdG9rZW46c3RyaW5nIiBdCiAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoc3BsaXRfYnkgKG5ldyBGdW5jdGlvbiAidG9rZW4iICJjb250YWluZXIiICJ7IHJldHVybiBjb250YWluZXIuc3BsaXQodG9rZW4pIH0iKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhIHN0cmluZyBmb3IgYSBzcGxpdHRpbmcgdG9rZW4gYW5kIGEgc3RyaW5nIHRvIHBhcnRpdGlvbiwgcmV0dXJuIGFuIGFycmF5IHdob3NlIGVsZW1lbnRzICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZSB0aGUgdGV4dCBmb3VuZCBiZXR3ZWVuIGVhY2ggc3BsaXR0aW5nIHRva2VuLiA8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKHNwbGl0X2J5IFwiLFwiIFwicmVkLGZveFwiKSA9PiBbIFwicmVkXCIgXCJmb3hcIiBdIikKICAgICAgICAgICAgICAgIGB0YWdzOiBbInBhcnRpdGlvbiIgImpvaW4iICJzZXBhcmF0ZSIgInN0cmluZyIgImFycmF5IiBdCiAgICAgICAgICAgICAgICBgdXNhZ2U6IFsic3BsaXRfdG9rZW46c3RyaW5nIiAic3RyaW5nX3RvX3NwbGl0OnN0cmluZyIgXQogICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGlzX29iamVjdD8gKG5ldyBGdW5jdGlvbiAieCIgInsgcmV0dXJuIHggaW5zdGFuY2VvZiBPYmplY3QgfSIpCiAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogImZvciB0aGUgZ2l2ZW4gdmFsdWUgeCwgcmV0dXJucyB0cnVlIGlmIHggaXMgYW4gSmF2YXNjcmlwdCBvYmplY3QgdHlwZS4iCiAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnOnZhbHVlIl0KICAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbInR5cGUiICJjb25kaXRpb24iICJzdWJ0eXBlIiAidmFsdWUiICJ3aGF0IiBdCiAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGlzX2FycmF5PyAobmV3IEZ1bmN0aW9uICJ4IiAieyByZXR1cm4geCBpbnN0YW5jZW9mIEFycmF5IH0iKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiZm9yIHRoZSBnaXZlbiB2YWx1ZSB4LCByZXR1cm5zIHRydWUgaWYgeCBpcyBhbiBhcnJheS4iCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJ0eXBlIiAiY29uZGl0aW9uIiAic3VidHlwZSIgInZhbHVlIiAid2hhdCIgXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGlzX251bWJlcj8gKGZ1bmN0aW9uICh4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD09IChzdWJ0eXBlIHgpICJOdW1iZXIiKSkKICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiZm9yIHRoZSBnaXZlbiB2YWx1ZSB4LCByZXR1cm5zIHRydWUgaWYgeCBpcyBhIG51bWJlci4iCiAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnOnZhbHVlIl0KICAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbInR5cGUiICJjb25kaXRpb24iICJzdWJ0eXBlIiAidmFsdWUiICJ3aGF0IiAiZnVuY3Rpb24iXQogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChpc19mdW5jdGlvbj8gKGZ1bmN0aW9uICh4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW5zdGFuY2VvZiB4IEZ1bmN0aW9uKSkKICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogImZvciB0aGUgZ2l2ZW4gdmFsdWUgeCwgcmV0dXJucyB0cnVlIGlmIHggaXMgYSBmdW5jdGlvbi4iCiAgICAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJ0eXBlIiAiY29uZGl0aW9uIiAic3VidHlwZSIgInZhbHVlIiAid2hhdCIgImZ1bmN0aW9uIl0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChpc19zZXQ/IChuZXcgRnVuY3Rpb24gIngiICJ7IHJldHVybiB4IGluc3RhbmNlb2YgU2V0IH0iKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJmb3IgdGhlIGdpdmVuIHZhbHVlIHgsIHJldHVybnMgdHJ1ZSBpZiB4IGlzIGEgc2V0LiIKICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsidHlwZSIgImNvbmRpdGlvbiIgInN1YnR5cGUiICJ2YWx1ZSIgIndoYXQiIF0KICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoaXNfZWxlbWVudD8gKG5ldyBGdW5jdGlvbiAieCIgInsgcmV0dXJuIHggaW5zdGFuY2VvZiBFbGVtZW50IH0iKQogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogImZvciB0aGUgZ2l2ZW4gdmFsdWUgeCwgcmV0dXJucyB0cnVlIGlmIHggaXMgYW4gRWxlbWVudCBvYmplY3QiCiAgICAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImFyZzp2YWx1ZSJdCiAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsidHlwZSIgImNvbmRpdGlvbiIgInN1YnR5cGUiICJ2YWx1ZSIgIndoYXQiIF0KICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGlzX3N0cmluZz8gKGZ1bmN0aW9uICh4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9yIChpbnN0YW5jZW9mIHggU3RyaW5nKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gKHR5cGVvZiB4KSAic3RyaW5nIikpKQogICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJmb3IgdGhlIGdpdmVuIHZhbHVlIHgsIHJldHVybnMgdHJ1ZSBpZiB4IGlzIGEgU3RyaW5nIG9iamVjdCIKICAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsidHlwZSIgImNvbmRpdGlvbiIgInN1YnR5cGUiICJ2YWx1ZSIgIndoYXQiIF0KICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoaXNfbmlsPyAoZnVuY3Rpb24gKHgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0geCBuaWwpKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJmb3IgdGhlIGdpdmVuIHZhbHVlIHgsIHJldHVybnMgdHJ1ZSBpZiB4IGlzIGV4YWN0bHkgZXF1YWwgdG8gbmlsLiIKICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsidHlwZSIgImNvbmRpdGlvbiIgInN1YnR5cGUiICJ2YWx1ZSIgIndoYXQiIF0KICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoaXNfcmVnZXg/IChmdW5jdGlvbiAoeCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD09IChzdWJfdHlwZSB4KSAiUmVnRXhwIikpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJmb3IgdGhlIGdpdmVuIHZhbHVlIHgsIHJldHVybnMgdHJ1ZSBpZiB4IGlzIGEgSmF2YXNjcmlwdCByZWdleCBvYmplY3QiCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJhcmc6dmFsdWUiXQogICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJ0eXBlIiAiY29uZGl0aW9uIiAic3VidHlwZSIgInZhbHVlIiAid2hhdCIgXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGlzX2RhdGU/IChmdW5jdGlvbiAoeCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gKHN1Yl90eXBlIHgpICJEYXRlIikpCiAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiZm9yIHRoZSBnaXZlbiB2YWx1ZSB4LCByZXR1cm5zIHRydWUgaWYgeCBpcyBhIERhdGUgb2JqZWN0LiIKICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnOnZhbHVlIl0KICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJ0eXBlIiAiY29uZGl0aW9uIiAic3VidHlwZSIgInZhbHVlIiAid2hhdCIgXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoZW5kc193aXRoPyAobmV3IEZ1bmN0aW9uICJ2YWwiICJ0ZXh0IiAieyBpZiAodGV4dCBpbnN0YW5jZW9mIEFycmF5KSB7IHJldHVybiB0ZXh0W3RleHQubGVuZ3RoLTFdPT09dmFsIH0gZWxzZSBpZiAoc3VidHlwZSh0ZXh0KT09J1N0cmluZycpIHsgcmV0dXJuIHRleHQuZW5kc1dpdGgodmFsKSB9IGVsc2UgeyByZXR1cm4gZmFsc2UgfX0iKQogICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJmb3IgYSBnaXZlbiBzdHJpbmcgb3IgYXJyYXksIGNoZWNrcyB0byBzZWUgaWYgaXQgZW5kcyB3aXRoIHRoZSBnaXZlbiBzdGFydF92YWx1ZS4gIE5vbiBzdHJpbmcgYXJncyByZXR1cm4gZmFsc2UuIgogICAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImVuZF92YWx1ZTp2YWx1ZSIgImNvbGxlY3Rpb246YXJyYXl8c3RyaW5nIiBdCiAgICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJzdHJpbmciICJ0ZXh0IiAibGlzdCIgImFycmF5IiAiZmlsdGVyIiAicmVkdWNlIl0KICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIChzdGFydHNfd2l0aD8gKG5ldyBGdW5jdGlvbiAidmFsIiAidGV4dCIgInsgaWYgKHRleHQgaW5zdGFuY2VvZiBBcnJheSkgeyByZXR1cm4gdGV4dFswXT09PXZhbCB9IGVsc2UgaWYgKHN1YnR5cGUodGV4dCk9PSdTdHJpbmcnKSB7IHJldHVybiB0ZXh0LnN0YXJ0c1dpdGgodmFsKSB9IGVsc2UgeyByZXR1cm4gZmFsc2UgfX0iKQogICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogImZvciBhIGdpdmVuIHN0cmluZyBvciBhcnJheSwgY2hlY2tzIHRvIHNlZSBpZiBpdCBzdGFydHMgd2l0aCB0aGUgZ2l2ZW4gc3RhcnRfdmFsdWUuICBOb24gc3RyaW5nIGFyZ3MgcmV0dXJuIGZhbHNlLiIKICAgICAgICAgICAgICAgICAgICAgICAgInVzYWdlIjogWyJzdGFydF92YWx1ZTp2YWx1ZSIgImNvbGxlY3Rpb246YXJyYXl8c3RyaW5nIiBdCiAgICAgICAgICAgICAgICAgICAgICAgICJ0YWdzIjogWyJzdHJpbmciICJ0ZXh0IiAibGlzdCIgImFycmF5IiAiZmlsdGVyIiAicmVkdWNlIiAiYmVnaW4iXQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAoZGVsZXRlX3Byb3AgKG5ldyBGdW5jdGlvbiAib2JqIiAiLi4uYXJncyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgInsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZSBvYmpbYXJnc1swXV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhcmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb3AgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbcHJvcF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSIpCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiUmVtb3ZlcyB0aGUga2V5IG9yIGtleXMgb2YgdGhlIHByb3ZpZGVkIG9iamVjdCwgYW5kIHJldHVybnMgdGhlIG1vZGlmaWVkIG9iamVjdC48YnI+RXhhbXBsZTo8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihkZWZnbG9iYWwgZm9vIHsgYWJjOiAxMjMgZGVmOiA0NTYgZ2hpOiA3ODkgfSk8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihkZWxldGVfcHJvcCBmb28gYGFiYyBgZGVmKSA9PiB7IGdoaTogNzg5IH08YnI+IikKICAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsib2JqOm9iamVjdHMiICJrZXkwOnN0cmluZyIgImtleU4/OnN0cmluZyJdCiAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGRlbGV0ZSBga2V5cyBgb2JqZWN0IGByZW1vdmUgYHJlbW92ZV9wcm9wIGBtdXRhdGUgXQogICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIChibGFuaz8gKGZ1bmN0aW9uICh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChvciAoZXEgdmFsIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgKGlzX3N0cmluZz8gdmFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gdmFsICIiKSkpKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYSB2YWx1ZSwgaWYgaXQgaXMgZXF1YWwgKHZpYSBlcSkgdG8gbmlsIG9yIHRvIFwiXCIgKGFuIGVtcHR5IHN0cmluZyksIHJldHVybnMgdHJ1ZSwgb3RoZXJ3aXNlIGZhbHNlLiIKICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInZhbDoqIl0KICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsic3RyaW5nIiAiZW1wdHkiICJ0ZXh0IiBdCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAKICAgICAgICAgKGNvbnRhaW5zPyAobmV3IEZ1bmN0aW9uICJ2YWx1ZSIgImNvbnRhaW5lciIKICAgICAgICAgICAgICAgICAgICAgICAgICJ7IGlmICghdmFsdWUgJiYgIWNvbnRhaW5lcikgeyByZXR1cm4gZmFsc2UgfQogICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb250YWluZXIgPT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcImNvbnRhaW5zPzogcGFzc2VkIG5pbC91bmRlZmluZWQgY29udGFpbmVyIHZhbHVlXCIpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnRhaW5lciBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gY29udGFpbmVyLmluY2x1ZGVzKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGFpbmVyIGluc3RhbmNlb2YgU2V0KSByZXR1cm4gY29udGFpbmVyLmhhcyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChjb250YWluZXIgaW5zdGFuY2VvZiBTdHJpbmcpIHx8IHR5cGVvZiBjb250YWluZXIgPT09IFwic3RyaW5nXCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VidHlwZSh2YWx1ZSkgPT09IFwiTnVtYmVyXCIpIHJldHVybiBjb250YWluZXIuaW5kZXhPZihcIlwiK3ZhbHVlKT4tMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBjb250YWluZXIuaW5kZXhPZih2YWx1ZSk+LTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiY29udGFpbnM/OiBwYXNzZWQgaW52YWxpZCBjb250YWluZXIgdHlwZTogXCIrc3VidHlwZShjb250YWluZXIpKSB9IikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkdpdmVuIGEgdGFyZ2V0IHZhbHVlIGFuZCBjb250YWluZXIgdmFsdWUgKGFycmF5LCBzZXQsIG9yIHN0cmluZyksIGNoZWNrcyBpZiB0aGUgY29udGFpbmVyIGhhcyB0aGUgdmFsdWUuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiSWYgaXQgaXMgZm91bmQsIHRydWUgaXMgcmV0dXJuZWQsIG90aGVyd2lzZSBmYWxzZSBpZiByZXR1cm5lZC4gICIpCiAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbInN0cmluZyIgImFycmF5IiAic2V0IiAiaGFzIiAiaW5jbHVkZXMiICJpbmRleE9mIiBdCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJ2YWx1ZToqIiAiY29udGFpbmVyOmFycmF5fHNldHxzdHJpbmciXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKG1ha2Vfc2V0IChmdW5jdGlvbiAodmFscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKGluc3RhbmNlb2YgdmFscyBBcnJheSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgU2V0IHZhbHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobGV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChgdnR5cGUgKHN1Yl90eXBlIHZhbHMpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gdnR5cGUgIlNldCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5ldyBTZXQgdmFscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gdnR5cGUgIm9iamVjdCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5ldyBTZXQgKHZhbHVlcyB2YWxzKSkpKSkpCiAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiSWYgZ2l2ZW4gYW4gYXJyYXksIGEgbmV3IFNldCBpcyByZXR1cm5lZCBjb250YWluaW5nIHRoZSBlbGVtZW50cyBvZiB0aGUgYXJyYXkuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJZiBnaXZlbiBhbiBvYmplY3QsIGEgbmV3IFNldCBpcyByZXR1cm5lZCBjb250YWluaW5nIHRoZSB2YWx1ZXMgb2YgdGhlIG9iamVjdCwgYW5kIHRoZSBrZXlzIGFyZSBkaXNjYXJkZWQuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJZiBnaXZlbiBhIHNldCwgbmV3IFNldCBpcyBjcmVhdGVkIGFuZCByZXR1cmVuZCAgZnJvbSB0aGUgdmFsdWVzIG9mIHRoZSBvbGQgc2V0LiIpICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsidmFsczphcnJheXxvYmplY3R8c2V0Il0KICAgICAgICAgICAgICAgICAgICBgdGFnczogW2BhcnJheSBgc2V0IGBvYmplY3QgYHZhbHVlcyBgY29udmVydCBdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgIAogICAgICAgICAobWV0YV9mb3Jfc3ltYm9sIChmbiAocXVvdGVkX3N5bWJvbCBzZWFyY2hfbW9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3aGVuIChpc19zdHJpbmc/IHF1b3RlZF9zeW1ib2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDs7IGlmIHdlIGhhdmUgYmVlbiBnaXZlbiBhIHN0cmluZywgZ2V0IGFueSBsb2NhbCBkYXRhIHdlIGhhdmUgaW4gb3VyIGdsb2JhbCBjb250ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkZWZ2YXIgbG9jYWxfZGF0YSAocHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlIHF1b3RlZF9zeW1ib2wpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmdmFyIGFjYyBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIHNlYXJjaF9tb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiBsb2NhbF9kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwdXNoIGFjYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKyB7IGBuYW1lc3BhY2U6IG5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYG5hbWU6IHF1b3RlZF9zeW1ib2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB0eXBlOiAoc3VidHlwZSBsb2NhbF9kYXRhKSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDs7IGluY2x1ZGUgYW55IHN5bWJvbHMgd2UgbmVlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYWlmIChwcm9wIEVudmlyb25tZW50LmRlZmluaXRpb25zIHF1b3RlZF9zeW1ib2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3aGVuIHBhcmVudF9lbnZpcm9ubWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVkdWNlIChpbmZvICgtPiAoLT4gcGFyZW50X2Vudmlyb25tZW50IGBtZXRhX2Zvcl9zeW1ib2wgcXVvdGVkX3N5bWJvbCB0cnVlKSBgZmxhdCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwdXNoIGFjYyBpbmZvKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiAoPiAobGVuZ3RoIChrZXlzIGNoaWxkcmVuKSkgMCkgIDs7IHdlIGRvbid0IGhhdmUgYSBwYXJlbnQsIGJ1dCB3ZSBoYXZlIGNoaWxkcmVuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlZHVjZSAoYGRldGFpbHMgKHJlZHVjZSAoYGNoaWxkX2RhdGEgKHBhaXJzIGNoaWxkcmVuKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiAobm90ICg9PSBjaGlsZF9kYXRhLjAgKGN1cnJlbnRfbmFtZXNwYWNlKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gY2hpbGRfZGF0YS4xIGBtZXRhX2Zvcl9zeW1ib2wgcXVvdGVkX3N5bWJvbCkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHVzaCBhY2MgZGV0YWlscykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gcXVvdGVkX3N5bWJvbCAoaWYgKHN0YXJ0c193aXRoPyAocXVvdGUgIj06IikgcXVvdGVkX3N5bWJvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gcXVvdGVkX3N5bWJvbCBgc3Vic3RyIDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGVkX3N5bWJvbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYWlmIChwcm9wIEVudmlyb25tZW50LmRlZmluaXRpb25zIHF1b3RlZF9zeW1ib2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgrIHsgYG5hbWVzcGFjZTogbmFtZXNwYWNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHR5cGU6IChzdWJfdHlwZSBsb2NhbF9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBuYW1lOiBxdW90ZWRfc3ltYm9sIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5pbCkpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhIHF1b3RlZCBzeW1ib2wgYW5kIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgb3Igbm90IGFsbCBuYW1lc3BhY2VzIHNob3VsZCBiZSBzZWFyY2hlZCwgcmV0dXJucyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRoZSBtZXRhIGRhdGEgYXNzb2NpYXRlZCB3aXRoIHRoZSBzeW1ib2wgZm9yIGVhY2ggZW52aXJvbm1lbnQuICBJZiBzZWFyY2ggbW9kZSBpcyByZXF1ZXN0ZWQsIHRoZSB2YWx1ZSByZXR1cm5lZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzIGFuIGFycmF5LCBzaW5jZSB0aGVyZSBjYW4gYmUgc3ltYm9scyB3aXRoIHRoZSBzYW1lIG5hbWUgaW4gZGlmZmVyZW50IGVudmlyb25tZW50cy4gSWYgbm8gdmFsdWVzIGFyZSBmb3VuZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkLiAgSWYgbm90IGluIHNlYXJjaCBtb2RlLCBtZXRhX2Zvcl9zeW1ib2wgc2VhcmNoZXMgdGhlIGN1cnJlbnQgbmFtZXNwYWNlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAib25seSwgYW5kIGlmIGEgbWF0Y2hpbmcgc3ltYm9sIGlzIGZvdW5kLCByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGFsbCBmb3VuZCBtZXRhZGF0YSwgb3RoZXJ3aXNlIG5pbCBpcyByZXR1cm5lZC4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsicXVvdGVkX3N5bWJvbDpzdHJpbmciICJzZWFyY2hfbW9kZTpib29sZWFuIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFtgZGVzY3JpYmUgYG1ldGEgYGhlbHAgYGRlZmluaXRpb24gYHN5bWJvbCBgbWV0YWRhdGEgXQogICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgCiAgICAgICAoZGVzY3JpYmUgKGZuIChxdW90ZWRfc3ltYm9sIHNlYXJjaF9tb2RlKQogICAgICAgICAgICAgICAgICAgKHByb2duCiAgICAgICAgICAgICAgICAgICAgKGRlZnZhciBpbnRlcm5hbF9yZXN1bHRzIChtZXRhX2Zvcl9zeW1ib2wgcXVvdGVkX3N5bWJvbCB0cnVlKSkKICAgICAgICAgICAgICAgICAgICAoaWYgKGFuZCAoaXNfYXJyYXk/IGludGVybmFsX3Jlc3VsdHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWxfcmVzdWx0cy4wKSAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgIChpZiBzZWFyY2hfbW9kZQogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbF9yZXN1bHRzICAgICAgICAgIDs7IGlmIHdlIGZvdW5kIHNvbWV0aGluZyBpbnRlcm5hbCwgcmV0dXJuIGFsbCByZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgIChmaXJzdCBpbnRlcm5hbF9yZXN1bHRzKSkgOzsgd2UgYXJlIGludGVyZXN0ZWQgaW4gdGhlIGZpcnN0IHJlc3VsdCBvbmx1CiAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgKGRlZnZhciBleHRlcm5hbF9yZXN1bHRzIChnZXRfb3V0c2lkZV9nbG9iYWwgcXVvdGVkX3N5bWJvbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIChpZiBleHRlcm5hbF9yZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICBgbG9jYXRpb246ICJleHRlcm5hbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgYHR5cGU6IChzdWJ0eXBlIGV4dGVybmFsX3Jlc3VsdHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBuaWwpKSkpKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYSBxdW90ZWQgc3ltYm9sIHJldHVybnMgdGhlIHJlbGV2YW50IG1ldGFkYXRhIHBlcnRpbmVudCB0byB0aGUgY3VycmVudCBuYW1lc3BhY2UgY29udGV4dC4iCiAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJxdW90ZWRfc3ltYm9sOnN0cmluZyIgInNlYXJjaF9tb2RlOmJvb2xlYW4iXQogICAgICAgICAgICAgICAgICBgdGFnczogWyBgbWV0YSBgaGVscCBgZGVmaW5pdGlvbiBgc3ltYm9sIGBtZXRhZGF0YSBgaW5mbyBgbWV0YV9mb3Jfc3ltYm9sIF0KICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgKHVuZGVmaW5lIChmdW5jdGlvbiAocXVvdGVkX3N5bWJvbCkKCQkJICAgICAoaWYgKGlzX3N0cmluZz8gcXVvdGVkX3N5bWJvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKGBuYW1lc3BhY2VfaWRlbnRpdHkgKHNwbGl0X2J5ICIvIiBxdW90ZWRfc3ltYm9sKSkgICA7OyAgc3BsaXQuLm5hbWVzcGFjZV9pZGVudGl0eSBtYXkgb25seSBoYXZlIDEgY29tcG9uZW50IHRob3VnaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYHBhcmVudF9jYWxsIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBjaGlsZF9jYWxsIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGB0YXJnZXRfc3ltYm9sIG5pbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkZWNsYXJlIChmdW5jdGlvbiBwYXJlbnRfY2FsbCkpCgkJCSAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9yIChhbmQgKD09IG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGggMSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZSBuYW1lc3BhY2VfaWRlbnRpdHkuMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgKD4gbmFtZXNwYWNlX2lkZW50aXR5Lmxlbmd0aCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBuYW1lc3BhY2VfaWRlbnRpdHkuMCBuYW1lc3BhY2UpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBpdCdzIG5vdCBxdWFsaWZpZWQgYW5kIGluIG91ciBsb2NhbCBlbnZpcm9ubWVudAoJCQkJICAgKHByb2duCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IHRhcmdldF9zeW1ib2wgKGlmICg+IG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGggMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZV9pZGVudGl0eS4xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VfaWRlbnRpdHkuMCkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVsZXRlX3Byb3AgRW52aXJvbm1lbnQuZGVmaW5pdGlvbnMgdGFyZ2V0X3N5bWJvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgdGFyZ2V0X3N5bWJvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVsZXRlX3Byb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZSB0YXJnZXRfc3ltYm9sKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCAoPiBuYW1lc3BhY2VfaWRlbnRpdHkubGVuZ3RoIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfZW52aXJvbm1lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb2duCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRxIHBhcmVudF9jYWxsICgtPiBwYXJlbnRfZW52aXJvbm1lbnQgYGdldF9nbG9iYWwgInVuZGVmaW5lIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYXJlbnRfY2FsbCBxdW90ZWRfc3ltYm9sKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCAoPiBuYW1lc3BhY2VfaWRlbnRpdHkubGVuZ3RoIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHJvcCBjaGlsZHJlbiBuYW1lc3BhY2VfaWRlbnRpdHkuMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgY2hpbGQgbmFtZXNwYWNlLCBzZW5kIGl0IHRoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb2duCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRxIGNoaWxkX2NhbGwgKC0+IChwcm9wIGNoaWxkcmVuIG5hbWVzcGFjZV9pZGVudGl0eS4wKSBgZ2V0X2dsb2JhbCAidW5kZWZpbmUiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNoaWxkX2NhbGwgcXVvdGVkX3N5bWJvbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKCQkJCSAgIGZhbHNlKSkKCQkJICAgICAgICh0aHJvdyBTeW50YXhFcnJvciAidW5kZWZpbmUgcmVxdWlyZXMgYSBxdW90ZWQgc3ltYm9sIikpKQogICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkdpdmVuIGEgcXVvdGVkIHN5bWJvbCByZW1vdmVzIHRoZSBzeW1ib2wgYW5kIGFueSBkZWZpbml0aW9uIGluZm9ybWF0aW9uIGZyb20gdGhlIG5hbWVzcGFjZS4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIklmIHRoZSBuYW1lc3BhY2UgaXMgZnVsbHktcXVhbGlmaWVkLCB0aGVuIHRoZSBzeW1ib2wgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIHNwZWNpZmllZCBuYW1lc3BhY2UgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImluc3RlYWQgb2YgdGhlIGN1cnJlbnRseSBhY3RpdmUgbmFtZXNwYWNlLiBJZiB0aGUgc3ltYm9sIGlzIHN1Y2Nlc3NmdWxseSByZW1vdmVkLCB0aGUgZnVuY3Rpb24gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIndpbGwgcmV0dXJuIHRydWUsIG90aGVyd2lzZSBpZiBpdCBpcyBub3QgZm91bmQsIGZhbHNlIHdpbGwgYmUgcmV0dXJuZWQuICBOb3RlIHRoYXQgaWYgdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzcGVjaWZpZWQgc3ltYm9sIGlzIG5vbi1xdWFsaWZpZWQsIGJ1dCBleGlzdHMgaW4gYSBkaWZmZXJlbnQsIGFjY2Vzc2libGUgbmFtZXNwYWNlLCBidXQgdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzeW1ib2wgaXNuJ3QgcHJlc2VudCBpbiB0aGUgY3VycmVudCBuYW1lc3BhY2UsIHRoZSBzeW1ib2wgd2lsbCBub3QgYmUgZGVsZXRlZC4gIFRoZSBlbnZpcm9ubWVudCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXMgbm90IHNlYXJjaGVkIGFuZCB0aGVyZWZvcmUgc3ltYm9scyBoYXZlIHRvIGJlIGV4cGxpY2l0bHkgZnVsbHktcXVhbGlmaWVkIGZvciBhbnkgZWZmZWN0ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvZiB0aGlzIGZ1bmN0aW9uIG91dHNpZGUgdGhlIGN1cnJlbnQgbmFtZXNwYWNlLiIpCiAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInF1b3RlZF9zeW1ib2w6c3RyaW5nIl0KICAgICAgICAgICAgICAgICAgICBgdGFnczogWyBgc3ltYm9sIGBkZWxldGUgYHJlbW92ZSBgdW5pbnRlcm4gYHJlZmVyZW5jZSBgdmFsdWUgXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAoZXZhbF9leHAgKGZuIChleHByZXNzaW9uKQogICAgICAgICAgICAgICAgICAgICAoZG8gCiAgICAgICAgICAgICAgICAgICAgICAgKGV4cHJlc3Npb24pKSkKICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJFdmFsdWF0ZXMgdGhlIGdpdmVuIGV4cHJlc3Npb24gYW5kIHJldHVybnMgdGhlIHZhbHVlLiIpCiAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImV4cHJlc3Npb246KiJdCiAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGV2YWwgYGV2YWx1YXRpb24gYGV4cHJlc3Npb24gXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGluZGlyZWN0X25ldyAobmV3IEZ1bmN0aW9uICIuLi5hcmdzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgInsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRhcmdldENsYXNzID0gYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnR5cGUodGFyZ2V0Q2xhc3MpPT09XCJTdHJpbmdcIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRtcGY9bmV3IEZ1bmN0aW9uKFwieyByZXR1cm4gXCIrdGFyZ2V0Q2xhc3MrXCIgfVwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldENsYXNzID0gdG1wZigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aD09MSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSBmdW5jdGlvbihDbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KENsYXNzLCBhcmdzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcnZhbCA9IGYuYXBwbHkodGhpcyxbdGFyZ2V0Q2xhc3NdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBydmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSBmdW5jdGlvbihDbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KENsYXNzLCBhcmdzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcnZhbCA9IGYuYXBwbHkodGhpcyxbdGFyZ2V0Q2xhc3NdLmNvbmNhdChhcmdzLnNsaWNlKDEpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX0iKQogICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiVXNlZCBieSB0aGUgY29tcGlsZXIgZm9yIGltcGxlbWVudGF0aW9uIG9mIHRoZSBuZXcgb3BlcmF0b3IgYW5kIHNob3VsZG4ndCBiZSBkaXJlY3RseSBjYWxsZWQgYnkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1c2VyIHByb2dyYW1zLiAgVGhlIG5ldyBvcGVyYXRvciBzaG91bGQgYmUgY2FsbGVkIGluc3RlYWQuIikKICAgICAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImFyZzA6KiIgImFyZ3NOOioiXQogICAgICAgICAgICAgICAgICAgICAgICBgdGFnczogWyBgc3lzdGVtIGBjb21waWxlciBgaW50ZXJuYWwgXQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKHJhbmdlIChmdW5jdGlvbiAoYCYgYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAobGV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoYGZyb21fdG8gKGlmIGFyZ3MuMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyAoaW50IGFyZ3MuMCkgKGludCBhcmdzLjEpIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsgMCAoaW50IGFyZ3MuMCkgXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYHN0ZXAgKGlmIGFyZ3MuMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZsb2F0IGFyZ3MuMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBpZHggZnJvbV90by4wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBhY2MgW10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFzc2VydCAoPiBzdGVwIDApICJyYW5nZTogc3RlcCBtdXN0IGJlID4gMCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYXNzZXJ0ICg+PSBmcm9tX3RvLjEgZnJvbV90by4wKSAicmFuZ2U6IGxvd2VyIGJvdW5kIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0aGFuIHVwcGVyIGJvdW5kIikgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hpbGUgKDwgaWR4IGZyb21fdG8uMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHB1c2ggYWNjIGlkeCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW5jIGlkeCBzdGVwKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2MpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIGB1c2FnZTogWyJzdGFydF9vcl9lbmQ6bnVtYmVyIiAiZW5kOm51bWJlciIgInN0ZXA6bnVtYmVyIl0KICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJSYW5nZSBoYXMgYSB2YXJpYWJsZSBmb3JtIGRlcGVuZGluZyBvbiB0aGUgYW1vdW50IG9mIGFyZ3VtZW50cyBwcm92aWRlZCB0byB0aGUgZnVuY3Rpb24gd2hlbiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2FsbGluZyBpdC4gSWYgcHJvdmlkZWQgb25lIGFyZ3VtZW50LCByYW5nZSB3aWxsIHByb2R1Y2UgYW4gYXJyYXkgZnJvbSAwIHVwIHRvLCBidXQgbm90IGluY2x1ZGluZyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGhlIHByb3ZpZGVkIHZhbHVlLiBJZiBnaXZlbiB0d28gYXJndW1lbnRzLCB0aGUgZmlyc3QgYXJndW1lbnQgd2lsbCBiZSB0aGUgc3RhcmdpbmcgdmFsdWUgYW5kICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aGUgbGFzdCB2YWx1ZSB3aWxsIGJlIHVzZWQgYXMgdGhlIHVwcGVyIGJvdW5kaW5nIHZhbHVlLCByZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBlbGVtZW50cyBzdGFydGluZyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXQgdGhlIHN0YXJ0IHZhbHVlIGFuZCB1cCB0bywgYnV0IG5vdCBpbmNsdWRpbmcgdGhlIGJvdW5kaW5nIHZhbHVlLiBJZiBnaXZlbiBhIHRoaXJkIHZhbHVlLCB0aGUgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIHdpbGwgYmUgaW50ZXJwcmV0ZWQgYXMgdGhlIHN0ZXAgdmFsdWUsIGFuZCB0aGUgcmV0dXJuZWQgYXJyYXkgd2lsbCBjb250YWluIHZhbHVlcyB0aGF0ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbmNyZW1lbnQgYnkgdGhlIHN0ZXAgYW1vdW50LiAgUmFuZ2Ugd2lsbCB0aHJvdyBhbiBlcnJvciBpZiBhIG5lZ2F0aXZlIHJhbmdlIGlzIHNwZWNpZmllZC4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkZvciBuZWdhdGl2ZSByYW5nZXMgc2VlIG5lZ19yYW5nZS4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiPGJyPjxicj5FeGFtcGxlczo8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihyYW5nZSA1KSAtPiBbIDAgMSAyIDMgNCBdPGJyPiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIocmFuZ2UgMTAgMTUpIC0+IFsgMTAgMTEgMTIgMTMgMTQgXTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKHJhbmdlIDEwIDIwKSAtPiBbIDEwIDEyIDE0IDE2IDE4IF08YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihyYW5nZSAtNSAwKSAtPiBbIC01IC00IC0zIC0yIC0xIF08YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihyYW5nZSAtMyAzKSAtPiBbIC0zLCAtMiwgLTEsIDAsIDEsIDIgXTxicj4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIAogICAgICAgICAoYWRkIChuZXcgRnVuY3Rpb24gIi4uLmFyZ3MiCiAgICAgICAgICAgICAgICAgICAiewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhY2M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdPT09XCJudW1iZXJcIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXJnc1swXSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmdzWzBdLmNvbmNhdChhcmdzLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdPT09J29iamVjdCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcnZhbCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4gYXJncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdzW2ldID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGsgaW4gYXJnc1tpXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydmFsW2tdID0gYXJnc1tpXVtrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBydmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjYyA9IFwiXCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4gYXJncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2MgKz0gYXJnc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IikKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkFkZCBpcyBhbiBvdmVybG9hZGVkIGZ1bmN0aW9uIHRoYXQsIGJhc2VkIG9uIHRoZSBmaXJzdCBhcmd1bWVudCBwcm92aWRlZCwgZGV0ZXJtaW5lcyBob3cgdG8gXCdhZGRcJyB0aGUgYXJndW1lbnRzLiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIklmIHByb3ZpZGVkIGEgbnVtYmVyIGFzIGEgZmlyc3QgYXJndW1lbnQsIHRoZW4gaXQgd2lsbCBhc3N1bWUgdGhlIHJlc3Qgb2YgdGhlIGFyZ3VtZW50cyBhcmUgbnVtYmVycyBhbmQgYWRkIHRoZW0gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0byB0aGUgZmlyc3QsIHJldHVybmluZyB0aGUgbnVtZXJpY2FsIHN1bSBvZiB0aGUgYXJndW1lbnRzLiBJZiBhbiBvYmplY3QsIGl0IHdpbGwgbWVyZ2UgdGhlIGtleXMgb2YgdGhlIHByb3ZpZGVkICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzLCByZXR1cm5pbmcgYSBjb21iaW5lZCBvYmplY3QuICBCZSBhd2FyZSB0aGF0IGlmIG1lcmdpbmcgb2JqZWN0cywgaWYgYXJndW1lbnRzIHRoYXQgaGF2ZSB0aGUgc2FtZSBrZXlzICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGhlIGFyZ3VtZW50IHdobyBhcHBlYXJzIGxhc3Qgd2l0aCB0aGUga2V5IHdpbGwgcHJldmFpbC4gIElmIGNhbGxlZCB3aXRoIGFuIGFycmF5IGFzIGEgZmlyc3QgYXJndW1lbnQsIHRoZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInN1YnNlcXVlbnQgYXJndW1lbnRzIHdpbGwgYmUgYWRkZWQgdG8gdGhlIGZpcnN0IHZpYSAnY29uY2F0Jy4gIElmIHN0cmluZ3MsIHRoZSBzdHJpbmdzIHdpbGwgYmUgam9pbmVkIGludG8gYSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNpbmdsZSBzdHJpbmcgYW5kIHJldHVybmVkLjxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihhZGQgMSAyIDMpID0+IDY8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoYWRkIHsgYGFiYzogMTIzIGBkZWY6IDM0NSB9IHsgYGRlZjogNDU2IH0pID0+IHsgYWJjOiAxMjMsIGRlZjogNDU2IH0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihhZGQgWyAxIDIgMyBdIFsgNCA1IDZdIDcpID0+IFsgMSwgMiwgMywgWyA0LCA1LCA2IF0sIDcgXTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihhZGQgXCJhYmNcIiBcImRlZlwiKSA9PiBcImFiY2RlZlwiPGJyPjxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk5vdGUgdGhhdCBhZGQgZG9lc24ndCB0eXBpY2FsbHkgbmVlZCB0byBleHBsaWNpbHkgY2FsbGVkLiAgVGhlIGNvbXBpbGVyIHdpbGwgdHJ5IGFuZCBkZXRlcm1pbmUgdGhlIGJlc3QgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ3YXkgdG8gaGFuZGxlIGFkZGluZyBiYXNlZCBvbiB0aGUgYXJndW1lbnRzIHRvIGJlIGFkZGVkLCBzbyB0aGUgKyBvcGVyYXRvciBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkLCBzaW5jZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIml0IGdpdmVzIHRoZSBjb21waWxlciBhbiBvcHBvcnR1bml0eSB0byBpbmxpbmUgaWYgcG9zc2libGUuIikKICAgICAgICAgICAgICAgYHVzYWdlOiBbICJhcmcwOioiICJhcmdOOioiIF0KICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGFkZCBgKyBgc3VtIGBudW1iZXIgYGFkZGl0aW9uIGBtZXJnZSBgam9pbiBgY29uY2F0IF0KICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChtZXJnZV9vYmplY3RzIChuZXcgRnVuY3Rpb24gIngiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJ2YWwgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSBpbiB4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgayBpbiB4W2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ2YWxba10gPSB4W2ldW2tdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIk1lcmdlIG9iamVjdHMgdGFrZXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBhbmQgcmV0dXJucyBhbiBvYmplY3Qgd2hvc2Uga2V5cyBhbmQgdmFsdWVzIGFyZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aGUgc3VtIG9mIHRoZSBwcm92aWRlZCBvYmplY3RzIChzYW1lIGJlaGF2aW9yIGFzIGFkZCB3aXRoIG9iamVjdHMpLiAgSWYgb2JqZWN0cyBoYXZlIHRoZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzYW1lIGtleXMsIHRoZSBsYXN0IGVsZW1lbnQgaW4gdGhlIGFycmF5IHdpdGggdGhlIGR1cGxpY2F0ZSBrZXkgd2lsbCBiZSB1c2VkIHRvIHByb3ZpZGUgdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIGZvciB0aGF0IGtleS4iKQogICAgICAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbIm9iamVjdHM6YXJyYXkiXQogICAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGFkZCBgbWVyZ2UgYGtleXMgYHZhbHVlcyBgb2JqZWN0cyBgdmFsdWUgXQogICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChpbmRleF9vZiAobmV3IEZ1bmN0aW9uICJ2YWx1ZSIgImNvbnRhaW5lciIKICAgICAgICAgICAgICAgICAgICAgICAgKCsgInsgcmV0dXJuIGNvbnRhaW5lci5pbmRleE9mKHZhbHVlKSB9IikpCiAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiR2l2ZW4gYSB2YWx1ZSBhbmQgYW4gYXJyYXkgY29udGFpbmVyLCByZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5LCBvciAtMSBpZiBub3QgZm91bmQuIgogICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJ2YWx1ZTpudW1iZXJ8c3RyaW5nfGJvb2xlYW4iICJjb250YWluZXI6YXJyYXkiIF0KICAgICAgICAgICAgICAgICAgICBgdGFnczogWyBgZmluZCBgcG9zaXRpb24gYGluZGV4IGBhcnJheSBgY29udGFpbnMgXQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAKICAgICAgICAgKHJlc29sdmVfcGF0aCAobmV3IEZ1bmN0aW9uICJwYXRoLG9iaiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXRoPT09J3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zcGxpdChcIi5cIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcz1vYmo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF0aC5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgY3VycikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmV2ID8gcHJldltjdXJyXSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgb2JqIHx8IHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IikKICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIkdpdmVuIGEgcGF0aCBhbmQgYSB0cmVlIHN0cnVjdHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBhbiBhcnJheSBvciBhbiBvYmplY3QsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHJhdmVyc2UgdGhlIHRyZWUgc3RydWN0dXJlIGFuZCByZXR1cm4gdGhlIHZhbHVlIGF0IHRoZSBwYXRoIGlmIGl0IGV4aXN0cywgb3RoZXJ3aXNlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5kZWZpbmVkIGlzIHJldHVybmVkLjxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIihyZXNvbHZlX3BhdGggWyAyIDEgXSBbIDEgMiBbIDMgNCA1IF0gNiA3XSkgPT4gNCkiKQogICAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsgInBhdGg6YXJyYXkiICJ0cmVlX3N0cnVjdHVyZTphcnJheXxvYmplY3QiIF0KICAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFsgYGZpbmQgYHBvc2l0aW9uIGBpbmRleCBgcGF0aCBgYXJyYXkgYHRyZWUgYGNvbnRhaW5zIGBzZXRfcGF0aCBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIAogICAgICAgICAKICAgICAgICAgCiAgICAgICAgIChtaW5fdmFsdWUgKG5ldyBGdW5jdGlvbiAiZWxlbWVudHMiICJ7IHJldHVybiBNYXRoLm1pbiguLi5lbGVtZW50cyk7IH0iKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiUmV0dXJucyB0aGUgbWluaW11bSB2YWx1ZSBpbiB0aGUgcHJvdmlkZWQgYXJyYXkgb2YgbnVtYmVycy4iCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJlbGVtZW50czphcnJheSJdCiAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbIGBtaW4gYG1heF92YWx1ZSBgYXJyYXkgYGVsZW1lbnRzIGBtaW5pbXVtIGBudW1iZXIgXQogICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIChtYXhfdmFsdWUgKG5ldyBGdW5jdGlvbiAiZWxlbWVudHMiICJ7IHJldHVybiBNYXRoLm1heCguLi5lbGVtZW50cyk7IH0iKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiUmV0dXJucyB0aGUgbWF4aW11bSB2YWx1ZSBpbiB0aGUgcHJvdmlkZWQgYXJyYXkgb2YgbnVtYmVycy4iCiAgICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJlbGVtZW50czphcnJheSJdCiAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbIGBtaW4gYG1heF92YWx1ZSBgYXJyYXkgYGVsZW1lbnRzIGBtaW5pbXVtIGBudW1iZXIgXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgCiAgICAgICAgIChpbnRlcmxhY2UgKGZuIChgJiBhcmdzKQogICAgICAgICAgICAgICAgICAgICAgKGxldCAKICAgICAgICAgICAgICAgICAgICAgICAgICAoKG1pbl9sZW5ndGggIChtaW5fdmFsdWUgKG1hcCBsZW5ndGggYXJncykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAocmxlbmd0aF9hcmdzIChyYW5nZSAobGVuZ3RoIGFyZ3MpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJ2YWwgW10pKQogICAgICAgICAgICAgICAgICAgICAgICAoZm9yX2VhY2ggKGBpIChyYW5nZSBtaW5fbGVuZ3RoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmb3JfZWFjaCAoYGogcmxlbmd0aF9hcmdzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwdXNoIHJ2YWwgKHByb3AgKHByb3AgYXJncyBqKSBpKSkpKQogICAgICAgICAgICAgICAgICAgICAgICBydmFsKSkKICAgICAgICAgICAgICAgICAgICB7IGB1c2FnZTogWyJsaXN0MDphcnJheSIgImxpc3QxOmFycmF5IiAibGlzdG4/OmFycmF5Il0gCiAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIlJldHVybnMgYSBsaXN0IGNvbnRhaW5pbmcgYSBjb25zZWN1dGl2ZSB2YWx1ZXMgZnJvbSBlYWNoIGxpc3QsIGluIGFyZ3VtZW50IG9yZGVyLiAgSS5lLiBsaXN0MC4wIGxpc3QxLjAgbGlzdG4uMCBsaXN0MC4xIGxpc3QxLjEgbGlzdG4uMSAuLi4iIAogICAgICAgICAgICAgICAgICAgICBgdGFnczogWyJsaXN0IiwiYXJyYXkiLCJqb2luIiAibWVyZ2UiXQogICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKHRyaW0gKGZ1bmN0aW9uICh4KQogICAgICAgICAgICAgICAgICAgICAgICAgKC0+IHggYHRyaW0pKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJSZW1vdmVzIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNwYWNlcyBmcm9tIHRoZSBwcm92aWRlZCBzdHJpbmcgdmFsdWUuIgogICAgICAgICAgICAgICAgYHVzYWdlOiBbInZhbHVlOnN0cmluZyJdCiAgICAgICAgICAgICAgICBgdGFnczogWyJzdHJpbmciICJzcGFjZXMiICJjbGVhbiIgInNxdWVlemUiICJsZWFkaW5nIiAidHJhaWxpbmciICJzcGFjZSJdCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAKICAgICAgICAgKGFzc2VydCAoZnVuY3Rpb24gKGFzc2VydGlvbl9mb3JtIGZhaWx1cmVfbWVzc2FnZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIGFzc2VydGlvbl9mb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnRpb25fZm9ybQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAob3IgZmFpbHVyZV9tZXNzYWdlICJhc3NlcnRpb24gZmFpbHVyZSIpKSkpCiAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJJZiB0aGUgZXZhbHVhdGVkIGFzc2VydGlvbiBmb3JtIGlzIHRydWUsIHRoZSByZXN1bHQgaXMgcmV0dXJuZWQsIG90aGVyd2lzZSBhbiBFdmFsRXJyb3IgaXMgdGhyb3duIHdpdGggdGhlIG9wdGlvbmFsbHkgcHJvdmlkZWQgZmFpbHVyZSBtZXNzYWdlLiIKICAgICAgICAgICAgICAgICAgYHVzYWdlOlsiZm9ybToqIiAiZmFpbHVyZV9tZXNzYWdlOnN0cmluZz8iXQogICAgICAgICAgICAgICAgICBgdGFnczpbInRydWUiICJlcnJvciIgImNoZWNrIiAiZGVidWciICJ2YWxpZCIgImFzc2VydGlvbiJdCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIAogICAgICAgICAKICAgICAgICAgKHVucXVvdGlmeSAoZm4gKHZhbCkKICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAoKGR2YWwgdmFsKSkKICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChzdGFydHNfd2l0aD8gIlwiIiBkdmFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICg9IGR2YWwgKC0+IGR2YWwgYHN1YnN0ciAxICgtIGR2YWwubGVuZ3RoIDIpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIChpZiAoc3RhcnRzX3dpdGg/ICI9OiIgZHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAoPSBkdmFsICgtPiBkdmFsIGBzdWJzdHIgMikpKQogICAgICAgICAgICAgICAgICAgICAgICBkdmFsKSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogIlJlbW92ZXMgYmluZGluZyBzeW1ib2xzIGFuZCBxdW90ZXMgZnJvbSBhIHN1cHBsaWVkIHZhbHVlLiAgRm9yIHVzZSBpbiBjb21waWxlIHRpbWUgZnVuY3Rpb24gc3VjaCBhcyBtYWNyb3MuIgogICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsidmFsOnN0cmluZyJdCiAgICAgICAgICAgICAgICAgICAgIGB0YWdzOlsibWFjcm8iICJxdW90ZSIgInF1b3RlcyIgImRlc3ltIl0KICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChvcl9hcmdzIChmbiAoYXJnc2V0KQogICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgKChpc190cnVlIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICAgIChmb3JfZWFjaCAoYGVsZW0gYXJnc2V0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZiBlbGVtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gaXNfdHJ1ZSB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYnJlYWspKSkpCiAgICAgICAgICAgICAgICAgICAgICBpc190cnVlKSkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAiUHJvdmlkZWQgYW4gYXJyYXkgb2YgdmFsdWVzLCByZXR1cm5zIHRydWUgaWYgYW55IG9mIHRoZSB2YWx1ZXMgYXJlIHRydWUsIG90aGVyd2lzZSB3aWxsIHJldHVybiBmYWxzZS4iCiAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsiYXJnc2V0OmFycmF5Il0KICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbICJvciIgInRydWUiICJmYWxzZSIgImFycmF5IiAibG9naWMiIF0KICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAKICAgICAgICAgKHNwZWNpYWxfb3BlcmF0b3JzIChmbiAoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobWFrZV9zZXQgKGNvbXBpbGVyIFtdIHsgYHNwZWNpYWxfb3BlcmF0b3JzOiB0cnVlIGBlbnY6IEVudmlyb25tZW50IH0pKSkpCgogICAgICAgICAoZGVmY2xvZyAoZm4gKG9wdHMpCiAgICAgICAgICAgICAgICAgICAgKGxldAogICAgICAgICAgICAgICAgICAgICAgICAoKGBzdHlsZSAoKyAicGFkZGluZzogNXB4OyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIG9wdHMuYmFja2dyb3VuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgrICJiYWNrZ3JvdW5kOiAiIG9wdHMuYmFja2dyb3VuZCAiOyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZiBvcHRzLmNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCsgImNvbG9yOiAiIG9wdHMuY29sb3IgIjsiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiIpKSkKICAgICAgICAgICAgICAgICAgICAgIChmbiAoYCYgYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgKGFwcGx5IGNvbnNvbGUubG9nICgrICIlYyIgKGlmIG9wdHMucHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0cy5wcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGFrZSBhcmdzKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uaiBbIHN0eWxlIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MpKSkpKQogICAgICAgICAgIHsKICAgICAgICAgICAgYGRlc2NyaXB0aW9uOiAoKyAiR2l2ZW4gYSBkZXNjcmlwdGlvbiBvYmplY3QsIGNvbnRhaW5pbmcgc3BlY2lmaWMga2V5cywgcmV0dXJucyBhIGN1c3RvbWl6ZWQgY29uc29sZSBsb2dnaW5nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZnVuY3Rpb24gaW1wbGVtZW50cyB0aGUgZ2l2ZW4gcmVxdWVzdGVkIHByb3BlcnRpZXMuPGJyPk9wdGlvbnM8YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcmVmaXg6c3RyaW5nOlRoZSBwcmVmaXggdG8gbG9nIHByaW9yIHRvIGFueSBzdXBwbGllZCB1c2VyIGFyZ3VtZW50cy48YnI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb2xvcjpzdHJpbmc6VGhlIHRleHQgY29sb3IgdG8gdXNlIG9uIHRoZSBwcmVmaXggKG9yIGluaXRpYWwgYXJndW1lbnQgaWYgbm8gcHJlZml4KTxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tncm91bmQ6c3RyaW5nOlRoZSBiYWNrZ3JvdW5kIGNvbG9lIHRvIHVzZSBvbiB0aGUgcHJlZml4IChvciBpbml0aWFsIGFyZ3VtZW50IGlmIG5vIHByZWZpeCk8YnI+IikKICAgICAgICAgICAgYHVzYWdlOiBbIm9wdGlvbnM6b2JqZWN0Il0KICAgICAgICAgICAgYHRhZ3M6IFsibG9nIiAibG9nZ2luZyIgImNvbnNvbGUiICJ1dGlsaXR5Il0KICAgICAgICAgICAgfSkKCiAgICAgCiAgICAgICAgIChOT1RfRk9VTkQgKG5ldyBSZWZlcmVuY2VFcnJvciAibm90IGZvdW5kIikpCiAgICAgICAgICAgICAgCiAgICAgICAgIChjaGVja19leHRlcm5hbF9lbnZfZGVmYXVsdCAoaWYgKD09IG5hbWVzcGFjZSAiY29yZSIpIHRydWUgZmFsc2UpKQogICAgICAgICAoKm5hbWVzcGFjZSogbmFtZXNwYWNlKQogICAgICAgICAocGVuZGluZ19uc19sb2FkcyB7fSkKICAgICAgICAgKHBlbmRfbG9hZCAoZm4gKGZyb21fbmFtZXNwYWNlIHRhcmdldF9uYW1lc3BhY2Ugc3ltYm9sIGluaXRpYWxpemVyKQogICAgICAgICAgICAgICAgICAgICAgKHByb2duICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICh3aGVuIChlcSBuaWwgKHByb3AgcGVuZGluZ19uc19sb2FkcyBmcm9tX25hbWVzcGFjZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBwZW5kaW5nX25zX2xvYWRzIGZyb21fbmFtZXNwYWNlIFtdKSkgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAocHVzaCAocHJvcCBwZW5kaW5nX25zX2xvYWRzIGZyb21fbmFtZXNwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBgc3ltYm9sOiBzeW1ib2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHNvdXJjZV9uczogZnJvbV9uYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHRhcmdldF9uczogdGFyZ2V0X25hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW5pdGlhbGl6ZXI6IFsocXVvdGUgcXVvdGUpIGluaXRpYWxpemVyXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkpKQogICAgICAgICAobG9hZF9wZW5kcyAoZm4gKGZyb21fbmFtZXNwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICh3aGVuIChwcm9wIHBlbmRpbmdfbnNfbG9hZHMgZnJvbV9uYW1lc3BhY2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmdmFyIGFjYyBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRxIGFjYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZvcl9lYWNoIChgbG9hZF9pbnN0cnVjdGlvbiAocHJvcCBwZW5kaW5nX25zX2xvYWRzIGZyb21fbmFtZXNwYWNlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKHVzZV9zeW1ib2xzICwjbG9hZF9pbnN0cnVjdGlvbi5zb3VyY2VfbnMgWyAsI2xvYWRfaW5zdHJ1Y3Rpb24uc3ltYm9sIF0gLCNsb2FkX2luc3RydWN0aW9uLnRhcmdldF9ucykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgKGNvbnNvbGUubG9nICJsb2FkX3BlbmRzOiAiIGFjYykKICAgICAgICAgICAgICAgICAgICAgICAgIChldmFsIGFjYykKICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpKSkKICAgICAgICAgKHN5bWJvbHMgKGZuIChvcHRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVxIG5pbCBvcHRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoa2V5cyBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLnVuaXF1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHJvZ24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkZWZ2YXIgbm9faW5jbHVkZXMgKG1ha2Vfc2V0IChjb25qIFsgIm1ldGFfZm9yX3N5bWJvbCIsICJkZXNjcmliZSIsICJ1bmRlZmluZSIsICIqbmFtZXNwYWNlKiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGVuZF9sb2FkIiwgInN5bWJvbHMiLCAic2V0X2dsb2JhbCIsICJnZXRfZ2xvYmFsIiwgInN5bWJvbF9kZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb21waWxlIiwgImVudl9sb2ciLCAiZXZhbHVhdGVfbG9jYWwiLCAiZXZhbHVhdGUiLCAiZXZhbF9zdHJ1Y3QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldF9jb21waWxlciIsICJjbG9uZSIsICJldmFsIiwgImFkZF9lc2NhcGVfZW5jb2RpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImdldF9vdXRzaWRlX2dsb2JhbCIsICJhc19saXNwIiwgImxpc3Bfd3JpdGVyIiwgImNsb25lX3RvX25ldyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2F2ZV9lbnYiLCAibnVsbCIsICJjb21waWxlciIgXSBidWlsdF9pbnMpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZWR1Y2UgKHN5bSAoa2V5cyBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmICgtPiBub19pbmNsdWRlcyBgaGFzIHN5bSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW0pKSkpKQogICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGBkZXNjcmlwdGlvbjogKCsgIlJldHVybnMgYW4gYXJyYXkgb2YgdGhlIGRlZmluZWQgZ2xvYmFsIHN5bWJvbHMgZm9yIHRoZSBsb2NhbCBlbnZpcm9ubWVudC4gICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJZiBvcHRzLnVuaXF1ZSBpcyB0cnVlLCBvbmx5IHN5bWJvbHMgdGhhdCBhcmUgbm90IHBhcnQgb2YgdGhlIGJ1aWx0IGlucyBhcmUgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImluY2x1ZGVkLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICBgdXNhZ2U6IFsib3B0czpvYmplY3QiXQogICAgICAgICAgICAgICAgICAgICAgICAgYHRhZ3M6IFtgc3ltYm9sIGBuYW1lcyBgZGVmaW5pdGlvbnMgYHZhbHVlcyBgc2NvcGVdCiAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgIChzZXRfZ2xvYmFsIAogICAgICAgICAgKGZ1bmN0aW9uIChyZWZuYW1lIHZhbHVlIG1ldGEgaXNfY29uc3RhbnQgdGFyZ2V0X25hbWVzcGFjZSBjb250YWluZWRfcmVxKQogICAgICAgICAgICAgICAgICAgIChwcm9nbgoJCSAgICAgKGNvbmQgKG5vdCAoPT0gKHR5cGVvZiByZWZuYW1lKSAic3RyaW5nIikpCgkJCSAgICh0aHJvdyBUeXBlRXJyb3IgInJlZmVyZW5jZSBuYW1lIG11c3QgYmUgYSBzdHJpbmcgdHlwZSIpCgkJCSAgIChvciAoPT0gRW52aXJvbm1lbnQgdmFsdWUpCgkJCSAgICAgICAoPT0gRW52aXJvbm1lbnQuZ2xvYmFsX2N0eCB2YWx1ZSkKCQkJICAgICAgICg9PSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlIHZhbHVlKSkKCQkJICAgKGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOyhkZWJ1ZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgRXZhbEVycm9yICJjYW5ub3Qgc2V0IHRoZSBlbnZpcm9ubWVudCBzY29wZSBhcyBhIGdsb2JhbCB2YWx1ZSIpKSkKCQkgICAgIAogICAgICAgICAgICAgICAgICAgICAod2hlbiAocmVzb2x2ZV9wYXRoIFsgcmVmbmFtZSBgY29uc3RhbnQgXSBFbnZpcm9ubWVudC5kZWZpbml0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgVHlwZUVycm9yICgrICJBc3NpZ25tZW50IHRvIGNvbnN0YW50IHZhcmlhYmxlICIgcmVmbmFtZSApKSkKCiAgICAgICAgICAgICAgICAgICAgIDs7IHdlIG5lZWQgdG8gZGV0ZXJtaW5lIHdoYXQgd2UndmUgYmVlbiBnaXZlbi4gIFdlIGNvdWxkIGhhdmU6CiAgICAgICAgICAgICAgICAgICAgIDs7IDEuIHJlZm5hbWUgYnkgaXRzZWxmLCB3aXRoIG5vIG5hbWUgc3BhY2UsIHNvIHdlIG5lZWQgdG8gY2hlY2sKICAgICAgICAgICAgICAgICAgICAgOzsgICAgaWYgaXQgaXMgdXMsIGFuZCBpZiBpdCBpcyBub3QsIGhhbmQgaXQgdXAgdG8gb3VyIHBhcmVudAogICAgICAgICAgICAgICAgICAgICA7OyAyLiBmdWxseS9xdWFsaWZpZWQgcmVmbmFtZSAtIG5lYWQgdG8gc3BsaXQgYW5kIHRoZW4gY2hlY2sKICAgICAgICAgICAgICAgICAgICAgOzsgMy4gcmVmbmFtZSBhbmQgdGFyZ2V0X25hbWVzcGFjZSAtIGlmIHVzIHdlIGRlYWwgd2l0aCBvcgogICAgICAgICAgICAgICAgICAgICA7OyAgICBzZW5kIG9ud2FyZHMgaWYgbm90IHVzLgoKICAgICAgICAgICAgICAgICAgICAgKGRlZnZhciBuYW1lc3BhY2VfaWRlbnRpdHkgKGlmIHRhcmdldF9uYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdGFyZ2V0X25hbWVzcGFjZSByZWZuYW1lXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzcGxpdF9ieSAiLyIgcmVmbmFtZSkpKQogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICA7OyBjaGVjayBpZiB3ZSBhbHJlYWR5IGhhdmUgYW4gZXhwbGljaXQgbmFtZXNwYWNlIGFuZCBpdCBpc24ndCB1cywKICAgICAgICAgICAgICAgICAgICAgICA7OyBzZW5kIGl0IHRvIG91ciBwYXJlbnQgdG8gZGVhbCB3aXRoLi4KICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAoYW5kIHBhcmVudF9lbnZpcm9ubWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKD4gbmFtZXNwYWNlX2lkZW50aXR5Lmxlbmd0aCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vdCAoPT0gbmFtZXNwYWNlIG5hbWVzcGFjZV9pZGVudGl0eS4wKSkpCiAgICAgICAgICAgICAgICAgICAgICAgKC0+IHBhcmVudF9lbnZpcm9ubWVudCBgc2V0X2dsb2JhbCBuYW1lc3BhY2VfaWRlbnRpdHkuMSB2YWx1ZSBtZXRhIGlzX2NvbnN0YW50IG5hbWVzcGFjZV9pZGVudGl0eS4wIChvciBjb250YWluZWQgY29udGFpbmVkX3JlcSkpCgogICAgICAgICAgICAgICAgICAgICAgIDs7IG5vdCB1cyBidXQgd2UgYXJlIHRoZSBjb3JlLCBzbyB3ZSBuZWVkIHRvIHNlbmQgaXQgdG8gdGhlIGFwcHJvcHJpYXRlIG5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgIChhbmQgKD4gbmFtZXNwYWNlX2lkZW50aXR5Lmxlbmd0aCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vdCAoPT0gbmFtZXNwYWNlX2lkZW50aXR5LjAgbmFtZXNwYWNlKSkpCiAgICAgICAgICAgICAgICAgICAgICAgKGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKGFuZCAocHJvcCBjaGlsZHJlbiBuYW1lc3BhY2VfaWRlbnRpdHkuMCkgICA7OyBkbyB3ZSBoYXZlIHRoZSByZXF1ZXN0ZWQgbmFtZXNwYWNlPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vdCBjb250YWluZWRfcmVxKSkgICAgICAgICAgICAgICAgICAgOzsgY2FuIHdlIGFjY2VzcyBpdD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IChwcm9wIGNoaWxkcmVuIG5hbWVzcGFjZV9pZGVudGl0eS4wKSAgICAgICA7OyBkaXNwYXRjaCBpdCB0aGVyZS4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgc2V0X2dsb2JhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlX2lkZW50aXR5LjEgdmFsdWUgbWV0YSBpc19jb25zdGFudCBuYW1lc3BhY2VfaWRlbnRpdHkuMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgbm8gc3VjaCBuYW1lc3BhY2Ugc28gaXQgaXMgYW4gZXJyb3IuLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAoKyAibmFtZXNwYWNlICIgbmFtZXNwYWNlX2lkZW50aXR5LjAgIiBkb2Vzbid0IGV4aXN0IikpKSkKICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgOzsgaXQncyBvbiB1cy4uLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgKGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmdmFyIGNvbXBzIChnZXRfb2JqZWN0X3BhdGggKGlmICg9PSAxIG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VfaWRlbnRpdHkuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlX2lkZW50aXR5LjEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBzLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgIChpZiAoYW5kIChpc19vYmplY3Q/IG1ldGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90IChpc19hcnJheT8gbWV0YSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiBpc19jb25zdGFudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIG1ldGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZGVmaW5pdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHMuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKHdoZW4gaXNfY29uc3RhbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZGVmaW5pdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHMuMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29uc3RhbnQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSkKICAgICAgICAgICAgICAgICAgICAgICAgIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgY29tcHMuMCkpKSkpKQogICAgICAgICAKICAgICAgICAgKGdldF9nbG9iYWwgCiAgICAgICAgICAoZnVuY3Rpb24gKHJlZm5hbWUgdmFsdWVfaWZfbm90X2ZvdW5kIHN1cHByZXNzX2NoZWNrX2V4dGVybmFsX2VudiB0YXJnZXRfbmFtZXNwYWNlIHBhdGhfY29tcHMgY29udGFpbmVkX3JlcSkKICAgICAgICAgICAgICAgICAgICAoY29uZCAKICAgICAgICAgICAgICAgICAgICAgIChub3QgKD09ICh0eXBlb2YgcmVmbmFtZSkgInN0cmluZyIpKQogICAgICAgICAgICAgICAgICAgICAgKHRocm93IFR5cGVFcnJvciAicmVmZXJlbmNlIG5hbWUgbXVzdCBiZSBhIHN0cmluZyB0eXBlIikKICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgKD09IHJlZm5hbWUgIkVudmlyb25tZW50IikKICAgICAgICAgICAgICAgICAgICAgIEVudmlyb25tZW50CiAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICgtPiBjb21waWxlcl9vcGVyYXRvcnMgYGhhcyByZWZuYW1lKQogICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbF9pZGVudGl0eQoKICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAoKGBuYW1lc3BhY2VfaWRlbnRpdHkgKGlmIHRhcmdldF9uYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdGFyZ2V0X25hbWVzcGFjZSByZWZuYW1lXSAgOzsgYWxyZWFkeSBoYXMgYmVlbiBzcGxpdCBvciBleHBsaWNpdGx5IHNwZWNpZmllZCwgc28gdXNlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNwbGl0X2J5ICIvIiByZWZuYW1lKSkpICAgIDs7IG90aGVyd2lzZSBzcGxpdC4ubmFtZXNwYWNlX2lkZW50aXR5IG1heSBvbmx5IGhhdmUgMSBjb21wb25lbnQgdGhvdWdoCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChgY29tcHMgKG9yIHBhdGhfY29tcHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdldF9vYmplY3RfcGF0aCAoaWYgKD09IDEgbmFtZXNwYWNlX2lkZW50aXR5Lmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZV9pZGVudGl0eS4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2VfaWRlbnRpdHkuMSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKGByZWZ2YWwgbmlsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAoYHN5bWJvbF9uYW1lIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgc2hhZG93IHRoZSBlbnZpcm9ubWVudHMgc2NvcGUgY2hlY2sgaWYgdGhlIHN1cHByZXNzX2NoZWNrX2V4dGVybmFsX2VudiBpcyBzZXQgdG8gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICA7OyB0aGlzIGlzIHVzZWZ1bCB3aGVuIHdlIGhhdmUgcmVmZXJlbmNlIG5hbWVzIHRoYXQgYXJlIG5vdCBsZWdhbCBqcyByZWZlcmVuY2UgbmFtZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChgY2hlY2tfZXh0ZXJuYWxfZW52IChpZiBzdXBwcmVzc19jaGVja19leHRlcm5hbF9lbnYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2V4dGVybmFsX2Vudl9kZWZhdWx0KSkpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgZ2l2ZW4gYSBmdWxseSBxdWFsaWZpZWQgbmFtZSwgaWYgbm90IHVzLCBwYXNzIGl0IHVwCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCBwYXJlbnRfZW52aXJvbm1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg+IG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGggMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChub3QgKD09IG5hbWVzcGFjZV9pZGVudGl0eS4wIG5hbWVzcGFjZSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgIDs7IHBhc3MgaXQgdXAuLi5ub3RlIHRoYXQgaXMgd2UgYXJlIGEgY29udGFpbmVkIGVudmlyb25tZW50LCBvdXIgcmVxdWVzdCB3aWxsIHR1cm4gY29udGFpbmVkIHRvIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gcGFyZW50X2Vudmlyb25tZW50IGBnZXRfZ2xvYmFsIG5hbWVzcGFjZV9pZGVudGl0eS4xIHZhbHVlX2lmX25vdF9mb3VuZCBzdXBwcmVzc19jaGVja19leHRlcm5hbF9lbnYgbmFtZXNwYWNlX2lkZW50aXR5LjAgY29tcHMgKG9yIGNvbnRhaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVkX3JlcSkpICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICAgIDs7IHdlIGFyZSBhdCB0aGUgcm9vdCAoY29yZSkgYnV0IGl0IGlzIG5vdCB1cywgc28gd2UgbmVlZCB0byBzZWUgaWYgd2UgaGF2ZSBhIG5hbWVzcGFjZSB0aGF0IGFsaWduZXMgYW5kIGlmIHNvLCBjYWxsIGl0J3MgZ2V0X2dsb2JhbCBzcGVjaWZpY2FsbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAoYW5kICg+IG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGggMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChub3QgKD09IG5hbWVzcGFjZV9pZGVudGl0eS4wIG5hbWVzcGFjZSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgIChkbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZiAoYW5kIChwcm9wIGNoaWxkcmVuIG5hbWVzcGFjZV9pZGVudGl0eS4wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vdCBjb250YWluZWRfcmVxKSkgICAgICAgICAgICAgICAgICAgOzsgY2FuIHdlIGFjY2VzcyBpdD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IChwcm9wIGNoaWxkcmVuIG5hbWVzcGFjZV9pZGVudGl0eS4wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGdldF9nbG9iYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZV9pZGVudGl0eS4xIHZhbHVlX2lmX25vdF9mb3VuZCBzdXBwcmVzc19jaGVja19leHRlcm5hbF9lbnYgbmFtZXNwYWNlX2lkZW50aXR5LjAgY29tcHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAoKyAibmFtZXNwYWNlICIgbmFtZXNwYWNlX2lkZW50aXR5LjAgIiBkb2Vzbid0IGV4aXN0IikpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgc2VhcmNoIHBhdGggaXMgdG8gZmlyc3QgY2hlY2sgdGhlIGdsb2JhbCBMaXNwIEVudmlyb25tZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBhbmQgaWYgdGhlIGNoZWNrX2V4dGVybmFsX2VudiBmbGFnIGlzIHRydWUsIHRoZW4gZ28gdG8gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBleHRlcm5hbCBKUyBlbnZpcm9ubWVudC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gcmVmdmFsIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgY29tcHMuMCkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChhbmQgKD09IHVuZGVmaW5lZCByZWZ2YWwpICAgICAgICAgICAgIDs7IGlmIHdlIGRpZG4ndCBmaW5kIGFueXRoaW5nIGhlcmUsIGFuZCBpZiB0aGUgcmVmbmFtZSB3YXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBuYW1lc3BhY2VfaWRlbnRpdHkubGVuZ3RoIDEpICA7OyBub24tcXVhbGlmaWVkIHdlIG5lZWQgdG8gY2hlY2sgdXB3YXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfZW52aXJvbm1lbnQpICAgICAgICAgICAgICAgOzsgaWYgcG9zc2libGUuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmdmFyIHJ2YWwgKC0+IHBhcmVudF9lbnZpcm9ubWVudCBgZ2V0X2dsb2JhbCByZWZuYW1lIHZhbHVlX2lmX25vdF9mb3VuZCBzdXBwcmVzc19jaGVja19leHRlcm5hbF9lbnYgbmlsIGNvbXBzIChvciBjb250YWluZWQgY29udGFpbmVkX3JlcSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDs7IHRoaXMgaXMgdXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKGFuZCAoPT0gdW5kZWZpbmVkIHJlZnZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja19leHRlcm5hbF9lbnYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPSByZWZ2YWwgKGlmIGNoZWNrX2V4dGVybmFsX2VudgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9yIChnZXRfb3V0c2lkZV9nbG9iYWwgY29tcHMuMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1RfRk9VTkQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1RfRk9VTkQpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBiYXNlZCBvbiB0aGUgdmFsdWUgb2YgcmVmdmFsLCByZXR1cm4gdGhlIHZhbHVlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYW5kICg9PSBOT1RfRk9VTkQgcmVmdmFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90ICg9PSB1bmRlZmluZWQgdmFsdWVfaWZfbm90X2ZvdW5kKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZV9pZl9ub3RfZm91bmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD09IE5PVF9GT1VORCByZWZ2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IFJlZmVyZW5jZUVycm9yICgrICJzeW1ib2wgbm90IGZvdW5kOiAiIChpZiAoPiBuYW1lc3BhY2VfaWRlbnRpdHkubGVuZ3RoIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKyBuYW1lc3BhY2UgIi8iIG5hbWVzcGFjZV9pZGVudGl0eS4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCsgbmFtZXNwYWNlICIvIiBuYW1lc3BhY2VfaWRlbnRpdHkuMCkpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gY29tcHMubGVuZ3RoIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZ2YWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD4gY29tcHMubGVuZ3RoIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXNvbHZlX3BhdGggKHJlc3QgY29tcHMpIHJlZnZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uc29sZS53YXJuICJnZXRfZ2xvYmFsOiBjb25kaXRpb24gZmFsbCB0aHJvdWdoOiAiIGNvbXBzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1RfRk9VTkQpKSkpKSkpKSkpCiAgICAgICAKICAgICAgIChzeW1ib2xfZGVmaW5pdGlvbiAoZm4gKHN5bW5hbWUgdGFyZ2V0X25hbWVzcGFjZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKG5hbWVzcGFjZV9pZGVudGl0eSAoaWYgdGFyZ2V0X25hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyB0YXJnZXRfbmFtZXNwYWNlIHN5bW5hbWUgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmICg+IChsZW5ndGggc3ltbmFtZSkgMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNwbGl0X2J5ICIvIiBzeW1uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc3ltbmFtZV0gKSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7KGNvbnNvbGUubG9nICJzeW1ib2xfZGVmaW5pdGlvbjogIiBzeW1uYW1lIG5hbWVzcGFjZV9pZGVudGl0eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gbmFtZXNwYWNlX2lkZW50aXR5Lmxlbmd0aCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBub3QgZnVsbHkgcXVhbGlmaWVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFpZiAocHJvcCBFbnZpcm9ubWVudC5kZWZpbml0aW9ucyBzeW1uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXQgOzsgd2UgaGF2ZSBpdCBoZXJlIHNvIHJldHVybiBpdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZiBwYXJlbnRfZW52aXJvbm1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IHBhcmVudF9lbnZpcm9ubWVudCBgc3ltYm9sX2RlZmluaXRpb24gc3ltbmFtZSkpKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gbmFtZXNwYWNlX2lkZW50aXR5LjAgIG5hbWVzcGFjZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHJvcCBFbnZpcm9ubWVudC5kZWZpbml0aW9ucyBzeW1uYW1lKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfZW52aXJvbm1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gcGFyZW50X2Vudmlyb25tZW50IGBzeW1ib2xfZGVmaW5pdGlvbiBuYW1lc3BhY2VfaWRlbnRpdHkuMSBuYW1lc3BhY2VfaWRlbnRpdHkuMCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD09IG5hbWVzcGFjZV9pZGVudGl0eS5sZW5ndGggMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gKHByb3AgY2hpbGRyZW4gbmFtZXNwYWNlX2lkZW50aXR5LjApIGBzeW1ib2xfZGVmaW5pdGlvbiBuYW1lc3BhY2VfaWRlbnRpdHkuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJHaXZlbiBhIHN5bWJvbCBuYW1lIGFuZCBhbiBvcHRpb25hbCBuYW1lc3BhY2UsIGVpdGhlciBhcyBhIGZ1bGx5IHF1YWxpZmllZCBwYXRoICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAib3IgdmlhIHRoZSB0YXJnZXRfbmFtZXNwYWNlIGFyZ3VtZW50LCByZXR1cm5zIGRlZmluaXRpb24gaW5mb3JtYXRpb24gYWJvdXQgdGhlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmV0cXVlc3RlZCBzeW1ib2wuICAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlVzZWQgcHJpbWFyaWx5IGJ5IHRoZSBjb21waWxlciB0byBmaW5kIG1ldGFkYXRhIGZvciBhIHNwZWNpZmljIHN5bWJvbCBkdXJpbmcgY29tcGlsYXRpb24uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgYHVzYWdlOiBbInN5bW5hbWU6c3RyaW5nIiAibmFtZXNwYWNlOnN0cmluZyJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGB0YWdzOiBbImNvbXBpbGVyIiAic3ltYm9scyIgIm5hbWVzcGFjZSIgInNlYXJjaCIgImNvbnRleHQiICJlbnZpcm9ubWVudCJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgKGNvbXBpbGUgKGZuIChqc29uX2V4cHJlc3Npb24gb3B0cykKICAgICAgICAgICAgICAgICAgICAobGV0CiAgICAgICAgICAgICAgICAgICAgICAgICgob3B0cyAoKyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGVudjogRW52aXJvbm1lbnQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBtZXRhOiAoaWYgKGFuZCBvcHRzIG9wdHMubWV0YSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAob3V0IG5pbCkpCiAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICg9IG91dAogICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVyIGpzb25fZXhwcmVzc2lvbiBvcHRzKSkKICAgICAgICAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgKGlzX2FycmF5PyBvdXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LjAuY3R5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gb3V0LjAuY3R5cGUgIkZBSUwiKSkKICAgICAgICAgICAgICAgICAgICAgICAgb3V0CiAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMubWV0YQogICAgICAgICAgICAgICAgICAgICAgICBvdXQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBvdXQuMSkpKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICgrICJDb21waWxlcyB0aGUgZ2l2ZW4gSlNPTiBvciBxdW90ZWQgbGlzcCBhbmQgcmV0dXJucyBhIHN0cmluZyBjb250YWluaW5nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRoZSBsaXNwIGZvcm0gb3IgZXhwcmVzc2lvbiBhcyBqYXZhc2NyaXB0Ljxicj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJJZiBwYXNzZWQgdGhlIG9wdGlvbiB7IG1ldGE6IHRydWUgfSAsIGFuIGFycmF5IGlzIHJldHVybmVkIGNvbnRhaW5pbmcgY29tcGlsYXRpb24gbWV0YWRhdGEgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW4gZWxlbWVudCAwIGFuZCB0aGUgY29tcGlsZWQgY29kZSBpbiBlbGVtZW50IDEuIikKICAgICAgICAgICAgICAgICAgIGB1c2FnZTogWyJqc29uX2V4cHJlc3Npb246KiIgIm9wdHM6b2JqZWN0Il0KICAgICAgICAgICAgICAgICAgIGB0YWdzOlsibWFjcm8iICJxdW90ZSIgInF1b3RlcyIgImRlc3ltIiAiY29tcGlsZXIiXQogICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChlbnZfbG9nIChkZWZjbG9nIHsgYHByZWZpeDogKCsgImVudiIgaWQpIGBiYWNrZ3JvdW5kOiAiI0IwRjBDMCIgfSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICBgZGVzY3JpcHRpb246ICJUaGUgZW52aXJvbm1lbnQgbG9nZ2luZyBmdW5jdGlvbiB1c2VkIGJ5IHRoZSBlbnZpcm9ubWVudC4iCiAgICAgICAgICAgICAgICAgYHVzYWdlOiBbImFyZzA6KiIgImFyZ046KiJdCiAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgCiAgICAgICAgIChldmFsdWF0ZV9sb2NhbCAoZm4gKGV4cHJlc3Npb24gY3R4IG9wdHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgob3B0cyAob3Igb3B0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVkIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXJyb3JfZGF0YSBuaWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdCBuaWwpKQoJCQkgICAgIDs7KGRlYnVnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIDs7KGNvbnNvbGUubG9nICJldmFsdWF0ZV9sb2NhbCBbICIgbmFtZXNwYWNlICJdIDoiIEVudmlyb25tZW50LmNvbnRleHQubmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgb3B0cy5jb21waWxlZF9zb3VyY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNvbXBpbGVkIGV4cHJlc3Npb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodHJ5IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPSBjb21waWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29tcGlsZXIgKGlmIG9wdHMuanNvbl9pbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiBFbnZpcm9ubWVudCBgcmVhZF9saXNwIGV4cHJlc3Npb24geyBgc291cmNlX25hbWU6IG9wdHMuc291cmNlX25hbWUgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGVudjogRW52aXJvbm1lbnQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGN0eDogY3R4IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBmb3JtYXR0ZWRfb3V0cHV0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHNvdXJjZV9uYW1lOiBvcHRzLnNvdXJjZV9uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHRocm93X29uX2Vycm9yOiBvcHRzLnRocm93X29uX2Vycm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGVycm9yX3JlcG9ydDogKG9yIG9wdHMuZXJyb3JfcmVwb3J0IG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcXVpZXRfbW9kZTogKG9yIG9wdHMucXVpZXRfbW9kZSBmYWxzZSkgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXRjaCBFcnJvciAoYGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHdoZW4gb3B0cy50aHJvd19vbl9lcnJvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiAoaW5zdGFuY2VvZiBlIExpc3BTeW50YXhFcnJvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoSlNPTi5wYXJzZSBlLm1lc3NhZ2UpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnN0YW5jZW9mIGUgTGlzcFN5bnRheEVycm9yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPSBlcnJvcl9kYXRhICgrIHsgYGVycm9yOiAiTGlzcFN5bnRheEVycm9yIiAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubWVzc2FnZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gZXJyb3JfZGF0YSAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBlcnJvcjogKHN1Yl90eXBlIGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbWVzc2FnZTogIGUubWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHN0YWNrOiBlLnN0YWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBmb3JtOiAoY29uZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgKGlzX3N0cmluZz8gZXhwcmVzc2lvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD4gZXhwcmVzc2lvbi5sZW5ndGggMTAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgrICgtPiBleHByZXNzaW9uIGBzdWJzdHIgMCAxMDApICIuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFzX2xpc3AgZXhwcmVzc2lvbikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgcGFyZW50X2Zvcm1zOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHNvdXJjZV9uYW1lOiBvcHRzLnNvdXJjZV9uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW52YWxpZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgb3B0cy5lcnJvcl9yZXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG9wdHMuZXJyb3JfcmVwb3J0IGVycm9yX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25zb2xlLmVycm9yICJDb21waWxhdGlvbiBFcnJvcjogIiBlcnJvcl9kYXRhKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNvbXBpbGVkIFsgeyBgZXJyb3I6IHRydWUgfSBuaWwgIF0pKSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlcSBuaWwgY29tcGlsZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyB3ZSBnb3Qgbm90aGluZyBiYWNrIC0gZm9yIG5vdyBub3RlIGl0IGFuZCByZXR1cm4gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBpZiB3ZSBoYWQgYW4gZXJyb3IgaXQgc2hvdWxkIG9mIGJlZW4gcmVwb3J0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCBjb21waWxlZC4wLm5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90ICg9PSBjb21waWxlZC4wLm5hbWVzcGFjZSBuYW1lc3BhY2UpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfZW52aXJvbm1lbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBub3QgdXMgYW5kIGlmIHdlIGFyZSBhIGNoaWxkLCBwYXNzIGl0IHVwIHRvIG91ciBwYXJlbnQgdG8gZGVhbCB3aXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gcGFyZW50X2Vudmlyb25tZW50IGBldmFsdWF0ZV9sb2NhbCBjb21waWxlZCBjdHggKCsge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBgY29tcGlsZWRfc291cmNlOiB0cnVlIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCBjb21waWxlZC4wLm5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90ICg9PSBjb21waWxlZC4wLm5hbWVzcGFjZSBuYW1lc3BhY2UpKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7OyBub3QgdXMsIGJ1dCB3ZSBhcmUgYSByb290IGFzIHdlIGhhdmUgbm8gcGFyZW50LCBzbyBkbyB3ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgaGF2ZSBhIGNoaWxkIG5hbWVzcGFjZSB0aGF0IG1hdGNoZXM/CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChwcm9wIGNoaWxkcmVuIGNvbXBpbGVkLjAubmFtZXNwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gKHByb3AgY2hpbGRyZW4gY29tcGlsZWQuMC5uYW1lc3BhY2UpIGBldmFsdWF0ZV9sb2NhbCBjb21waWxlZCBjdHggKCsge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgYGNvbXBpbGVkX3NvdXJjZTogdHJ1ZSB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAoKyAidW5rbm93biBuYW1lc3BhY2UgIiBjb21waWxlZC4wLm5hbWVzcGFjZSAiIGFzc2lnbm1lbnQiKSkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgdGhpcyBpcyB1cyBvciBubyBuYW1lc3BhY2UgZGVzaWduYXRlZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIG9wdHMub25fY29tcGlsYXRpb25fY29tcGxldGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3B0cy5vbl9jb21waWxhdGlvbl9jb21wbGV0ZSBjb21waWxlZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0cnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3aGVuIChhbmQgKGlzX2FycmF5PyBjb21waWxlZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlzX29iamVjdD8gY29tcGlsZWQuMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGlsZWQuMC5jdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90IChpc19zdHJpbmc/IGNvbXBpbGVkLjAuY3R5cGUpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIGNvbXBpbGVkLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHN1YnR5cGUgY29tcGlsZWQuMC5jdHlwZSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21waWxlZC5lcnJvciAgOzsgY29tcGlsZXIgZXJyb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IChuZXcgY29tcGlsZWQuZXJyb3IgY29tcGlsZWQubWVzc2FnZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYW5kIGNvbXBpbGVkLjAuY3R5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3IgKGNvbnRhaW5zPyAiYmxvY2siIGNvbXBpbGVkLjAuY3R5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBjb21waWxlZC4wLmN0eXBlICJhc3NpZ25tZW50IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD09IGNvbXBpbGVkLjAuY3R5cGUgIl9fIU5PVF9GT1VORCFfXyIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChjb21waWxlZC4wLmhhc19saXNwX2dsb2JhbHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIGNvbXBpbGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgQXN5bmNGdW5jdGlvbiAiRW52aXJvbm1lbnQiICgrICJ7ICIgY29tcGlsZWQuMSAifSIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVkLjEgRW52aXJvbm1lbnQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBjb21waWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobmV3IEFzeW5jRnVuY3Rpb24gICgrICJ7IiBjb21waWxlZC4xICJ9IikpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVkLjEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgY29tcGlsZWQuMC5jdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvciAoPT0gIkFzeW5jRnVuY3Rpb24iIGNvbXBpbGVkLjAuY3R5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSAic3RhdGVtZW50IiBjb21waWxlZC4wLmN0eXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gIm9iamxpdGVyYWwiIGNvbXBpbGVkLjAuY3R5cGUpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChjb21waWxlZC4wLmhhc19saXNwX2dsb2JhbHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsoY29uc29sZS5sb2cgImVudjogY29tcGlsZWQgdGV4dDogIiAoKyAieyByZXR1cm4gIiBjb21waWxlZC4xICJ9ICIpKSAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBjb21waWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5ldyBBc3luY0Z1bmN0aW9uICJFbnZpcm9ubWVudCIgKCsgInsgcmV0dXJuICIgY29tcGlsZWQuMSAifSAiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb21waWxlZC4xIEVudmlyb25tZW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgY29tcGlsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgQXN5bmNGdW5jdGlvbiAoKyAieyByZXR1cm4gIiBjb21waWxlZC4xICJ9IikpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29tcGlsZWQuMSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhbmQgY29tcGlsZWQuMC5jdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSAiRnVuY3Rpb24iIGNvbXBpbGVkLjAuY3R5cGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKGNvbXBpbGVkLjAuaGFzX2xpc3BfZ2xvYmFscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgY29tcGlsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgRnVuY3Rpb24gIkVudmlyb25tZW50IiAoKyAieyByZXR1cm4gIiBjb21waWxlZC4xICJ9ICIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVkLjEgRW52aXJvbm1lbnQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgY29tcGlsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgRnVuY3Rpb24gKCsgInsgcmV0dXJuICIgY29tcGlsZWQuMSAifSIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXBpbGVkLjEpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgOzsgdGhpcyBpcyBhIHNpbXBsZSBleHByZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBpbGVkLjEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2F0Y2ggRXJyb3IgKGUpCgkJCQkgICAgIChkbwoJCQkJICAgICAgKHdoZW4gKG9yIG9wdHMubG9nX2Vycm9ycwoJCQkJCQkgICAoPiBFbnZpcm9ubWVudC5jb250ZXh0LnNjb3BlLl9fVkVSQk9TSVRZX18gIDQpKQkgICAKCQkJCQkoaWYgZS5kZXRhaWxzCQkJCQkgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZW52X2xvZyAiY2F1Z2h0IGVycm9yOiAiIGUuZGV0YWlscykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVudl9sb2cgImNhdWdodCBlcnJvcjogIiBlLm5hbWUgZS5tZXNzYWdlIGUpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKGFuZCAoPT0gKHN1Yl90eXBlIGUpICJTeW50YXhFcnJvciIpCgkJCQkJICAgICAgIChvciBvcHRzLmxvZ19lcnJvcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKD4gRW52aXJvbm1lbnQuY29udGV4dC5zY29wZS5fX1ZFUkJPU0lUWV9fICA0KSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbnNvbGUubG9nIGNvbXBpbGVkLjEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAod2hlbiBvcHRzLmVycm9yX3JlcG9ydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvcHRzLmVycm9yX3JlcG9ydCAoaWYgZS5kZXRhaWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5kZXRhaWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgZXJyb3I6IGUubmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbWVzc2FnZTogZS5tZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBmb3JtOiBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHBhcmVudF9mb3JtczogbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBpbnZhbGlkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB0ZXh0OiBlLnN0YWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IHJlc3VsdCBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKG9yIChub3Qgb3B0cy5jYXRjaF9lcnJvcnMpCgkJCQkJICAgICAgIChhbmQgY3R4IGN0eC5pbl90cnkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwcm9nbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IHJlc3VsdCkpKSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpKSkpKQogICAgICAgCgkgKGV2YWx1YXRlIChmbiAoZXhwcmVzc2lvbiBjdHggb3B0cykKCQkgICAgICAgKHByb2duCQkJIAoJCQkoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBuYW1lc3BhY2UgYWN0aXZlX25hbWVzcGFjZSkKCQkJICAoZXZhbHVhdGVfbG9jYWwgZXhwcmVzc2lvbiBjdHggb3B0cykgIDs7IHdlIGJ5IGRlZmF1bHQgdXNlIGV2YWx1YXRlIGxvY2FsCiAgICAgICAgICAgICAgICAgICAgICAgICAgO3BhcmVudF9lbnZpcm9ubWVudAogICAgICAgICAgICAgICAgICAgICAgICAgIDsoLT4gcGFyZW50X2Vudmlyb25tZW50IGBldmFsdWF0ZSBleHByZXNzaW9uIGN0eCBvcHRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBuYW1lc3BhY2UgImNvcmUiKSAgICAgICAgICAgICAgICAgICAgICAgICAgCgkJCSAgICgtPiAocHJvcCBjaGlsZHJlbiBhY3RpdmVfbmFtZXNwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGV2YWx1YXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uIGN0eCBvcHRzKSkpKSkgOzsgb3RoZXJ3aXNlIGV2YWx1YXRlIHVzaW5nIHRoZSBhY3RpdmUgbmFtZXNwYWNlCiAgICAgICAKICAgICAgIChldmFsX3N0cnVjdCAoZm4gKGxpc3Bfc3RydWN0IGN0eCBvcHRzKQogICAgICAgICAgICAgICAgICAgICAgKGxldAogICAgICAgICAgICAgICAgICAgICAgICAgICgocnZhbCBuaWwpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOyhlbnZfbG9nICJldmFsX3N0cnVjdCAtPiIgKGNsb25lIGxpc3Bfc3RydWN0KSBjdHggb3B0cykKICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChpc19mdW5jdGlvbj8gbGlzcF9zdHJ1Y3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgKD0gcnZhbCAobGlzcF9zdHJ1Y3QpKQogICAgICAgICAgICAgICAgICAgICAgICAgICg9IHJ2YWwgKGV2YWx1YXRlIGxpc3Bfc3RydWN0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBqc29uX2luOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3Igb3B0cyB7fSkpKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7KGVudl9sb2cgImV2YWxfc3RydWN0IDwtIiAoY2xvbmUgcnZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJ2YWwpKSkpCgogICAgIDs7IHRoZXNlIGFyZSBzZWxlY3RlZCBuYW1lcyB3aGljaCB3ZSBkb24ndCBuZWVkIHRvIHByb3BvZ2F0ZSB0byBjaGlsZHJlbgogICAgIDs7IGhvd2V2ZXIsIGFueXRoaW5nIHRoYXQgb3BlcmF0ZXMgb24gdGhlIHRvcGxldmVsIGNvbnRleHQgbmVlZHMgdG8gcmVtYWluCiAgICAgOzsgc28gZ2V0X2dsb2JhbCwgdW5kZWZpbmUsIHNldF9nbG9iYWwsIGV0Yy4gCiAgICAgCiAgICAgKGRlZnZhciBidWlsdF9pbnMKICAgICAgIFsiTUFYX1NBRkVfSU5URUdFUiIsIkxpc3BTeW50YXhFcnJvciIsInN1Yl90eXBlIiwiX19WRVJCT1NJVFlfXyIsImludCIsImZsb2F0IiwKICAgICAgICAidmFsdWVzIiwicGFpcnMiLCJrZXlzIiwidGFrZSIsInByZXBlbmQiLCJmaXJzdCIsImxhc3QiLCJsZW5ndGgiLCJjb25qIiwicmV2ZXJzZSIsCiAgICAgICAgIm1hcCIsImJpbmQiLCJ0b19vYmplY3QiLCJ0b19hcnJheSIsInNsaWNlIiwicmVzdCIsInNlY29uZCIsInRoaXJkIiwiY2hvcCIsImNob21wIiwKCSJub3QiLCJwdXNoIiwicG9wIiwibGlzdCIsImZsYXR0ZW4iLCJqc2xhbWJkYSIsImpvaW4iLCJsb3dlcmNhc2UiLCJ1cHBlcmNhc2UiLCJsb2ciLAoJInNwbGl0Iiwic3BsaXRfYnkiLCJpc19vYmplY3Q/IiwiaXNfYXJyYXk/IiwgImlzX251bWJlcj8iLCAiaXNfZnVuY3Rpb24/IiwgImlzX3NldD8iLAoJImlzX2VsZW1lbnQ/IiwgImlzX3N0cmluZz8iLCAiaXNfbmlsPyIsICJpc19yZWdleD8iLCAiaXNfZGF0ZT8iLCAiZW5kc193aXRoPyIsICJzdGFydHNfd2l0aD8iLAoJImJsYW5rPyIsImNvbnRhaW5zPyIsIm1ha2Vfc2V0IiwgImV2YWxfZXhwIiwgImluZGlyZWN0X25ldyIsICJnZXRfaW1wb3J0X2VudHJ5IgogICAgICAgICJyYW5nZSIsICJhZGQiLCAibWVyZ2Vfb2JqZWN0cyIsICJpbmRleF9vZiIsICJyZXNvbHZlX3BhdGgiLCAiZGVsZXRlX3Byb3AiLCAibG9hZF9wZW5kcyIsCgkibWluX3ZhbHVlIiwibWF4X3ZhbHVlIiwiaW50ZXJsYWNlIiwidHJpbSIsImFzc2VydCIsInVucXVvdGlmeSIsIm9yX2FyZ3MiLCAicGVuZGluZ19uc19sb2FkcyIsCgkic3BlY2lhbF9vcGVyYXRvcnMiLCJkZWZjbG9nIiwiTk9UX0ZPVU5EIiwiY2hlY2tfZXh0ZXJuYWxfZW52X2RlZmF1bHQiICJidWlsdF9pbnMiCiAgICAgICAgInJlYWRlciJdKQoKICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZQoJICAgICAgIGBidWlsdF9pbnMKCSAgICAgICBidWlsdF9pbnMpCiAgICAgCiAgICAgOzsgVGhpcyB3aWxsIGFsbG93IHVzIHRvIHN3YXAgb3V0IGNvbXBpbGVyIGZ1bmN0aW9ucyBmb3Igd2hlbiB3ZSBhcmUgdXNpbmcgcG90ZW50aWFsbHkKICAgICA7OyBtdWx0aXBsZSBjb21waWxlcnMsIGZvciBleGFtcGxlIGluIHRoZSBkZXZlbG9wbWVudCBvZiB0aGUgY29tcGlsZXIuCiAgICAgCiAgICAgKGRlZnZhciBzZXRfY29tcGlsZXIgKGZuIChjb21waWxlcl9mdW5jdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKG5ld19vcHMgKGNvbXBpbGVyX2Z1bmN0aW9uIFtdIHsgYHNwZWNpYWxfb3BlcmF0b3JzOiB0cnVlIGBlbnY6IEVudmlyb25tZW50IH0pKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChpc19zZXQ/IG5ld19vcHMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNvbXBpbGVyX29wZXJhdG9ycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X29wcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNvbXBpbGVyIGNvbXBpbGVyX2Z1bmN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29tcGlsZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGlsZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVnaXN0ZXJfZmVhdHVyZSAiY29tcGlsZXIiKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb25zb2xlLmVycm9yICJJbnZhbGlkIGNvbXBpbGVyIGZ1bmN0aW9uOiBpbnZhbGlkIG9wZXJhdG9ycyByZXR1cm5lZC4gTm90IGluc3RhbGxpbmcuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyBFdmFsRXJyb3IgIkludmFsaWQgY29tcGlsZXIgZnVuY3Rpb24iKSkpCgkgICAgICAgICAgICAgICAgICAgICAgY29tcGlsZXIpKSkJICAKICAgICAKICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZQoJICAgICAgIGBzZXRfY29tcGlsZXIKCSAgICAgICBzZXRfY29tcGlsZXIpCiAgICAgICAgICAKICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZQoJICAgICAgIGBjbG9uZQoJICAgICAgIChmbiAodmFsKQoJCSAoaWYgKD09IHZhbCBFbnZpcm9ubWVudCkKCQkgICBFbnZpcm9ubWVudAoJCSAgIChjbG9uZSB2YWwgMCBFbnZpcm9ubWVudCkpKSkKCiAgICAgOzsgRXhwb3NlIG91ciBnbG9iYWwgc2V0dGVycy9nZXR0ZXJzIGZvciB0aGUgZHluYW1pYyBhbmQgdG9wIGxldmVsIGNvbnRleHRzCiAgICAgCiAgICAgKHNldF9wcm9wIEVudmlyb25tZW50CiAgICAgICAgICAgICAgIGBnZXRfZ2xvYmFsIGdldF9nbG9iYWwKICAgICAgICAgICAgICAgYHNldF9nbG9iYWwgc2V0X2dsb2JhbCAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICBgc3ltYm9sX2RlZmluaXRpb24gc3ltYm9sX2RlZmluaXRpb24gICAgICAgICAgICAgIAogICAgICAgICAgICAgICBgbmFtZXNwYWNlIG5hbWVzcGFjZSkKCgoKICAgIAogICAgIAogICAgIDs7IElmIHdlIGhhdmUgY2hpbGQgZW52aXJvbm1lbnRzIChuYW1lc3BhY2VzKSB3ZSBuZWVkIHRvIGtub3cgYWJvdXQgdGhlbQogICAgIDs7IGJlY2F1c2Ugd2UgbmVlZCB0byBiZSBhYmxlIHRvIG1hbmFnZSB0aGVtIGFuZCB3ZSBuZWVkIHRvIGJlIGFibGUgdG8KICAgICA7OyBzZXQgb3VyIGN1cnJlbnQgZXZhbHVhdGlvbiBwYXRoIHRvIHRoZSBjb3JyZWN0IGVudmlyb25tZW50IGFzIHRoZQogICAgIDs7IGVudHJ5IHBvaW50LgogICAgIDs7IGNvbnRhaW5lciBmb3IgdGhlIGNoaWxkIGVudmlyb25tZW50cwogICAgICAgCiAgICAgKGRlZnZhciBjaGlsZHJlbiAob3Igb3B0cy5jaGlsZHJlbiB7fSkpCiAgICAgCiAgICAgOzsgY29udGFpbmVyIGZvciBkZWNsYXJhdGlvbnMgcGVydGFpbmluZyB0byBvdXIgY2hpbGQgZW52aXJvbm1lbnRzCiAgICAgCiAgICAgKGRlZnZhciBjaGlsZHJlbl9kZWNsYXJhdGlvbnMgKG9yIG9wdHMuY2hpbGRyZW5fZGVjbGFyYXRpb25zIHt9KSkKCiAgICAgICAgICA7OyBub3cgYnJpbmcgYW55IGluY2x1ZGVzIGZyb20gdGhlIG9wdGlvbnMuLi4KICAgICA7OyB0aGUgbmlsIHZhbHVlIG9mIGluY2x1ZGVkX2dsb2JhbHMgaXMgcmVwbGFjZWQgd2l0aCB0aGUgc2F2ZV9lbnYKICAgICA7OyBmdW5jdGlvbgogICAgIAogICAKCiAgICAgOzsgd2hlbiBpbmNsdWRlZF9nbG9iYWxzIGhhcyBhIHBvcHVsYXRlZCB2YWx1ZSAod2hpY2ggaXQgZ2V0cyBmcm9tIHNhdmVfZW52KQogICAgIDs7IHRoZSBkZWZpbml0aW9ucyBnZXQgcmVpbnRlZ3JhdGVkIGludG8gdGhpcyBlbnZpcm9ubWVudAogICAgIAogICAgIAogICAgIAogICAgIDs7IHRoZSBjb3JlIG5hbWVzcGFjZSBoYXMgc3BlY2lhbCByZXNwb25zaWJpbGl0aWVzLCBuYW1lbHkgdG8gbWFuYWdlCiAgICAgOzsgdGhlIG5hbWVzcGFjZXMgYW5kIHRoZSBvdmVyYWxsIGNvbmZpZ3VyYXRpb24sIHdoaWNoIGlzIGF2YWlsYWJsZQogICAgIDs7IHZpYSB0aGUgKmVudl9jb25maWcqIG9iamVjdAoKICAgICAod2hlbiAoPT0gbmFtZXNwYWNlICJjb3JlIikKICAgICAgIAogICAgICAgKHdoZW4gKG5vdCAocHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlCgkJCWAqZW52X2NvbmZpZyopKQoJIChzZXRfcHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlCgkJICAgYCplbnZfY29uZmlnKgoJCSAgIHsgYGV4cG9ydDogeyBgc2F2ZV9wYXRoOiAianMvanVuby5qcyIKCQkgICAgICAgICAgICAgICAgYGRlZmF1bHRfbmFtZXNwYWNlOiAiY29yZSIKCQkgICAgICAgICAgICAgICAgYGluY2x1ZGVfc291cmNlOiBmYWxzZSB9CgkJICAgICBgZmVhdHVyZXM6IFtdCgkJICAgICBgYnVpbGQ6IChqYXZhc2NyaXB0IERMSVNQX0VOVl9WRVJTSU9OKQogICAgICAgICAgICAgICAgICAgICBgaW1wb3J0czoge30gfSkpCgogICAgICAgOzsgcmV0dXJucyB0aGUgY3VycmVudCBuYW1lc3BhY2UgCgogICAgICAgKGRlZnZhciBjdXJyZW50X25hbWVzcGFjZSAoZnVuY3Rpb24gKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZV9uYW1lc3BhY2UpKQogICAgICAgCiAgICAgICAoZGVmdmFyIGNyZWF0ZV9uYW1lc3BhY2UgKGZuIChuYW1lIG9wdGlvbnMgZGVmZXJfaW5pdGlhbGl6YXRpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90IChpc19zdHJpbmc/IG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgVHlwZUVycm9yICJuYW1lc3BhY2UgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb3AgY2hpbGRyZW4gbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAibmFtZXNwYWNlIGFscmVhZHkgZXhpc3RzIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChvcHRpb25zIChvciBvcHRpb25zIHt9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hpbGRfZW52IChkbGlzcF9lbnYgeyBgcGFyZW50X2Vudmlyb25tZW50OiBFbnZpcm9ubWVudCBgbmFtZXNwYWNlOiBuYW1lIGBjb250YWluZWQ6IG9wdGlvbnMuY29udGFpbmVkIGBkZWZlcl9pbml0aWFsaXphdGlvbjogZGVmZXJfaW5pdGlhbGl6YXRpb259KSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIGNoaWxkX2Vudi5ldmFsdWF0ZSAgIDs7IHdlIGdvdCBhbiBsZWdpdCBlbnYgYmFjayAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gY2hpbGRfZW52IGBzZXRfY29tcGlsZXIgY29tcGlsZXIpIDs7IHdlIGFsbCBzaGFyZSBhIHNpbmdsZSBjb21waWxlciBieSBkZWZhdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBjaGlsZHJlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRfZW52KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgY2hpbGRyZW5fZGVjbGFyYXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkKCQkJCQkgICgtPiBjaGlsZF9lbnYgYGV2YWx1YXRlX2xvY2FsICIoZm9yX2VhY2ggKHN5bSBidWlsdF9pbnMpIChkZWxldGVfcHJvcCBFbnZpcm9ubWVudC5jb250ZXh0LnNjb3BlIHN5bSkpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IGNoaWxkX2VudiBgZXZhbHVhdGVfbG9jYWwgIihmb3JfZWFjaCAoc3ltIGJ1aWx0X2lucykgKGRlbGV0ZV9wcm9wIEVudmlyb25tZW50LmRlZmluaXRpb25zIHN5bSkpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIG9wdGlvbnMuY29udGFpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIChwcm9wIGNoaWxkcmVuX2RlY2xhcmF0aW9ucyBuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29udGFpbmVkIHRydWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgKHByb3AgY2hpbGRyZW5fZGVjbGFyYXRpb25zIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBzZXJpYWxpemVfd2l0aF9pbWFnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKD09IGZhbHNlIG9wdGlvbnMuc2VyaWFsaXplX3dpdGhfaW1hZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uc29sZS5lcnJvciAiRU5WOiBjb3VsZG4ndCBjcmVhdGUgdGhlIGNoaWxkIGVudmlyb25tZW50LiBSZWNlaXZlZDogIiBjaGlsZF9lbnYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyBFdmFsRXJyb3IgKCsgInVuYWJsZSB0byBjcmVhdGUgbmFtZXNwYWNlICIgbmFtZSkpKSkpKSkpCiAgICAgICAKICAgICAgIChkZWZ2YXIgc2V0X25hbWVzcGFjZSAoZm4gKG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobm90IChpc19zdHJpbmc/IG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgVHlwZUVycm9yICJuYW1lc3BhY2UgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFuZCAobm90ICg9PSAiY29yZSIgbmFtZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVxIG5pbCAocHJvcCBjaGlsZHJlbiBuYW1lKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyBFdmFsRXJyb3IgKCsgIm5hbWVzcGFjZSAiIG5hbWUgIiBkb2Vzbid0IGV4aXN0IikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaWYgKD09IG5hbWUgImNvcmUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPSBhY3RpdmVfbmFtZXNwYWNlICJjb3JlIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZG8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPSBhY3RpdmVfbmFtZXNwYWNlIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpICA7OyBwb2ludCB0aGUgZXZhbHVhdGUgZnVuY3Rpb24gYXQgdGhlIHJpZ2h0IGVudmlyb25tZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSkpKSkKCiAgICAgICAoZGVmdmFyIGRlbGV0ZV9uYW1lc3BhY2UgKGZuIChuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG5vdCAoaXNfc3RyaW5nPyBuYW1lKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IFR5cGVFcnJvciAibmFtZXNwYWNlIG5hbWUgbXVzdCBiZSBhIHN0cmluZyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSAiY29yZSIgbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRocm93IEV2YWxFcnJvciAiY29yZSBuYW1lc3BhY2UgY2Fubm90IGJlIHJlbW92ZWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXEgbmlsIChwcm9wIGNoaWxkcmVuIG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgRXZhbEVycm9yICgrICJuYW1lc3BhY2UgIiBuYW1lICJkb2Vzbid0IGV4aXN0IikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9PSBuYW1lIChjdXJyZW50X25hbWVzcGFjZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyBFdmFsRXJyb3IgIm5hbWVzcGFjZSBpcyB0aGUgY3VycmVudCBuYW1lc3BhY2UiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZW1vdmVfcHJvcCBjaGlsZHJlbiBuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmb3JfZWFjaCAoYGsgKG9yIChyZXNvbHZlX3BhdGggWyBgZ2xvYmFsX2N0eCBgc2NvcGUgYCplbnZfY29uZmlnKiBgaW1wb3J0c10gRW52aXJvbm1lbnQpIFtdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHdoZW4gKHN0YXJ0c193aXRoPyBrIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlbW92ZV9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguKmVudl9jb25maWcqLmltcG9ydHMgaykpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUpKSkpCgogICAgICAgCiAgICAgICA7OyBpZiB3ZSBhcmUgaW4gY29yZSwgc2V0IHVwIHRoZSBhY3RpdmUgbmFtZXNwYWNlCiAgICAgICAKICAgICAgIChzZXRfcHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlCiAgICAgICAgICAgICAgICAgImNyZWF0ZV9uYW1lc3BhY2UiIGNyZWF0ZV9uYW1lc3BhY2UKICAgICAgICAgICAgICAgICAic2V0X25hbWVzcGFjZSIgc2V0X25hbWVzcGFjZQogICAgICAgICAgICAgICAgICJkZWxldGVfbmFtZXNwYWNlIiBkZWxldGVfbmFtZXNwYWNlICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICJuYW1lc3BhY2VzIiAoZnVuY3Rpb24gKCkgKCsgKGtleXMgY2hpbGRyZW4pICJjb3JlIikpICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICJjdXJyZW50X25hbWVzcGFjZSIgY3VycmVudF9uYW1lc3BhY2UpKQoKICAgICAoZGVmdmFyIGdldF9uYW1lc3BhY2VfaGFuZGxlIChmbiAobmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb2duCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gbmFtZXNwYWNlIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVudmlyb25tZW50ICA7OyBqdXN0IHJldHVybiB1cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gbmFtZXNwYWNlICJjb3JlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChhbmQgKGlzX3N0cmluZz8gbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb3AgY2hpbGRyZW4gbmFtZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb3AgY2hpbGRyZW4gbmFtZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9lbnZpcm9ubWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoLT4gcGFyZW50X2Vudmlyb25tZW50IGBnZXRfbmFtZXNwYWNlX2hhbmRsZSBuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyAiaW52YWxpZCBuYW1lc3BhY2UgaGFuZGxlIHJlcXVlc3RlZCIpKSkpKQogICAgICAgCiAgICAgCiAgICAgOzsgaW5jbHVkZWRfZ2xvYmFscyBuaWwgdmFsdWUgd2lsbCBiZSByZXBsYWNlZCBpbiB0aGUgSlNPTiB0cmVlCiAgICAgOzsgd2l0aCB2YWx1ZXMgZnJvbSB0aGlzIGVudmlyb25tZW50IHVwb24gc2F2aW5nIHRoZSBpbWFnZS4gSXQKICAgICA7OyBpcyB0aGVuIHVzZWQgdG8gcmVoeWRyYXRlIHRoZSB2YWx1ZXMgb24gcmVzdGFydAogICAgIAogICAgIChkZWZ2YXIgaW5jbHVkZWRfZ2xvYmFscyBuaWwpCiAgICAgCiAgICAgKHdoZW4gKGFuZCBpbmNsdWRlZF9nbG9iYWxzCgkJKD09IG5hbWVzcGFjZSAiY29yZSIpKQoKICAgICAgIDs7IGV2YWx1YXRlIHRoZSBpbnNlcnRlZCBjb2RlLi4uIAogICAgICAgCiAgICAgICAoPSBpbmNsdWRlZF9nbG9iYWxzIChpbmNsdWRlZF9nbG9iYWxzKSkKICAgICAgIAogICAgICAgOzsgaWYgbm90IGFscmVhZHkgZGVmaW5lZCBieSB0aGUgZW52aXJvbm1lbnQgaXRzZWxmLCBtZXJnZSB0aGUKICAgICAgIDs7IHByb3ZpZGVkIG5hbWVzIGFuZCB2YWx1ZXMgaW50byB0aGUgZ2xvYmFsIGNvbnRleHQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7KGNvbnNvbGUubG9nICJpbXBvcnRpbmcgc3ltYm9sczogIiAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBzeW1ib2xzKSkKCiAgICAgICAod2hlbiAocmVzb2x2ZV9wYXRoIFsgYHN5bWJvbHMgYGNvbXBpbGVyIF0gaW5jbHVkZWRfZ2xvYmFscykKICAgICAgICAgKHNldF9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUKICAgICAgICAgICAgICAgICAgIGBjb21waWxlcgogICAgICAgICAgICAgICAgICAgKHJlc29sdmVfcGF0aCBbIGBzeW1ib2xzIGBjb21waWxlciBdIGluY2x1ZGVkX2dsb2JhbHMpKQogICAgICAgICA7OyB1bm9mZmljaWFsbHkgc2V0IHRoZSBjb21waWxlciwgYnV0IHdlIHdpbGwgY29tcGxldGUgdGhlIHNldHRpbmcgb2YgaXQgb25jZQogICAgICAgICA7OyB0aGUgcmVtYWluZGVyIG9mIHRoZSBmdW5jdGlvbnMgaGF2ZSBiZWVuIGVtYmVkZGVkCiAgICAgICAgIDs7KGRlYnVnKQogICAgICAgICAoPSBjb21waWxlciBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlLmNvbXBpbGVyKSkKCiAgICAgICA7OyBsb2FkIHRoZSBleHBvcnRlZCBjb25maWcgCiAgICAgICAod2hlbiAoaXNfb2JqZWN0PyAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBjb25maWcpKQogICAgICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZQogICAgICAgICAgICAgICAgICAgIiplbnZfY29uZmlnKiIKICAgICAgICAgICAgICAgICAgIGluY2x1ZGVkX2dsb2JhbHMuY29uZmlnKSkKICAgICAgICAgICAgICAgICAgIAoKICAgICAgIDs7IGJpbmQgYW55IHN0YXRpYyBpbXBvcnRzIGZvciB0aGUgY29yZSBuYW1lc3BhY2UKICAgICAgIDs7IHRoYXQgbWF5IGJlIG5lZWRlZCBhcyBkZXBlbmRlbmNpZXMKCiAgICAgICAoZGVmdmFyIGltcHMgbmlsKQogICAgICAgCiAgICAgICAod2hlbiAoaXNfb2JqZWN0PyAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBpbXBvcnRzKSkgICAgICAgICAKICAgICAgICAgKD0gaW1wcyAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBpbXBvcnRzKSkgICAgICAgICAKICAgICAgICAgKHdoZW4gaW1wcwogICAgICAgICAgIChmb3JfZWFjaCAoaW1wX3NvdXJjZSAodmFsdWVzIGltcHMpKQogICAgICAgICAgICAgKHByb2duCiAgICAgICAgICAgICAgIChjb25kCiAgICAgICAgICAgICAgICAgKD09IGltcF9zb3VyY2UubmFtZXNwYWNlIG5hbWVzcGFjZSkgIDs7IG9ubHkgZm9yIGNvcmUgYXQgdGhpcyBwb2ludC4uCiAgICAgICAgICAgICAgICAgKHByb2duICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wX3NvdXJjZS5zeW1ib2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wX3NvdXJjZS5pbml0aWFsaXplcikpKSkpKSkKCiAgICAgICA7OyBOZXh0IHNldHVwIHRoZSBzeW1ib2xzIGFuZCB0aGVpciB2YWx1ZXMgaW4gY29yZSBnbG9iYWwgc2NvcGUuLi4KICAgICAgIAogICAgICAgKHdoZW4gKGlzX29iamVjdD8gKHByb3AgaW5jbHVkZWRfZ2xvYmFscyBgc3ltYm9scykpCiAgICAgICAgIChmb3JfZWFjaCAoc3ltc2V0IChwYWlycyBpbmNsdWRlZF9nbG9iYWxzLnN5bWJvbHMpKQogICAgICAgICAgICAgICAgICAgKHdoZW4gKGVxIG5pbCAocHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlIHN5bXNldC4wKSkKICAgICAgICAgICAgICAgICAgICAgICAgIDsgICAgKD09IHN5bXNldC4wICIqZW52X2NvbmZpZyoiKSkgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bXNldC4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1zZXQuMSkpKSkKICAgICAgIAogICAgICAgOzsgVGhlbiwgc2V0dXAgdGhlaXIgZGVmaW5pdGlvbnMuLgogICAgICAgCiAgICAgICAod2hlbiAoaXNfb2JqZWN0PyAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBkZWZpbml0aW9ucykpICAgICAgICAgCiAgICAgICAgIChmb3JfZWFjaCAoc3ltc2V0IChwYWlycyBpbmNsdWRlZF9nbG9iYWxzLmRlZmluaXRpb25zKSkKICAgICAgICAgICAgICAgICAgICh3aGVuIChlcSBuaWwgKHByb3AgRW52aXJvbm1lbnQuZGVmaW5pdGlvbnMgc3ltc2V0LjApKSAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgRW52aXJvbm1lbnQuZGVmaW5pdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bXNldC4wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW1zZXQuMSkpKSkKCiAgICAgICA7OyBBbnkgZGVjbGFyYXRpb25zIGZvciBjb3JlLi4KICAgICAgIAogICAgICAgKHdoZW4gKGlzX29iamVjdD8gKHByb3AgaW5jbHVkZWRfZ2xvYmFscyBgZGVjbGFyYXRpb25zKSkKICAgICAgICAgKGZvcl9lYWNoIChzeW1zZXQgKHBhaXJzIGluY2x1ZGVkX2dsb2JhbHMuZGVjbGFyYXRpb25zKSkKICAgICAgICAgICAgICAgICAgICh3aGVuIChlcSBuaWwgKHByb3AgRW52aXJvbm1lbnQuZGVjbGFyYXRpb25zIHN5bXNldC4wKSkgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgKHNldF9wcm9wIEVudmlyb25tZW50LmRlY2xhcmF0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ltc2V0LjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChxdW90ZWwgc3ltc2V0LjEpKSkpKQoKICAgICAgIDs7IGlmIHdlIGhhdmUgYSBjb21waWxlciwgc2V0IHRoZSBlbnZpcm9ubWVudCB0byB1c2UgaXQuCiAgICAgCiAgICAgICAod2hlbiAocHJvcCBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlIGBjb21waWxlcikgICAgICAgICAKCSAoc2V0X2NvbXBpbGVyIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgYGNvbXBpbGVyKSkpCgogICAgICAgOzsgbmV4dCBmb3IgYW55IGNoaWxkIG5hbWVzcGFjZXMgKGVudmlyb25tZW50cyksIGNyZWF0ZSB0aGVtLi4KICAgICAgCiAgICAgICAod2hlbiAoaXNfb2JqZWN0PyAocHJvcCBpbmNsdWRlZF9nbG9iYWxzIGBjaGlsZHJlbikpCiAgICAgICAgIChmb3JfZWFjaCAoY2hpbGRzZXQgKHBhaXJzIGluY2x1ZGVkX2dsb2JhbHMuY2hpbGRyZW4pKQoJICAgICAgICAgICAoZG8JICAgICAgIAoJICAgICAgICAgICAgIChjcmVhdGVfbmFtZXNwYWNlIGNoaWxkc2V0LjAKCQkJCSAgICAgICAoaWYgKHByb3AgaW5jbHVkZWRfZ2xvYmFscy5jaGlsZHJlbl9kZWNsYXJhdGlvbnMgY2hpbGRzZXQuMCkKCQkJCSAgICAgICAgIChwcm9wIGluY2x1ZGVkX2dsb2JhbHMuY2hpbGRyZW5fZGVjbGFyYXRpb25zIGNoaWxkc2V0LjApCgkJCQkgICAgICAgICB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSkpKSAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgOzsgb25jZSB0aGUgbmFtZXNwYWNlcyBhcmUgY3JlYXRlZCwgc2V0IGFueSBzdGF0aWMgaW1wb3J0cyB0aGV5IGhhdmUKICAgICAgICAgOzsgYW5kIGV2YWx1YXRlIHRoZSBjaGlsZCAKICAgICAgICAgCiAgICAgICAgIChmb3JfZWFjaCAoY2hpbGRzZXQgKHBhaXJzIGluY2x1ZGVkX2dsb2JhbHMuY2hpbGRyZW4pKQoJICAgICAgICAgICAoZG8gICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgKGNvbnNvbGUubG9nICJpbnN0YWxsaW5nIGNoaWxkIHN5bWJvbHM6ICIgY2hpbGRzZXQuMCkgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgKGRlZnZhciBjaGlsZGVudiAocHJvcCBjaGlsZHJlbiBjaGlsZHNldC4wKSkKICAgICAgICAgICAgICAgICAgICAgKHdoZW4gKGlzX29iamVjdD8gKHByb3AgaW5jbHVkZWRfZ2xvYmFscyBgaW1wb3J0cykpCiAgICAgICAgICAgICAgICAgICAgICAgKD0gIGltcHMgKHByb3AgaW5jbHVkZWRfZ2xvYmFscyBgaW1wb3J0cykpICAgICAKICAgICAgICAgICAgICAgICAgICAgICAod2hlbiBpbXBzCiAgICAgICAgICAgICAgICAgICAgICAgICAoZm9yX2VhY2ggKGltcF9zb3VyY2UgKHZhbHVlcyBpbXBzKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHJvZ24gICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIChwcm9wIGNoaWxkcmVuIGltcF9zb3VyY2UubmFtZXNwYWNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwcm9nbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X2dsb2JhbCAoKyAiIiBpbXBfc291cmNlLm5hbWVzcGFjZSAiLyIgaW1wX3NvdXJjZS5zeW1ib2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcF9zb3VyY2UuaW5pdGlhbGl6ZXIpKSkgKSkpKQogICAgICAgICAgICAgICAgICAgICAoZGVidWcpCiAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBjaGlsZHNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKC0+IGNoaWxkZW52IGBldmFsIGNoaWxkc2V0LjEpKQoJICAgICAgICAgICAgIChmb3JfZWFjaCAoc3ltc2V0IGNoaWxkc2V0LjEpCgkJCSAgICAgICAod2hlbiAoZXEgbmlsIChyZXNvbHZlX3BhdGggWyBjaGlsZHNldC4wIGBjb250ZXh0IGBzY29wZSBzeW1zZXQuMCBdIGNoaWxkcmVuKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOzsgdGhlIGNoaWxkIGVudiBpcyBhbHJlYWR5IGNvbXBpbGVkIGF0IHRoaXMgcG9pbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsoY29uc29sZS5sb2cgY2hpbGRzZXQuMCAiOiAiIHN5bXNldC4wIHN5bXNldC4xKSAgICAgICAgICAgICAgICAgICAgICAgICAgCgkJCSAgICAgICAgIChzZXRfcGF0aCBbIGNoaWxkc2V0LjAgYGNvbnRleHQgYHNjb3BlIHN5bXNldC4wIF0gY2hpbGRyZW4JCQkJCSAgCgkJCQkgICAgICAgICAgIHN5bXNldC4xKSkpKSkpKQoKICAgICA7OyBjbG9uZV90b19uZXc6IGFuIGVhcmxpZXIgZXhwZXJpbWVudCBpbiB3b3JraW5nIHdpdGggZW52aXJvbm1lbnRzLi4uCiAgICAgOzsgbWF5IG5vdCBiZSByZXF1aXJlZCBidXQga2VlcGluZyBpdCBmb3Igbm93IHVudGlsIGFuYWx5c2lzIGNhbiBiZSBkb25lLgogICAgIAogICAgIChkZWZ2YXIgY2xvbmVfdG9fbmV3IChmbiAob3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKG5ld19lbnYgbmlsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobXlfY2hpbGRyZW4gbmlsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobXlfY2hpbGRyZW5fZGVjbGFyYXRpb25zIG5pbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZW52X2xvZyBuYW1lc3BhY2UgImNsb25pbmc6ICMgY2hpbGRyZW46ICIgKGxlbmd0aCBjaGlsZHJlbikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IG5ld19lbnYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRsaXNwX2VudiB7IGBlbnY6IChjbG9uZSBFbnZpcm9ubWVudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGNoaWxkcmVuOiAoY2xvbmUgY2hpbGRyZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjaGlsZHJlbl9kZWNsYXJhdGlvbnM6IChjbG9uZSBjaGlsZHJlbl9kZWNsYXJhdGlvbnMpIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZW52X2xvZyBuYW1lc3BhY2UgImNvbnN0cnVjdGVkOiAiICgtPiAgbmV3X2VudiBgaWQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfZW52KSkpCgogICAgCiAgICAgOzsgZmFjaWxhdGUgdGhlIGV4cG9ydGF0aW9uIChzZXJpYWxpemF0aW9uIHRvIEpTT04pIG9mIHN5bWJvbHMgZnJvbSB0aGUgZW52aXJvbm1lbnQuLgogICAgIDs7IG5vdGUgdGhhdCB0aGVyZSB3aWxsIGJlIGEgbG90IG9mIEphdmFzY3JpcHQgZW1iZWRkZWQgaW4gdGhlIHByb2R1Y2VkIG91dHB1dAogICAgIDs7IHNpbmNlIGFueSBjYWxsYWJsZSBjb2RlIG11c3QgYmUgaW4gSlMgZm9ybS4KICAgICAKICAgICAoZGVmdmFyIGV4cG9ydF9zeW1ib2xfc2V0CiAgICAgICAoZm4gKG9wdGlvbnMpCgkgICAocmVkdWNlIChzeW1zZXQgKHBhaXJzIChjbG9uZSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKSkpCiAgICAgICAgICAgICAgICAgICAoZG8KCQkgICAgOyhjb25zb2xlLmxvZyBuYW1lc3BhY2UgIi8iIHN5bXNldC4wICItPiIgc3ltc2V0LjEpCiAgICAgICAgICAgICAgICAgICAgKGNvbmQKCQkgICAgIChhbmQgb3B0aW9ucyBvcHRpb25zLm5vX2NvbXBpbGVyCgkJCSAgKD09IHN5bXNldC4wICJjb21waWxlciIpKQoJCSAgICAgbmlsCgkJICAgICAoc3RhcnRzX3dpdGg/ICIkIiBzeW1zZXQuMCkgIDs7IGFueSB2YWx1ZXMgc3RhcnRpbmcgd2l0aCAkIGRvIG5vdCBnZXQgZXhwb3J0ZWQKCQkgICAgIG5pbAogICAgICAgICAgICAgICAgICAgICAoPT0gKHJlc29sdmVfcGF0aCBbIHN5bXNldC4wIGBzZXJpYWxpemVfd2l0aF9pbWFnZSBdIEVudmlyb25tZW50LmRlZmluaXRpb25zKSBmYWxzZSApCiAgICAgICAgICAgICAgICAgICAgIG5pbAogICAgICAgICAgICAgICAgICAgICAoYW5kIG9wdGlvbnMgb3B0aW9ucy5kb19ub3RfaW5jbHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgIChjb250YWlucz8gc3ltc2V0LjAgb3B0aW9ucy5kb19ub3RfaW5jbHVkZSkpCiAgICAgICAgICAgICAgICAgICAgIG5pbAoKICAgICAgICAgICAgICAgICAgICAgKD09IHN5bXNldC4wICIqZW52X3NrZWxldG9uKiIpCiAgICAgICAgICAgICAgICAgICAgIFsgc3ltc2V0LjAgWyhxdW90ZSBxdW90ZWwpIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgIiplbnZfc2tlbGV0b24qIikgXV0KCiAgICAgICAgICAgICAgICAgICAgIChyZXNvbHZlX3BhdGggWyBzeW1zZXQuMCBgaW5pdGlhbGl6ZXIgXSBFbnZpcm9ubWVudC5kZWZpbml0aW9ucykgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgW3N5bXNldC4wIChyZXNvbHZlX3BhdGggWyBzeW1zZXQuMCBgaW5pdGlhbGl6ZXIgXSBFbnZpcm9ubWVudC5kZWZpbml0aW9ucyldCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICg9PSBuaWwgc3ltc2V0LjEpCiAgICAgICAgICAgICAgICAgICAgIFtzeW1zZXQuMCAocXVvdGUgbmlsKV0KICAgICAgICAgICAgICAgICAgICAgKD09IHVuZGVmaW5lZCBzeW1zZXQuMSkKICAgICAgICAgICAgICAgICAgICAgW3N5bXNldC4wIChxdW90ZSB1bmRlZmluZWQpXQogICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgIFtzeW1zZXQuMCBzeW1zZXQuMV0pKSkpKQoKICAgICA7OyBUaGlzIHJvdXRpbmUgc2F2ZXMgdGhlIGVudmlyb25tZW50IGltYWdlIGludG8gZWZmZWN0aXZlbHkgYSBKYXZhc2NyaXB0CiAgICAgOzsgZmlsZSBvciBMaXNwIGZpbGUuLi4KICAgICAKICAgICAoZGVmdmFyIHNhdmVfZW52CiAgICAgICAoZm4gKG9wdGlvbnMpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgKGxldAogICAgICAgICAgICAgKChuZXdfZW52IG5pbCkKICAgICAgICAgICAgICAobXlfY2hpbGRyZW4gbmlsKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAoZW52X2NvbnN0cnVjdG9yIG5pbCkKICAgICAgICAgICAgICAoZGNvbXBzIChkYXRlX2NvbXBvbmVudHMgKG5ldyBEYXRlKSkpCiAgICAgICAgICAgICAgKG9wdGlvbnMgKG9yIG9wdGlvbnMge30pKQogICAgICAgICAgICAgICh2ZXJzaW9uX3RhZyAoaWYgKG5vdCAoYmxhbms/IG9wdHMudmVyc2lvbl90YWcpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMudmVyc2lvbl90YWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoam9pbiAiLiIgWyBkY29tcHMueWVhciBkY29tcHMubW9udGggZGNvbXBzLmRheSBkY29tcHMuaG91ciBkY29tcHMubWludXRlIF0pKSkKICAgICAgICAgICAgICAoYnVpbGRfdGltZSAoZm9ybWF0dGVkX2RhdGUgKG5ldyBEYXRlKSkpCiAgICAgICAgICAgICAgKGJ1aWxkX2hlYWRlcnMgW10pICAgICAgICAgICAgICAKICAgICAgICAgICAgICAoY2hpbGRfZW52IG5pbCkKICAgICAgICAgICAgICAod2FudF9idWZmZXIgKG9yIG9wdGlvbnMud2FudF9idWZmZXIgZmFsc2UpKQogICAgICAgICAgICAgIChjb21wX2J1ZmZlciBuaWwpCgkgICAgICAocHJlc2VydmVfaW1wb3J0cyAoaWYgKGFuZCBvcHRpb25zCgkJCQkJICg9PSBvcHRpb25zLnByZXNlcnZlX2ltcG9ydHMgZmFsc2UpKQoJCQkJCWZhbHNlCgkJCQkgICAgICAgIHRydWUpKQogICAgICAgICAgICAgIChpbmNsdWRlX3NvdXJjZSBmYWxzZSkKICAgICAgICAgICAgICAoZXhwb3J0cyBbXSkKICAgICAgICAgICAgICAoc3JjIChpZiAoLT4gRW52aXJvbm1lbnQgYGdldF9nbG9iYWwgIiplbnZfc2tlbGV0b24qIiBuaWwpCiAgICAgICAgICAgICAgICAgICAgIChjbG9uZSAoLT4gRW52aXJvbm1lbnQgYGdldF9nbG9iYWwgIiplbnZfc2tlbGV0b24qIikpCgkJICAgICAocmVhZGVyIChyZWFkX3RleHRfZmlsZSAgIi4vc3JjL2Vudmlyb25tZW50Lmxpc3AiKSkpKQogICAgICAgICAgICAgICh0YXJnZXRfaW5zZXJ0aW9uX3BhdGggbmlsKSAgOzsgd2hlcmUgd2UgaW5qZWN0IG91ciBjb250ZXh0IGludG8gdGhlIHNvdXJjZSB0cmVlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgIChvdXRwdXRfcGF0aCBuaWwpKQkJCSAgICAgICAKCiAgICAgICAgICAgKHdoZW4gKHByb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZSAiKmVudl9za2VsZXRvbioiKQogICAgICAgICAgICAgKHJlZ2lzdGVyX2ZlYXR1cmUgIiplbnZfc2tlbGV0b24qIikpCiAgICAgICAgICAgOzsgY29uc3RydWN0IG91ciBmb3JtIGJ5IGRvaW5nIHN1cmdlcnkgb24gb3Vyc2VsdmVzLi4KICAgICAgICAgICAKICAgICAgICAgICAoPSB0YXJnZXRfaW5zZXJ0aW9uX3BhdGggKGZpcnN0IChmaW5kcGF0aHMgKHF1b3RlIGluY2x1ZGVkX2dsb2JhbHMpIHNyYykpKQogICAgICAgICAgIAogICAgICAgICAgIChpZiAobm90IChpc19hcnJheT8gdGFyZ2V0X2luc2VydGlvbl9wYXRoKSkKICAgICAgICAgICAgICh0aHJvdyBFdmFsRXJyb3IgIlVuYWJsZSB0byBmaW5kIHRoZSBmaXJzdCBpbmNsdWRlZF9nbG9iYWxzIHN5bWJvbCIpKQoKICAgICAgICAgICAoPSB0YXJnZXRfaW5zZXJ0aW9uX3BhdGggKGNvbmogKGNob3AgdGFyZ2V0X2luc2VydGlvbl9wYXRoKSBbIDIgXSkpIDs7IG1vdmUgb25lIGZvcndhcmQgdG8gdGhlIHZhbHVlIHBvc2l0aW9uCiAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgKHdoZW4gb3B0aW9ucy5pbmNsdWRlX3NvdXJjZQogICAgICAgICAgICAgKD0gaW5jbHVkZV9zb3VyY2UgdHJ1ZSkpCiAgICAgICAgICAgCiAgICAgICAgICAgKGVudl9sb2cgbmFtZXNwYWNlICJjbG9uaW5nOiAjIGNoaWxkcmVuOiAiIChsZW5ndGggY2hpbGRyZW4pKSAgICAgICAgICAgICAgICAgICAgICAgICAgIAoJICAgKGVudl9sb2cgbmFtZXNwYWNlICJwcmVzZXJ2ZV9pbXBvcnRzOiAiIHByZXNlcnZlX2ltcG9ydHMpCgkgICAoPSBleHBvcnRzIChleHBvcnRfc3ltYm9sX3NldCAoaWYgb3B0aW9ucy5kb19ub3RfaW5jbHVkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBkb19ub3RfaW5jbHVkZTogb3B0aW9ucy5kb19ub3RfaW5jbHVkZSB9KSkpCiAgICAgICAgICAgCgkgIAoJICAgKD0gbXlfY2hpbGRyZW4KCSAgICAgICh0b19vYmplY3QKICAgICAgICAgICAgICAgKHJlZHVjZSAoY2hpbGQgKHBhaXJzIGNoaWxkcmVuKSkKICAgICAgICAgICAgICAgICAgICAgICAoaWYgKHJlc29sdmVfcGF0aCBbIGNoaWxkLjAgInNlcmlhbGl6ZV93aXRoX2ltYWdlIiBdIGNoaWxkcmVuX2RlY2xhcmF0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgIChwcm9nbgogICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNoaWxkX2VudiAoLT4gY2hpbGQuMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGNvbXBpbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgtPiBjaGlsZC4xIGBleHBvcnRfc3ltYm9sX3NldCB7IGBub19jb21waWxlcjogdHJ1ZSB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBgdGhyb3dfb25fZXJyb3I6IHRydWUgIH0pKSAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgIFtjaGlsZC4wICBgKGphdmFzY3JpcHQgLCNjaGlsZF9lbnYpIF0pKSkpKQogICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgO1socXVvdGUgbGV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOyAgW1socXVvdGUgRW52aXJvbm1lbnQpIFsocXVvdGUgcHJvcCkgKHF1b3RlIGNoaWxkcmVuKSBjaGlsZC4wXV1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7ICBbKHF1b3RlIGphdmFzY3JpcHQpIGNoaWxkX2Vudi4xXV1dKSkpKSkKCSAgIAoJICAgCiAgICAgICAgICAgOzsgbm93IGVtYmVkIG91ciBjb21waWxlZCBleGlzdGluZyBjb250ZXh0IGludG8gdGhlIHNvdXJjZSB0cmVlLi4uCQkJICAgIAogICAgICAgICAgIChzZXRfcGF0aCB0YXJnZXRfaW5zZXJ0aW9uX3BhdGggc3JjCgkJICAgICBgKGZuICgpCiAgICAgICAgICAgICAgICAgICAgICAgICwjKHRvX29iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICBbW2BkZWZpbml0aW9ucyAgWyhxdW90ZWwgcXVvdGUpIChjbG9uZSBFbnZpcm9ubWVudC5kZWZpbml0aW9ucyldXQoJCQkgICAgW2BkZWNsYXJhdGlvbnMgKGNsb25lIEVudmlyb25tZW50LmRlY2xhcmF0aW9ucyldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYGNvbmZpZyA7KGNsb25lIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgIiplbnZfY29uZmlnKiIpKSBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobGV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChleHBfY29uZiAoY2xvbmUgKHByb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZSAiKmVudl9jb25maWcqIikpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHdoZW4gKG5vdCBwcmVzZXJ2ZV9pbXBvcnRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZXRfcHJvcCBleHBfY29uZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW1wb3J0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3aGVuIG9wdGlvbnMuZmVhdHVyZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2V0X3Byb3AgZXhwX2NvbmYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGZlYXR1cmVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZmVhdHVyZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBfY29uZikgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW2BpbXBvcnRzICAgICAgKGlmIHByZXNlcnZlX2ltcG9ydHMKCQkJCQkgICAgICAgKHRvX29iamVjdAoJCQkJCQkoZm9yX2VhY2ggKGltcF9zb3VyY2UgKHZhbHVlcyAob3IgKHJlc29sdmVfcGF0aCBbIiplbnZfY29uZmlnKiIgImltcG9ydHMiXSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKSB7fSkpKQoJCQkJCQkJICBbIGltcF9zb3VyY2Uuc3ltYm9sIHsgYGluaXRpYWxpemVyOiBgKGphdmFzY3JpcHQgIm5ldyBmdW5jdGlvbiAoKSB7IHJldHVybiAiICwjaW1wX3NvdXJjZS5zeW1ib2wgIiB9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBzeW1ib2w6IGltcF9zb3VyY2Uuc3ltYm9sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbmFtZXNwYWNlOiBpbXBfc291cmNlLm5hbWVzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBdKSkKCQkJCQkgICAgIHt9KSBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYHN5bWJvbHMgICAgICBbKHF1b3RlIGphdmFzY3JpcHQpIChjb21waWxlICh0b19vYmplY3QgZXhwb3J0cykgeyBgdGhyb3dfb25fZXJyb3I6IHRydWUgfSApIF1dCgkJCSAgICBbIGBjaGlsZHJlbl9kZWNsYXJhdGlvbnMgYChmbiAoKSAsIyhjbG9uZSBjaGlsZHJlbl9kZWNsYXJhdGlvbnMpKSBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbIGBjaGlsZHJlbiAgICBteV9jaGlsZHJlbiBdXSkpKQoKICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAoPSBvdXRwdXRfcGF0aCAoaWYgb3B0aW9ucy53YW50X2J1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAob3Igb3B0aW9ucy5zYXZlX2FzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc29sdmVfcGF0aCBbIiplbnZfY29uZmlnKiIgImV4cG9ydCIgInNhdmVfcGF0aCIgXSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKSkpKQogICAgICAgICAgIAogICAgICAgICAgIDs7IGlmIG91ciBvdXRwdXQgcGF0aCBpcyBhIGZ1bmN0aW9uLCBjYWxsIGl0IHRvIGdldCBhbiBhY3R1YWwgbmFtZS4uLgogICAgICAgICAgIChpZiAoaXNfZnVuY3Rpb24/IG91dHB1dF9wYXRoKQogICAgICAgICAgICAgKD0gb3V0cHV0X3BhdGggKG91dHB1dF9wYXRoKSkpCiAgICAgICAgICAgCiAgICAgICAgICAgKGlmIChhbmQgKG5vdCAoaXNfc3RyaW5nPyBvdXRwdXRfcGF0aCkpCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3BhdGgpCiAgICAgICAgICAgICAodGhyb3cgRXZhbEVycm9yICJpbnZhbGlkIG5hbWUgZm9yIHRhcmdldCBmb3Igc2F2aW5nIHRoZSBlbnZpcm9ubWVudC4gIE11c3QgYmUgYSBzdHJpbmcgb3IgZnVuY3Rpb24iKSkKICAgICAgICAgICAKICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgKG9yIHdhbnRfYnVmZmVyCiAgICAgICAgICAgICAgICAgKGFuZCBvdXRwdXRfcGF0aAogICAgICAgICAgICAgICAgICAgICAgKGVuZHNfd2l0aD8gIi5qcyIgb3V0cHV0X3BhdGgpKSkKICAgICAgICAgICAgIChkbwogICAgICAgICAgICAgICAocHVzaCBidWlsZF9oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICgrICIvLyBCdWlsZCBUaW1lOiAiIGJ1aWxkX3RpbWUpKQogICAgICAgICAgICAgICAocHVzaCBidWlsZF9oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICgrICIvLyBWZXJzaW9uOiAiIHZlcnNpb25fdGFnKSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAocHVzaCBidWlsZF9oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICgrICJleHBvcnQgY29uc3QgRExJU1BfRU5WX1ZFUlNJT049JyIgdmVyc2lvbl90YWcgIic7IikpCiAgICAgICAgICAgICAgIChlbnZfbG9nICJzYXZpbmcgdG86ICIgb3V0cHV0X3BhdGgpCiAgICAgICAgICAgICAgIChjb21waWxlX2J1ZmZlciBzcmMgImluaXRfZGxpc3AiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYG5hbWVzcGFjZTogbmFtZXNwYWNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHRvcGxldmVsOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGluY2x1ZGVfYm9pbGVycGxhdGU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHZlcmJvc2U6IGZhbHNlCgkJCQlgYnVuZGxlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHdhbnRfYnVmZmVyOiB3YW50X2J1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBpbXBvcnRzOiAoaWYgcHJlc2VydmVfaW1wb3J0cwoJCQkJCSAgICAocmVzb2x2ZV9wYXRoIFsiKmVudl9jb25maWcqIiAiaW1wb3J0cyIgXSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBganNfaGVhZGVyczogWyhzaG93IGNoZWNrX3RydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2hvdyBnZXRfbmV4dF9lbnZpcm9ubWVudF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzaG93IGdldF9vdXRzaWRlX2dsb2JhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzaG93IHN1YnR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2hvdyBsaXNwX3dyaXRlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzaG93IGNsb25lKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzaG93IExpc3BTeW50YXhFcnJvcildCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCgkJCQlgYnVuZGxlX29wdGlvbnM6IHsgZGVmYXVsdF9uYW1lc3BhY2U6IChyZXNvbHZlX3BhdGggWyIqZW52X2NvbmZpZyoiICJleHBvcnQiICJkZWZhdWx0X25hbWVzcGFjZSIgXSBFbnZpcm9ubWVudC5nbG9iYWxfY3R4LnNjb3BlKQoJCQkJCQkgIH0KCQkJCQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBvdXRwdXRfZmlsZTogb3V0cHV0X3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW5jbHVkZV9zb3VyY2U6IChvciBvcHRpb25zLmluY2x1ZGVfc291cmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc29sdmVfcGF0aCBbIiplbnZfY29uZmlnKiIgImV4cG9ydCIgImluY2x1ZGVfc291cmNlIiBdIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGB0b3BsZXZlbDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBidWlsZF9oZWFkZXJzOiBidWlsZF9oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCgkgICAgIChhbmQgb3V0cHV0X3BhdGgKCQkgIChlbmRzX3dpdGg/ICIubGlzcCIgb3V0cHV0X3BhdGgpKQoJICAgICAod3JpdGVfdGV4dF9maWxlIG91dHB1dF9wYXRoIChKU09OLnN0cmluZ2lmeSBzcmMgbmlsIDQpKQogICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgc3JjKSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgKGlmICg9PSAidW5kZWZpbmVkIiAodHlwZW9mIEVsZW1lbnQpKQogICAgICAgKHNldF9wcm9wIGdsb2JhbFRoaXMKICAgICAgICAgICAgICAgICBgRWxlbWVudAogICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSBmYWxzZSkpKQoKICAgICAKICAgICAgICAgIAogICAgIDs7IEluIHRoZSBjb21waWxlciBjb250ZXh0LCB3ZSBoYXZlIGFjY2VzcyB0byB0aGUgZXhpc3RpbmcgZW52aXJvbm1lbnQsCiAgICAgOzsgYnJpbmcgdGhlIG5lZWRlZCBmdW5jdGlvbnMgaW4gYW5kIHJlYnVpbGQgdGhlbSBpbiB0aGUgY3VycmVudCBzY29wZS4KICAgICAKICAgICAoZGVjbGFyZSAobG9jYWwgbGlzcF93cml0ZXIpCiAgICAgICAgICAgICAgKGluY2x1ZGUgcmVhZGVyIGFkZF9lc2NhcGVfZW5jb2RpbmcgCiAgICAgICAgICAgICAgICAgICAgICAgZG9fZGVmZXJyZWRfc3BsaWNlIHNhZmVfYWNjZXNzIGVtYmVkX2NvbXBpbGVkX3F1b3RlKSkgICAgICAgIAogICAgIAogICAgIAogICAgIChkZWZ2YXIgYXNfbGlzcCBsaXNwX3dyaXRlcikKICAgICAoZGVmdmFyIHJlYWRfbGlzcCByZWFkZXIpCiAgICAgCiAgICAgKHNldF9wcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUKICAgICAgICAgICAgICAgYGV2YWwgZXZhbF9leHAKICAgICAgICAgICAgICAgYHJlYWRlciByZWFkZXIKICAgICAgICAgICAgICAgYGFkZF9lc2NhcGVfZW5jb2RpbmcgYWRkX2VzY2FwZV9lbmNvZGluZwogICAgICAgICAgICAgICBgZ2V0X291dHNpZGVfZ2xvYmFsIGdldF9vdXRzaWRlX2dsb2JhbAogICAgICAgICAgICAgICBgYXNfbGlzcCBsaXNwX3dyaXRlcgogICAgICAgICAgICAgICBgbGlzcF93cml0ZXIgbGlzcF93cml0ZXIKICAgICAgICAgICAgICAgYGNsb25lX3RvX25ldyBjbG9uZV90b19uZXcKICAgICAgICAgICAgICAgYHNhdmVfZW52IHNhdmVfZW52CiAgICAgICAgICAgICAgIGBudWxsIG51bGwpCgogICAgCiAgICAgICAKICAgICA7OyBpbmxpbmUgZnVuY3Rpb25zIGZvciBtb3JlIGVmZmljaWVudCBjb21waWxlZCBjb2RlLi4uCiAgICAgOzsgaW5zdGVhZCBvZiBjYWxsaW5nIGZ1bmN0aW9ucyB0aGVzZSBzZXJ2ZSB0byBpbmxpbmUgaW5zaWRlCiAgICAgOzsgb2YgdGhlIHByb2R1Y2VkIGphdmFzY3JpcHQgdHJlZQogICAgIDs7IGFkZCB5b3VyIG93biB3aXRoIHRoZSBpbmxpbmUgb3B0aW9uOgogICAgIDs7IGZvcm1hdCBpczogeyBvcGVyYXRvcjogKGZuIChhcmdzKSBbIGBqcyBgdG8gYGJlIGBpbnNlcnRlZCBdKSB9CiAgICAgOzsgUmV0dXJuIGFuIGFycmF5IG9mIHRva2VucyB0byBiZSBkaXJlY3RseSBpbnNlcnRlZCBpbnRvIHRoZSB0cmVlCiAgICAgOzsgdGhlIGlubGluZSBmdW5jdGlvbiBtdXN0IGFkZCBzcGFjZXMuCiAgICAgCiAgICAgKGRlZnZhciBpbmxpbmVzCiAgICAgICAoaWYgcGFyZW50X2Vudmlyb25tZW50CiAgICAgICAgICgrIHt9CiAgICAgICAgICAgIHBhcmVudF9lbnZpcm9ubWVudC5pbmxpbmVzCiAgICAgICAgICAgIChpZiBvcHRzLmlubGluZXMKICAgICAgICAgICAgICBvcHRzLmlubGluZXMKICAgICAgICAgICAgICB7fSkpCiAgICAgICAgICgrICB7fSAKICAgICAgICAgICAgIChpZiBvcHRzLmlubGluZXMKICAgICAgICAgICAgICAgb3B0cy5pbmxpbmVzCiAgICAgICAgICAgICAgIHt9KQogICAgICAgICAgICAgewogICAgICAgICAgICAgIGBwb3A6IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgIFsiKCIgYXJncy4wICIpIiAiLiIgInBvcCgpIl0pCiAgICAgICAgICAgICAgYHB1c2g6IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICBbIigiIGFyZ3MuMCAiKSIgIi5wdXNoIiAiKCIgYXJncy4xICIpIl0pCiAgICAgICAgICAgICAgYGNob21wOiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgIFsiKCIgYXJncy4wICIpIiAiLnN1YnN0ciIgIigiIDAgIiwiICIoIiBhcmdzLjAgIi5sZW5ndGgiICItIiAxICIpIiAiKSIgXSkKICAgICAgICAgICAgICBgam9pbjogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgIChpZiAoPT0gYXJncy5sZW5ndGggMSkgCiAgICAgICAgICAgICAgICAgICAgICAgICBbIigiIGFyZ3MuMCAiKSIgIi5qb2luIiAiKCcnKSJdCiAgICAgICAgICAgICAgICAgICAgICAgICBbIigiIGFyZ3MuMSAiKSIgIi5qb2luIiAiKCIgYXJncy4wICIpIiBdKSkKICAgICAgICAgICAgICBgdGFrZTogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgIFsiKCIgYXJncy4wICIpIiAiLnNoaWZ0IiAiKCkiIF0pCiAgICAgICAgICAgICAgYHByZXBlbmQ6IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICBbICIoIiBhcmdzLjAgIikiICIudW5zaGlmdCIgIigiIGFyZ3MuMSAiKSJdKQogICAgICAgICAgICAgIAogICAgICAgICAgICAgIGB0cmltOiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgWyAiKCIgYXJncy4wICIpIiAiLnRyaW0oKSJdKQoKICAgICAgICAgICAgICAKICAgICAgICAgICAgICBgbG93ZXJjYXNlOiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbIigiIGFyZ3MuMCAiKSIgIi50b0xvd2VyQ2FzZSgpIl0pCiAgICAgICAgICAgICAgYHVwcGVyY2FzZTogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWyIoIiBhcmdzLjAgIikiICIudG9VcHBlckNhc2UoKSJdKSAgICAgICAgICAgIAogICAgICAgICAgICAgIGBpc2xpY2U6IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgIChjb25kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gYXJncy5sZW5ndGggMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgWyAiKCIgYXJncy4wICIpIiAiLnNsaWNlKCIgYXJncy4xICIsIiBhcmdzLjIgIikiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAoPT0gYXJncy5sZW5ndGggMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgWyAiKCIgYXJncy4wICIpIiAiLnNsaWNlKCIgYXJncy4xICIpIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAodGhyb3cgU3ludGF4RXJyb3IgInNsaWNlIHJlcXVpcmVzIDIgb3IgMyBhcmd1bWVudHMiKSkpCiAgICAgICAgICAgICAgYHNwbGl0X2J5OiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFsgIigiIGFyZ3MuMSAiKSIgIi5zcGxpdCIgIigiIGFyZ3MuMCAiKSJdKQogICAgICAgICAgICAgIGBiaW5kZjogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgICBbICAgYXJncy4wICIuYmluZCgiIGFyZ3MuMSAiKSJdKQogICAgICAgICAgICAgIGBpc19hcnJheT86IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsgIigiIGFyZ3MuMCAiIGluc3RhbmNlb2YgQXJyYXkiICIpIl0pCiAgICAgICAgICAgICAgYGlzX29iamVjdD86IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbICIoIiBhcmdzLjAgIiBpbnN0YW5jZW9mIE9iamVjdCIgIikiIF0pCiAgICAgICAgICAgICAgYGlzX3N0cmluZz86IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbICIoIiBhcmdzLjAgIiBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2YgIiBhcmdzLjAgIj09PSIgIidzdHJpbmcnIiAiKSJdKQogICAgICAgICAgICAgIGBpc19mdW5jdGlvbj86IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsgYXJncy4wICIgaW5zdGFuY2VvZiBGdW5jdGlvbiJdKQogICAgICAgICAgICAgIGBpc19lbGVtZW50PzogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbIGFyZ3MuMCAiIGluc3RhbmNlb2YgRWxlbWVudCJdKQogICAgICAgICAgICAgIGBsb2c6IChmbiAoYXJncykKICAgICAgICAgICAgICAgICAgICAgIFsiY29uc29sZS5sb2ciICIoIiAobWFwIChmbiAodmFsIGlkeCB0bCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmICg8IGlkeCAoLSB0bCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdmFsICIsIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdmFsXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzKSAiKSJdKQogICAgICAgICAgICAgIGByZXZlcnNlOiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgWyIoImFyZ3MuMCAiKSIgIi5zbGljZSgwKS5yZXZlcnNlKCkiXSkKICAgICAgICAgICAgICAKICAgICAgICAgICAgICBgaW50OiAoZm4gKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgICAoY29uZAogICAgICAgICAgICAgICAgICAgICAgICAoPT0gYXJncy5sZW5ndGggMSkKICAgICAgICAgICAgICAgICAgICAgICAgWyJwYXJzZUludCgiIGFyZ3MuMCAiKSJdCiAgICAgICAgICAgICAgICAgICAgICAgICg9PSBhcmdzLmxlbmd0aCAyKQogICAgICAgICAgICAgICAgICAgICAgICBbInBhcnNlSW50KCIgYXJncy4wICIsIiBhcmdzLjEgIikiXQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICh0aHJvdyAiU3ludGF4RXJyb3IiICgrICJpbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMgdG8gaW50OiByZWNlaXZlZCAiIGFyZ3MubGVuZ3RoKSkpKQogICAgICAgICAgICAgIGBmbG9hdDogKGZuIChhcmdzKQogICAgICAgICAgICAgICAgICAgICAgICBbInBhcnNlRmxvYXQoIiBhcmdzLjAgIikiXSkKICAgICAgICAgICAgICAKICAgICAgICAgICAgICB9KSkpCiAgICAgICAgICAKICAgICA7OyBGaW5hbGx5IHRoZSBpbnRlcmZhY2UgdGhhdCBpcyBleHBvc2VkIHRvIGNvbXBpbGVyIGFuZCB0aGUgY29tcGlsZWQgY29kZS4uLgogICAgIAogICAgIChzZXRfcHJvcCBFbnZpcm9ubWVudAogICAgICAgICAgICAgICBgZXZhbCBldmFsX3N0cnVjdAogICAgICAgICAgICAgICBgaWRlbnRpZnkgc3VidHlwZQogICAgICAgICAgICAgICBgbWV0YV9mb3Jfc3ltYm9sIG1ldGFfZm9yX3N5bWJvbAogICAgICAgICAgICAgICBgc2V0X2NvbXBpbGVyIHNldF9jb21waWxlcgogICAgICAgICAgICAgICBgcmVhZF9saXNwIHJlYWRlcgogICAgICAgICAgICAgICBgYXNfbGlzcCBhc19saXNwCiAgICAgICAgICAgICAgIGBzeW1ib2xzIHN5bWJvbHMKICAgICAgICAgICAgICAgYGlubGluZXMgaW5saW5lcwogICAgICAgICAgICAgICBgY2xvbmVfdG9fbmV3IGNsb25lX3RvX25ldwoJICAgICAgIGBleHBvcnRfc3ltYm9sX3NldCBleHBvcnRfc3ltYm9sX3NldAoJICAgICAgIGBzYXZlX2VudiBzYXZlX2VudgogICAgICAgICAgICAgICBgc3BlY2lhbF9vcGVyYXRvcnMgc3BlY2lhbF9vcGVyYXRvcnMKICAgICAgICAgICAgICAgYGRlZmluaXRpb25zIEVudmlyb25tZW50LmRlZmluaXRpb25zCiAgICAgICAgICAgICAgIGBkZWNsYXJhdGlvbnMgRW52aXJvbm1lbnQuZGVjbGFyYXRpb25zCiAgICAgICAgICAgICAgIGBnZXRfbmFtZXNwYWNlX2hhbmRsZSBnZXRfbmFtZXNwYWNlX2hhbmRsZQogICAgICAgICAgICAgICBgY29tcGlsZSBjb21waWxlCSAgICAgICAKICAgICAgICAgICAgICAgYGV2YWx1YXRlIGV2YWx1YXRlCiAgICAgICAgICAgICAgIGBldmFsdWF0ZV9sb2NhbCBldmFsdWF0ZV9sb2NhbAogICAgICAgICAgICAgICBgZG9fZGVmZXJyZWRfc3BsaWNlIGRvX2RlZmVycmVkX3NwbGljZQogICAgICAgICAgICAgICBgaWQgKGZuICgpIGlkKQogICAgICAgICAgICAgICBgc2V0X2NoZWNrX2V4dGVybmFsX2VudiAoZm4gKHN0YXRlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICg9IGNoZWNrX2V4dGVybmFsX2Vudl9kZWZhdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2V4dGVybmFsX2Vudl9kZWZhdWx0KSkKICAgICAgICAgICAgICAgYGNoZWNrX2V4dGVybmFsX2VudiAoZm4gKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2V4dGVybmFsX2Vudl9kZWZhdWx0KSkKCiAgICAgOzsgdHdvIGluaXRpYWxpemF0aW9ucyAtIG9uZSBmb3IgdGhlIHN5c3RlbSBhbmQgb25lIGZvciB0aGUgdXNlcgogICAgCiAgICAgCiAgICAgKHNldHEgaW5fYm9vdCBmYWxzZSkKICAgICAKICAgICAoZGVmdmFyIHN5c19pbml0IChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgIipzeXN0ZW1faW5pdGlhbGl6ZXIqIikpCiAgICAgKGRlZnZhciBpbml0IChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgIippbml0aWFsaXplcioiKSkKICAgICAKICAgICA7KGNvbnNvbGUubG9nICJlbnY6ICIgbmFtZXNwYWNlICI6IGluaXRpYWxpemVyOiAiIGluaXQgInN5c3RlbTogIiBzeXNfaW5pdCkKICAgICA7OyBzZXQgdGhlIGRlZmF1bHQgbmFtZXNwYWNlIGlmIHdlIGhhdmUgYmVlbiBnaXZlbiBvbmUgYW5kIHdlIGhhdmUgY2hpbGRyZW4uLgogICAgICh3aGVuIChhbmQgb3B0cy5kZWZhdWx0X25hbWVzcGFjZQoJICAgICAgICAobm90ICg9PSBjb21waWxlciB1bnNldF9jb21waWxlcikpCQoJCShwcm9wIGNoaWxkcmVuIG9wdHMuZGVmYXVsdF9uYW1lc3BhY2UpKQogICAgICAgKHNldF9uYW1lc3BhY2Ugb3B0cy5kZWZhdWx0X25hbWVzcGFjZSkpCgogICAgIAogICAgCiAgICAgKHdoZW4gKD09IG5hbWVzcGFjZSAiY29yZSIpCiAgICAgICAgOzsgY2FsbCB0aGUgc3lzdGVtIGluaXRpYWxpemVyCiAgICAgICAod2hlbiBzeXNfaW5pdAogICAgICAgICAoZXZhbCBzeXNfaW5pdCkpCiAgICAgCiAgICAgOzsgY2FsbCB0aGUgdXNlciBpbml0aWFsaXplciAgICAgCiAgICAgICAod2hlbiBpbml0IAogICAgICAgICAoZXZhbCBpbml0KSkKCiAgICAgICA7OyB3ZSB3aWxsIGhhdmUgZGVmZXJyZWQgaW5pdGlhbGl6YXRpb25zIG9mIHRoZSBuYW1lc3BhY2VzCiAgICAgICA7OyBpZiB0aGVyZSB3ZXJlIGFueSBjaGlsZHJlbiBpbiB0aGUgZXhwb3J0LCBzbyBkbyB0aGVzZSBub3cKCiAgICAgICAoZm9yX2VhY2ggKGNoaWxkIGNoaWxkcmVuKQogICAgICAgICAgICAgICAgIChwcm9nbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAoLT4gY2hpbGQgYGV2YWx1YXRlX2xvY2FsCiAgICAgICAgICAgICAgICAgICAgICAoKyAiKHByb2duIChjb25zb2xlLmxvZyBcImNoaWxkIHJ1bm5pbmcgaW5pdGlhbGl6YXRpb24uLlwiKSAoaWYgKHByb3AgRW52aXJvbm1lbnQuZ2xvYmFsX2N0eC5zY29wZSBgKnN5c3RlbV9pbml0aWFsaXplciopIChldmFsICpzeXN0ZW1faW5pdGlhbGl6ZXIqKSkgKGlmIChwcm9wIEVudmlyb25tZW50Lmdsb2JhbF9jdHguc2NvcGUgYCppbml0aWFsaXplciopIChldmFsICppbml0aWFsaXplciopKSkiKSkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgCiAgICAgRW52aXJvbm1lbnQpKSkKCgoK";return __obj__1;})(),children_declarations:async function() {
    return {
        user:{
            serialize_with_image:true
        },html:{
            serialize_with_image:false
        }
    }
},children:{
    user:[["meta_for_symbol",async function(quoted_symbol,search_mode) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let local_data=Environment.global_ctx.scope[quoted_symbol];
                                ;
                                let acc=[];
                                ;
                                if (check_true (search_mode)){
                                    {
                                        if (check_true (local_data)){
                                            {
                                                (acc).push(await (await get_global("add"))({
                                                    namespace:namespace,name:quoted_symbol,type:await subtype(local_data)
                                                },await (async function(){
                                                    let it;
                                                    it=Environment.definitions[quoted_symbol];
                                                    if (check_true (it)){
                                                        return it
                                                    } else {
                                                        return new Object()
                                                    }
                                                })()))
                                            }
                                        };
                                        if (check_true (parent_environment)){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(info) {
                                                        return (acc).push(info)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__121=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__122=[],__elements__120=await (async function() {
                                                            {
                                                                 let __call_target__=await parent_environment["meta_for_symbol"].call(parent_environment,quoted_symbol,true), __call_method__="flat";
                                                                return await __call_target__[__call_method__].call(__call_target__,1)
                                                            } 
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__119 in __elements__120) {
                                                            __array__122.push(await __for_body__121(__elements__120[__iter__119]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__122.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__122;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        if (check_true ((await length(await keys(children))>0))){
                                            {
                                                {
                                                    let __collector;
                                                    let __result;
                                                    let __action;
                                                    __collector=[];
                                                    __result=null;
                                                    __action=async function(details) {
                                                        return (acc).push(details)
                                                    };
                                                    ;
                                                    await (async function() {
                                                        let __for_body__125=async function(__item) {
                                                            __result=await __action(__item);
                                                            if (check_true (__result)){
                                                                return (__collector).push(__result)
                                                            }
                                                        };
                                                        let __array__126=[],__elements__124=await (async function(){
                                                            let ____collector__127= async function(){
                                                                return []
                                                            };
                                                            let ____result__128= async function(){
                                                                return null
                                                            };
                                                            let ____action__129= async function(){
                                                                return async function(child_data) {
                                                                    if (check_true (await not((child_data['0']===await (await get_global("current_namespace"))())))){
                                                                        {
                                                                            return await child_data['1']["meta_for_symbol"].call(child_data['1'],quoted_symbol)
                                                                        }
                                                                    }
                                                                }
                                                            };
                                                            {
                                                                let __collector=await ____collector__127();
                                                                ;
                                                                let __result=await ____result__128();
                                                                ;
                                                                let __action=await ____action__129();
                                                                ;
                                                                ;
                                                                await (async function() {
                                                                    let __for_body__132=async function(__item) {
                                                                        __result=await __action(__item);
                                                                        if (check_true (__result)){
                                                                            return (__collector).push(__result)
                                                                        }
                                                                    };
                                                                    let __array__133=[],__elements__131=await pairs(children);
                                                                    let __BREAK__FLAG__=false;
                                                                    for(let __iter__130 in __elements__131) {
                                                                        __array__133.push(await __for_body__132(__elements__131[__iter__130]));
                                                                        if(__BREAK__FLAG__) {
                                                                             __array__133.pop();
                                                                            break;
                                                                            
                                                                        }
                                                                    }return __array__133;
                                                                     
                                                                })();
                                                                return __collector
                                                            }
                                                        })();
                                                        let __BREAK__FLAG__=false;
                                                        for(let __iter__123 in __elements__124) {
                                                            __array__126.push(await __for_body__125(__elements__124[__iter__123]));
                                                            if(__BREAK__FLAG__) {
                                                                 __array__126.pop();
                                                                break;
                                                                
                                                            }
                                                        }return __array__126;
                                                         
                                                    })();
                                                    __collector
                                                }
                                            }
                                        };
                                        return acc
                                    }
                                } else {
                                    {
                                        quoted_symbol=await (async function(){
                                            if (check_true (await starts_with_ques_(await (async function(){
                                                 return "=:" 
                                            })(),quoted_symbol))){
                                                return await quoted_symbol["substr"].call(quoted_symbol,2)
                                            } else {
                                                return quoted_symbol
                                            }
                                        })();
                                        {
                                            let it;
                                            it=Environment.definitions[quoted_symbol];
                                            if (check_true (it)){
                                                return await (await get_global("add"))({
                                                    namespace:namespace,type:await sub_type(local_data),name:quoted_symbol
                                                },it)
                                            } else {
                                                return null
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }],["describe",async function(quoted_symbol,search_mode) {
                        let internal_results=await (async function(){
                             return await meta_for_symbol(quoted_symbol,true) 
                        })();
                        ;
                        if (check_true (((internal_results instanceof Array)&& internal_results['0']))){
                            if (check_true (search_mode)){
                                return internal_results
                            } else {
                                return await first(internal_results)
                            }
                        } else {
                            {
                                let external_results=await get_outside_global(quoted_symbol);
                                ;
                                if (check_true (external_results)){
                                    return {
                                        location:"external",type:await subtype(external_results)
                                    }
                                } else {
                                    return null
                                }
                            }
                        }
                    }],["undefine",function(quoted_symbol) {
                        if (check_true ((quoted_symbol instanceof String || typeof quoted_symbol==='string'))){
                            {
                                let namespace_identity;
                                let parent_call;
                                let child_call;
                                let target_symbol;
                                namespace_identity=(quoted_symbol).split("/");
                                parent_call=null;
                                child_call=null;
                                target_symbol=null;
                                ;
                                return   (function(){
                                    if (check_true ((((namespace_identity.length===1)&& Environment.global_ctx.scope[namespace_identity['0']])|| ((namespace_identity.length>1)&& (namespace_identity['0']===namespace))))) {
                                        {
                                            target_symbol= ( function(){
                                                if (check_true ((namespace_identity.length>1))){
                                                    return namespace_identity['1']
                                                } else {
                                                    return namespace_identity['0']
                                                }
                                            })();
                                             delete_prop(Environment.definitions,target_symbol);
                                            if (check_true (Environment.global_ctx.scope[target_symbol])){
                                                return  delete_prop(Environment.global_ctx.scope,target_symbol)
                                            } else {
                                                return false
                                            }
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& parent_environment))) {
                                        {
                                            parent_call= parent_environment["get_global"].call(parent_environment,"undefine");
                                            return (parent_call)(quoted_symbol)
                                        }
                                    } else if (check_true (((namespace_identity.length>1)&& children[namespace_identity['0']]))) {
                                        {
                                            child_call= ( function() {
                                                {
                                                     let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                    return  __call_target__[__call_method__].call(__call_target__,"undefine")
                                                } 
                                            })();
                                            return  child_call(quoted_symbol)
                                        }
                                    } else {
                                        return false
                                    }
                                } )()
                            }
                        } else {
                            throw new SyntaxError("undefine requires a quoted symbol");
                            
                        }
                    }],["*namespace*","user"],["pend_load",async function(from_namespace,target_namespace,symbol,initializer) {
                        if (check_true ((null==pending_ns_loads[from_namespace]))){
                            {
                                await async function(){
                                    pending_ns_loads[from_namespace]=[];
                                    return pending_ns_loads;
                                    
                                }()
                            }
                        };
                        return (pending_ns_loads[from_namespace]).push({
                            symbol:symbol,source_ns:from_namespace,target_ns:target_namespace,initializer:await (async function(){
                                 return ["=:quote",initializer] 
                            })()
                        })
                    }],["symbols",async function(opts) {
                        return await async function(){
                            if (check_true ((null==opts))) {
                                return await keys(Environment.global_ctx.scope)
                            } else if (check_true (opts.unique)) {
                                {
                                    let no_includes=await make_set(await conj(["meta_for_symbol","describe","undefine","*namespace*","pend_load","symbols","set_global","get_global","symbol_definition","compile","env_log","evaluate_local","evaluate","eval_struct","set_compiler","clone","eval","add_escape_encoding","get_outside_global","as_lisp","lisp_writer","clone_to_new","save_env","null","compiler"],built_ins));
                                    ;
                                    {
                                        let __collector;
                                        let __result;
                                        let __action;
                                        __collector=[];
                                        __result=null;
                                        __action=async function(sym) {
                                            if (check_true (await no_includes["has"].call(no_includes,sym))){
                                                return null
                                            } else {
                                                return sym
                                            }
                                        };
                                        ;
                                        await (async function() {
                                            let __for_body__212=async function(__item) {
                                                __result=await __action(__item);
                                                if (check_true (__result)){
                                                    return (__collector).push(__result)
                                                }
                                            };
                                            let __array__213=[],__elements__211=await keys(Environment.global_ctx.scope);
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__210 in __elements__211) {
                                                __array__213.push(await __for_body__212(__elements__211[__iter__210]));
                                                if(__BREAK__FLAG__) {
                                                     __array__213.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__213;
                                             
                                        })();
                                        return __collector
                                    }
                                }
                            }
                        } ()
                    }],["set_global",function(refname,value,meta,is_constant,target_namespace,contained_req) {
                          (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true (((Environment===value)|| (Environment.global_ctx===value)|| (Environment.global_ctx.scope===value)))) {
                                {
                                    throw new EvalError("cannot set the environment scope as a global value");
                                    
                                }
                            }
                        } )();
                        if (check_true ( resolve_path( ( function(){
                            let __array_op_rval__216=refname;
                             if (__array_op_rval__216 instanceof Function){
                                return  __array_op_rval__216("constant") 
                            } else {
                                return [__array_op_rval__216,"constant"]
                            }
                        })(),Environment.definitions))){
                            {
                                throw new TypeError(("Assignment to constant variable "+ refname));
                                
                            }
                        };
                        let namespace_identity= ( function(){
                            if (check_true (target_namespace)){
                                return  ( function(){
                                    let __array_op_rval__217=target_namespace;
                                     if (__array_op_rval__217 instanceof Function){
                                        return  __array_op_rval__217(refname) 
                                    } else {
                                        return [__array_op_rval__217,refname]
                                    }
                                })()
                            } else {
                                return (refname).split("/")
                            }
                        })();
                        ;
                        return   (function(){
                            if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace===namespace_identity['0']))))) {
                                return  parent_environment["set_global"].call(parent_environment,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'],(contained|| contained_req))
                            } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                {
                                    if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                        return  ( function() {
                                            {
                                                 let __call_target__=children[namespace_identity['0']], __call_method__="set_global";
                                                return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value,meta,is_constant,namespace_identity['0'])
                                            } 
                                        })()
                                    } else {
                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                        
                                    }
                                }
                            } else {
                                {
                                    let comps= get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })());
                                    ;
                                      (function(){
                                        Environment.global_ctx.scope[comps['0']]=value;
                                        return Environment.global_ctx.scope;
                                        
                                    })();
                                    if (check_true (((meta instanceof Object)&&  not((meta instanceof Array))))){
                                        {
                                            if (check_true (is_constant)){
                                                {
                                                      (function(){
                                                        meta["constant"]=true;
                                                        return meta;
                                                        
                                                    })()
                                                }
                                            };
                                              (function(){
                                                Environment.definitions[comps['0']]=meta;
                                                return Environment.definitions;
                                                
                                            })()
                                        }
                                    } else {
                                        if (check_true (is_constant)){
                                            {
                                                  (function(){
                                                    Environment.definitions[comps['0']]={
                                                        constant:true
                                                    };
                                                    return Environment.definitions;
                                                    
                                                })()
                                            }
                                        }
                                    };
                                    return Environment.global_ctx.scope[comps['0']]
                                }
                            }
                        } )()
                    }],["get_global",function(refname,value_if_not_found,suppress_check_external_env,target_namespace,path_comps,contained_req) {
                        return   (function(){
                            if (check_true ( not((typeof refname==="string")))) {
                                throw new TypeError("reference name must be a string type");
                                
                            } else if (check_true ((refname==="Environment"))) {
                                return Environment
                            } else if (check_true ( compiler_operators["has"].call(compiler_operators,refname))) {
                                return special_identity
                            } else {
                                {
                                    let namespace_identity;
                                    let comps;
                                    let refval;
                                    let symbol_name;
                                    let check_external_env;
                                    namespace_identity= ( function(){
                                        if (check_true (target_namespace)){
                                            return  ( function(){
                                                let __array_op_rval__224=target_namespace;
                                                 if (__array_op_rval__224 instanceof Function){
                                                    return  __array_op_rval__224(refname) 
                                                } else {
                                                    return [__array_op_rval__224,refname]
                                                }
                                            })()
                                        } else {
                                            return (refname).split("/")
                                        }
                                    })();
                                    comps=(path_comps||  get_object_path( ( function(){
                                        if (check_true ((1===namespace_identity.length))){
                                            return namespace_identity['0']
                                        } else {
                                            return namespace_identity['1']
                                        }
                                    })()));
                                    refval=null;
                                    symbol_name=null;
                                    check_external_env= ( function(){
                                        if (check_true (suppress_check_external_env)){
                                            return false
                                        } else {
                                            return check_external_env_default
                                        }
                                    })();
                                    return   (function(){
                                        if (check_true ((parent_environment&& (namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            return  parent_environment["get_global"].call(parent_environment,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps,(contained|| contained_req))
                                        } else if (check_true (((namespace_identity.length>1)&&  not((namespace_identity['0']===namespace))))) {
                                            {
                                                if (check_true ((children[namespace_identity['0']]&&  not(contained_req)))){
                                                    return  ( function() {
                                                        {
                                                             let __call_target__=children[namespace_identity['0']], __call_method__="get_global";
                                                            return  __call_target__[__call_method__].call(__call_target__,namespace_identity['1'],value_if_not_found,suppress_check_external_env,namespace_identity['0'],comps)
                                                        } 
                                                    })()
                                                } else {
                                                    {
                                                        throw new EvalError(("namespace "+ namespace_identity['0']+ " doesn't exist"));
                                                        
                                                    }
                                                }
                                            }
                                        } else {
                                            {
                                                refval=Environment.global_ctx.scope[comps['0']];
                                                if (check_true (((undefined===refval)&& (namespace_identity.length===1)&& parent_environment))){
                                                    {
                                                        let rval= parent_environment["get_global"].call(parent_environment,refname,value_if_not_found,suppress_check_external_env,null,comps,(contained|| contained_req));
                                                        ;
                                                        return rval
                                                    }
                                                } else {
                                                    {
                                                        if (check_true (((undefined===refval)&& check_external_env))){
                                                            refval= ( function(){
                                                                if (check_true (check_external_env)){
                                                                    return ( get_outside_global(comps['0'])|| NOT_FOUND)
                                                                } else {
                                                                    return NOT_FOUND
                                                                }
                                                            })()
                                                        };
                                                        return   (function(){
                                                            if (check_true (((NOT_FOUND===refval)&&  not((undefined===value_if_not_found))))) {
                                                                return value_if_not_found
                                                            } else if (check_true ((NOT_FOUND===refval))) {
                                                                {
                                                                    throw new ReferenceError(("symbol not found: "+  ( function(){
                                                                        if (check_true ((namespace_identity.length>1))){
                                                                            return  add(namespace,"/",namespace_identity['1'])
                                                                        } else {
                                                                            return  add(namespace,"/",namespace_identity['0'])
                                                                        }
                                                                    })()));
                                                                    
                                                                }
                                                            } else if (check_true ((comps.length===1))) {
                                                                return refval
                                                            } else if (check_true ((comps.length>1))) {
                                                                {
                                                                    return  resolve_path( rest(comps),refval)
                                                                }
                                                            } else {
                                                                {
                                                                     console.warn("get_global: condition fall through: ",comps);
                                                                    return NOT_FOUND
                                                                }
                                                            }
                                                        } )()
                                                    }
                                                }
                                            }
                                        }
                                    } )()
                                }
                            }
                        } )()
                    }],["symbol_definition",async function(symname,target_namespace) {
                        let namespace_identity;
                        namespace_identity=await (async function(){
                            if (check_true (target_namespace)){
                                return await (async function(){
                                    let __array_op_rval__227=target_namespace;
                                     if (__array_op_rval__227 instanceof Function){
                                        return await __array_op_rval__227(symname) 
                                    } else {
                                        return [__array_op_rval__227,symname]
                                    }
                                })()
                            } else {
                                if (check_true ((await length(symname)>2))){
                                    return (symname).split("/")
                                } else {
                                    return await (async function(){
                                        let __array_op_rval__228=symname;
                                         if (__array_op_rval__228 instanceof Function){
                                            return await __array_op_rval__228() 
                                        } else {
                                            return [__array_op_rval__228]
                                        }
                                    })()
                                }
                            }
                        })();
                        return await async function(){
                            if (check_true ((namespace_identity.length===1))) {
                                {
                                    let it;
                                    it=Environment.definitions[symname];
                                    if (check_true (it)){
                                        return it
                                    } else {
                                        if (check_true (parent_environment)){
                                            return await parent_environment["symbol_definition"].call(parent_environment,symname)
                                        }
                                    }
                                }
                            } else if (check_true ((namespace_identity['0']===namespace))) {
                                return Environment.definitions[symname]
                            } else if (check_true (parent_environment)) {
                                return await parent_environment["symbol_definition"].call(parent_environment,namespace_identity['1'],namespace_identity['0'])
                            } else if (check_true ((namespace_identity.length===2))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[namespace_identity['0']], __call_method__="symbol_definition";
                                        return await __call_target__[__call_method__].call(__call_target__,namespace_identity['1'])
                                    } 
                                })()
                            } else {
                                return undefined
                            }
                        } ()
                    }],["compile",async function(json_expression,opts) {
                        let out;
                        opts=await add({
                            env:Environment
                        },opts,{
                            meta:await (async function(){
                                if (check_true ((opts&& opts.meta))){
                                    return true
                                } else {
                                    return false
                                }
                            })()
                        });
                        out=null;
                        out=await (async function(){
                             return await compiler(json_expression,opts) 
                        })();
                        return await async function(){
                            if (check_true (((out instanceof Array)&& out['0'].ctype&& (out['0'].ctype==="FAIL")))) {
                                return out
                            } else if (check_true (opts.meta)) {
                                return out
                            } else {
                                return out['1']
                            }
                        } ()
                    }],["env_log",async function(...args) {
                            return await (async function(){
                                let __target_arg__188=[].concat(await conj(await (async function(){
                                    let __array_op_rval__189=style;
                                     if (__array_op_rval__189 instanceof Function){
                                        return await __array_op_rval__189() 
                                    } else {
                                        return [__array_op_rval__189]
                                    }
                                })(),args));
                                if(!__target_arg__188 instanceof Array){
                                    throw new TypeError("Invalid final argument to apply - an array is required")
                                }let __pre_arg__190=await (async function(){
                                     return ("%c"+ await (async function(){
                                        if (check_true (opts.prefix)){
                                            return opts.prefix
                                        } else {
                                            return (args).shift()
                                        }
                                    })()) 
                                })();
                                __target_arg__188.unshift(__pre_arg__190);
                                return (console.log).apply(this,__target_arg__188)
                            })()
                        }],["evaluate_local",async function(expression,ctx,opts) {
                        let compiled;
                        let error_data;
                        let result;
                        opts=(opts|| new Object());
                        compiled=null;
                        error_data=null;
                        result=null;
                        if (check_true (opts.compiled_source)){
                            compiled=expression
                        } else {
                            try {
                                compiled=await (async function(){
                                     return await compiler(await (async function(){
                                        if (check_true (opts.json_in)){
                                            return expression
                                        } else {
                                            return await Environment["read_lisp"].call(Environment,expression,{
                                                source_name:opts.source_name
                                            })
                                        }
                                    })(),{
                                        env:Environment,ctx:ctx,formatted_output:true,source_name:opts.source_name,throw_on_error:opts.throw_on_error,error_report:(opts.error_report|| null),quiet_mode:(opts.quiet_mode|| false)
                                    }) 
                                })()
                            } catch (__exception__235) {
                                if (__exception__235 instanceof Error) {
                                    let e=__exception__235;
                                    {
                                        {
                                            if (check_true (opts.throw_on_error)){
                                                {
                                                    throw e;
                                                    
                                                }
                                            };
                                            if (check_true ((e instanceof LispSyntaxError))){
                                                {
                                                    await async function(){
                                                        e["message"]=await JSON.parse(e.message);
                                                        return e;
                                                        
                                                    }()
                                                }
                                            };
                                            await async function(){
                                                if (check_true ((e instanceof LispSyntaxError))) {
                                                    return error_data=await add({
                                                        error:"LispSyntaxError"
                                                    },e.message)
                                                } else {
                                                    error_data={
                                                        error:await sub_type(e),message:e.message,stack:e.stack,form:await (async function(){
                                                             return await async function(){
                                                                if (check_true (((expression instanceof String || typeof expression==='string')&& (expression.length>100)))) {
                                                                    return await add(await expression["substr"].call(expression,0,100),"...")
                                                                } else {
                                                                    return await (await get_global("as_lisp"))(expression)
                                                                }
                                                            } () 
                                                        })(),parent_forms:[],source_name:opts.source_name,invalid:true
                                                    }
                                                }
                                            } ();
                                            if (check_true (opts.error_report)){
                                                await (async function(){
                                                    let __array_op_rval__237=opts.error_report;
                                                     if (__array_op_rval__237 instanceof Function){
                                                        return await __array_op_rval__237(error_data) 
                                                    } else {
                                                        return [__array_op_rval__237,error_data]
                                                    }
                                                })()
                                            } else {
                                                await console.error("Compilation Error: ",error_data)
                                            };
                                            compiled=await (async function(){
                                                 return [{
                                                    error:true
                                                },null] 
                                            })()
                                        }
                                    }
                                }
                            }
                        };
                        return await async function(){
                            if (check_true ((null==compiled))) {
                                return null
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))&& parent_environment))) {
                                return await parent_environment["evaluate_local"].call(parent_environment,compiled,ctx,await add(new Object(),opts,{
                                    compiled_source:true
                                }))
                            } else if (check_true ((compiled['0'].namespace&& await not((compiled['0'].namespace===namespace))))) {
                                if (check_true (children[compiled['0'].namespace])){
                                    return await (async function() {
                                        {
                                             let __call_target__=children[compiled['0'].namespace], __call_method__="evaluate_local";
                                            return await __call_target__[__call_method__].call(__call_target__,compiled,ctx,await add(new Object(),opts,{
                                                compiled_source:true
                                            }))
                                        } 
                                    })()
                                } else {
                                    throw new EvalError(("unknown namespace "+ compiled['0'].namespace+ " assignment"));
                                    
                                }
                            } else {
                                {
                                    if (check_true (opts.on_compilation_complete)){
                                        await (async function(){
                                            let __array_op_rval__238=opts.on_compilation_complete;
                                             if (__array_op_rval__238 instanceof Function){
                                                return await __array_op_rval__238(compiled) 
                                            } else {
                                                return [__array_op_rval__238,compiled]
                                            }
                                        })()
                                    };
                                    try {
                                        if (check_true (((compiled instanceof Array)&& (compiled['0'] instanceof Object)&& compiled['0'].ctype&& await not((compiled['0'].ctype instanceof String || typeof compiled['0'].ctype==='string'))))){
                                            {
                                                await async function(){
                                                    compiled['0']["ctype"]=await subtype(compiled['0'].ctype);
                                                    return compiled['0'];
                                                    
                                                }()
                                            }
                                        };
                                        result=await (async function(){
                                             return await async function(){
                                                if (check_true (compiled.error)) {
                                                    throw new Error((await get_global("indirect_new"))(compiled.error,compiled.message));
                                                    
                                                } else if (check_true ((compiled['0'].ctype&& (await contains_ques_("block",compiled['0'].ctype)|| (compiled['0'].ctype==="assignment")|| (compiled['0'].ctype==="__!NOT_FOUND!__"))))) {
                                                    if (check_true (await (async function(){
                                                        let __array_op_rval__241=compiled['0'].has_lisp_globals;
                                                         if (__array_op_rval__241 instanceof Function){
                                                            return await __array_op_rval__241() 
                                                        } else {
                                                            return [__array_op_rval__241]
                                                        }
                                                    })())){
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction("Environment",("{ "+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__243=compiled['1'];
                                                                 if (__array_op_rval__243 instanceof Function){
                                                                    return await __array_op_rval__243(Environment) 
                                                                } else {
                                                                    return [__array_op_rval__243,Environment]
                                                                }
                                                            })()
                                                        }
                                                    } else {
                                                        {
                                                            await async function(){
                                                                compiled[1]=new AsyncFunction(("{"+ compiled['1']+ "}"));
                                                                return compiled;
                                                                
                                                            }();
                                                            return await (async function(){
                                                                let __array_op_rval__245=compiled['1'];
                                                                 if (__array_op_rval__245 instanceof Function){
                                                                    return await __array_op_rval__245() 
                                                                } else {
                                                                    return [__array_op_rval__245]
                                                                }
                                                            })()
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& (("AsyncFunction"===compiled['0'].ctype)|| ("statement"===compiled['0'].ctype)|| ("objliteral"===compiled['0'].ctype))))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__246=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__246 instanceof Function){
                                                                return await __array_op_rval__246() 
                                                            } else {
                                                                return [__array_op_rval__246]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__248=compiled['1'];
                                                                     if (__array_op_rval__248 instanceof Function){
                                                                        return await __array_op_rval__248(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__248,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new AsyncFunction(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__250=compiled['1'];
                                                                     if (__array_op_rval__250 instanceof Function){
                                                                        return await __array_op_rval__250() 
                                                                    } else {
                                                                        return [__array_op_rval__250]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else if (check_true ((compiled['0'].ctype&& ("Function"===compiled['0'].ctype)))) {
                                                    {
                                                        if (check_true (await (async function(){
                                                            let __array_op_rval__251=compiled['0'].has_lisp_globals;
                                                             if (__array_op_rval__251 instanceof Function){
                                                                return await __array_op_rval__251() 
                                                            } else {
                                                                return [__array_op_rval__251]
                                                            }
                                                        })())){
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function("Environment",("{ return "+ compiled['1']+ "} "));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__253=compiled['1'];
                                                                     if (__array_op_rval__253 instanceof Function){
                                                                        return await __array_op_rval__253(Environment) 
                                                                    } else {
                                                                        return [__array_op_rval__253,Environment]
                                                                    }
                                                                })()
                                                            }
                                                        } else {
                                                            {
                                                                await async function(){
                                                                    compiled[1]=new Function(("{ return "+ compiled['1']+ "}"));
                                                                    return compiled;
                                                                    
                                                                }();
                                                                return await (async function(){
                                                                    let __array_op_rval__255=compiled['1'];
                                                                     if (__array_op_rval__255 instanceof Function){
                                                                        return await __array_op_rval__255() 
                                                                    } else {
                                                                        return [__array_op_rval__255]
                                                                    }
                                                                })()
                                                            }
                                                        }
                                                    }
                                                } else {
                                                    return compiled['1']
                                                }
                                            } () 
                                        })()
                                    } catch (__exception__239) {
                                        if (__exception__239 instanceof Error) {
                                            let e=__exception__239;
                                            {
                                                {
                                                    if (check_true ((opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4)))){
                                                        {
                                                            if (check_true (e.details)){
                                                                await env_log("caught error: ",e.details)
                                                            } else {
                                                                await env_log("caught error: ",e.name,e.message,e)
                                                            }
                                                        }
                                                    };
                                                    if (check_true (((await sub_type(e)==="SyntaxError")&& (opts.log_errors|| (Environment.context.scope.__VERBOSITY__>4))))){
                                                        await console.log(compiled['1'])
                                                    };
                                                    if (check_true (opts.error_report)){
                                                        {
                                                            await (async function(){
                                                                let __array_op_rval__256=opts.error_report;
                                                                 if (__array_op_rval__256 instanceof Function){
                                                                    return await __array_op_rval__256(await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()) 
                                                                } else {
                                                                    return [__array_op_rval__256,await (async function(){
                                                                        if (check_true (e.details)){
                                                                            return e.details
                                                                        } else {
                                                                            return {
                                                                                error:e.name,message:e.message,form:null,parent_forms:null,invalid:true,text:e.stack
                                                                            }
                                                                        }
                                                                    })()]
                                                                }
                                                            })()
                                                        }
                                                    };
                                                    result=e;
                                                    if (check_true ((await not(opts.catch_errors)|| (ctx&& ctx.in_try)))){
                                                        {
                                                            throw result;
                                                            
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    };
                                    return result
                                }
                            }
                        } ()
                    }],["evaluate",async function(expression,ctx,opts) {
                        return await async function(){
                            if (check_true ((namespace===active_namespace))) {
                                return await evaluate_local(expression,ctx,opts)
                            } else if (check_true ((namespace==="core"))) {
                                return await (async function() {
                                    {
                                         let __call_target__=children[active_namespace], __call_method__="evaluate";
                                        return await __call_target__[__call_method__].call(__call_target__,expression,ctx,opts)
                                    } 
                                })()
                            }
                        } ()
                    }],["eval_struct",async function(lisp_struct,ctx,opts) {
                        let rval;
                        rval=null;
                        if (check_true (lisp_struct instanceof Function)){
                            rval=await (async function(){
                                let __array_op_rval__261=lisp_struct;
                                 if (__array_op_rval__261 instanceof Function){
                                    return await __array_op_rval__261() 
                                } else {
                                    return [__array_op_rval__261]
                                }
                            })()
                        } else {
                            rval=await (async function(){
                                 return await evaluate(lisp_struct,ctx,await add({
                                    json_in:true
                                },(opts|| new Object()))) 
                            })()
                        };
                        return rval
                    }],["set_compiler",async function(compiler_function) {
                        let new_ops;
                        new_ops=await (async function(){
                            let __array_op_rval__265=compiler_function;
                             if (__array_op_rval__265 instanceof Function){
                                return await __array_op_rval__265([],{
                                    special_operators:true,env:Environment
                                }) 
                            } else {
                                return [__array_op_rval__265,[],{
                                    special_operators:true,env:Environment
                                }]
                            }
                        })();
                        if (check_true (await is_set_ques_(new_ops))){
                            {
                                compiler_operators=new_ops;
                                compiler=compiler_function;
                                await async function(){
                                    Environment.global_ctx.scope["compiler"]=compiler;
                                    return Environment.global_ctx.scope;
                                    
                                }();
                                await (await get_global("register_feature"))("compiler")
                            }
                        } else {
                            {
                                await console.error("Invalid compiler function: invalid operators returned. Not installing.");
                                throw new EvalError("Invalid compiler function");
                                
                            }
                        };
                        return compiler
                    }],["clone",async function(val) {
                            if (check_true ((val===Environment))){
                                return Environment
                            } else {
                                return await clone(val,0,Environment)
                            }
                        }],["eval",async function(expression) {
                        return await (async function(){
                            let __array_op_rval__140=expression;
                             if (__array_op_rval__140 instanceof Function){
                                return await __array_op_rval__140() 
                            } else {
                                return [__array_op_rval__140]
                            }
                        })()
                    }],["add_escape_encoding",async function(text) {        if (check_true ((text instanceof String || typeof text==='string'))){            let chars;            let acc;            chars=(text).split("");            acc=[];            await (async function() {                let __for_body__3=async function(c) {                     return  await async function(){                        if (check_true( ((await c["charCodeAt"].call(c,0)===34)))) {                            (acc).push(await String.fromCharCode(92));                             return  (acc).push(c)                        } else  {                             return (acc).push(c)                        }                    } ()                };                let __array__4=[],__elements__2=chars;                let __BREAK__FLAG__=false;                for(let __iter__1 in __elements__2) {                    __array__4.push(await __for_body__3(__elements__2[__iter__1]));                    if(__BREAK__FLAG__) {                         __array__4.pop();                        break;                                            }                }return __array__4;                             })();             return  (acc).join("")        } else {              return text        }    }],["get_outside_global",function get_outside_global(refname) {  try {    let tfn = new Function("{ if (typeof " + refname + " === 'undefined') { return undefined } else { return "+refname+" } }");    return tfn();  } catch (ex) {    return undefined;  }}],["as_lisp",lisp_writer],["lisp_writer",lisp_writer],["clone_to_new",async function(options) {
                        let new_env;
                        let my_children;
                        let my_children_declarations;
                        new_env=null;
                        my_children=null;
                        my_children_declarations=null;
                        await env_log(namespace,"cloning: # children: ",await length(children));
                        new_env=await (async function(){
                             return await dlisp_env({
                                env:await (async function(){
                                     return await clone(Environment) 
                                })(),children:await (async function(){
                                     return await clone(children) 
                                })(),children_declarations:await (async function(){
                                     return await clone(children_declarations) 
                                })()
                            }) 
                        })();
                        await env_log(namespace,"constructed: ",await new_env["id"]());
                        return new_env
                    }],["save_env",async function(options) {
                        let new_env;
                        let my_children;
                        let env_constructor;
                        let dcomps;
                        let version_tag;
                        let build_time;
                        let build_headers;
                        let child_env;
                        let want_buffer;
                        let comp_buffer;
                        let preserve_imports;
                        let include_source;
                        let exports;
                        let src;
                        let target_insertion_path;
                        let output_path;
                        new_env=null;
                        my_children=null;
                        env_constructor=null;
                        dcomps=await (async function(){
                             return await (await get_global("date_components"))(new Date()) 
                        })();
                        options=(options|| new Object());
                        version_tag=await (async function(){
                            if (check_true (await not(await blank_ques_(opts.version_tag)))){
                                return opts.version_tag
                            } else {
                                return (await (async function(){
                                    let __array_op_rval__334=dcomps.year;
                                     if (__array_op_rval__334 instanceof Function){
                                        return await __array_op_rval__334(dcomps.month,dcomps.day,dcomps.hour,dcomps.minute) 
                                    } else {
                                        return [__array_op_rval__334,dcomps.month,dcomps.day,dcomps.hour,dcomps.minute]
                                    }
                                })()).join(".")
                            }
                        })();
                        build_time=await (async function(){
                             return await (await get_global("formatted_date"))(new Date()) 
                        })();
                        build_headers=[];
                        child_env=null;
                        want_buffer=(options.want_buffer|| false);
                        comp_buffer=null;
                        preserve_imports=await (async function(){
                            if (check_true ((options&& (options.preserve_imports===false)))){
                                return false
                            } else {
                                return true
                            }
                        })();
                        include_source=false;
                        exports=[];
                        src=await (async function(){
                            if (check_true (await Environment["get_global"].call(Environment,"*env_skeleton*",null))){
                                return await clone(await Environment["get_global"].call(Environment,"*env_skeleton*"))
                            } else {
                                return await (await get_global("reader"))(await (async function(){
                                     return await (await get_global("read_text_file"))("./src/environment.lisp") 
                                })())
                            }
                        })();
                        target_insertion_path=null;
                        output_path=null;
                        if (check_true (Environment.global_ctx.scope["*env_skeleton*"])){
                            {
                                await (await get_global("register_feature"))("*env_skeleton*")
                            }
                        };
                        target_insertion_path=await first(await (async function(){
                             return await (await get_global("findpaths"))(await (async function(){
                                 return "=:included_globals" 
                            })(),src) 
                        })());
                        if (check_true (await not((target_insertion_path instanceof Array)))){
                            throw new EvalError("Unable to find the first included_globals symbol");
                            
                        };
                        target_insertion_path=await conj(await chop(target_insertion_path),[2]);
                        if (check_true (options.include_source)){
                            {
                                include_source=true
                            }
                        };
                        await env_log(namespace,"cloning: # children: ",await length(children));
                        await env_log(namespace,"preserve_imports: ",preserve_imports);
                        exports=await export_symbol_set(await (async function(){
                            if (check_true (options.do_not_include)){
                                return {
                                    do_not_include:options.do_not_include
                                }
                            }
                        })());
                        my_children=await to_object(await (async function(){
                            let __collector;
                            let __result;
                            let __action;
                            __collector=[];
                            __result=null;
                            __action=async function(child) {
                                if (check_true (await resolve_path(await (async function(){
                                    let __array_op_rval__335=child['0'];
                                     if (__array_op_rval__335 instanceof Function){
                                        return await __array_op_rval__335("serialize_with_image") 
                                    } else {
                                        return [__array_op_rval__335,"serialize_with_image"]
                                    }
                                })(),children_declarations))){
                                    {
                                        child_env=await child['1']["compile"].call(child['1'],await child['1']["export_symbol_set"].call(child['1'],{
                                            no_compiler:true
                                        }),{
                                            throw_on_error:true
                                        });
                                        return await (async function(){
                                            let __array_op_rval__336=child['0'];
                                             if (__array_op_rval__336 instanceof Function){
                                                return await __array_op_rval__336(await (async function(){
                                                     return ["=:javascript",child_env] 
                                                })()) 
                                            } else {
                                                return [__array_op_rval__336,await (async function(){
                                                     return ["=:javascript",child_env] 
                                                })()]
                                            }
                                        })()
                                    }
                                }
                            };
                            ;
                            await (async function() {
                                let __for_body__339=async function(__item) {
                                    __result=await __action(__item);
                                    if (check_true (__result)){
                                        return (__collector).push(__result)
                                    }
                                };
                                let __array__340=[],__elements__338=await pairs(children);
                                let __BREAK__FLAG__=false;
                                for(let __iter__337 in __elements__338) {
                                    __array__340.push(await __for_body__339(__elements__338[__iter__337]));
                                    if(__BREAK__FLAG__) {
                                         __array__340.pop();
                                        break;
                                        
                                    }
                                }return __array__340;
                                 
                            })();
                            return __collector
                        })());
                        await (await get_global("set_path"))(target_insertion_path,src,await (async function(){
                             return ["=:fn",[],await to_object(await (async function(){
                                 return [["definitions",await (async function(){
                                     return ["=:quote",await (async function(){
                                         return await clone(Environment.definitions) 
                                    })()] 
                                })()],["declarations",await (async function(){
                                     return await clone(Environment.declarations) 
                                })()],["config",await (async function(){
                                    let exp_conf;
                                    exp_conf=await (async function(){
                                         return await clone(Environment.global_ctx.scope["*env_config*"]) 
                                    })();
                                    if (check_true (await not(preserve_imports))){
                                        {
                                            await async function(){
                                                exp_conf["imports"]=new Object();
                                                return exp_conf;
                                                
                                            }()
                                        }
                                    };
                                    if (check_true (options.features)){
                                        {
                                            await async function(){
                                                exp_conf["features"]=options.features;
                                                return exp_conf;
                                                
                                            }()
                                        }
                                    };
                                    return exp_conf
                                })()],["imports",await (async function(){
                                    if (check_true (preserve_imports)){
                                        return await to_object(await (async function() {
                                            let __for_body__345=async function(imp_source) {
                                                return await (async function(){
                                                    let __array_op_rval__347=imp_source.symbol;
                                                     if (__array_op_rval__347 instanceof Function){
                                                        return await __array_op_rval__347({
                                                            initializer:await (async function(){
                                                                 return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                                            })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                                        }) 
                                                    } else {
                                                        return [__array_op_rval__347,{
                                                            initializer:await (async function(){
                                                                 return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                                            })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                                        }]
                                                    }
                                                })()
                                            };
                                            let __array__346=[],__elements__344=await values((await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)|| new Object()));
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__343 in __elements__344) {
                                                __array__346.push(await __for_body__345(__elements__344[__iter__343]));
                                                if(__BREAK__FLAG__) {
                                                     __array__346.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__346;
                                             
                                        })())
                                    } else {
                                        return new Object()
                                    }
                                })()],["symbols",await (async function(){
                                     return ["=:javascript",await compile(await to_object(exports),{
                                        throw_on_error:true
                                    })] 
                                })()],["children_declarations",await (async function(){
                                     return ["=:fn",[],await clone(children_declarations)] 
                                })()],["children",my_children]] 
                            })())] 
                        })());
                        output_path=await (async function(){
                            if (check_true (options.want_buffer)){
                                return null
                            } else {
                                return (options.save_as|| await resolve_path(["*env_config*","export","save_path"],Environment.global_ctx.scope))
                            }
                        })();
                        if (check_true (output_path instanceof Function)){
                            output_path=await (async function(){
                                let __array_op_rval__348=output_path;
                                 if (__array_op_rval__348 instanceof Function){
                                    return await __array_op_rval__348() 
                                } else {
                                    return [__array_op_rval__348]
                                }
                            })()
                        };
                        if (check_true ((await not((output_path instanceof String || typeof output_path==='string'))&& output_path))){
                            throw new EvalError("invalid name for target for saving the environment.  Must be a string or function");
                            
                        };
                        return await async function(){
                            if (check_true ((want_buffer|| (output_path&& await ends_with_ques_(".js",output_path))))) {
                                {
                                    (build_headers).push(("// Build Time: "+ build_time));
                                    (build_headers).push(("// Version: "+ version_tag));
                                    (build_headers).push(("export const DLISP_ENV_VERSION='"+ version_tag+ "';"));
                                    await env_log("saving to: ",output_path);
                                    return await (await get_global("compile_buffer"))(src,"init_dlisp",{
                                        namespace:namespace,toplevel:true,include_boilerplate:false,verbose:false,bundle:true,want_buffer:want_buffer,imports:await (async function(){
                                            if (check_true (preserve_imports)){
                                                return await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)
                                            }
                                        })(),js_headers:await (async function(){
                                             return [await (await get_global("show"))(check_true),await (async function(){
                                                 return await (await get_global("show"))(get_next_environment_id) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(get_outside_global) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(subtype) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(lisp_writer) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(clone) 
                                            })(),await (async function(){
                                                 return await (await get_global("show"))(LispSyntaxError) 
                                            })()] 
                                        })(),bundle_options:{
                                            default_namespace:await resolve_path(["*env_config*","export","default_namespace"],Environment.global_ctx.scope)
                                        },output_file:output_path,include_source:(options.include_source|| await resolve_path(["*env_config*","export","include_source"],Environment.global_ctx.scope)),build_headers:build_headers
                                    })
                                }
                            } else if (check_true ((output_path&& await ends_with_ques_(".lisp",output_path)))) {
                                return await (await get_global("write_text_file"))(output_path,await JSON.stringify(src,null,4))
                            } else {
                                return src
                            }
                        } ()
                    }],["null",null]]
}
}
};
;
if (check_true ((included_globals&& (namespace==="core")))){
    {
        included_globals=await included_globals();
        if (check_true (await resolve_path(["symbols","compiler"],included_globals))){
            {
                await async function(){
                    Environment.global_ctx.scope["compiler"]=await resolve_path(["symbols","compiler"],included_globals);
                    return Environment.global_ctx.scope;
                    
                }();
                compiler=Environment.global_ctx.scope.compiler
            }
        };
        if (check_true ((included_globals["config"] instanceof Object))){
            {
                await async function(){
                    Environment.global_ctx.scope["*env_config*"]=included_globals.config;
                    return Environment.global_ctx.scope;
                    
                }()
            }
        };
        let imps=null;
        ;
        if (check_true ((included_globals["imports"] instanceof Object))){
            {
                imps=included_globals["imports"];
                if (check_true (imps)){
                    {
                        await (async function() {
                            let __for_body__284=async function(imp_source) {
                                return await async function(){
                                    if (check_true ((imp_source.namespace===namespace))) {
                                        {
                                            return await async function(){
                                                Environment.global_ctx.scope[imp_source.symbol]=imp_source.initializer;
                                                return Environment.global_ctx.scope;
                                                
                                            }()
                                        }
                                    }
                                } ()
                            };
                            let __array__285=[],__elements__283=await values(imps);
                            let __BREAK__FLAG__=false;
                            for(let __iter__282 in __elements__283) {
                                __array__285.push(await __for_body__284(__elements__283[__iter__282]));
                                if(__BREAK__FLAG__) {
                                     __array__285.pop();
                                    break;
                                    
                                }
                            }return __array__285;
                             
                        })()
                    }
                }
            }
        };
        if (check_true ((included_globals["symbols"] instanceof Object))){
            {
                await (async function() {
                    let __for_body__289=async function(symset) {
                        if (check_true ((null==Environment.global_ctx.scope[symset['0']]))){
                            {
                                return await async function(){
                                    Environment.global_ctx.scope[symset['0']]=symset['1'];
                                    return Environment.global_ctx.scope;
                                    
                                }()
                            }
                        }
                    };
                    let __array__290=[],__elements__288=await pairs(included_globals.symbols);
                    let __BREAK__FLAG__=false;
                    for(let __iter__287 in __elements__288) {
                        __array__290.push(await __for_body__289(__elements__288[__iter__287]));
                        if(__BREAK__FLAG__) {
                             __array__290.pop();
                            break;
                            
                        }
                    }return __array__290;
                     
                })()
            }
        };
        if (check_true ((included_globals["definitions"] instanceof Object))){
            {
                await (async function() {
                    let __for_body__294=async function(symset) {
                        if (check_true ((null==Environment.definitions[symset['0']]))){
                            {
                                return await async function(){
                                    Environment.definitions[symset['0']]=symset['1'];
                                    return Environment.definitions;
                                    
                                }()
                            }
                        }
                    };
                    let __array__295=[],__elements__293=await pairs(included_globals.definitions);
                    let __BREAK__FLAG__=false;
                    for(let __iter__292 in __elements__293) {
                        __array__295.push(await __for_body__294(__elements__293[__iter__292]));
                        if(__BREAK__FLAG__) {
                             __array__295.pop();
                            break;
                            
                        }
                    }return __array__295;
                     
                })()
            }
        };
        if (check_true ((included_globals["declarations"] instanceof Object))){
            {
                await (async function() {
                    let __for_body__299=async function(symset) {
                        if (check_true ((null==Environment.declarations[symset['0']]))){
                            {
                                return await async function(){
                                    Environment.declarations[symset['0']]=await (async function(){
                                         return "=:symset.1" 
                                    })();
                                    return Environment.declarations;
                                    
                                }()
                            }
                        }
                    };
                    let __array__300=[],__elements__298=await pairs(included_globals.declarations);
                    let __BREAK__FLAG__=false;
                    for(let __iter__297 in __elements__298) {
                        __array__300.push(await __for_body__299(__elements__298[__iter__297]));
                        if(__BREAK__FLAG__) {
                             __array__300.pop();
                            break;
                            
                        }
                    }return __array__300;
                     
                })()
            }
        };
        if (check_true (Environment.global_ctx.scope["compiler"])){
            {
                await set_compiler(Environment.global_ctx.scope["compiler"])
            }
        };
        if (check_true ((included_globals["children"] instanceof Object))){
            {
                await (async function() {
                    let __for_body__304=async function(childset) {
                        return await (await get_global("create_namespace"))(childset['0'],await (async function(){
                            if (check_true (included_globals.children_declarations[childset['0']])){
                                return included_globals.children_declarations[childset['0']]
                            } else {
                                return new Object()
                            }
                        })(),true)
                    };
                    let __array__305=[],__elements__303=await pairs(included_globals.children);
                    let __BREAK__FLAG__=false;
                    for(let __iter__302 in __elements__303) {
                        __array__305.push(await __for_body__304(__elements__303[__iter__302]));
                        if(__BREAK__FLAG__) {
                             __array__305.pop();
                            break;
                            
                        }
                    }return __array__305;
                     
                })();
                await (async function() {
                    let __for_body__308=async function(childset) {
                        await console.log("installing child symbols: ",childset['0']);
                        let childenv=children[childset['0']];
                        ;
                        if (check_true ((included_globals["imports"] instanceof Object))){
                            {
                                imps=included_globals["imports"];
                                if (check_true (imps)){
                                    {
                                        await (async function() {
                                            let __for_body__312=async function(imp_source) {
                                                if (check_true (children[imp_source.namespace])){
                                                    {
                                                        return await set_global((""+ imp_source.namespace+ "/"+ imp_source.symbol),imp_source.initializer)
                                                    }
                                                }
                                            };
                                            let __array__313=[],__elements__311=await values(imps);
                                            let __BREAK__FLAG__=false;
                                            for(let __iter__310 in __elements__311) {
                                                __array__313.push(await __for_body__312(__elements__311[__iter__310]));
                                                if(__BREAK__FLAG__) {
                                                     __array__313.pop();
                                                    break;
                                                    
                                                }
                                            }return __array__313;
                                             
                                        })()
                                    }
                                }
                            }
                        };
                        debugger;
                        ;
                        await async function(){
                            childset[1]=await childenv["eval"].call(childenv,childset['1']);
                            return childset;
                            
                        }();
                        return await (async function() {
                            let __for_body__317=async function(symset) {
                                if (check_true ((null==await resolve_path(await (async function(){
                                    let __array_op_rval__319=childset['0'];
                                     if (__array_op_rval__319 instanceof Function){
                                        return await __array_op_rval__319("context","scope",symset['0']) 
                                    } else {
                                        return [__array_op_rval__319,"context","scope",symset['0']]
                                    }
                                })(),children)))){
                                    {
                                        return await (await get_global("set_path"))(await (async function(){
                                            let __array_op_rval__320=childset['0'];
                                             if (__array_op_rval__320 instanceof Function){
                                                return await __array_op_rval__320("context","scope",symset['0']) 
                                            } else {
                                                return [__array_op_rval__320,"context","scope",symset['0']]
                                            }
                                        })(),children,symset['1'])
                                    }
                                }
                            };
                            let __array__318=[],__elements__316=childset['1'];
                            let __BREAK__FLAG__=false;
                            for(let __iter__315 in __elements__316) {
                                __array__318.push(await __for_body__317(__elements__316[__iter__315]));
                                if(__BREAK__FLAG__) {
                                     __array__318.pop();
                                    break;
                                    
                                }
                            }return __array__318;
                             
                        })()
                    };
                    let __array__309=[],__elements__307=await pairs(included_globals.children);
                    let __BREAK__FLAG__=false;
                    for(let __iter__306 in __elements__307) {
                        __array__309.push(await __for_body__308(__elements__307[__iter__306]));
                        if(__BREAK__FLAG__) {
                             __array__309.pop();
                            break;
                            
                        }
                    }return __array__309;
                     
                })()
            }
        }
    }
};
let clone_to_new=async function(options) {
    let new_env;
    let my_children;
    let my_children_declarations;
    new_env=null;
    my_children=null;
    my_children_declarations=null;
    await env_log(namespace,"cloning: # children: ",await length(children));
    new_env=await (async function(){
         return await dlisp_env({
            env:await (async function(){
                 return await clone(Environment) 
            })(),children:await (async function(){
                 return await clone(children) 
            })(),children_declarations:await (async function(){
                 return await clone(children_declarations) 
            })()
        }) 
    })();
    await env_log(namespace,"constructed: ",await new_env["id"]());
    return new_env
};
;
let export_symbol_set=async function(options) {
    let __collector;
    let __result;
    let __action;
    __collector=[];
    __result=null;
    __action=async function(symset) {
        return await async function(){
            if (check_true ((options&& options.no_compiler&& (symset['0']==="compiler")))) {
                return null
            } else if (check_true (await starts_with_ques_("$",symset['0']))) {
                return null
            } else if (check_true ((await resolve_path(await (async function(){
                let __array_op_rval__321=symset['0'];
                 if (__array_op_rval__321 instanceof Function){
                    return await __array_op_rval__321("serialize_with_image") 
                } else {
                    return [__array_op_rval__321,"serialize_with_image"]
                }
            })(),Environment.definitions)===false))) {
                return null
            } else if (check_true ((options&& options.do_not_include&& await contains_ques_(symset['0'],options.do_not_include)))) {
                return null
            } else if (check_true ((symset['0']==="*env_skeleton*"))) {
                return await (async function(){
                    let __array_op_rval__322=symset['0'];
                     if (__array_op_rval__322 instanceof Function){
                        return await __array_op_rval__322(await (async function(){
                             return ["=:quotel",Environment.global_ctx.scope["*env_skeleton*"]] 
                        })()) 
                    } else {
                        return [__array_op_rval__322,await (async function(){
                             return ["=:quotel",Environment.global_ctx.scope["*env_skeleton*"]] 
                        })()]
                    }
                })()
            } else if (check_true (await resolve_path(await (async function(){
                let __array_op_rval__323=symset['0'];
                 if (__array_op_rval__323 instanceof Function){
                    return await __array_op_rval__323("initializer") 
                } else {
                    return [__array_op_rval__323,"initializer"]
                }
            })(),Environment.definitions))) {
                return await (async function(){
                    let __array_op_rval__325=symset['0'];
                     if (__array_op_rval__325 instanceof Function){
                        return await __array_op_rval__325(await resolve_path(await (async function(){
                            let __array_op_rval__324=symset['0'];
                             if (__array_op_rval__324 instanceof Function){
                                return await __array_op_rval__324("initializer") 
                            } else {
                                return [__array_op_rval__324,"initializer"]
                            }
                        })(),Environment.definitions)) 
                    } else {
                        return [__array_op_rval__325,await resolve_path(await (async function(){
                            let __array_op_rval__324=symset['0'];
                             if (__array_op_rval__324 instanceof Function){
                                return await __array_op_rval__324("initializer") 
                            } else {
                                return [__array_op_rval__324,"initializer"]
                            }
                        })(),Environment.definitions)]
                    }
                })()
            } else if (check_true ((null===symset['1']))) {
                return await (async function(){
                    let __array_op_rval__326=symset['0'];
                     if (__array_op_rval__326 instanceof Function){
                        return await __array_op_rval__326(await (async function(){
                             return "=:nil" 
                        })()) 
                    } else {
                        return [__array_op_rval__326,await (async function(){
                             return "=:nil" 
                        })()]
                    }
                })()
            } else if (check_true ((undefined===symset['1']))) {
                return await (async function(){
                    let __array_op_rval__327=symset['0'];
                     if (__array_op_rval__327 instanceof Function){
                        return await __array_op_rval__327(await (async function(){
                             return "=:undefined" 
                        })()) 
                    } else {
                        return [__array_op_rval__327,await (async function(){
                             return "=:undefined" 
                        })()]
                    }
                })()
            } else {
                return await (async function(){
                    let __array_op_rval__328=symset['0'];
                     if (__array_op_rval__328 instanceof Function){
                        return await __array_op_rval__328(symset['1']) 
                    } else {
                        return [__array_op_rval__328,symset['1']]
                    }
                })()
            }
        } ()
    };
    ;
    await (async function() {
        let __for_body__331=async function(__item) {
            __result=await __action(__item);
            if (check_true (__result)){
                return (__collector).push(__result)
            }
        };
        let __array__332=[],__elements__330=await pairs(await (async function(){
             return await clone(Environment.global_ctx.scope) 
        })());
        let __BREAK__FLAG__=false;
        for(let __iter__329 in __elements__330) {
            __array__332.push(await __for_body__331(__elements__330[__iter__329]));
            if(__BREAK__FLAG__) {
                 __array__332.pop();
                break;
                
            }
        }return __array__332;
         
    })();
    return __collector
};
;
let save_env=async function(options) {
    let new_env;
    let my_children;
    let env_constructor;
    let dcomps;
    let version_tag;
    let build_time;
    let build_headers;
    let child_env;
    let want_buffer;
    let comp_buffer;
    let preserve_imports;
    let include_source;
    let exports;
    let src;
    let target_insertion_path;
    let output_path;
    new_env=null;
    my_children=null;
    env_constructor=null;
    dcomps=await (async function(){
         return await (await get_global("date_components"))(new Date()) 
    })();
    options=(options|| new Object());
    version_tag=await (async function(){
        if (check_true (await not(await blank_ques_(opts.version_tag)))){
            return opts.version_tag
        } else {
            return (await (async function(){
                let __array_op_rval__333=dcomps.year;
                 if (__array_op_rval__333 instanceof Function){
                    return await __array_op_rval__333(dcomps.month,dcomps.day,dcomps.hour,dcomps.minute) 
                } else {
                    return [__array_op_rval__333,dcomps.month,dcomps.day,dcomps.hour,dcomps.minute]
                }
            })()).join(".")
        }
    })();
    build_time=await (async function(){
         return await (await get_global("formatted_date"))(new Date()) 
    })();
    build_headers=[];
    child_env=null;
    want_buffer=(options.want_buffer|| false);
    comp_buffer=null;
    preserve_imports=await (async function(){
        if (check_true ((options&& (options.preserve_imports===false)))){
            return false
        } else {
            return true
        }
    })();
    include_source=false;
    exports=[];
    src=await (async function(){
        if (check_true (await Environment["get_global"].call(Environment,"*env_skeleton*",null))){
            return await clone(await Environment["get_global"].call(Environment,"*env_skeleton*"))
        } else {
            return await (await get_global("reader"))(await (async function(){
                 return await (await get_global("read_text_file"))("./src/environment.lisp") 
            })())
        }
    })();
    target_insertion_path=null;
    output_path=null;
    if (check_true (Environment.global_ctx.scope["*env_skeleton*"])){
        {
            await (await get_global("register_feature"))("*env_skeleton*")
        }
    };
    target_insertion_path=await first(await (async function(){
         return await (await get_global("findpaths"))(await (async function(){
             return "=:included_globals" 
        })(),src) 
    })());
    if (check_true (await not((target_insertion_path instanceof Array)))){
        throw new EvalError("Unable to find the first included_globals symbol");
        
    };
    target_insertion_path=await conj(await chop(target_insertion_path),[2]);
    if (check_true (options.include_source)){
        {
            include_source=true
        }
    };
    await env_log(namespace,"cloning: # children: ",await length(children));
    await env_log(namespace,"preserve_imports: ",preserve_imports);
    exports=await export_symbol_set(await (async function(){
        if (check_true (options.do_not_include)){
            return {
                do_not_include:options.do_not_include
            }
        }
    })());
    my_children=await to_object(await (async function(){
        let __collector;
        let __result;
        let __action;
        __collector=[];
        __result=null;
        __action=async function(child) {
            if (check_true (await resolve_path(await (async function(){
                let __array_op_rval__334=child['0'];
                 if (__array_op_rval__334 instanceof Function){
                    return await __array_op_rval__334("serialize_with_image") 
                } else {
                    return [__array_op_rval__334,"serialize_with_image"]
                }
            })(),children_declarations))){
                {
                    child_env=await child['1']["compile"].call(child['1'],await child['1']["export_symbol_set"].call(child['1'],{
                        no_compiler:true
                    }),{
                        throw_on_error:true
                    });
                    return await (async function(){
                        let __array_op_rval__335=child['0'];
                         if (__array_op_rval__335 instanceof Function){
                            return await __array_op_rval__335(await (async function(){
                                 return ["=:javascript",child_env] 
                            })()) 
                        } else {
                            return [__array_op_rval__335,await (async function(){
                                 return ["=:javascript",child_env] 
                            })()]
                        }
                    })()
                }
            }
        };
        ;
        await (async function() {
            let __for_body__338=async function(__item) {
                __result=await __action(__item);
                if (check_true (__result)){
                    return (__collector).push(__result)
                }
            };
            let __array__339=[],__elements__337=await pairs(children);
            let __BREAK__FLAG__=false;
            for(let __iter__336 in __elements__337) {
                __array__339.push(await __for_body__338(__elements__337[__iter__336]));
                if(__BREAK__FLAG__) {
                     __array__339.pop();
                    break;
                    
                }
            }return __array__339;
             
        })();
        return __collector
    })());
    await (await get_global("set_path"))(target_insertion_path,src,await (async function(){
         return ["=:fn",[],await to_object(await (async function(){
             return [["definitions",await (async function(){
                 return ["=:quote",await (async function(){
                     return await clone(Environment.definitions) 
                })()] 
            })()],["declarations",await (async function(){
                 return await clone(Environment.declarations) 
            })()],["config",await (async function(){
                let exp_conf;
                exp_conf=await (async function(){
                     return await clone(Environment.global_ctx.scope["*env_config*"]) 
                })();
                if (check_true (await not(preserve_imports))){
                    {
                        await async function(){
                            exp_conf["imports"]=new Object();
                            return exp_conf;
                            
                        }()
                    }
                };
                if (check_true (options.features)){
                    {
                        await async function(){
                            exp_conf["features"]=options.features;
                            return exp_conf;
                            
                        }()
                    }
                };
                return exp_conf
            })()],["imports",await (async function(){
                if (check_true (preserve_imports)){
                    return await to_object(await (async function() {
                        let __for_body__344=async function(imp_source) {
                            return await (async function(){
                                let __array_op_rval__346=imp_source.symbol;
                                 if (__array_op_rval__346 instanceof Function){
                                    return await __array_op_rval__346({
                                        initializer:await (async function(){
                                             return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                        })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                    }) 
                                } else {
                                    return [__array_op_rval__346,{
                                        initializer:await (async function(){
                                             return ["=:javascript","new function () { return ",imp_source.symbol," }"] 
                                        })(),symbol:imp_source.symbol,namespace:imp_source.namespace
                                    }]
                                }
                            })()
                        };
                        let __array__345=[],__elements__343=await values((await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)|| new Object()));
                        let __BREAK__FLAG__=false;
                        for(let __iter__342 in __elements__343) {
                            __array__345.push(await __for_body__344(__elements__343[__iter__342]));
                            if(__BREAK__FLAG__) {
                                 __array__345.pop();
                                break;
                                
                            }
                        }return __array__345;
                         
                    })())
                } else {
                    return new Object()
                }
            })()],["symbols",await (async function(){
                 return ["=:javascript",await compile(await to_object(exports),{
                    throw_on_error:true
                })] 
            })()],["children_declarations",await (async function(){
                 return ["=:fn",[],await clone(children_declarations)] 
            })()],["children",my_children]] 
        })())] 
    })());
    output_path=await (async function(){
        if (check_true (options.want_buffer)){
            return null
        } else {
            return (options.save_as|| await resolve_path(["*env_config*","export","save_path"],Environment.global_ctx.scope))
        }
    })();
    if (check_true (output_path instanceof Function)){
        output_path=await (async function(){
            let __array_op_rval__347=output_path;
             if (__array_op_rval__347 instanceof Function){
                return await __array_op_rval__347() 
            } else {
                return [__array_op_rval__347]
            }
        })()
    };
    if (check_true ((await not((output_path instanceof String || typeof output_path==='string'))&& output_path))){
        throw new EvalError("invalid name for target for saving the environment.  Must be a string or function");
        
    };
    return await async function(){
        if (check_true ((want_buffer|| (output_path&& await ends_with_ques_(".js",output_path))))) {
            {
                (build_headers).push(("// Build Time: "+ build_time));
                (build_headers).push(("// Version: "+ version_tag));
                (build_headers).push(("export const DLISP_ENV_VERSION='"+ version_tag+ "';"));
                await env_log("saving to: ",output_path);
                return await (await get_global("compile_buffer"))(src,"init_dlisp",{
                    namespace:namespace,toplevel:true,include_boilerplate:false,verbose:false,bundle:true,want_buffer:want_buffer,imports:await (async function(){
                        if (check_true (preserve_imports)){
                            return await resolve_path(["*env_config*","imports"],Environment.global_ctx.scope)
                        }
                    })(),js_headers:await (async function(){
                         return [await (await get_global("show"))(check_true),await (async function(){
                             return await (await get_global("show"))(get_next_environment_id) 
                        })(),await (async function(){
                             return await (await get_global("show"))(get_outside_global) 
                        })(),await (async function(){
                             return await (await get_global("show"))(subtype) 
                        })(),await (async function(){
                             return await (await get_global("show"))(lisp_writer) 
                        })(),await (async function(){
                             return await (await get_global("show"))(clone) 
                        })(),await (async function(){
                             return await (await get_global("show"))(LispSyntaxError) 
                        })()] 
                    })(),bundle_options:{
                        default_namespace:await resolve_path(["*env_config*","export","default_namespace"],Environment.global_ctx.scope)
                    },output_file:output_path,include_source:(options.include_source|| await resolve_path(["*env_config*","export","include_source"],Environment.global_ctx.scope)),build_headers:build_headers
                })
            }
        } else if (check_true ((output_path&& await ends_with_ques_(".lisp",output_path)))) {
            return await (await get_global("write_text_file"))(output_path,await JSON.stringify(src,null,4))
        } else {
            return src
        }
    } ()
};
;
if (check_true (("undefined"===typeof Element))){
    await async function(){
        globalThis["Element"]=function() {
            return false
        };
        return globalThis;
        
    }()
};
let reader=async function(text,opts) {     return  await async function(){        if (check_true( (undefined==text))) {             throw new EvalError(("reader: received undefined, text must be a string."));                    } else if (check_true( await (await Environment.get_global("not"))((text instanceof String || typeof text==='string')))) {             throw new EvalError(("reader: received "+await (await Environment.get_global("sub_type"))(text)+": text must be a string."));                    } else  {            let output_structure;            let idx;            let line_number;            let column_number;            let source_name;            let len;            let debugmode;            let in_buffer;            let in_code;            let in_quotes;            let in_long_text;            let in_comment;            let in_single_quote;            let reading_object;            let mode;            let local_text;            let position;            let read_table;            let get_char;            let error;            let handle_escape_char;            let process_word;            let registered_stop_char;            let handler_stack;            let handler;            let c;            let next_c;            let depth;            let stop;            let read_block;            output_structure=[];            idx=-1;            line_number=1;            column_number=0;            source_name=await (async function () {                 if (check_true ((opts && opts["source_name"]))){                      return (opts && opts["source_name"])                } else {                      return "anonymous"                }             })();            opts=(opts||new Object());            len=(await (await Environment.get_global("length"))(text)-1);            debugmode=await async function(){                if (check_true((opts && opts["verbose"]))) {                     return true                } else if (check_true( ((opts && opts["verbose"])===false))) {                     return false                } else if (check_true( ((await Environment.get_global("__VERBOSITY__"))>6))) {                     return true                } else  {                     return false                }            } ();            in_buffer=(text).split("");            in_code=0;            in_quotes=1;            in_long_text=2;            in_comment=3;            in_single_quote=4;            reading_object=false;            mode=in_code;            local_text=async function() {                let start;                let end;                start=await Math.max(0,(idx-10));                end=await Math.min(await (await Environment.get_global("length"))(in_buffer),(idx+10));                 return  (await (await Environment.get_global("slice"))(in_buffer,start,end)).join("")            };            position=async function(offset) {                 return  ("line: "+line_number+" column: "+await (async function () {                     if (check_true (offset)){                          return (column_number+offset)                    } else {                          return column_number                    }                 })())            };            read_table=await (await Environment.get_global("add"))(new Object(),await (async function() {                 if (check_true ((opts && opts["read_table_entries"]))){                      return (opts && opts["read_table_entries"])                } else {                      return new Object()                }             } )(),await ( async function(){                let __obj__1=new Object();                __obj__1["("]=[")",async function(block) {                     return  block                }];                __obj__1["["]=["]",async function(block) {                     return  block                }];                __obj__1["{"]=["}",async function(block) {                    let obj;                    let __idx__2= async function(){                        return -1                    };                    let key_mode;                    let need_colon;                    let value_mode;                    let key;                    let value;                    let cpos;                    let state;                    let block_length;                    {                        obj=new Object();                        let idx=await __idx__2();                        ;                        key_mode=0;                        need_colon=1;                        value_mode=2;                        key=null;                        value=null;                        cpos=null;
                        state=key_mode;
                        block_length=(await (await Environment.get_global("length"))(block)-1);
                        reading_object=false;
                        await (async function(){
                             let __test_condition__3=async function() {
                                 return  (idx<block_length)
                            };
                            let __body_ref__4=async function() {
                                (idx=idx+1);
                                key=block[idx];
                                if (check_true (((key instanceof Array)&&((key && key.length)===2)&&((key && key["0"])==="=:quotem")&&((key && key["1"]) instanceof String || typeof (key && key["1"])==='string')))){
                                     key=(key && key["1"])
                                };
                                if (check_true (((key instanceof String || typeof key==='string')&&await (await Environment.get_global("starts_with?"))("=:",key)&&(await (await Environment.get_global("length"))(key)>2)))){
                                     key=await key["substr"].call(key,2)
                                };
                                 return  await async function(){
                                    if (check_true( await (await Environment.get_global("blank?"))(key))) {
                                         return await error("missing object key",("blank or nil key: "+block[idx]))
                                    } else if (check_true( await (await Environment.get_global("is_number?"))(key))) {
                                        (idx=idx+1);
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    } else if (check_true( ((key instanceof String || typeof key==='string')&&await (await Environment.get_global("contains?"))(":",key)&&await (await Environment.get_global("not"))(await (await Environment.get_global("ends_with?"))(":",key))))) {
                                        cpos=await key["indexOf"].call(key,":");
                                        value=await key["substr"].call(key,(cpos+1));
                                        key=await key["substr"].call(key,0,cpos);
                                        value=await process_word((value).split(""),0);
                                         return  await async function(){
                                            obj[key]=value;
                                            return obj;
                                            
                                        }()
                                    } else  {
                                        (idx=idx+1);
                                        if (check_true (await (await Environment.get_global("ends_with?"))(":",key))){
                                             key=await (await Environment.get_global("chop"))(key)
                                        } else {
                                            if (check_true ((block[idx]===":"))){
                                                 (idx=idx+1)
                                            } else {
                                                 await error("missing colon",("expected colon for: "+key))
                                            }
                                        };
                                         return  await async function(){
                                            obj[key]=block[idx];
                                            return obj;
                                            
                                        }()
                                    }
                                } ()
                            };
                            let __BREAK__FLAG__=false;
                            while(await __test_condition__3()) {
                                await __body_ref__4();
                                 if(__BREAK__FLAG__) {
                                     break;
                                    
                                }
                            } ;
                            
                        })();
                         return  obj
                    }
                },async function() {
                     return  reading_object=true
                }];
                __obj__1["\""]=["\"",async function(block) {
                     return  ["quotes",block]
                }];
                return __obj__1;
                
            })());
            get_char=async function(pos) {
                 return  in_buffer[pos]
            };
            error=async function(type,message,offset) {
                throw new LispSyntaxError({
                    message:message,position:await position(offset),pos:{
                        line:line_number,column:(column_number+(offset||0))
                    },depth:depth,local_text:await local_text(),source_name:source_name,type:type
                });
                
            };
            handle_escape_char=async function(c) {
                let ccode;
                ccode=await c["charCodeAt"].call(c,0);
                 return  await async function(){
                    if (check_true( (ccode===34))) {
                         return c
                    } else if (check_true( (ccode===92))) {
                         return c
                    } else if (check_true( (c==="t"))) {
                         return await String.fromCharCode(9)
                    } else if (check_true( (c==="n"))) {
                         return await String.fromCharCode(10)
                    } else if (check_true( (c==="r"))) {
                         return await String.fromCharCode(13)
                    } else if (check_true( (c==="f"))) {
                         return c
                    } else if (check_true( (c==="b"))) {
                         return c
                    } else  {
                         return c
                    }
                } ()
            };
            process_word=async function(word_acc,backtick_mode) {
                let word;
                let word_as_number;
                word=(word_acc).join("");
                word_as_number=await Number(word);
                if (check_true (debugmode)){
                     console.log("process_word: ",word,word_as_number,backtick_mode)
                };
                 return  await async function(){
                    if (check_true( ("true"===word))) {
                         return true
                    } else if (check_true( ("false"===word))) {
                         return false
                    } else if (check_true( (":"===word))) {
                         return word
                    } else if (check_true( (",@"===word))) {
                         return "=$,@"
                    } else if (check_true( ((",#"===word)||("##"===word)))) {
                         return "=:##"
                    } else if (check_true( ("=$,@"===word))) {
                         return "=$,@"
                    } else if (check_true( ("=:##"===word))) {
                         return "=:##"
                    } else if (check_true( await isNaN(word_as_number))) {
                         return  await async function(){
                            if (check_true( (word==="=:"))) {
                                 return  "=:"
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))(")",word)))) {
                                 return await error("trailing character","unexpected trailing parenthesis")
                            } else if (check_true( ((backtick_mode===0)&&await (await Environment.get_global("ends_with?"))("]",word)))) {
                                 return await error("trailing character","unexpected trailing bracket")
                            } else if (check_true( await (await Environment.get_global("contains?"))(word,["=:(","=:)","=:'"]))) {
                                 return  word
                            } else if (check_true( (backtick_mode===1))) {
                                 return word
                            } else  {
                                 return await (await Environment.get_global("add"))("=:",word)
                            }
                        } ()
                    } else if (check_true( await (await Environment.get_global("is_number?"))(word_as_number))) {
                         return word_as_number
                    } else  {
                        console.log("reader: ",await position()," what is this?",word,word_acc,await local_text());
                         return  word
                    }
                } ()
            };
            registered_stop_char=null;
            handler_stack=[];
            handler=null;
            c=null;
            next_c=null;
            depth=0;
            stop=false;
            read_block=async function(_depth,_prefix_op) {
                let acc;
                let word_acc;
                let backtick_mode;
                let escape_mode;
                let last_c;
                let block_return;
                acc=[];
                word_acc=[];
                backtick_mode=0;
                escape_mode=0;
                last_c=null;
                block_return=null;
                if (check_true (_prefix_op)){
                     (acc).push(_prefix_op)
                };
                depth=_depth;
                await (async function(){
                     let __test_condition__8=async function() {
                         return  (await (await Environment.get_global("not"))(stop)&&(idx<len))
                    };
                    let __body_ref__9=async function() {
                        idx+=1;
                        escape_mode=await Math.max(0,(escape_mode-1));
                        c=await get_char(idx);
                        next_c=await get_char((idx+1));
                        if (check_true ((c==="\n"))){
                            line_number+=1;
                             column_number=0
                        };
                        if (check_true (debugmode)){
                             await console.log(_depth,"C->",c,next_c,mode,escape_mode,await clone(acc),await clone(word_acc),(handler_stack && handler_stack.length))
                        };
                        await async function(){
                            if (check_true( ((next_c===undefined)&&await (await Environment.get_global("not"))((await (async function(){
                                let __targ__10=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__10){
                                     return(__targ__10)[0]
                                } 
                            })()===undefined))&&(await (await Environment.get_global("not"))((c===await (async function(){
                                let __targ__11=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__11){
                                     return(__targ__11)[0]
                                } 
                            })()))||((handler_stack && handler_stack.length)>1))))) {
                                 return await error("premature end",("premature end: expected: "+await (async function(){
                                    let __targ__12=await (await Environment.get_global("last"))(handler_stack);
                                    if (__targ__12){
                                         return(__targ__12)[0]
                                    } 
                                })()))
                            } else if (check_true( ((next_c===undefined)&&(mode===in_quotes)&&await (await Environment.get_global("not"))((await c["charCodeAt"]()===34))))) {
                                 return await error("premature end","premature end: expected: \"")
                            } else if (check_true( ((next_c===undefined)&&(mode===in_long_text)&&await (await Environment.get_global("not"))((c==="|"))))) {
                                 return await error("premature end","premature end: expected: |")
                            } else if (check_true( ((mode===in_code)&&(_depth===1)&&(next_c===")")&&(c===")")))) {
                                 return  await error("trailing character","unexpected trailing parenthesis")
                            }
                        } ();
                        await async function(){
                            if (check_true( ((c==="\n")&&(mode===in_comment)))) {
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((92===await c["charCodeAt"].call(c,0))&&(mode===in_long_text)))) {
                                (word_acc).push(c);
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(escape_mode===1)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  (word_acc).push(c)
                            } else if (check_true( ((mode>0)&&(92===await c["charCodeAt"].call(c,0))))) {
                                 return  escape_mode=2
                            } else if (check_true( ((mode>0)&&(escape_mode===1)))) {
                                 return  (word_acc).push(await handle_escape_char(c))
                            } else if (check_true( ((mode===in_long_text)&&(escape_mode===0)&&(c==="|")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_quotes)&&(escape_mode===0)&&(c==="\"")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_single_quote)&&(escape_mode===0)&&(c==="'")))) {
                                acc=await (await Environment.get_global("add"))((word_acc).join(""));
                                word_acc=[];
                                mode=in_code;
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((c==="|")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_long_text;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                    block_return=["=:quotem",block_return];
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="\"")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_quotes;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( ((c==="'")&&(escape_mode===0)&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_single_quote;
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                if (check_true ((backtick_mode===1))){
                                     backtick_mode=0
                                };
                                 return  (acc).push(block_return)
                            } else if (check_true( (mode===in_comment))) {
                                 return false
                            } else if (check_true( ((c===";")&&(mode===in_code)))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                mode=in_comment;
                                 return  await read_block(await (await Environment.get_global("add"))(_depth,1))
                            } else if (check_true( ((mode===in_code)&&(await (await Environment.get_global("length"))(handler_stack)>0)&&(c===await (async function(){
                                let __targ__13=await (await Environment.get_global("last"))(handler_stack);
                                if (__targ__13){
                                     return(__targ__13)[0]
                                } 
                            })())))) {
                                __BREAK__FLAG__=true;
                                return
                            } else if (check_true( ((mode===in_code)&&read_table[c]&&await (await Environment.get_global("first"))(read_table[c])))) {
                                if (check_true (await (async function(){
                                    let __targ__14=read_table[c];
                                    if (__targ__14){
                                         return(__targ__14)[2]
                                    } 
                                })())){
                                    handler=await (async function(){
                                        let __targ__15=read_table[c];
                                        if (__targ__15){
                                             return(__targ__15)[2]
                                        } 
                                    })();
                                    await (async function(){
                                        let __array_op_rval__16=handler;
                                         if (__array_op_rval__16 instanceof Function){
                                            return await __array_op_rval__16() 
                                        } else {
                                            return[__array_op_rval__16]
                                        }
                                    })();
                                     handler=null
                                };
                                (handler_stack).push(read_table[c]);
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc,backtick_mode));
                                    backtick_mode=0;
                                     word_acc=[]
                                };
                                block_return=await read_block(await (await Environment.get_global("add"))(_depth,1));
                                handler=await (async function(){
                                    let __targ__17=(handler_stack).pop();
                                    if (__targ__17){
                                         return(__targ__17)[1]
                                    } 
                                })();
                                block_return=await (async function(){
                                    let __array_op_rval__18=handler;
                                     if (__array_op_rval__18 instanceof Function){
                                        return await __array_op_rval__18(block_return) 
                                    } else {
                                        return[__array_op_rval__18,block_return]
                                    }
                                })();
                                if (check_true (await (await Environment.get_global("not"))((undefined===block_return)))){
                                    if (check_true ((backtick_mode===1))){
                                        block_return=["=:quotem",block_return];
                                         backtick_mode=0
                                    };
                                     return  (acc).push(block_return)
                                }
                            } else if (check_true( ((mode===in_code)&&(c==="`")))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    (acc).push(await process_word(word_acc));
                                     word_acc=[]
                                };
                                 return  backtick_mode=1
                            } else if (check_true( ((mode===in_code)&&(c===":")&&((word_acc && word_acc.length)===0)&&((acc && acc.length)>0)&&(await (await Environment.get_global("last"))(acc) instanceof String || typeof await (await Environment.get_global("last"))(acc)==='string')))) {
                                 return (acc).push(await (await Environment.get_global("add"))((acc).pop(),":"))
                            } else if (check_true( ((mode===in_code)&&(last_c===",")&&((c==="#")||(c==="@"))))) {
                                (word_acc).push(c);
                                (acc).push(await process_word(word_acc));
                                 return  word_acc=[]
                            } else if (check_true( ((mode===in_code)&&((c===" ")||(await c["charCodeAt"].call(c,0)===10)||(await c["charCodeAt"].call(c,0)===9)||((c===",")&&await (await Environment.get_global("not"))((next_c==="@"))&&await (await Environment.get_global("not"))((next_c==="#"))))))) {
                                if (check_true (((word_acc && word_acc.length)>0))){
                                    if (check_true ((backtick_mode===1))){
                                        (acc).push(await process_word(word_acc,backtick_mode));
                                         backtick_mode=0
                                    } else {
                                         (acc).push(await process_word(word_acc))
                                    };
                                     return  word_acc=[]
                                }
                            } else if (check_true( ((mode===in_code)&&(await c["charCodeAt"].call(c,0)===13)))) {
                                 return false
                            } else  {
                                 return  (word_acc).push(c)
                            }
                        } ();
                        column_number+=1;
                         return  last_c=c
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__8()) {
                        await __body_ref__9();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                if (check_true (((word_acc && word_acc.length)>0))){
                    (acc).push(await process_word(word_acc,backtick_mode));
                     word_acc=[]
                };
                 return  acc
            };
            if (check_true (debugmode)){
                 await console.log("read->",in_buffer)
            };
            output_structure=await read_block(0);
            if (check_true (debugmode)){
                 await console.log("read<-",await clone(output_structure))
            };
            if (check_true (((output_structure instanceof Array)&&(await (await Environment.get_global("length"))(output_structure)>1)))){
                (output_structure).unshift("=:iprogn");
                 return  await (await Environment.get_global("first"))(await (async function(){
                    let __array_op_rval__19=output_structure;
                     if (__array_op_rval__19 instanceof Function){
                        return await __array_op_rval__19() 
                    } else {
                        return[__array_op_rval__19]
                    }
                })())
            } else {
                  return await (await Environment.get_global("first"))(output_structure)
            }
        }
    } ()
};
let add_escape_encoding=async function(text) {        if (check_true ((text instanceof String || typeof text==='string'))){            let chars;            let acc;            chars=(text).split("");            acc=[];            await (async function() {                let __for_body__3=async function(c) {                     return  await async function(){                        if (check_true( ((await c["charCodeAt"].call(c,0)===34)))) {                            (acc).push(await String.fromCharCode(92));                             return  (acc).push(c)                        } else  {                             return (acc).push(c)                        }                    } ()                };                let __array__4=[],__elements__2=chars;                let __BREAK__FLAG__=false;                for(let __iter__1 in __elements__2) {                    __array__4.push(await __for_body__3(__elements__2[__iter__1]));                    if(__BREAK__FLAG__) {                         __array__4.pop();                        break;                                            }                }return __array__4;                             })();             return  (acc).join("")        } else {              return text        }    };
let do_deferred_splice=async function(tree) {    let rval;
    let idx;
    let tval;
    let deferred_operator;
    rval=null;
    idx=0;
    tval=null;
    deferred_operator=(["=","$","&","!"]).join("");
    return await async function(){
        if (check_true ((tree instanceof Array))) {
            {
                rval=[];
                await (async function(){
                     let __test_condition__15=async function() {
                        return (idx<(tree && tree.length))
                    };
                    let __body_ref__16=async function() {
                        tval=tree[idx];
                        if (check_true ((tval===deferred_operator))){
                            {
                                idx+=1;
                                tval=tree[idx];
                                rval=await rval["concat"].call(rval,await (async function(){
                                     return await do_deferred_splice(tval) 
                                })())
                            }
                        } else {
                            (rval).push(await (async function(){
                                 return await do_deferred_splice(tval) 
                            })())
                        };
                        return idx+=1
                    };
                    let __BREAK__FLAG__=false;
                    while(await __test_condition__15()) {
                        await __body_ref__16();
                         if(__BREAK__FLAG__) {
                             break;
                            
                        }
                    } ;
                    
                })();
                return rval
            }
        } else if (check_true ((tree instanceof Object))) {
            {
                rval=new Object();
                await (async function() {
                    let __for_body__19=async function(pset) {
                        return await async function(){
                            rval[(pset && pset["0"])]=await (async function(){
                                 return await do_deferred_splice((pset && pset["1"])) 
                            })();
                            return rval;
                            
                        }()
                    };
                    let __array__20=[],__elements__18=await (await Environment.get_global("pairs"))(tree);
                    let __BREAK__FLAG__=false;
                    for(let __iter__17 in __elements__18) {
                        __array__20.push(await __for_body__19(__elements__18[__iter__17]));
                        if(__BREAK__FLAG__) {
                             __array__20.pop();
                            break;
                            
                        }
                    }return __array__20;
                     
                })();
                return rval
            }
        } else {
            return tree
        }
    } ()
};
let safe_access=async function(token,ctx,sanitizer_fn) {    let comps;
    let acc;
    let acc_full;
    let pos;
    let rval;
    comps=null;
    acc=[];
    acc_full=[];
    pos=null;
    rval=null;
    comps=((token && token.name)).split(".");
    if (check_true (((comps && comps.length)===1))){
        return (token && token.name)
    } else {
        {
            await async function(){
                comps[0]=await (async function(){
                    let __array_op_rval__222=sanitizer_fn;
                     if (__array_op_rval__222 instanceof Function){
                        return await __array_op_rval__222((comps && comps["0"])) 
                    } else {
                        return [__array_op_rval__222,(comps && comps["0"])]
                    }
                })();
                return comps;
                
            }();
            await (async function(){
                 let __test_condition__223=async function() {
                    return ((comps && comps.length)>0)
                };
                let __body_ref__224=async function() {
                    (acc).push((comps).shift());
                    return (acc_full).push(await (async function(){
                         return await (await Environment.get_global("expand_dot_accessor"))((acc).join("."),ctx) 
                    })())
                };
                let __BREAK__FLAG__=false;
                while(await __test_condition__223()) {
                    await __body_ref__224();
                     if(__BREAK__FLAG__) {
                         break;
                        
                    }
                } ;
                
            })();
            rval=await (await Environment.get_global("flatten"))(["(",(acc_full).join(" && "),")"]);
            return rval
        }
    }
};
;
let as_lisp=lisp_writer;
;
let read_lisp=reader;
;
await async function(){
    Environment.global_ctx.scope["eval"]=eval_exp;
    Environment.global_ctx.scope["reader"]=reader;
    Environment.global_ctx.scope["add_escape_encoding"]=add_escape_encoding;
    Environment.global_ctx.scope["get_outside_global"]=get_outside_global;
    Environment.global_ctx.scope["as_lisp"]=lisp_writer;
    Environment.global_ctx.scope["lisp_writer"]=lisp_writer;
    Environment.global_ctx.scope["clone_to_new"]=clone_to_new;
    Environment.global_ctx.scope["save_env"]=save_env;
    Environment.global_ctx.scope["null"]=null;
    return Environment.global_ctx.scope;
    
}();
let inlines=await (async function(){
    if (check_true (parent_environment)){
        return await add(new Object(),parent_environment.inlines,await (async function(){
            if (check_true (opts.inlines)){
                return opts.inlines
            } else {
                return new Object()
            }
        })())
    } else {
        return await add(new Object(),await (async function(){
            if (check_true (opts.inlines)){
                return opts.inlines
            } else {
                return new Object()
            }
        })(),await ( async function(){
            let __obj__350=new Object();
            __obj__350["pop"]=async function(args) {
                return ["(",args['0'],")",".","pop()"]
            };
            __obj__350["push"]=async function(args) {
                return ["(",args['0'],")",".push","(",args['1'],")"]
            };
            __obj__350["chomp"]=async function(args) {
                return ["(",args['0'],")",".substr","(",0,",","(",args['0'],".length","-",1,")",")"]
            };
            __obj__350["join"]=async function(args) {
                if (check_true ((args.length===1))){
                    return ["(",args['0'],")",".join","('')"]
                } else {
                    return ["(",args['1'],")",".join","(",args['0'],")"]
                }
            };
            __obj__350["take"]=async function(args) {
                return ["(",args['0'],")",".shift","()"]
            };
            __obj__350["prepend"]=async function(args) {
                return ["(",args['0'],")",".unshift","(",args['1'],")"]
            };
            __obj__350["trim"]=async function(args) {
                return ["(",args['0'],")",".trim()"]
            };
            __obj__350["lowercase"]=async function(args) {
                return ["(",args['0'],")",".toLowerCase()"]
            };
            __obj__350["uppercase"]=async function(args) {
                return ["(",args['0'],")",".toUpperCase()"]
            };
            __obj__350["islice"]=async function(args) {
                return await async function(){
                    if (check_true ((args.length===3))) {
                        return ["(",args['0'],")",".slice(",args['1'],",",args['2'],")"]
                    } else if (check_true ((args.length===2))) {
                        return ["(",args['0'],")",".slice(",args['1'],")"]
                    } else {
                        throw new SyntaxError("slice requires 2 or 3 arguments");
                        
                    }
                } ()
            };
            __obj__350["split_by"]=async function(args) {
                return ["(",args['1'],")",".split","(",args['0'],")"]
            };
            __obj__350["bindf"]=async function(args) {
                return await (async function(){
                    let __array_op_rval__351=args['0'];
                     if (__array_op_rval__351 instanceof Function){
                        return await __array_op_rval__351(".bind(",args['1'],")") 
                    } else {
                        return [__array_op_rval__351,".bind(",args['1'],")"]
                    }
                })()
            };
            __obj__350["is_array?"]=async function(args) {
                return ["(",args['0']," instanceof Array",")"]
            };
            __obj__350["is_object?"]=async function(args) {
                return ["(",args['0']," instanceof Object",")"]
            };
            __obj__350["is_string?"]=async function(args) {
                return ["(",args['0']," instanceof String || typeof ",args['0'],"===","'string'",")"]
            };
            __obj__350["is_function?"]=async function(args) {
                return await (async function(){
                    let __array_op_rval__352=args['0'];
                     if (__array_op_rval__352 instanceof Function){
                        return await __array_op_rval__352(" instanceof Function") 
                    } else {
                        return [__array_op_rval__352," instanceof Function"]
                    }
                })()
            };
            __obj__350["is_element?"]=async function(args) {
                return await (async function(){
                    let __array_op_rval__353=args['0'];
                     if (__array_op_rval__353 instanceof Function){
                        return await __array_op_rval__353(" instanceof Element") 
                    } else {
                        return [__array_op_rval__353," instanceof Element"]
                    }
                })()
            };
            __obj__350["log"]=async function(args) {
                return ["console.log","(",await (async function(){
                     return await map(async function(val,idx,tl) {
                        if (check_true ((idx<(tl- 1)))){
                            return await (async function(){
                                let __array_op_rval__354=val;
                                 if (__array_op_rval__354 instanceof Function){
                                    return await __array_op_rval__354(",") 
                                } else {
                                    return [__array_op_rval__354,","]
                                }
                            })()
                        } else {
                            return await (async function(){
                                let __array_op_rval__355=val;
                                 if (__array_op_rval__355 instanceof Function){
                                    return await __array_op_rval__355() 
                                } else {
                                    return [__array_op_rval__355]
                                }
                            })()
                        }
                    },args) 
                })(),")"]
            };
            __obj__350["reverse"]=async function(args) {
                return ["(",args['0'],")",".slice(0).reverse()"]
            };
            __obj__350["int"]=async function(args) {
                return await async function(){
                    if (check_true ((args.length===1))) {
                        return ["parseInt(",args['0'],")"]
                    } else if (check_true ((args.length===2))) {
                        return ["parseInt(",args['0'],",",args['1'],")"]
                    } else {
                        throw new "SyntaxError"(("invalid number of arguments to int: received "+ args.length));
                        
                    }
                } ()
            };
            __obj__350["float"]=async function(args) {
                return ["parseFloat(",args['0'],")"]
            };
            return __obj__350;
            
        })())
    }
})();
;
await async function(){
    Environment["eval"]=eval_struct;
    Environment["identify"]=subtype;
    Environment["meta_for_symbol"]=meta_for_symbol;
    Environment["set_compiler"]=set_compiler;
    Environment["read_lisp"]=reader;
    Environment["as_lisp"]=as_lisp;
    Environment["symbols"]=symbols;
    Environment["inlines"]=inlines;
    Environment["clone_to_new"]=clone_to_new;
    Environment["export_symbol_set"]=export_symbol_set;
    Environment["save_env"]=save_env;
    Environment["special_operators"]=special_operators;
    Environment["definitions"]=Environment.definitions;
    Environment["declarations"]=Environment.declarations;
    Environment["get_namespace_handle"]=get_namespace_handle;
    Environment["compile"]=compile;
    Environment["evaluate"]=evaluate;
    Environment["evaluate_local"]=evaluate_local;
    Environment["do_deferred_splice"]=do_deferred_splice;
    Environment["id"]=async function() {
        return id
    };
    Environment["set_check_external_env"]=async function(state) {
        check_external_env_default=state;
        return check_external_env_default
    };
    Environment["check_external_env"]=async function() {
        return check_external_env_default
    };
    return Environment;
    
}();
in_boot=false;
let sys_init=Environment.global_ctx.scope["*system_initializer*"];
;
let init=Environment.global_ctx.scope["*initializer*"];
;
if (check_true ((opts.default_namespace&& await not((compiler===unset_compiler))&& children[opts.default_namespace]))){
    {
        await (await get_global("set_namespace"))(opts.default_namespace)
    }
};
if (check_true ((namespace==="core"))){
    {
        if (check_true (sys_init)){
            {
                (await Environment.eval(await async function(){
                    return sys_init
                }()))
            }
        };
        if (check_true (init)){
            {
                (await Environment.eval(await async function(){
                    return init
                }()))
            }
        };
        await (async function() {
            let __for_body__359=async function(child) {
                return await child["evaluate_local"].call(child,("(progn (console.log \"child running initialization..\") (if (prop Environment.global_ctx.scope `*system_initializer*) (eval *system_initializer*)) (if (prop Environment.global_ctx.scope `*initializer*) (eval *initializer*)))"))
            };
            let __array__360=[],__elements__358=children;
            let __BREAK__FLAG__=false;
            for(let __iter__357 in __elements__358) {
                __array__360.push(await __for_body__359(__elements__358[__iter__357]));
                if(__BREAK__FLAG__) {
                     __array__360.pop();
                    break;
                    
                }
            }return __array__360;
             
        })()
    }
};
return Environment
};
return globalThis;

}();
return globalThis[symname]
}
}
}
}
await init_dlisp();
let env = await dlisp_env({"default_namespace":"user"}); 

 globalThis.in_starter=true; 

</script> <script id='ace_editor'  type='text/javascript'  charset='utf-8'>(function(){function o(n){var i=e;n&&(e[n]||(e[n]={}),i=e[n]);if(!i.define||!i.define.packaged)t.original=i.define,i.define=t,i.define.packaged=!0;if(!i.require||!i.require.packaged)r.original=i.require,i.require=r,i.require.packaged=!0}var ACE_NAMESPACE = "ace",e=function(){return this}();!e&&typeof window!="undefined"&&(e=window);if(!ACE_NAMESPACE&&typeof requirejs!="undefined")return;var t=function(e,n,r){if(typeof e!="string"){t.original?t.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace());return}arguments.length==2&&(r=n),t.modules[e]||(t.payloads[e]=r,t.modules[e]=null)};t.modules={},t.payloads={};var n=function(e,t,n){if(typeof t=="string"){var i=s(e,t);if(i!=undefined)return n&&n(),i}else if(Object.prototype.toString.call(t)==="[object Array]"){var o=[];for(var u=0,a=t.length;u<a;++u){var f=s(e,t[u]);if(f==undefined&&r.original)return;o.push(f)}return n&&n.apply(null,o)||!0}},r=function(e,t){var i=n("",e,t);return i==undefined&&r.original?r.original.apply(this,arguments):i},i=function(e,t){if(t.indexOf("!")!==-1){var n=t.split("!");return i(e,n[0])+"!"+i(e,n[1])}if(t.charAt(0)=="."){var r=e.split("/").slice(0,-1).join("/");t=r+"/"+t;while(t.indexOf(".")!==-1&&s!=t){var s=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return t},s=function(e,r){r=i(e,r);var s=t.modules[r];if(!s){s=t.payloads[r];if(typeof s=="function"){var o={},u={id:r,uri:"",exports:o,packaged:!0},a=function(e,t){return n(r,e,t)},f=s(a,o,u);o=f||u.exports,t.modules[r]=o,delete t.payloads[r]}s=t.modules[r]=o||s}return s};o(ACE_NAMESPACE)})(),ace.define("ace/lib/fixoldbrowsers",["require","exports","module"],function(e,t,n){"use strict";typeof Element!="undefined"&&!Element.prototype.remove&&Object.defineProperty(Element.prototype,"remove",{enumerable:!1,writable:!0,configurable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})}),ace.define("ace/lib/useragent",["require","exports","module"],function(e,t,n){"use strict";t.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};var r=typeof navigator=="object"?navigator:{},i=(/mac|win|linux/i.exec(r.platform)||["other"])[0].toLowerCase(),s=r.userAgent||"",o=r.appName||"";t.isWin=i=="win",t.isMac=i=="mac",t.isLinux=i=="linux",t.isIE=o=="Microsoft Internet Explorer"||o.indexOf("MSAppHost")>=0?parseFloat((s.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((s.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),t.isOldIE=t.isIE&&t.isIE<9,t.isGecko=t.isMozilla=s.match(/ Gecko\/\d+/),t.isOpera=typeof opera=="object"&&Object.prototype.toString.call(window.opera)=="[object Opera]",t.isWebKit=parseFloat(s.split("WebKit/")[1])||undefined,t.isChrome=parseFloat(s.split(" Chrome/")[1])||undefined,t.isEdge=parseFloat(s.split(" Edge/")[1])||undefined,t.isAIR=s.indexOf("AdobeAIR")>=0,t.isAndroid=s.indexOf("Android")>=0,t.isChromeOS=s.indexOf(" CrOS ")>=0,t.isIOS=/iPad|iPhone|iPod/.test(s)&&!window.MSStream,t.isIOS&&(t.isMac=!0),t.isMobile=t.isIOS||t.isAndroid}),ace.define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],function(e,t,n){"use strict";function u(){var e=o;o=null,e&&e.forEach(function(e){a(e[0],e[1])})}function a(e,n,r){if(typeof document=="undefined")return;if(o)if(r)u();else if(r===!1)return o.push([e,n]);if(s)return;var i=r;if(!r||!r.getRootNode)i=document;else{i=r.getRootNode();if(!i||i==r)i=document}var a=i.ownerDocument||i;if(n&&t.hasCssString(n,i))return null;n&&(e+="\n/*# sourceURL=ace/css/"+n+" */");var f=t.createElement("style");f.appendChild(a.createTextNode(e)),n&&(f.id=n),i==a&&(i=t.getDocumentHead(a)),i.insertBefore(f,i.firstChild)}var r=e("./useragent"),i="http://www.w3.org/1999/xhtml";t.buildDom=function l(e,t,n){if(typeof e=="string"&&e){var r=document.createTextNode(e);return t&&t.appendChild(r),r}if(!Array.isArray(e))return e&&e.appendChild&&t&&t.appendChild(e),e;if(typeof e[0]!="string"||!e[0]){var i=[];for(var s=0;s<e.length;s++){var o=l(e[s],t,n);o&&i.push(o)}return i}var u=document.createElement(e[0]),a=e[1],f=1;a&&typeof a=="object"&&!Array.isArray(a)&&(f=2);for(var s=f;s<e.length;s++)l(e[s],u,n);return f==2&&Object.keys(a).forEach(function(e){var t=a[e];e==="class"?u.className=Array.isArray(t)?t.join(" "):t:typeof t=="function"||e=="value"||e[0]=="$"?u[e]=t:e==="ref"?n&&(n[t]=u):e==="style"?typeof t=="string"&&(u.style.cssText=t):t!=null&&u.setAttribute(e,t)}),t&&t.appendChild(u),u},t.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName("head")[0]||e.documentElement},t.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||i,e):document.createElement(e)},t.removeChildren=function(e){e.innerHTML=""},t.createTextNode=function(e,t){var n=t?t.ownerDocument:document;return n.createTextNode(e)},t.createFragment=function(e){var t=e?e.ownerDocument:document;return t.createDocumentFragment()},t.hasCssClass=function(e,t){var n=(e.className+"").split(/\s+/g);return n.indexOf(t)!==-1},t.addCssClass=function(e,n){t.hasCssClass(e,n)||(e.className+=" "+n)},t.removeCssClass=function(e,t){var n=e.className.split(/\s+/g);for(;;){var r=n.indexOf(t);if(r==-1)break;n.splice(r,1)}e.className=n.join(" ")},t.toggleCssClass=function(e,t){var n=e.className.split(/\s+/g),r=!0;for(;;){var i=n.indexOf(t);if(i==-1)break;r=!1,n.splice(i,1)}return r&&n.push(t),e.className=n.join(" "),r},t.setCssClass=function(e,n,r){r?t.addCssClass(e,n):t.removeCssClass(e,n)},t.hasCssString=function(e,t){var n=0,r;t=t||document;if(r=t.querySelectorAll("style"))while(n<r.length)if(r[n++].id===e)return!0};var s,o=[];t.useStrictCSP=function(e){s=e,e==0?u():o||(o=[])},t.importCssString=a,t.importCssStylsheet=function(e,n){t.buildDom(["link",{rel:"stylesheet",href:e}],t.getDocumentHead(n))},t.scrollbarWidth=function(e){var n=t.createElement("ace_inner");n.style.width="100%",n.style.minWidth="0px",n.style.height="200px",n.style.display="block";var r=t.createElement("ace_outer"),i=r.style;i.position="absolute",i.left="-10000px",i.overflow="hidden",i.width="200px",i.minWidth="0px",i.height="150px",i.display="block",r.appendChild(n);var s=e.documentElement;s.appendChild(r);var o=n.offsetWidth;i.overflow="scroll";var u=n.offsetWidth;return o==u&&(u=r.clientWidth),s.removeChild(r),o-u},t.computedStyle=function(e,t){return window.getComputedStyle(e,"")||{}},t.setStyle=function(e,t,n){e[t]!==n&&(e[t]=n)},t.HAS_CSS_ANIMATION=!1,t.HAS_CSS_TRANSFORMS=!1,t.HI_DPI=r.isWin?typeof window!="undefined"&&window.devicePixelRatio>=1.5:!0,r.isChromeOS&&(t.HI_DPI=!1);if(typeof document!="undefined"){var f=document.createElement("div");t.HI_DPI&&f.style.transform!==undefined&&(t.HAS_CSS_TRANSFORMS=!0),!r.isEdge&&typeof f.style.animationName!="undefined"&&(t.HAS_CSS_ANIMATION=!0),f=null}t.HAS_CSS_TRANSFORMS?t.translate=function(e,t,n){e.style.transform="translate("+Math.round(t)+"px, "+Math.round(n)+"px)"}:t.translate=function(e,t,n){e.style.top=Math.round(n)+"px",e.style.left=Math.round(t)+"px"}}),ace.define("ace/lib/oop",["require","exports","module"],function(e,t,n){"use strict";t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.mixin=function(e,t){for(var n in t)e[n]=t[n];return e},t.implement=function(e,n){t.mixin(e,n)}}),ace.define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(e,t,n){"use strict";var r=e("./oop"),i=function(){var e={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,"super":8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}},t,n;for(n in e.FUNCTION_KEYS)t=e.FUNCTION_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);for(n in e.PRINTABLE_KEYS)t=e.PRINTABLE_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);return r.mixin(e,e.MODIFIER_KEYS),r.mixin(e,e.PRINTABLE_KEYS),r.mixin(e,e.FUNCTION_KEYS),e.enter=e["return"],e.escape=e.esc,e.del=e["delete"],e[173]="-",function(){var t=["cmd","ctrl","alt","shift"];for(var n=Math.pow(2,t.length);n--;)e.KEY_MODS[n]=t.filter(function(t){return n&e.KEY_MODS[t]}).join("-")+"-"}(),e.KEY_MODS[0]="",e.KEY_MODS[-1]="input-",e}();r.mixin(t,i),t.keyCodeToString=function(e){var t=i[e];return typeof t!="string"&&(t=String.fromCharCode(e)),t.toLowerCase()}}),ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,t,n){"use strict";function a(){u=!1;try{document.createComment("").addEventListener("test",function(){},{get passive(){u={passive:!1}}})}catch(e){}}function f(){return u==undefined&&a(),u}function l(e,t,n){this.elem=e,this.type=t,this.callback=n}function d(e,t,n){var u=p(t);if(!i.isMac&&s){t.getModifierState&&(t.getModifierState("OS")||t.getModifierState("Win"))&&(u|=8);if(s.altGr){if((3&u)==3)return;s.altGr=0}if(n===18||n===17){var a="location"in t?t.location:t.keyLocation;if(n===17&&a===1)s[n]==1&&(o=t.timeStamp);else if(n===18&&u===3&&a===2){var f=t.timeStamp-o;f<50&&(s.altGr=!0)}}}n in r.MODIFIER_KEYS&&(n=-1);if(!u&&n===13){var a="location"in t?t.location:t.keyLocation;if(a===3){e(t,u,-n);if(t.defaultPrevented)return}}if(i.isChromeOS&&u&8){e(t,u,n);if(t.defaultPrevented)return;u&=-9}return!!u||n in r.FUNCTION_KEYS||n in r.PRINTABLE_KEYS?e(t,u,n):!1}function v(){s=Object.create(null)}var r=e("./keys"),i=e("./useragent"),s=null,o=0,u;l.prototype.destroy=function(){h(this.elem,this.type,this.callback),this.elem=this.type=this.callback=undefined};var c=t.addListener=function(e,t,n,r){e.addEventListener(t,n,f()),r&&r.$toDestroy.push(new l(e,t,n))},h=t.removeListener=function(e,t,n){e.removeEventListener(t,n,f())};t.stopEvent=function(e){return t.stopPropagation(e),t.preventDefault(e),!1},t.stopPropagation=function(e){e.stopPropagation&&e.stopPropagation()},t.preventDefault=function(e){e.preventDefault&&e.preventDefault()},t.getButton=function(e){return e.type=="dblclick"?0:e.type=="contextmenu"||i.isMac&&e.ctrlKey&&!e.altKey&&!e.shiftKey?2:e.button},t.capture=function(e,t,n){function i(e){t&&t(e),n&&n(e),h(r,"mousemove",t),h(r,"mouseup",i),h(r,"dragstart",i)}var r=e&&e.ownerDocument||document;return c(r,"mousemove",t),c(r,"mouseup",i),c(r,"dragstart",i),i},t.addMouseWheelListener=function(e,t,n){c(e,"wheel",function(e){var n=.15,r=e.deltaX||0,i=e.deltaY||0;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=r*n,e.wheelY=i*n;break;case e.DOM_DELTA_LINE:var s=15;e.wheelX=r*s,e.wheelY=i*s;break;case e.DOM_DELTA_PAGE:var o=150;e.wheelX=r*o,e.wheelY=i*o}t(e)},n)},t.addMultiMouseDownListener=function(e,n,r,s,o){function p(e){t.getButton(e)!==0?u=0:e.detail>1?(u++,u>4&&(u=1)):u=1;if(i.isIE){var o=Math.abs(e.clientX-a)>5||Math.abs(e.clientY-f)>5;if(!l||o)u=1;l&&clearTimeout(l),l=setTimeout(function(){l=null},n[u-1]||600),u==1&&(a=e.clientX,f=e.clientY)}e._clicks=u,r[s]("mousedown",e);if(u>4)u=0;else if(u>1)return r[s](h[u],e)}var u=0,a,f,l,h={2:"dblclick",3:"tripleclick",4:"quadclick"};Array.isArray(e)||(e=[e]),e.forEach(function(e){c(e,"mousedown",p,o)})};var p=function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)};t.getModifierString=function(e){return r.KEY_MODS[p(e)]},t.addCommandKeyListener=function(e,n,r){if(i.isOldGecko||i.isOpera&&!("KeyboardEvent"in window)){var o=null;c(e,"keydown",function(e){o=e.keyCode},r),c(e,"keypress",function(e){return d(n,e,o)},r)}else{var u=null;c(e,"keydown",function(e){s[e.keyCode]=(s[e.keyCode]||0)+1;var t=d(n,e,e.keyCode);return u=e.defaultPrevented,t},r),c(e,"keypress",function(e){u&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(t.stopEvent(e),u=null)},r),c(e,"keyup",function(e){s[e.keyCode]=null},r),s||(v(),c(window,"focus",v))}};if(typeof window=="object"&&window.postMessage&&!i.isOldIE){var m=1;t.nextTick=function(e,n){n=n||window;var r="zero-timeout-message-"+m++,i=function(s){s.data==r&&(t.stopPropagation(s),h(n,"message",i),e())};c(n,"message",i),n.postMessage(r,"*")}}t.$idleBlocked=!1,t.onIdle=function(e,n){return setTimeout(function r(){t.$idleBlocked?setTimeout(r,100):e()},n)},t.$idleBlockId=null,t.blockIdle=function(e){t.$idleBlockId&&clearTimeout(t.$idleBlockId),t.$idleBlocked=!0,t.$idleBlockId=setTimeout(function(){t.$idleBlocked=!1},e||100)},t.nextFrame=typeof window=="object"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),t.nextFrame?t.nextFrame=t.nextFrame.bind(window):t.nextFrame=function(e){setTimeout(e,17)}}),ace.define("ace/range",["require","exports","module"],function(e,t,n){"use strict";var r=function(e,t){return e.row-t.row||e.column-t.column},i=function(e,t,n,r){this.start={row:e,column:t},this.end={row:n,column:r}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(e,t){return this.compare(e,t)==0},this.compareRange=function(e){var t,n=e.end,r=e.start;return t=this.compare(n.row,n.column),t==1?(t=this.compare(r.row,r.column),t==1?2:t==0?1:0):t==-1?-2:(t=this.compare(r.row,r.column),t==-1?-1:t==1?42:0)},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return this.comparePoint(e.start)==0&&this.comparePoint(e.end)==0},this.intersects=function(e){var t=this.compareRange(e);return t==-1||t==0||t==1},this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t},this.isStart=function(e,t){return this.start.row==e&&this.start.column==t},this.setStart=function(e,t){typeof e=="object"?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){typeof e=="object"?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)||this.isStart(e,t)?!1:!0:!1},this.insideStart=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)?!1:!0:!1},this.insideEnd=function(e,t){return this.compare(e,t)==0?this.isStart(e,t)?!1:!0:!1},this.compare=function(e,t){return!this.isMultiLine()&&e===this.start.row?t<this.start.column?-1:t>this.end.column?1:0:e<this.start.row?-1:e>this.end.row?1:this.start.row===e?t>=this.start.column?0:-1:this.end.row===e?t<=this.end.column?0:1:0},this.compareStart=function(e,t){return this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&&this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&&this.end.column==t?1:this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){if(this.end.row>t)var n={row:t+1,column:0};else if(this.end.row<e)var n={row:e,column:0};if(this.start.row>t)var r={row:t+1,column:0};else if(this.start.row<e)var r={row:e,column:0};return i.fromPoints(r||this.start,n||this.end)},this.extend=function(e,t){var n=this.compare(e,t);if(n==0)return this;if(n==-1)var r={row:e,column:t};else var s={row:e,column:t};return i.fromPoints(r||this.start,s||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return i.fromPoints(this.start,this.end)},this.collapseRows=function(){return this.end.column==0?new i(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new i(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),n=e.documentToScreenPosition(this.end);return new i(t.row,t.column,n.row,n.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(i.prototype),i.fromPoints=function(e,t){return new i(e.row,e.column,t.row,t.column)},i.comparePoints=r,i.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=i}),ace.define("ace/lib/lang",["require","exports","module"],function(e,t,n){"use strict";t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split("").reverse().join("")},t.stringRepeat=function(e,t){var n="";while(t>0){t&1&&(n+=e);if(t>>=1)e+=e}return n};var r=/^\s\s*/,i=/\s\s*$/;t.stringTrimLeft=function(e){return e.replace(r,"")},t.stringTrimRight=function(e){return e.replace(i,"")},t.copyObject=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.copyArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)e[n]&&typeof e[n]=="object"?t[n]=this.copyObject(e[n]):t[n]=e[n];return t},t.deepCopy=function s(e){if(typeof e!="object"||!e)return e;var t;if(Array.isArray(e)){t=[];for(var n=0;n<e.length;n++)t[n]=s(e[n]);return t}if(Object.prototype.toString.call(e)!=="[object Object]")return e;t={};for(var n in e)t[n]=s(e[n]);return t},t.arrayToMap=function(e){var t={};for(var n=0;n<e.length;n++)t[e[n]]=1;return t},t.createMap=function(e){var t=Object.create(null);for(var n in e)t[n]=e[n];return t},t.arrayRemove=function(e,t){for(var n=0;n<=e.length;n++)t===e[n]&&e.splice(n,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},t.escapeHTML=function(e){return(""+e).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},t.getMatchOffsets=function(e,t){var n=[];return e.replace(t,function(e){n.push({offset:arguments[arguments.length-2],length:e.length})}),n},t.deferredCall=function(e){var t=null,n=function(){t=null,e()},r=function(e){return r.cancel(),t=setTimeout(n,e||0),r};return r.schedule=r,r.call=function(){return this.cancel(),e(),r},r.cancel=function(){return clearTimeout(t),t=null,r},r.isPending=function(){return t},r},t.delayedCall=function(e,t){var n=null,r=function(){n=null,e()},i=function(e){n==null&&(n=setTimeout(r,e||t))};return i.delay=function(e){n&&clearTimeout(n),n=setTimeout(r,e||t)},i.schedule=i,i.call=function(){this.cancel(),e()},i.cancel=function(){n&&clearTimeout(n),n=null},i.isPending=function(){return n},i}}),ace.define("ace/clipboard",["require","exports","module"],function(e,t,n){"use strict";var r;n.exports={lineMode:!1,pasteCancelled:function(){return r&&r>Date.now()-50?!0:r=!1},cancel:function(){r=Date.now()}}}),ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/clipboard","ace/lib/keys"],function(e,t,n){"use strict";var r=e("../lib/event"),i=e("../lib/useragent"),s=e("../lib/dom"),o=e("../lib/lang"),u=e("../clipboard"),a=i.isChrome<18,f=i.isIE,l=i.isChrome>63,c=400,h=e("../lib/keys"),p=h.KEY_MODS,d=i.isIOS,v=d?/\s/:/\n/,m=i.isMobile,g=function(e,t){function X(){x=!0,n.blur(),n.focus(),x=!1}function $(e){e.keyCode==27&&n.value.length<n.selectionStart&&(b||(T=n.value),N=C=-1,O()),V()}function K(){clearTimeout(J),J=setTimeout(function(){E&&(n.style.cssText=E,E=""),t.renderer.$isMousePressed=!1,t.renderer.$keepTextAreaAtCursor&&t.renderer.$moveTextAreaToCursor()},0)}function G(e,t,n){var r=null,i=!1;n.addEventListener("keydown",function(e){r&&clearTimeout(r),i=!0},!0),n.addEventListener("keyup",function(e){r=setTimeout(function(){i=!1},100)},!0);var s=function(e){if(document.activeElement!==n)return;if(i||b||t.$mouseHandler.isMousePressed)return;if(g)return;var r=n.selectionStart,s=n.selectionEnd,o=null,u=0;if(r==0)o=h.up;else if(r==1)o=h.home;else if(s>C&&T[s]=="\n")o=h.end;else if(r<N&&T[r-1]==" ")o=h.left,u=p.option;else if(r<N||r==N&&C!=N&&r==s)o=h.left;else if(s>C&&T.slice(0,s).split("\n").length>2)o=h.down;else if(s>C&&T[s-1]==" ")o=h.right,u=p.option;else if(s>C||s==C&&C!=N&&r==s)o=h.right;r!==s&&(u|=p.shift);if(o){var a=t.onCommandKey({},u,o);if(!a&&t.commands){o=h.keyCodeToString(o);var f=t.commands.findKeyCommand(u,o);f&&t.execCommand(f)}N=r,C=s,O("")}};document.addEventListener("selectionchange",s),t.on("destroy",function(){document.removeEventListener("selectionchange",s)})}var n=s.createElement("textarea");n.className="ace_text-input",n.setAttribute("wrap","off"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck",!1),n.style.opacity="0",e.insertBefore(n,e.firstChild);var g=!1,y=!1,b=!1,w=!1,E="";m||(n.style.fontSize="1px");var S=!1,x=!1,T="",N=0,C=0,k=0;try{var L=document.activeElement===n}catch(A){}r.addListener(n,"blur",function(e){if(x)return;t.onBlur(e),L=!1},t),r.addListener(n,"focus",function(e){if(x)return;L=!0;if(i.isEdge)try{if(!document.hasFocus())return}catch(e){}t.onFocus(e),i.isEdge?setTimeout(O):O()},t),this.$focusScroll=!1,this.focus=function(){if(E||l||this.$focusScroll=="browser")return n.focus({preventScroll:!0});var e=n.style.top;n.style.position="fixed",n.style.top="0px";try{var t=n.getBoundingClientRect().top!=0}catch(r){return}var i=[];if(t){var s=n.parentElement;while(s&&s.nodeType==1)i.push(s),s.setAttribute("ace_nocontext",!0),!s.parentElement&&s.getRootNode?s=s.getRootNode().host:s=s.parentElement}n.focus({preventScroll:!0}),t&&i.forEach(function(e){e.removeAttribute("ace_nocontext")}),setTimeout(function(){n.style.position="",n.style.top=="0px"&&(n.style.top=e)},0)},this.blur=function(){n.blur()},this.isFocused=function(){return L},t.on("beforeEndOperation",function(){var e=t.curOp,r=e&&e.command&&e.command.name;if(r=="insertstring")return;var i=r&&(e.docChanged||e.selectionChanged);b&&i&&(T=n.value="",W()),O()});var O=d?function(e){if(!L||g&&!e||w)return;e||(e="");var r="\n ab"+e+"cde fg\n";r!=n.value&&(n.value=T=r);var i=4,s=4+(e.length||(t.selection.isEmpty()?0:1));(N!=i||C!=s)&&n.setSelectionRange(i,s),N=i,C=s}:function(){if(b||w)return;if(!L&&!P)return;b=!0;var e=0,r=0,i="";if(t.session){var s=t.selection,o=s.getRange(),u=s.cursor.row;e=o.start.column,r=o.end.column,i=t.session.getLine(u);if(o.start.row!=u){var a=t.session.getLine(u-1);e=o.start.row<u-1?0:e,r+=a.length+1,i=a+"\n"+i}else if(o.end.row!=u){var f=t.session.getLine(u+1);r=o.end.row>u+1?f.length:r,r+=i.length+1,i=i+"\n"+f}else m&&u>0&&(i="\n"+i,r+=1,e+=1);i.length>c&&(e<c&&r<c?i=i.slice(0,c):(i="\n",e==r?e=r=0:(e=0,r=1)))}var l=i+"\n\n";l!=T&&(n.value=T=l,N=C=l.length),P&&(N=n.selectionStart,C=n.selectionEnd);if(C!=r||N!=e||n.selectionEnd!=C)try{n.setSelectionRange(e,r),N=e,C=r}catch(h){}b=!1};this.resetSelection=O,L&&t.onFocus();var M=function(e){return e.selectionStart===0&&e.selectionEnd>=T.length&&e.value===T&&T&&e.selectionEnd!==C},_=function(e){if(b)return;g?g=!1:M(n)?(t.selectAll(),O()):m&&n.selectionStart!=N&&O()},D=null;this.setInputHandler=function(e){D=e},this.getInputHandler=function(){return D};var P=!1,H=function(e,r){P&&(P=!1);if(y)return O(),e&&t.onPaste(e),y=!1,"";var s=n.selectionStart,o=n.selectionEnd,u=N,a=T.length-C,f=e,l=e.length-s,c=e.length-o,h=0;while(u>0&&T[h]==e[h])h++,u--;f=f.slice(h),h=1;while(a>0&&T.length-h>N-1&&T[T.length-h]==e[e.length-h])h++,a--;l-=h-1,c-=h-1;var p=f.length-h+1;p<0&&(u=-p,p=0),f=f.slice(0,p);if(!r&&!f&&!l&&!u&&!a&&!c)return"";w=!0;var d=!1;return i.isAndroid&&f==". "&&(f="  ",d=!0),f&&!u&&!a&&!l&&!c||S?t.onTextInput(f):t.onTextInput(f,{extendLeft:u,extendRight:a,restoreStart:l,restoreEnd:c}),w=!1,T=e,N=s,C=o,k=c,d?"\n":f},B=function(e){if(b)return z();if(e&&e.inputType){if(e.inputType=="historyUndo")return t.execCommand("undo");if(e.inputType=="historyRedo")return t.execCommand("redo")}var r=n.value,i=H(r,!0);(r.length>c+100||v.test(i)||m&&N<1&&N==C)&&O()},j=function(e,t,n){var r=e.clipboardData||window.clipboardData;if(!r||a)return;var i=f||n?"Text":"text/plain";try{return t?r.setData(i,t)!==!1:r.getData(i)}catch(e){if(!n)return j(e,t,!0)}},F=function(e,i){var s=t.getCopyText();if(!s)return r.preventDefault(e);j(e,s)?(d&&(O(s),g=s,setTimeout(function(){g=!1},10)),i?t.onCut():t.onCopy(),r.preventDefault(e)):(g=!0,n.value=s,n.select(),setTimeout(function(){g=!1,O(),i?t.onCut():t.onCopy()}))},I=function(e){F(e,!0)},q=function(e){F(e,!1)},R=function(e){var s=j(e);if(u.pasteCancelled())return;typeof s=="string"?(s&&t.onPaste(s,e),i.isIE&&setTimeout(O),r.preventDefault(e)):(n.value="",y=!0)};r.addCommandKeyListener(n,t.onCommandKey.bind(t),t),r.addListener(n,"select",_,t),r.addListener(n,"input",B,t),r.addListener(n,"cut",I,t),r.addListener(n,"copy",q,t),r.addListener(n,"paste",R,t),(!("oncut"in n)||!("oncopy"in n)||!("onpaste"in n))&&r.addListener(e,"keydown",function(e){if(i.isMac&&!e.metaKey||!e.ctrlKey)return;switch(e.keyCode){case 67:q(e);break;case 86:R(e);break;case 88:I(e)}},t);var U=function(e){if(b||!t.onCompositionStart||t.$readOnly)return;b={};if(S)return;e.data&&(b.useTextareaForIME=!1),setTimeout(z,0),t._signal("compositionStart"),t.on("mousedown",X);var r=t.getSelectionRange();r.end.row=r.start.row,r.end.column=r.start.column,b.markerRange=r,b.selectionStart=N,t.onCompositionStart(b),b.useTextareaForIME?(T=n.value="",N=0,C=0):(n.msGetInputContext&&(b.context=n.msGetInputContext()),n.getInputContext&&(b.context=n.getInputContext()))},z=function(){if(!b||!t.onCompositionUpdate||t.$readOnly)return;if(S)return X();if(b.useTextareaForIME)t.onCompositionUpdate(n.value);else{var e=n.value;H(e),b.markerRange&&(b.context&&(b.markerRange.start.column=b.selectionStart=b.context.compositionStartOffset),b.markerRange.end.column=b.markerRange.start.column+C-b.selectionStart+k)}},W=function(e){if(!t.onCompositionEnd||t.$readOnly)return;b=!1,t.onCompositionEnd(),t.off("mousedown",X),e&&B()},V=o.delayedCall(z,50).schedule.bind(null,null);r.addListener(n,"compositionstart",U,t),r.addListener(n,"compositionupdate",z,t),r.addListener(n,"keyup",$,t),r.addListener(n,"keydown",V,t),r.addListener(n,"compositionend",W,t),this.getElement=function(){return n},this.setCommandMode=function(e){S=e,n.readOnly=!1},this.setReadOnly=function(e){S||(n.readOnly=e)},this.setCopyWithEmptySelection=function(e){},this.onContextMenu=function(e){P=!0,O(),t._emit("nativecontextmenu",{target:t,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,o){E||(E=n.style.cssText),n.style.cssText=(o?"z-index:100000;":"")+(i.isIE?"opacity:0.1;":"")+"text-indent: -"+(N+C)*t.renderer.characterWidth*.5+"px;";var u=t.container.getBoundingClientRect(),a=s.computedStyle(t.container),f=u.top+(parseInt(a.borderTopWidth)||0),l=u.left+(parseInt(u.borderLeftWidth)||0),c=u.bottom-f-n.clientHeight-2,h=function(e){s.translate(n,e.clientX-l-2,Math.min(e.clientY-f-2,c))};h(e);if(e.type!="mousedown")return;t.renderer.$isMousePressed=!0,clearTimeout(J),i.isWin&&r.capture(t.container,h,K)},this.onContextMenuClose=K;var J,Q=function(e){t.textInput.onContextMenu(e),K()};r.addListener(n,"mouseup",Q,t),r.addListener(n,"mousedown",function(e){e.preventDefault(),K()},t),r.addListener(t.renderer.scroller,"contextmenu",Q,t),r.addListener(n,"contextmenu",Q,t),d&&G(e,t,n)};t.TextInput=g,t.$setUserAgentForTests=function(e,t){m=e,d=t}}),ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],function(e,t,n){"use strict";function o(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e)),t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e)),t.setDefaultHandler("tripleclick",this.onTripleClick.bind(e)),t.setDefaultHandler("quadclick",this.onQuadClick.bind(e)),t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e));var n=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];n.forEach(function(t){e[t]=this[t]},this),e.selectByLines=this.extendSelectionBy.bind(e,"getLineRange"),e.selectByWords=this.extendSelectionBy.bind(e,"getWordRange")}function u(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}function a(e,t){if(e.start.row==e.end.row)var n=2*t.column-e.start.column-e.end.column;else if(e.start.row==e.end.row-1&&!e.start.column&&!e.end.column)var n=t.column-4;else var n=2*t.row-e.start.row-e.end.row;return n<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}var r=e("../lib/useragent"),i=0,s=550;(function(){this.onMouseDown=function(e){var t=e.inSelection(),n=e.getDocumentPosition();this.mousedownEvent=e;var i=this.editor,s=e.getButton();if(s!==0){var o=i.getSelectionRange(),u=o.isEmpty();(u||s==1)&&i.selection.moveToPosition(n),s==2&&(i.textInput.onContextMenu(e.domEvent),r.isMozilla||e.preventDefault());return}this.mousedownEvent.time=Date.now();if(t&&!i.isFocused()){i.focus();if(this.$focusTimeout&&!this.$clickSelection&&!i.inMultiSelectMode){this.setState("focusWait"),this.captureMouse(e);return}}return this.captureMouse(e),this.startSelect(n,e.domEvent._clicks>1),e.preventDefault()},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var n=this.editor;if(!this.mousedownEvent)return;this.mousedownEvent.getShiftKey()?n.selection.selectToPosition(e):t||n.selection.moveToPosition(e),t||this.select(),n.renderer.scroller.setCapture&&n.renderer.scroller.setCapture(),n.setStyle("ace_selecting"),this.setState("select")},this.select=function(){var e,t=this.editor,n=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var r=this.$clickSelection.comparePoint(n);if(r==-1)e=this.$clickSelection.end;else if(r==1)e=this.$clickSelection.start;else{var i=a(this.$clickSelection,n);n=i.cursor,e=i.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(n),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,n=this.editor,r=n.renderer.screenToTextCoordinates(this.x,this.y),i=n.selection[e](r.row,r.column);if(this.$clickSelection){var s=this.$clickSelection.comparePoint(i.start),o=this.$clickSelection.comparePoint(i.end);if(s==-1&&o<=0){t=this.$clickSelection.end;if(i.end.row!=r.row||i.end.column!=r.column)r=i.start}else if(o==1&&s>=0){t=this.$clickSelection.start;if(i.start.row!=r.row||i.start.column!=r.column)r=i.end}else if(s==-1&&o==1)r=i.end,t=i.start;else{var u=a(this.$clickSelection,r);r=u.cursor,t=u.anchor}n.selection.setSelectionAnchor(t.row,t.column)}n.selection.selectToPosition(r),n.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e=u(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),t=Date.now();(e>i||t-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),n=this.editor,r=n.session,i=r.getBracketRange(t);i?(i.isEmpty()&&(i.start.column--,i.end.column++),this.setState("select")):(i=n.selection.getWordRange(t.row,t.column),this.setState("selectByWords")),this.$clickSelection=i,this.select()},this.onTripleClick=function(e){var t=e.getDocumentPosition(),n=this.editor;this.setState("selectByLines");var r=n.getSelectionRange();r.isMultiLine()&&r.contains(t.row,t.column)?(this.$clickSelection=n.selection.getLineRange(r.start.row),this.$clickSelection.end=n.selection.getLineRange(r.end.row).end):this.$clickSelection=n.selection.getLineRange(t.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){if(e.getAccelKey())return;e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0);var t=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var n=this.$lastScroll,r=e.domEvent.timeStamp,i=r-n.t,o=i?e.wheelX/i:n.vx,u=i?e.wheelY/i:n.vy;i<s&&(o=(o+n.vx)/2,u=(u+n.vy)/2);var a=Math.abs(o/u),f=!1;a>=1&&t.renderer.isScrollableBy(e.wheelX*e.speed,0)&&(f=!0),a<=1&&t.renderer.isScrollableBy(0,e.wheelY*e.speed)&&(f=!0);if(f)n.allowed=r;else if(r-n.allowed<s){var l=Math.abs(o)<=1.5*Math.abs(n.vx)&&Math.abs(u)<=1.5*Math.abs(n.vy);l?(f=!0,n.allowed=r):n.allowed=0}n.t=r,n.vx=o,n.vy=u;if(f)return t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()}}).call(o.prototype),t.DefaultHandlers=o}),ace.define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],function(e,t,n){"use strict";function s(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}var r=e("./lib/oop"),i=e("./lib/dom");(function(){this.$init=function(){return this.$element=i.createElement("div"),this.$element.className="ace_tooltip",this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){this.getElement().textContent=e},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+"px",this.getElement().style.top=t+"px"},this.setClassName=function(e){i.addCssClass(this.getElement(),e)},this.show=function(e,t,n){e!=null&&this.setText(e),t!=null&&n!=null&&this.setPosition(t,n),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth},this.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)}}).call(s.prototype),t.Tooltip=s}),ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],function(e,t,n){"use strict";function u(e){function l(){var r=u.getDocumentPosition().row,s=n.$annotations[r];if(!s)return c();var o=t.session.getLength();if(r==o){var a=t.renderer.pixelToScreenCoordinates(0,u.y).row,l=u.$pos;if(a>t.session.documentToScreenRow(l.row,l.column))return c()}if(f==s)return;f=s.text.join("<br/>"),i.setHtml(f),i.show(),t._signal("showGutterTooltip",i),t.on("mousewheel",c);if(e.$tooltipFollowsMouse)h(u);else{var p=u.domEvent.target,d=p.getBoundingClientRect(),v=i.getElement().style;v.left=d.right+"px",v.top=d.bottom+"px"}}function c(){o&&(o=clearTimeout(o)),f&&(i.hide(),f=null,t._signal("hideGutterTooltip",i),t.off("mousewheel",c))}function h(e){i.setPosition(e.x,e.y)}var t=e.editor,n=t.renderer.$gutterLayer,i=new a(t.container);e.editor.setDefaultHandler("guttermousedown",function(r){if(!t.isFocused()||r.getButton()!=0)return;var i=n.getRegion(r);if(i=="foldWidgets")return;var s=r.getDocumentPosition().row,o=t.session.selection;if(r.getShiftKey())o.selectTo(s,0);else{if(r.domEvent.detail==2)return t.selectAll(),r.preventDefault();e.$clickSelection=t.selection.getLineRange(s)}return e.setState("selectByLines"),e.captureMouse(r),r.preventDefault()});var o,u,f;e.editor.setDefaultHandler("guttermousemove",function(t){var n=t.domEvent.target||t.domEvent.srcElement;if(r.hasCssClass(n,"ace_fold-widget"))return c();f&&e.$tooltipFollowsMouse&&h(t),u=t;if(o)return;o=setTimeout(function(){o=null,u&&!e.isMousePressed?l():c()},50)}),s.addListener(t.renderer.$gutter,"mouseout",function(e){u=null;if(!f||o)return;o=setTimeout(function(){o=null,c()},50)},t),t.on("changeSession",c)}function a(e){o.call(this,e)}var r=e("../lib/dom"),i=e("../lib/oop"),s=e("../lib/event"),o=e("../tooltip").Tooltip;i.inherits(a,o),function(){this.setPosition=function(e,t){var n=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight,i=this.getWidth(),s=this.getHeight();e+=15,t+=15,e+i>n&&(e-=e+i-n),t+s>r&&(t-=20+s),o.prototype.setPosition.call(this,e,t)}}.call(a.prototype),t.GutterHandler=u}),ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(e,t,n){"use strict";var r=e("../lib/event"),i=e("../lib/useragent"),s=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){r.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){r.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var e=this.editor,t=e.getSelectionRange();if(t.isEmpty())this.$inSelection=!1;else{var n=this.getDocumentPosition();this.$inSelection=t.contains(n.row,n.column)}return this.$inSelection},this.getButton=function(){return r.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=i.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(s.prototype)}),ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(e,t,n){"use strict";function f(e){function T(e,n){var r=Date.now(),i=!n||e.row!=n.row,s=!n||e.column!=n.column;if(!S||i||s)t.moveCursorToPosition(e),S=r,x={x:p,y:d};else{var o=l(x.x,x.y,p,d);o>a?S=null:r-S>=u&&(t.renderer.scrollCursorIntoView(),S=null)}}function N(e,n){var r=Date.now(),i=t.renderer.layerConfig.lineHeight,s=t.renderer.layerConfig.characterWidth,u=t.renderer.scroller.getBoundingClientRect(),a={x:{left:p-u.left,right:u.right-p},y:{top:d-u.top,bottom:u.bottom-d}},f=Math.min(a.x.left,a.x.right),l=Math.min(a.y.top,a.y.bottom),c={row:e.row,column:e.column};f/s<=2&&(c.column+=a.x.left<a.x.right?-3:2),l/i<=1&&(c.row+=a.y.top<a.y.bottom?-1:1);var h=e.row!=c.row,v=e.column!=c.column,m=!n||e.row!=n.row;h||v&&!m?E?r-E>=o&&t.renderer.scrollCursorIntoView(c):E=r:E=null}function C(){var e=g;g=t.renderer.screenToTextCoordinates(p,d),T(g,e),N(g,e)}function k(){m=t.selection.toOrientedRange(),h=t.session.addMarker(m,"ace_selection",t.getSelectionStyle()),t.clearSelection(),t.isFocused()&&t.renderer.$cursorLayer.setBlinking(!1),clearInterval(v),C(),v=setInterval(C,20),y=0,i.addListener(document,"mousemove",O)}function L(){clearInterval(v),t.session.removeMarker(h),h=null,t.selection.fromOrientedRange(m),t.isFocused()&&!w&&t.$resetCursorStyle(),m=null,g=null,y=0,E=null,S=null,i.removeListener(document,"mousemove",O)}function O(){A==null&&(A=setTimeout(function(){A!=null&&h&&L()},20))}function M(e){var t=e.types;return!t||Array.prototype.some.call(t,function(e){return e=="text/plain"||e=="Text"})}function _(e){var t=["copy","copymove","all","uninitialized"],n=["move","copymove","linkmove","all","uninitialized"],r=s.isMac?e.altKey:e.ctrlKey,i="uninitialized";try{i=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var o="none";return r&&t.indexOf(i)>=0?o="copy":n.indexOf(i)>=0?o="move":t.indexOf(i)>=0&&(o="copy"),o}var t=e.editor,n=r.createElement("div");n.style.cssText="top:-100px;position:absolute;z-index:2147483647;opacity:0.5",n.textContent="\u00a0";var f=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];f.forEach(function(t){e[t]=this[t]},this),t.on("mousedown",this.onMouseDown.bind(e));var c=t.container,h,p,d,v,m,g,y=0,b,w,E,S,x;this.onDragStart=function(e){if(this.cancelDrag||!c.draggable){var r=this;return setTimeout(function(){r.startSelect(),r.captureMouse(e)},0),e.preventDefault()}m=t.getSelectionRange();var i=e.dataTransfer;i.effectAllowed=t.getReadOnly()?"copy":"copyMove",t.container.appendChild(n),i.setDragImage&&i.setDragImage(n,0,0),setTimeout(function(){t.container.removeChild(n)}),i.clearData(),i.setData("Text",t.session.getTextRange()),w=!0,this.setState("drag")},this.onDragEnd=function(e){c.draggable=!1,w=!1,this.setState(null);if(!t.getReadOnly()){var n=e.dataTransfer.dropEffect;!b&&n=="move"&&t.session.remove(t.getSelectionRange()),t.$resetCursorStyle()}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return p=e.clientX,d=e.clientY,h||k(),y++,e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragOver=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return p=e.clientX,d=e.clientY,h||(k(),y++),A!==null&&(A=null),e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragLeave=function(e){y--;if(y<=0&&h)return L(),b=null,i.preventDefault(e)},this.onDrop=function(e){if(!g)return;var n=e.dataTransfer;if(w)switch(b){case"move":m.contains(g.row,g.column)?m={start:g,end:g}:m=t.moveText(m,g);break;case"copy":m=t.moveText(m,g,!0)}else{var r=n.getData("Text");m={start:g,end:t.session.insert(g,r)},t.focus(),b=null}return L(),i.preventDefault(e)},i.addListener(c,"dragstart",this.onDragStart.bind(e),t),i.addListener(c,"dragend",this.onDragEnd.bind(e),t),i.addListener(c,"dragenter",this.onDragEnter.bind(e),t),i.addListener(c,"dragover",this.onDragOver.bind(e),t),i.addListener(c,"dragleave",this.onDragLeave.bind(e),t),i.addListener(c,"drop",this.onDrop.bind(e),t);var A=null}function l(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var r=e("../lib/dom"),i=e("../lib/event"),s=e("../lib/useragent"),o=200,u=200,a=5;(function(){this.dragWait=function(){var e=Date.now()-this.mousedownEvent.time;e>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){var e=this.editor.container;e.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor,t=e.container;t.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle("ace_dragging");var n=s.isWin?"default":"move";e.renderer.setCursorStyle(n),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;if(s.isIE&&this.state=="dragReady"){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>3&&t.dragDrop()}if(this.state==="dragWait"){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n>0&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(e){if(!this.$dragEnabled)return;this.mousedownEvent=e;var t=this.editor,n=e.inSelection(),r=e.getButton(),i=e.domEvent.detail||1;if(i===1&&r===0&&n){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var o=e.domEvent.target||e.domEvent.srcElement;"unselectable"in o&&(o.unselectable="on");if(t.getDragDelay()){if(s.isWebKit){this.cancelDrag=!0;var u=t.container;u.draggable=!0}this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}).call(f.prototype),t.DragdropHandler=f}),ace.define("ace/mouse/touch_handler",["require","exports","module","ace/mouse/mouse_event","ace/lib/event","ace/lib/dom"],function(e,t,n){"use strict";var r=e("./mouse_event").MouseEvent,i=e("../lib/event"),s=e("../lib/dom");t.addTouchListeners=function(e,t){function b(){var e=window.navigator&&window.navigator.clipboard,r=!1,i=function(){var n=t.getCopyText(),i=t.session.getUndoManager().hasUndo();y.replaceChild(s.buildDom(r?["span",!n&&["span",{"class":"ace_mobile-button",action:"selectall"},"Select All"],n&&["span",{"class":"ace_mobile-button",action:"copy"},"Copy"],n&&["span",{"class":"ace_mobile-button",action:"cut"},"Cut"],e&&["span",{"class":"ace_mobile-button",action:"paste"},"Paste"],i&&["span",{"class":"ace_mobile-button",action:"undo"},"Undo"],["span",{"class":"ace_mobile-button",action:"find"},"Find"],["span",{"class":"ace_mobile-button",action:"openCommandPallete"},"Pallete"]]:["span"]),y.firstChild)},o=function(n){var s=n.target.getAttribute("action");if(s=="more"||!r)return r=!r,i();if(s=="paste")e.readText().then(function(e){t.execCommand(s,e)});else if(s){if(s=="cut"||s=="copy")e?e.writeText(t.getCopyText()):document.execCommand("copy");t.execCommand(s)}y.firstChild.style.display="none",r=!1,s!="openCommandPallete"&&t.focus()};y=s.buildDom(["div",{"class":"ace_mobile-menu",ontouchstart:function(e){n="menu",e.stopPropagation(),e.preventDefault(),t.textInput.focus()},ontouchend:function(e){e.stopPropagation(),e.preventDefault(),o(e)},onclick:o},["span"],["span",{"class":"ace_mobile-button",action:"more"},"..."]],t.container)}function w(){y||b();var e=t.selection.cursor,n=t.renderer.textToScreenCoordinates(e.row,e.column),r=t.renderer.textToScreenCoordinates(0,0).pageX,i=t.renderer.scrollLeft,s=t.container.getBoundingClientRect();y.style.top=n.pageY-s.top-3+"px",n.pageX-s.left<s.width-70?(y.style.left="",y.style.right="10px"):(y.style.right="",y.style.left=r+i-s.left+"px"),y.style.display="",y.firstChild.style.display="none",t.on("input",E)}function E(e){y&&(y.style.display="none"),t.off("input",E)}function S(){l=null,clearTimeout(l);var e=t.selection.getRange(),r=e.contains(p.row,p.column);if(e.isEmpty()||!r)t.selection.moveToPosition(p),t.selection.selectWord();n="wait",w()}function x(){l=null,clearTimeout(l),t.selection.moveToPosition(p);var e=d>=2?t.selection.getLineRange(p.row):t.session.getBracketRange(p);e&&!e.isEmpty()?t.selection.setRange(e):t.selection.selectWord(),n="wait"}function T(){h+=60,c=setInterval(function(){h--<=0&&(clearInterval(c),c=null),Math.abs(v)<.01&&(v=0),Math.abs(m)<.01&&(m=0),h<20&&(v=.9*v),h<20&&(m=.9*m);var e=t.session.getScrollTop();t.renderer.scrollBy(10*v,10*m),e==t.session.getScrollTop()&&(h=0)},10)}var n="scroll",o,u,a,f,l,c,h=0,p,d=0,v=0,m=0,g,y;i.addListener(e,"contextmenu",function(e){if(!g)return;var n=t.textInput.getElement();n.focus()},t),i.addListener(e,"touchstart",function(e){var i=e.touches;if(l||i.length>1){clearTimeout(l),l=null,a=-1,n="zoom";return}g=t.$mouseHandler.isMousePressed=!0;var s=t.renderer.layerConfig.lineHeight,c=t.renderer.layerConfig.lineHeight,y=e.timeStamp;f=y;var b=i[0],w=b.clientX,E=b.clientY;Math.abs(o-w)+Math.abs(u-E)>s&&(a=-1),o=e.clientX=w,u=e.clientY=E,v=m=0;var T=new r(e,t);p=T.getDocumentPosition();if(y-a<500&&i.length==1&&!h)d++,e.preventDefault(),e.button=0,x();else{d=0;var N=t.selection.cursor,C=t.selection.isEmpty()?N:t.selection.anchor,k=t.renderer.$cursorLayer.getPixelPosition(N,!0),L=t.renderer.$cursorLayer.getPixelPosition(C,!0),A=t.renderer.scroller.getBoundingClientRect(),O=t.renderer.layerConfig.offset,M=t.renderer.scrollLeft,_=function(e,t){return e/=c,t=t/s-.75,e*e+t*t};if(e.clientX<A.left){n="zoom";return}var D=_(e.clientX-A.left-k.left+M,e.clientY-A.top-k.top+O),P=_(e.clientX-A.left-L.left+M,e.clientY-A.top-L.top+O);D<3.5&&P<3.5&&(n=D>P?"cursor":"anchor"),P<3.5?n="anchor":D<3.5?n="cursor":n="scroll",l=setTimeout(S,450)}a=y},t),i.addListener(e,"touchend",function(e){g=t.$mouseHandler.isMousePressed=!1,c&&clearInterval(c),n=="zoom"?(n="",h=0):l?(t.selection.moveToPosition(p),h=0,w()):n=="scroll"?(T(),E()):w(),clearTimeout(l),l=null},t),i.addListener(e,"touchmove",function(e){l&&(clearTimeout(l),l=null);var i=e.touches;if(i.length>1||n=="zoom")return;var s=i[0],a=o-s.clientX,c=u-s.clientY;if(n=="wait"){if(!(a*a+c*c>4))return e.preventDefault();n="cursor"}o=s.clientX,u=s.clientY,e.clientX=s.clientX,e.clientY=s.clientY;var h=e.timeStamp,p=h-f;f=h;if(n=="scroll"){var d=new r(e,t);d.speed=1,d.wheelX=a,d.wheelY=c,10*Math.abs(a)<Math.abs(c)&&(a=0),10*Math.abs(c)<Math.abs(a)&&(c=0),p!=0&&(v=a/p,m=c/p),t._emit("mousewheel",d),d.propagationStopped||(v=m=0)}else{var g=new r(e,t),y=g.getDocumentPosition();n=="cursor"?t.selection.moveCursorToPosition(y):n=="anchor"&&t.selection.setSelectionAnchor(y.row,y.column),t.renderer.scrollCursorIntoView(y),e.preventDefault()}},t)}}),ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";var r=e("./dom");t.get=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)},t.loadScript=function(e,t){var n=r.getDocumentHead(),i=document.createElement("script");i.src=e,n.appendChild(i),i.onload=i.onreadystatechange=function(e,n){if(n||!i.readyState||i.readyState=="loaded"||i.readyState=="complete")i=i.onload=i.onreadystatechange=null,n||t()}},t.qualifyURL=function(e){var t=document.createElement("a");return t.href=e,t.href}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(e,t,n){"use strict";var r={},i=function(){this.propagationStopped=!0},s=function(){this.defaultPrevented=!0};r._emit=r._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var n=this._eventRegistry[e]||[],r=this._defaultHandlers[e];if(!n.length&&!r)return;if(typeof t!="object"||!t)t={};t.type||(t.type=e),t.stopPropagation||(t.stopPropagation=i),t.preventDefault||(t.preventDefault=s),n=n.slice();for(var o=0;o<n.length;o++){n[o](t,this);if(t.propagationStopped)break}if(r&&!t.defaultPrevented)return r(t,this)},r._signal=function(e,t){var n=(this._eventRegistry||{})[e];if(!n)return;n=n.slice();for(var r=0;r<n.length;r++)n[r](t,this)},r.once=function(e,t){var n=this;this.on(e,function r(){n.off(e,r),t.apply(null,arguments)});if(!t)return new Promise(function(e){t=e})},r.setDefaultHandler=function(e,t){var n=this._defaultHandlers;n||(n=this._defaultHandlers={_disabled_:{}});if(n[e]){var r=n[e],i=n._disabled_[e];i||(n._disabled_[e]=i=[]),i.push(r);var s=i.indexOf(t);s!=-1&&i.splice(s,1)}n[e]=t},r.removeDefaultHandler=function(e,t){var n=this._defaultHandlers;if(!n)return;var r=n._disabled_[e];if(n[e]==t)r&&this.setDefaultHandler(e,r.pop());else if(r){var i=r.indexOf(t);i!=-1&&r.splice(i,1)}},r.on=r.addEventListener=function(e,t,n){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[e];return r||(r=this._eventRegistry[e]=[]),r.indexOf(t)==-1&&r[n?"unshift":"push"](t),t},r.off=r.removeListener=r.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[e];if(!n)return;var r=n.indexOf(t);r!==-1&&n.splice(r,1)},r.removeAllListeners=function(e){e||(this._eventRegistry=this._defaultHandlers=undefined),this._eventRegistry&&(this._eventRegistry[e]=undefined),this._defaultHandlers&&(this._defaultHandlers[e]=undefined)},t.EventEmitter=r}),ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,n){"no use strict";function o(e){typeof console!="undefined"&&console.warn&&console.warn.apply(console,arguments)}function u(e,t){var n=new Error(e);n.data=t,typeof console=="object"&&console.error&&console.error(n),setTimeout(function(){throw n})}var r=e("./oop"),i=e("./event_emitter").EventEmitter,s={setOptions:function(e){Object.keys(e).forEach(function(t){this.setOption(t,e[t])},this)},getOptions:function(e){var t={};if(!e){var n=this.$options;e=Object.keys(n).filter(function(e){return!n[e].hidden})}else Array.isArray(e)||(t=e,e=Object.keys(t));return e.forEach(function(e){t[e]=this.getOption(e)},this),t},setOption:function(e,t){if(this["$"+e]===t)return;var n=this.$options[e];if(!n)return o('misspelled option "'+e+'"');if(n.forwardTo)return this[n.forwardTo]&&this[n.forwardTo].setOption(e,t);n.handlesSet||(this["$"+e]=t),n&&n.set&&n.set.call(this,t)},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&&this[t.forwardTo].getOption(e):t&&t.get?t.get.call(this):this["$"+e]:o('misspelled option "'+e+'"')}},a=function(){this.$defaultOptions={}};(function(){r.implement(this,i),this.defineOptions=function(e,t,n){return e.$options||(this.$defaultOptions[t]=e.$options={}),Object.keys(n).forEach(function(t){var r=n[t];typeof r=="string"&&(r={forwardTo:r}),r.name||(r.name=t),e.$options[r.name]=r,"initialValue"in r&&(e["$"+r.name]=r.initialValue)}),r.implement(e,s),this},this.resetOptions=function(e){Object.keys(e.$options).forEach(function(t){var n=e.$options[t];"value"in n&&e.setOption(t,n.value)})},this.setDefaultValue=function(e,t,n){if(!e){for(e in this.$defaultOptions)if(this.$defaultOptions[e][t])break;if(!this.$defaultOptions[e][t])return!1}var r=this.$defaultOptions[e]||(this.$defaultOptions[e]={});r[t]&&(r.forwardTo?this.setDefaultValue(r.forwardTo,t,n):r[t].value=n)},this.setDefaultValues=function(e,t){Object.keys(t).forEach(function(n){this.setDefaultValue(e,n,t[n])},this)},this.warn=o,this.reportError=u}).call(a.prototype),t.AppConfig=a}),ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/dom","ace/lib/app_config"],function(e,t,n){"no use strict";function c(r){if(!a||!a.document)return;f.packaged=r||e.packaged||n.packaged||a.define&&define.packaged;var i={},s="",o=document.currentScript||document._currentScript,u=o&&o.ownerDocument||document,l=u.getElementsByTagName("script");for(var c=0;c<l.length;c++){var p=l[c],d=p.src||p.getAttribute("src");if(!d)continue;var v=p.attributes;for(var m=0,g=v.length;m<g;m++){var y=v[m];y.name.indexOf("data-ace-")===0&&(i[h(y.name.replace(/^data-ace-/,""))]=y.value)}var b=d.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);b&&(s=b[1])}s&&(i.base=i.base||s,i.packaged=!0),i.basePath=i.base,i.workerPath=i.workerPath||i.base,i.modePath=i.modePath||i.base,i.themePath=i.themePath||i.base,delete i.base;for(var w in i)typeof i[w]!="undefined"&&t.set(w,i[w])}function h(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./lib/net"),o=e("./lib/dom"),u=e("./lib/app_config").AppConfig;n.exports=t=new u;var a=function(){return this||typeof window!="undefined"&&window}(),f={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1,useStrictCSP:null};t.get=function(e){if(!f.hasOwnProperty(e))throw new Error("Unknown config key: "+e);return f[e]},t.set=function(e,t){if(f.hasOwnProperty(e))f[e]=t;else if(this.setDefaultValue("",e,t)==0)throw new Error("Unknown config key: "+e);e=="useStrictCSP"&&o.useStrictCSP(t)},t.all=function(){return r.copyObject(f)},t.$modes={},t.moduleUrl=function(e,t){if(f.$moduleUrls[e])return f.$moduleUrls[e];var n=e.split("/");t=t||n[n.length-2]||"";var r=t=="snippets"?"/":"-",i=n[n.length-1];if(t=="worker"&&r=="-"){var s=new RegExp("^"+t+"[\\-_]|[\\-_]"+t+"$","g");i=i.replace(s,"")}(!i||i==t)&&n.length>1&&(i=n[n.length-2]);var o=f[t+"Path"];return o==null?o=f.basePath:r=="/"&&(t=r=""),o&&o.slice(-1)!="/"&&(o+="/"),o+t+r+i+this.get("suffix")},t.setModuleUrl=function(e,t){return f.$moduleUrls[e]=t},t.$loading={},t.loadModule=function(n,r){var i,o;Array.isArray(n)&&(o=n[0],n=n[1]);try{i=e(n)}catch(u){}if(i&&!t.$loading[n])return r&&r(i);t.$loading[n]||(t.$loading[n]=[]),t.$loading[n].push(r);if(t.$loading[n].length>1)return;var a=function(){e([n],function(e){t._emit("load.module",{name:n,module:e});var r=t.$loading[n];t.$loading[n]=null,r.forEach(function(t){t&&t(e)})})};if(!t.get("packaged"))return a();s.loadScript(t.moduleUrl(n,o),a),l()};var l=function(){!f.basePath&&!f.workerPath&&!f.modePath&&!f.themePath&&!Object.keys(f.$moduleUrls).length&&(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),l=function(){})};t.init=c,t.version="1.5.0"}),ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/mouse/touch_handler","ace/config"],function(e,t,n){"use strict";var r=e("../lib/event"),i=e("../lib/useragent"),s=e("./default_handlers").DefaultHandlers,o=e("./default_gutter_handler").GutterHandler,u=e("./mouse_event").MouseEvent,a=e("./dragdrop_handler").DragdropHandler,f=e("./touch_handler").addTouchListeners,l=e("../config"),c=function(e){var t=this;this.editor=e,new s(this),new o(this),new a(this);var n=function(t){var n=!document.hasFocus||!document.hasFocus()||!e.isFocused()&&document.activeElement==(e.textInput&&e.textInput.getElement());n&&window.focus(),e.focus()},u=e.renderer.getMouseEventTarget();r.addListener(u,"click",this.onMouseEvent.bind(this,"click"),e),r.addListener(u,"mousemove",this.onMouseMove.bind(this,"mousemove"),e),r.addMultiMouseDownListener([u,e.renderer.scrollBarV&&e.renderer.scrollBarV.inner,e.renderer.scrollBarH&&e.renderer.scrollBarH.inner,e.textInput&&e.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",e),r.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel"),e),f(e.container,e);var l=e.renderer.$gutter;r.addListener(l,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"),e),r.addListener(l,"click",this.onMouseEvent.bind(this,"gutterclick"),e),r.addListener(l,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),e),r.addListener(l,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),e),r.addListener(u,"mousedown",n,e),r.addListener(l,"mousedown",n,e),i.isIE&&e.renderer.scrollBarV&&(r.addListener(e.renderer.scrollBarV.element,"mousedown",n,e),r.addListener(e.renderer.scrollBarH.element,"mousedown",n,e)),e.on("mousemove",function(n){if(t.state||t.$dragDelay||!t.$dragEnabled)return;var r=e.renderer.screenToTextCoordinates(n.x,n.y),i=e.session.selection.getRange(),s=e.renderer;!i.isEmpty()&&i.insideStart(r.row,r.column)?s.setCursorStyle("default"):s.setCursorStyle("")},e)};(function(){this.onMouseEvent=function(e,t){if(!this.editor.session)return;this.editor._emit(e,new u(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;if(!n||!n.length)return;this.editor._emit(e,new u(t,this.editor))},this.onMouseWheel=function(e,t){var n=new u(t,this.editor);n.speed=this.$scrollSpeed*2,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var n=this.editor,s=this.editor.renderer;s.$isMousePressed=!0;var o=this,a=function(e){if(!e)return;if(i.isWebKit&&!e.which&&o.releaseMouse)return o.releaseMouse();o.x=e.clientX,o.y=e.clientY,t&&t(e),o.mouseEvent=new u(e,o.editor),o.$mouseMoved=!0},f=function(e){n.off("beforeEndOperation",c),clearInterval(h),n.session&&l(),o[o.state+"End"]&&o[o.state+"End"](e),o.state="",o.isMousePressed=s.$isMousePressed=!1,s.$keepTextAreaAtCursor&&s.$moveTextAreaToCursor(),o.$onCaptureMouseMove=o.releaseMouse=null,e&&o.onMouseEvent("mouseup",e),n.endOperation()},l=function(){o[o.state]&&o[o.state](),o.$mouseMoved=!1};if(i.isOldIE&&e.domEvent.type=="dblclick")return setTimeout(function(){f(e)});var c=function(e){if(!o.releaseMouse)return;n.curOp.command.name&&n.curOp.selectionChanged&&(o[o.state+"End"]&&o[o.state+"End"](),o.state="",o.releaseMouse())};n.on("beforeEndOperation",c),n.startOperation({command:{name:"mouse"}}),o.$onCaptureMouseMove=a,o.releaseMouse=r.capture(this.editor.container,a,f);var h=setInterval(l,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var e=function(t){if(t&&t.domEvent&&t.domEvent.type!="contextmenu")return;this.editor.off("nativecontextmenu",e),t&&t.domEvent&&r.stopEvent(t.domEvent)}.bind(this);setTimeout(e,10),this.editor.on("nativecontextmenu",e)},this.destroy=function(){this.releaseMouse&&this.releaseMouse()}}).call(c.prototype),l.defineOptions(c.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:i.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=c}),ace.define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";function i(e){e.on("click",function(t){var n=t.getDocumentPosition(),i=e.session,s=i.getFoldAt(n.row,n.column,1);s&&(t.getAccelKey()?i.removeFold(s):i.expandFold(s),t.stop());var o=t.domEvent&&t.domEvent.target;o&&r.hasCssClass(o,"ace_inline_button")&&r.hasCssClass(o,"ace_toggle_wrap")&&(i.setOption("wrap",!i.getUseWrapMode()),e.renderer.scrollCursorIntoView())}),e.on("gutterclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n=="foldWidgets"){var r=t.getDocumentPosition().row,i=e.session;i.foldWidgets&&i.foldWidgets[r]&&e.session.onFoldWidgetClick(r,t),e.isFocused()||e.focus(),t.stop()}}),e.on("gutterdblclick",function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n=="foldWidgets"){var r=t.getDocumentPosition().row,i=e.session,s=i.getParentFoldRangeData(r,!0),o=s.range||s.firstRange;if(o){r=o.start.row;var u=i.getFoldAt(r,i.getLine(r).length,1);u?i.removeFold(u):(i.addFold("...",o),e.renderer.scrollCursorIntoView({row:o.start.row,column:0}))}t.stop()}})}var r=e("../lib/dom");t.FoldHandler=i}),ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(e,t,n){"use strict";var r=e("../lib/keys"),i=e("../lib/event"),s=function(e){this.$editor=e,this.$data={editor:e},this.$handlers=[],this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0)},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]==e)return;while(t[t.length-1]&&t[t.length-1]!=this.$defaultHandler)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)},this.addKeyboardHandler=function(e,t){if(!e)return;typeof e=="function"&&!e.handleKeyboard&&(e.handleKeyboard=e);var n=this.$handlers.indexOf(e);n!=-1&&this.$handlers.splice(n,1),t==undefined?this.$handlers.push(e):this.$handlers.splice(t,0,e),n==-1&&e.attach&&e.attach(this.$editor)},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return t==-1?!1:(this.$handlers.splice(t,1),e.detach&&e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var e=this.$data,t=e.editor;return this.$handlers.map(function(n){return n.getStatusText&&n.getStatusText(t,e)||""}).filter(Boolean).join(" ")},this.$callKeyboardHandlers=function(e,t,n,r){var s,o=!1,u=this.$editor.commands;for(var a=this.$handlers.length;a--;){s=this.$handlers[a].handleKeyboard(this.$data,e,t,n,r);if(!s||!s.command)continue;s.command=="null"?o=!0:o=u.exec(s.command,this.$editor,s.args,r),o&&r&&e!=-1&&s.passEvent!=1&&s.command.passEvent!=1&&i.stopEvent(r);if(o)break}return!o&&e==-1&&(s={command:"insertstring"},o=u.exec("insertstring",this.$editor,t)),o&&this.$editor._signal&&this.$editor._signal("keyboardActivity",s),o},this.onCommandKey=function(e,t,n){var i=r.keyCodeToString(n);return this.$callKeyboardHandlers(t,i,n,e)},this.onTextInput=function(e){return this.$callKeyboardHandlers(-1,e)}}).call(s.prototype),t.KeyBinding=s}),ace.define("ace/lib/bidiutil",["require","exports","module"],function(e,t,n){"use strict";function F(e,t,n,r){var i=s?d:p,c=null,h=null,v=null,m=0,g=null,y=null,b=-1,w=null,E=null,T=[];if(!r)for(w=0,r=[];w<n;w++)r[w]=R(e[w]);o=s,u=!1,a=!1,f=!1,l=!1;for(E=0;E<n;E++){c=m,T[E]=h=q(e,r,T,E),m=i[c][h],g=m&240,m&=15,t[E]=v=i[m][5];if(g>0)if(g==16){for(w=b;w<E;w++)t[w]=1;b=-1}else b=-1;y=i[m][6];if(y)b==-1&&(b=E);else if(b>-1){for(w=b;w<E;w++)t[w]=v;b=-1}r[E]==S&&(t[E]=0),o|=v}if(l)for(w=0;w<n;w++)if(r[w]==x){t[w]=s;for(var C=w-1;C>=0;C--){if(r[C]!=N)break;t[C]=s}}}function I(e,t,n){if(o<e)return;if(e==1&&s==m&&!f){n.reverse();return}var r=n.length,i=0,u,a,l,c;while(i<r){if(t[i]>=e){u=i+1;while(u<r&&t[u]>=e)u++;for(a=i,l=u-1;a<l;a++,l--)c=n[a],n[a]=n[l],n[l]=c;i=u}i++}}function q(e,t,n,r){var i=t[r],o,c,h,p;switch(i){case g:case y:u=!1;case E:case w:return i;case b:return u?w:b;case T:return u=!0,a=!0,y;case N:return E;case C:if(r<1||r+1>=t.length||(o=n[r-1])!=b&&o!=w||(c=t[r+1])!=b&&c!=w)return E;return u&&(c=w),c==o?c:E;case k:o=r>0?n[r-1]:S;if(o==b&&r+1<t.length&&t[r+1]==b)return b;return E;case L:if(r>0&&n[r-1]==b)return b;if(u)return E;p=r+1,h=t.length;while(p<h&&t[p]==L)p++;if(p<h&&t[p]==b)return b;return E;case A:h=t.length,p=r+1;while(p<h&&t[p]==A)p++;if(p<h){var d=e[r],v=d>=1425&&d<=2303||d==64286;o=t[p];if(v&&(o==y||o==T))return y}if(r<1||(o=t[r-1])==S)return E;return n[r-1];case S:return u=!1,f=!0,s;case x:return l=!0,E;case O:case M:case D:case P:case _:u=!1;case H:return E}}function R(e){var t=e.charCodeAt(0),n=t>>8;return n==0?t>191?g:B[t]:n==5?/[\u0591-\u05f4]/.test(e)?y:g:n==6?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(e)?A:/[\u0660-\u0669\u066b-\u066c]/.test(e)?w:t==1642?L:/[\u06f0-\u06f9]/.test(e)?b:T:n==32&&t<=8287?j[t&255]:n==254?t>=65136?T:E:E}function U(e){return e>="\u064b"&&e<="\u0655"}var r=["\u0621","\u0641"],i=["\u063a","\u064a"],s=0,o=0,u=!1,a=!1,f=!1,l=!1,c=!1,h=!1,p=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],d=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],v=0,m=1,g=0,y=1,b=2,w=3,E=4,S=5,x=6,T=7,N=8,C=9,k=10,L=11,A=12,O=13,M=14,_=15,D=16,P=17,H=18,B=[H,H,H,H,H,H,H,H,H,x,S,x,N,S,H,H,H,H,H,H,H,H,H,H,H,H,H,H,S,S,S,x,N,E,E,L,L,L,E,E,E,E,E,k,C,k,C,C,b,b,b,b,b,b,b,b,b,b,C,E,E,E,E,E,E,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,E,E,E,E,E,E,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,E,E,E,E,H,H,H,H,H,H,S,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,C,E,L,L,L,L,E,E,E,E,g,E,E,H,E,E,L,L,b,b,E,g,E,E,E,b,g,E,E,E,E,E],j=[N,N,N,N,N,N,N,N,N,N,N,H,H,H,g,y,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,N,S,O,M,_,D,P,C,L,L,L,L,L,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,C,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,N];t.L=g,t.R=y,t.EN=b,t.ON_R=3,t.AN=4,t.R_H=5,t.B=6,t.RLE=7,t.DOT="\u00b7",t.doBidiReorder=function(e,n,r){if(e.length<2)return{};var i=e.split(""),o=new Array(i.length),u=new Array(i.length),a=[];s=r?m:v,F(i,a,i.length,n);for(var f=0;f<o.length;o[f]=f,f++);I(2,a,o),I(1,a,o);for(var f=0;f<o.length-1;f++)n[f]===w?a[f]=t.AN:a[f]===y&&(n[f]>T&&n[f]<O||n[f]===E||n[f]===H)?a[f]=t.ON_R:f>0&&i[f-1]==="\u0644"&&/\u0622|\u0623|\u0625|\u0627/.test(i[f])&&(a[f-1]=a[f]=t.R_H,f++);i[i.length-1]===t.DOT&&(a[i.length-1]=t.B),i[0]==="\u202b"&&(a[0]=t.RLE);for(var f=0;f<o.length;f++)u[f]=a[o[f]];return{logicalFromVisual:o,bidiLevels:u}},t.hasBidiCharacters=function(e,t){var n=!1;for(var r=0;r<e.length;r++)t[r]=R(e.charAt(r)),!n&&(t[r]==y||t[r]==T||t[r]==w)&&(n=!0);return n},t.getVisualFromLogicalIdx=function(e,t){for(var n=0;n<t.logicalFromVisual.length;n++)if(t.logicalFromVisual[n]==e)return n;return 0}}),ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],function(e,t,n){"use strict";var r=e("./lib/bidiutil"),i=e("./lib/lang"),s=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/,o=function(e){this.session=e,this.bidiMap={},this.currentRow=null,this.bidiUtil=r,this.charWidths=[],this.EOL="\u00ac",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="\u00b6",this.RLE="\u202b",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=s.test(e.getValue())};(function(){this.isBidiRow=function(e,t,n){return this.seenBidi?(e!==this.currentRow&&(this.currentRow=e,this.updateRowLine(t,n),this.updateBidiMap()),this.bidiMap.bidiLevels):!1},this.onChange=function(e){this.seenBidi?this.currentRow=null:e.action=="insert"&&s.test(e.lines.join("\n"))&&(this.seenBidi=!0,this.currentRow=null)},this.getDocumentRow=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var n=this.session.$getRowCacheIndex(t,this.currentRow);n>=0&&(e=this.session.$docRowCache[n])}return e},this.getSplitIndex=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var n,r=this.session.$getRowCacheIndex(t,this.currentRow);while(this.currentRow-e>0){n=this.session.$getRowCacheIndex(t,this.currentRow-e-1);if(n!==r)break;r=n,e++}}else e=this.currentRow;return e},this.updateRowLine=function(e,t){e===undefined&&(e=this.getDocumentRow());var n=e===this.session.getLength()-1,s=n?this.EOF:this.EOL;this.wrapIndent=0,this.line=this.session.getLine(e),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE;if(this.session.$useWrapMode){var o=this.session.$wrapData[e];o&&(t===undefined&&(t=this.getSplitIndex()),t>0&&o.length?(this.wrapIndent=o.indent,this.wrapOffset=this.wrapIndent*this.charWidths[r.L],this.line=t<o.length?this.line.substring(o[t-1],o[t]):this.line.substring(o[o.length-1])):this.line=this.line.substring(0,o[t])),t==o.length&&(this.line+=this.showInvisibles?s:r.DOT)}else this.line+=this.showInvisibles?s:r.DOT;var u=this.session,a=0,f;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(e,t){return e==="	"||u.isFullWidth(e.charCodeAt(0))?(f=e==="	"?u.getScreenTabSize(t+a):2,a+=f-1,i.stringRepeat(r.DOT,f)):e}),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==r.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},this.updateBidiMap=function(){var e=[];r.hasBidiCharacters(this.line,e)||this.isRtlDir?this.bidiMap=r.doBidiReorder(this.line,e,this.isRtlDir):this.bidiMap={}},this.markAsDirty=function(){this.currentRow=null},this.updateCharacterWidths=function(e){if(this.characterWidth===e.$characterSize.width)return;this.fontMetrics=e;var t=this.characterWidth=e.$characterSize.width,n=e.$measureCharWidth("\u05d4");this.charWidths[r.L]=this.charWidths[r.EN]=this.charWidths[r.ON_R]=t,this.charWidths[r.R]=this.charWidths[r.AN]=n,this.charWidths[r.R_H]=n*.45,this.charWidths[r.B]=this.charWidths[r.RLE]=0,this.currentRow=null},this.setShowInvisibles=function(e){this.showInvisibles=e,this.currentRow=null},this.setEolChar=function(e){this.EOL=e},this.setContentWidth=function(e){this.contentWidth=e},this.isRtlLine=function(e){return this.$isRtl?!0:e!=undefined?this.session.getLine(e).charAt(0)==this.RLE:this.isRtlDir},this.setRtlDirection=function(e,t){var n=e.getCursorPosition();for(var r=e.selection.getSelectionAnchor().row;r<=n.row;r++)!t&&e.session.getLine(r).charAt(0)===e.session.$bidiHandler.RLE?e.session.doc.removeInLine(r,0,1):t&&e.session.getLine(r).charAt(0)!==e.session.$bidiHandler.RLE&&e.session.doc.insert({column:0,row:r},e.session.$bidiHandler.RLE)},this.getPosLeft=function(e){e-=this.wrapIndent;var t=this.line.charAt(0)===this.RLE?1:0,n=e>t?this.session.getOverwrite()?e:e-1:t,i=r.getVisualFromLogicalIdx(n,this.bidiMap),s=this.bidiMap.bidiLevels,o=0;!this.session.getOverwrite()&&e<=t&&s[i]%2!==0&&i++;for(var u=0;u<i;u++)o+=this.charWidths[s[u]];return!this.session.getOverwrite()&&e>t&&s[i]%2===0&&(o+=this.charWidths[s[i]]),this.wrapIndent&&(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(o+=this.rtlLineOffset),o},this.getSelections=function(e,t){var n=this.bidiMap,r=n.bidiLevels,i,s=[],o=0,u=Math.min(e,t)-this.wrapIndent,a=Math.max(e,t)-this.wrapIndent,f=!1,l=!1,c=0;this.wrapIndent&&(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var h,p=0;p<r.length;p++)h=n.logicalFromVisual[p],i=r[p],f=h>=u&&h<a,f&&!l?c=o:!f&&l&&s.push({left:c,width:o-c}),o+=this.charWidths[i],l=f;f&&p===r.length&&s.push({left:c,width:o-c});if(this.isRtlDir)for(var d=0;d<s.length;d++)s[d].left+=this.rtlLineOffset;return s},this.offsetToCol=function(e){this.isRtlDir&&(e-=this.rtlLineOffset);var t=0,e=Math.max(e,0),n=0,r=0,i=this.bidiMap.bidiLevels,s=this.charWidths[i[r]];this.wrapIndent&&(e-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);while(e>n+s/2){n+=s;if(r===i.length-1){s=0;break}s=this.charWidths[i[++r]]}return r>0&&i[r-1]%2!==0&&i[r]%2===0?(e<n&&r--,t=this.bidiMap.logicalFromVisual[r]):r>0&&i[r-1]%2===0&&i[r]%2!==0?t=1+(e>n?this.bidiMap.logicalFromVisual[r]:this.bidiMap.logicalFromVisual[r-1]):this.isRtlDir&&r===i.length-1&&s===0&&i[r-1]%2===0||!this.isRtlDir&&r===0&&i[r]%2!==0?t=1+this.bidiMap.logicalFromVisual[r]:(r>0&&i[r-1]%2!==0&&s!==0&&r--,t=this.bidiMap.logicalFromVisual[r]),t===0&&this.isRtlDir&&t++,t+this.wrapIndent}}).call(o.prototype),t.BidiHandler=o}),ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/lang"),s=e("./lib/event_emitter").EventEmitter,o=e("./range").Range,u=function(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var t=this;this.cursor.on("change",function(e){t.$cursorChanged=!0,t.$silent||t._emit("changeCursor"),!t.$isEmpty&&!t.$silent&&t._emit("changeSelection"),!t.$keepDesiredColumnOnChange&&e.old.column!=e.value.column&&(t.$desiredColumn=null)}),this.anchor.on("change",function(){t.$anchorChanged=!0,!t.$isEmpty&&!t.$silent&&t._emit("changeSelection")})};(function(){r.implement(this,s),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.$isEmpty=!1,this.anchor.setPosition(e,t)},this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.$isEmpty?o.fromPoints(t,t):this.isBackwards()?o.fromPoints(t,e):o.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},this.setRange=this.setSelectionRange=function(e,t){var n=t?e.end:e.start,r=t?e.start:e.end;this.$setSelection(n.row,n.column,r.row,r.column)},this.$setSelection=function(e,t,n,r){if(this.$silent)return;var i=this.$isEmpty,s=this.inMultiSelectMode;this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(e,t),this.cursor.setPosition(n,r),this.$isEmpty=!o.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),(this.$cursorChanged||this.$anchorChanged||i!=this.$isEmpty||s)&&this._emit("changeSelection")},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&&this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCursorTo(e,t)})},this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCursorToPosition(e)})},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){if(typeof t=="undefined"){var n=e||this.lead;e=n.row,t=n.column}return this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),t=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(t)},this.getLineRange=function(e,t){var n=typeof e=="number"?e:this.lead.row,r,i=this.session.getFoldLine(n);return i?(n=i.start.row,r=i.end.row):r=n,t===!0?new o(n,0,r,this.session.getLine(r).length):new o(n,0,r+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.wouldMoveIntoSoftTab=function(e,t,n){var r=e.column,i=e.column+t;return n<0&&(r=e.column-t,i=e.column),this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(r,i).split(" ").length-1==t},this.moveCursorLeft=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,-1))this.moveCursorTo(t.start.row,t.start.column);else if(e.column===0)e.row>0&&this.moveCursorTo(e.row-1,this.doc.getLine(e.row-1).length);else{var n=this.session.getTabSize();this.wouldMoveIntoSoftTab(e,n,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-n):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,1))this.moveCursorTo(t.end.row,t.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var n=this.session.getTabSize(),e=this.lead;this.wouldMoveIntoSoftTab(e,n,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,n):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,n=this.session.documentToScreenRow(e,t),r=this.session.screenToDocumentPosition(n,0),i=this.session.getDisplayLine(e,null,r.row,r.column),s=i.match(/^\s*/);s[0].length!=t&&!this.session.$useEmacsStyleLineStart&&(r.column+=s[0].length),this.moveCursorToPosition(r)},this.moveCursorLineEnd=function(){var e=this.lead,t=this.session.getDocumentLastRowColumnPosition(e.row,e.column);if(this.lead.column==t.column){var n=this.session.getLine(t.row);if(t.column==n.length){var r=n.search(/\s+$/);r>0&&(t.column=r)}}this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var i=this.session.getFoldAt(e,t,1);if(i){this.moveCursorTo(i.end.row,i.end.column);return}this.session.nonTokenRe.exec(r)&&(t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,r=n.substring(t));if(t>=n.length){this.moveCursorTo(e,n.length),this.moveCursorRight(),e<this.doc.getLength()-1&&this.moveCursorWordRight();return}this.session.tokenRe.exec(r)&&(t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)},this.moveCursorLongWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1)){this.moveCursorTo(n.start.row,n.start.column);return}var r=this.session.getFoldStringAt(e,t,-1);r==null&&(r=this.doc.getLine(e).substring(0,t));var s=i.stringReverse(r);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(s)&&(t-=this.session.nonTokenRe.lastIndex,s=s.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0);if(t<=0){this.moveCursorTo(e,0),this.moveCursorLeft(),e>0&&this.moveCursorWordLeft();return}this.session.tokenRe.exec(s)&&(t-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)},this.$shortWordEndIndex=function(e){var t=0,n,r=/\s/,i=this.session.tokenRe;i.lastIndex=0;if(this.session.tokenRe.exec(e))t=this.session.tokenRe.lastIndex;else{while((n=e[t])&&r.test(n))t++;if(t<1){i.lastIndex=0;while((n=e[t])&&!i.test(n)){i.lastIndex=0,t++;if(r.test(n)){if(t>2){t--;break}while((n=e[t])&&r.test(n))t++;if(t>2)break}}}}return i.lastIndex=0,t},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t),i=this.session.getFoldAt(e,t,1);if(i)return this.moveCursorTo(i.end.row,i.end.column);if(t==n.length){var s=this.doc.getLength();do e++,r=this.doc.getLine(e);while(e<s&&/^\s*$/.test(r));/^\s+/.test(r)||(r=""),t=0}var o=this.$shortWordEndIndex(r);this.moveCursorTo(e,t+o)},this.moveCursorShortWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1))return this.moveCursorTo(n.start.row,n.start.column);var r=this.session.getLine(e).substring(0,t);if(t===0){do e--,r=this.doc.getLine(e);while(e>0&&/^\s*$/.test(r));t=r.length,/\s+$/.test(r)||(r="")}var s=i.stringReverse(r),o=this.$shortWordEndIndex(s);return this.moveCursorTo(e,t-o)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var n=this.session.documentToScreenPosition(this.lead.row,this.lead.column),r;t===0&&(e!==0&&(this.session.$bidiHandler.isBidiRow(n.row,this.lead.row)?(r=this.session.$bidiHandler.getPosLeft(n.column),n.column=Math.round(r/this.session.$bidiHandler.charWidths[0])):r=n.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?n.column=this.$desiredColumn:this.$desiredColumn=n.column);if(e!=0&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]){var i=this.session.lineWidgets[this.lead.row];e<0?e-=i.rowsAbove||0:e>0&&(e+=i.rowCount-(i.rowsAbove||0))}var s=this.session.screenToDocumentPosition(n.row+e,n.column,r);e!==0&&t===0&&s.row===this.lead.row&&s.column===this.lead.column,this.moveCursorTo(s.row,s.column+t,t===0)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,n){var r=this.session.getFoldAt(e,t,1);r&&(e=r.start.row,t=r.start.column),this.$keepDesiredColumnOnChange=!0;var i=this.session.getLine(e);/[\uDC00-\uDFFF]/.test(i.charAt(t))&&i.charAt(t-1)&&(this.lead.row==e&&this.lead.column==t+1?t-=1:t+=1),this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,n||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,n){var r=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(r.row,r.column,n)},this.detach=function(){this.lead.detach(),this.anchor.detach()},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.getRangeOfMovements=function(e){var t=this.getCursor();try{e(this);var n=this.getCursor();return o.fromPoints(t,n)}catch(r){return o.fromPoints(t,t)}finally{this.moveCursorToPosition(t)}},this.toJSON=function(){if(this.rangeCount)var e=this.ranges.map(function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t});else{var e=this.getRange();e.isBackwards=this.isBackwards()}return e},this.fromJSON=function(e){if(e.start==undefined){if(this.rangeList&&e.length>1){this.toSingleRange(e[0]);for(var t=e.length;t--;){var n=o.fromPoints(e[t].start,e[t].end);e[t].isBackwards&&(n.cursor=n.start),this.addRange(n,!0)}return}e=e[0]}this.rangeList&&this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&&e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(u.prototype),t.Selection=u}),ace.define("ace/tokenizer",["require","exports","module","ace/config"],function(e,t,n){"use strict";var r=e("./config"),i=2e3,s=function(e){this.states=e,this.regExps={},this.matchMappings={};for(var t in this.states){var n=this.states[t],r=[],i=0,s=this.matchMappings[t]={defaultToken:"text"},o="g",u=[];for(var a=0;a<n.length;a++){var f=n[a];f.defaultToken&&(s.defaultToken=f.defaultToken),f.caseInsensitive&&o.indexOf("i")===-1&&(o+="i"),f.unicode&&o.indexOf("u")===-1&&(o+="u");if(f.regex==null)continue;f.regex instanceof RegExp&&(f.regex=f.regex.toString().slice(1,-1));var l=f.regex,c=(new RegExp("(?:("+l+")|(.))")).exec("a").length-2;Array.isArray(f.token)?f.token.length==1||c==1?f.token=f.token[0]:c-1!=f.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:f,groupCount:c-1}),f.token=f.token[0]):(f.tokenArray=f.token,f.token=null,f.onMatch=this.$arrayTokens):typeof f.token=="function"&&!f.onMatch&&(c>1?f.onMatch=this.$applyToken:f.onMatch=f.token),c>1&&(/\\\d/.test(f.regex)?l=f.regex.replace(/\\([0-9]+)/g,function(e,t){return"\\"+(parseInt(t,10)+i+1)}):(c=1,l=this.removeCapturingGroups(f.regex)),!f.splitRegex&&typeof f.token!="string"&&u.push(f)),s[i]=a,i+=c,r.push(l),f.onMatch||(f.onMatch=null)}r.length||(s[0]=0,r.push("$")),u.forEach(function(e){e.splitRegex=this.createSplitterRegexp(e.regex,o)},this),this.regExps[t]=new RegExp("("+r.join(")|(")+")|($)",o)}};(function(){this.$setMaxTokenCount=function(e){i=e|0},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),n=this.token.apply(this,t);if(typeof n=="string")return[{type:n,value:e}];var r=[];for(var i=0,s=n.length;i<s;i++)t[i]&&(r[r.length]={type:n[i],value:t[i]});return r},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return"text";var n=[],r=this.tokenArray;for(var i=0,s=r.length;i<s;i++)t[i+1]&&(n[n.length]={type:r[i],value:t[i+1]});return n},this.removeCapturingGroups=function(e){var t=e.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!<]|(\()/g,function(e,t){return t?"(?:":e});return t},this.createSplitterRegexp=function(e,t){if(e.indexOf("(?=")!=-1){var n=0,r=!1,i={};e.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(e,t,s,o,u,a){return r?r=u!="]":u?r=!0:o?(n==i.stack&&(i.end=a+1,i.stack=-1),n--):s&&(n++,s.length!=1&&(i.stack=n,i.start=a)),e}),i.end!=null&&/^\)*$/.test(e.substr(i.end))&&(e=e.substring(0,i.start)+e.substr(i.end))}return e.charAt(0)!="^"&&(e="^"+e),e.charAt(e.length-1)!="$"&&(e+="$"),new RegExp(e,(t||"").replace("g",""))},this.getLineTokens=function(e,t){if(t&&typeof t!="string"){var n=t.slice(0);t=n[0],t==="#tmp"&&(n.shift(),t=n.shift())}else var n=[];var r=t||"start",s=this.states[r];s||(r="start",s=this.states[r]);var o=this.matchMappings[r],u=this.regExps[r];u.lastIndex=0;var a,f=[],l=0,c=0,h={type:null,value:""};while(a=u.exec(e)){var p=o.defaultToken,d=null,v=a[0],m=u.lastIndex;if(m-v.length>l){var g=e.substring(l,m-v.length);h.type==p?h.value+=g:(h.type&&f.push(h),h={type:p,value:g})}for(var y=0;y<a.length-2;y++){if(a[y+1]===undefined)continue;d=s[o[y]],d.onMatch?p=d.onMatch(v,r,n,e):p=d.token,d.next&&(typeof d.next=="string"?r=d.next:r=d.next(r,n),s=this.states[r],s||(this.reportError("state doesn't exist",r),r="start",s=this.states[r]),o=this.matchMappings[r],l=m,u=this.regExps[r],u.lastIndex=m),d.consumeLineEnd&&(l=m);break}if(v)if(typeof p=="string")!!d&&d.merge===!1||h.type!==p?(h.type&&f.push(h),h={type:p,value:v}):h.value+=v;else if(p){h.type&&f.push(h),h={type:null,value:""};for(var y=0;y<p.length;y++)f.push(p[y])}if(l==e.length)break;l=m;if(c++>i){c>2*e.length&&this.reportError("infinite loop with in ace tokenizer",{startState:t,line:e});while(l<e.length)h.type&&f.push(h),h={value:e.substring(l,l+=500),type:"overflow"};r="start",n=[];break}}return h.type&&f.push(h),n.length>1&&n[0]!==r&&n.unshift("#tmp",r),{tokens:f,state:n.length?n:r}},this.reportError=r.reportError}).call(s.prototype),t.Tokenizer=s}),ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],function(e,t,n){"use strict";var r=e("../lib/lang"),i=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(e,t){if(!t){for(var n in e)this.$rules[n]=e[n];return}for(var n in e){var r=e[n];for(var i=0;i<r.length;i++){var s=r[i];if(s.next||s.onMatch)typeof s.next=="string"&&s.next.indexOf(t)!==0&&(s.next=t+s.next),s.nextState&&s.nextState.indexOf(t)!==0&&(s.nextState=t+s.nextState)}this.$rules[t+n]=r}},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,n,i,s){var o=typeof e=="function"?(new e).getRules():e;if(i)for(var u=0;u<i.length;u++)i[u]=t+i[u];else{i=[];for(var a in o)i.push(t+a)}this.addRules(o,t);if(n){var f=Array.prototype[s?"push":"unshift"];for(var u=0;u<i.length;u++)f.apply(this.$rules[i[u]],r.deepCopy(n))}this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};var e=function(e,t){return(e!="start"||t.length)&&t.unshift(this.nextState,e),this.nextState},t=function(e,t){return t.shift(),t.shift()||"start"};this.normalizeRules=function(){function i(s){var o=r[s];o.processed=!0;for(var u=0;u<o.length;u++){var a=o[u],f=null;Array.isArray(a)&&(f=a,a={}),!a.regex&&a.start&&(a.regex=a.start,a.next||(a.next=[]),a.next.push({defaultToken:a.token},{token:a.token+".end",regex:a.end||a.start,next:"pop"}),a.token=a.token+".start",a.push=!0);var l=a.next||a.push;if(l&&Array.isArray(l)){var c=a.stateName;c||(c=a.token,typeof c!="string"&&(c=c[0]||""),r[c]&&(c+=n++)),r[c]=l,a.next=c,i(c)}else l=="pop"&&(a.next=t);a.push&&(a.nextState=a.next||a.push,a.next=e,delete a.push);if(a.rules)for(var h in a.rules)r[h]?r[h].push&&r[h].push.apply(r[h],a.rules[h]):r[h]=a.rules[h];var p=typeof a=="string"?a:a.include;p&&(Array.isArray(p)?f=p.map(function(e){return r[e]}):f=r[p]);if(f){var d=[u,1].concat(f);a.noEscape&&(d=d.filter(function(e){return!e.next})),o.splice.apply(o,d),u--}a.keywordMap&&(a.token=this.createKeywordMapper(a.keywordMap,a.defaultToken||"text",a.caseInsensitive),delete a.defaultToken)}}var n=0,r=this.$rules;Object.keys(r).forEach(i,this)},this.createKeywordMapper=function(e,t,n,r){var i=Object.create(null);return this.$keywordList=[],Object.keys(e).forEach(function(t){var s=e[t],o=s.split(r||"|");for(var u=o.length;u--;){var a=o[u];this.$keywordList.push(a),n&&(a=a.toLowerCase()),i[a]=t}},this),e=null,n?function(e){return i[e.toLowerCase()]||t}:function(e){return i[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(i.prototype),t.TextHighlightRules=i}),ace.define("ace/mode/behaviour",["require","exports","module"],function(e,t,n){"use strict";var r=function(){this.$behaviours={}};(function(){this.add=function(e,t,n){switch(undefined){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=n},this.addBehaviours=function(e){for(var t in e)for(var n in e[t])this.add(t,n,e[t][n])},this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]},this.inherit=function(e,t){if(typeof e=="function")var n=(new e).getBehaviours(t);else var n=e.getBehaviours(t);this.addBehaviours(n)},this.getBehaviours=function(e){if(!e)return this.$behaviours;var t={};for(var n=0;n<e.length;n++)this.$behaviours[e[n]]&&(t[e[n]]=this.$behaviours[e[n]]);return t}}).call(r.prototype),t.Behaviour=r}),ace.define("ace/token_iterator",["require","exports","module","ace/range"],function(e,t,n){"use strict";var r=e("./range").Range,i=function(e,t,n){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t);var r=e.getTokenAt(t,n);this.$tokenIndex=r?r.index:-1};(function(){this.stepBackward=function(){this.$tokenIndex-=1;while(this.$tokenIndex<0){this.$row-=1;if(this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){this.$tokenIndex+=1;var e;while(this.$tokenIndex>=this.$rowTokens.length){this.$row+=1,e||(e=this.$session.getLength());if(this.$row>=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,n=e[t].start;if(n!==undefined)return n;n=0;while(t>0)t-=1,n+=e[t].value.length;return n},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},this.getCurrentTokenRange=function(){var e=this.$rowTokens[this.$tokenIndex],t=this.getCurrentTokenColumn();return new r(this.$row,t,this.$row,t+e.value.length)}}).call(i.prototype),t.TokenIterator=i}),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("../behaviour").Behaviour,s=e("../../token_iterator").TokenIterator,o=e("../../lib/lang"),u=["text","paren.rparen","rparen","paren","punctuation.operator"],a=["text","paren.rparen","rparen","paren","punctuation.operator","comment"],f,l={},c={'"':'"',"'":"'"},h=function(e){var t=-1;e.multiSelect&&(t=e.selection.index,l.rangeCount!=e.multiSelect.rangeCount&&(l={rangeCount:e.multiSelect.rangeCount}));if(l[t])return f=l[t];f=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},p=function(e,t,n,r){var i=e.end.row-e.start.row;return{text:n+t+r,selection:[0,e.start.column+1,i,e.end.column+(i?0:1)]}},d=function(e){this.add("braces","insertion",function(t,n,r,i,s){var u=r.getCursorPosition(),a=i.doc.getLine(u.row);if(s=="{"){h(r);var l=r.getSelectionRange(),c=i.doc.getTextRange(l);if(c!==""&&c!=="{"&&r.getWrapBehavioursEnabled())return p(l,c,"{","}");if(d.isSaneInsertion(r,i))return/[\]\}\)]/.test(a[u.column])||r.inMultiSelectMode||e&&e.braces?(d.recordAutoInsert(r,i,"}"),{text:"{}",selection:[1,1]}):(d.recordMaybeInsert(r,i,"{"),{text:"{",selection:[1,1]})}else if(s=="}"){h(r);var v=a.substring(u.column,u.column+1);if(v=="}"){var m=i.$findOpeningBracket("}",{column:u.column+1,row:u.row});if(m!==null&&d.isAutoInsertedClosing(u,a,s))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else{if(s=="\n"||s=="\r\n"){h(r);var g="";d.isMaybeInsertedClosing(u,a)&&(g=o.stringRepeat("}",f.maybeInsertedBrackets),d.clearMaybeInsertedClosing());var v=a.substring(u.column,u.column+1);if(v==="}"){var y=i.findMatchingBracket({row:u.row,column:u.column+1},"}");if(!y)return null;var b=this.$getIndent(i.getLine(y.row))}else{if(!g){d.clearMaybeInsertedClosing();return}var b=this.$getIndent(a)}var w=b+i.getTabString();return{text:"\n"+w+"\n"+b+g,selection:[1,w.length,1,w.length]}}d.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="{"){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.end.column,i.end.column+1);if(u=="}")return i.end.column++,i;f.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,r,i){if(i=="("){h(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==""&&n.getWrapBehavioursEnabled())return p(s,o,"(",")");if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,")"),{text:"()",selection:[1,1]}}else if(i==")"){h(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f==")"){var l=r.$findOpeningBracket(")",{column:u.column+1,row:u.row});if(l!==null&&d.isAutoInsertedClosing(u,a,i))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="("){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u==")")return i.end.column++,i}}),this.add("brackets","insertion",function(e,t,n,r,i){if(i=="["){h(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==""&&n.getWrapBehavioursEnabled())return p(s,o,"[","]");if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,"]"),{text:"[]",selection:[1,1]}}else if(i=="]"){h(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f=="]"){var l=r.$findOpeningBracket("]",{column:u.column+1,row:u.row});if(l!==null&&d.isAutoInsertedClosing(u,a,i))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&&s=="["){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u=="]")return i.end.column++,i}}),this.add("string_dquotes","insertion",function(e,t,n,r,i){var s=r.$mode.$quotes||c;if(i.length==1&&s[i]){if(this.lineCommentStart&&this.lineCommentStart.indexOf(i)!=-1)return;h(n);var o=i,u=n.getSelectionRange(),a=r.doc.getTextRange(u);if(a!==""&&(a.length!=1||!s[a])&&n.getWrapBehavioursEnabled())return p(u,a,o,o);if(!a){var f=n.getCursorPosition(),l=r.doc.getLine(f.row),d=l.substring(f.column-1,f.column),v=l.substring(f.column,f.column+1),m=r.getTokenAt(f.row,f.column),g=r.getTokenAt(f.row,f.column+1);if(d=="\\"&&m&&/escape/.test(m.type))return null;var y=m&&/string|escape/.test(m.type),b=!g||/string|escape/.test(g.type),w;if(v==o)w=y!==b,w&&/string\.end/.test(g.type)&&(w=!1);else{if(y&&!b)return null;if(y&&b)return null;var E=r.$mode.tokenRe;E.lastIndex=0;var S=E.test(d);E.lastIndex=0;var x=E.test(d);if(S||x)return null;if(v&&!/[\s;,.})\]\\]/.test(v))return null;var T=l[f.column-2];if(!(d!=o||T!=o&&!E.test(T)))return null;w=!0}return{text:w?o+o:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,r,i){var s=r.$mode.$quotes||c,o=r.doc.getTextRange(i);if(!i.isMultiLine()&&s.hasOwnProperty(o)){h(n);var u=r.doc.getLine(i.start.row),a=u.substring(i.start.column+1,i.start.column+2);if(a==o)return i.end.column++,i}})};d.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),r=new s(t,n.row,n.column);if(!this.$matchTokenType(r.getCurrentToken()||"text",u)){if(/[)}\]]/.test(e.session.getLine(n.row)[n.column]))return!0;var i=new s(t,n.row,n.column+1);if(!this.$matchTokenType(i.getCurrentToken()||"text",u))return!1}return r.stepForward(),r.getCurrentTokenRow()!==n.row||this.$matchTokenType(r.getCurrentToken()||"text",a)},d.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},d.recordAutoInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isAutoInsertedClosing(r,i,f.autoInsertedLineEnd[0])||(f.autoInsertedBrackets=0),f.autoInsertedRow=r.row,f.autoInsertedLineEnd=n+i.substr(r.column),f.autoInsertedBrackets++},d.recordMaybeInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isMaybeInsertedClosing(r,i)||(f.maybeInsertedBrackets=0),f.maybeInsertedRow=r.row,f.maybeInsertedLineStart=i.substr(0,r.column)+n,f.maybeInsertedLineEnd=i.substr(r.column),f.maybeInsertedBrackets++},d.isAutoInsertedClosing=function(e,t,n){return f.autoInsertedBrackets>0&&e.row===f.autoInsertedRow&&n===f.autoInsertedLineEnd[0]&&t.substr(e.column)===f.autoInsertedLineEnd},d.isMaybeInsertedClosing=function(e,t){return f.maybeInsertedBrackets>0&&e.row===f.maybeInsertedRow&&t.substr(e.column)===f.maybeInsertedLineEnd&&t.substr(0,e.column)==f.maybeInsertedLineStart},d.popAutoInsertedClosing=function(){f.autoInsertedLineEnd=f.autoInsertedLineEnd.substr(1),f.autoInsertedBrackets--},d.clearMaybeInsertedClosing=function(){f&&(f.maybeInsertedBrackets=0,f.maybeInsertedRow=-1)},r.inherits(d,i),t.CstyleBehaviour=d}),ace.define("ace/unicode",["require","exports","module"],function(e,t,n){"use strict";var r=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],i=0,s=[];for(var o=0;o<r.length;o+=2)s.push(i+=r[o]),r[o+1]&&s.push(45,i+=r[o+1]);t.wordChars=String.fromCharCode.apply(null,s)}),ace.define("ace/mode/text",["require","exports","module","ace/config","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(e,t,n){"use strict";var r=e("../config"),i=e("../tokenizer").Tokenizer,s=e("./text_highlight_rules").TextHighlightRules,o=e("./behaviour/cstyle").CstyleBehaviour,u=e("../unicode"),a=e("../lib/lang"),f=e("../token_iterator").TokenIterator,l=e("../range").Range,c=function(){this.HighlightRules=s};(function(){this.$defaultBehaviour=new o,this.tokenRe=new RegExp("^["+u.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+u.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new i(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,t,n,r){function w(e){for(var t=n;t<=r;t++)e(i.getLine(t),t)}var i=t.doc,s=!0,o=!0,u=Infinity,f=t.getTabSize(),l=!1;if(!this.lineCommentStart){if(!this.blockComment)return!1;var c=this.blockComment.start,h=this.blockComment.end,p=new RegExp("^(\\s*)(?:"+a.escapeRegExp(c)+")"),d=new RegExp("(?:"+a.escapeRegExp(h)+")\\s*$"),v=function(e,t){if(g(e,t))return;if(!s||/\S/.test(e))i.insertInLine({row:t,column:e.length},h),i.insertInLine({row:t,column:u},c)},m=function(e,t){var n;(n=e.match(d))&&i.removeInLine(t,e.length-n[0].length,e.length),(n=e.match(p))&&i.removeInLine(t,n[1].length,n[0].length)},g=function(e,n){if(p.test(e))return!0;var r=t.getTokens(n);for(var i=0;i<r.length;i++)if(r[i].type==="comment")return!0}}else{if(Array.isArray(this.lineCommentStart))var p=this.lineCommentStart.map(a.escapeRegExp).join("|"),c=this.lineCommentStart[0];else var p=a.escapeRegExp(this.lineCommentStart),c=this.lineCommentStart;p=new RegExp("^(\\s*)(?:"+p+") ?"),l=t.getUseSoftTabs();var m=function(e,t){var n=e.match(p);if(!n)return;var r=n[1].length,s=n[0].length;!b(e,r,s)&&n[0][s-1]==" "&&s--,i.removeInLine(t,r,s)},y=c+" ",v=function(e,t){if(!s||/\S/.test(e))b(e,u,u)?i.insertInLine({row:t,column:u},y):i.insertInLine({row:t,column:u},c)},g=function(e,t){return p.test(e)},b=function(e,t,n){var r=0;while(t--&&e.charAt(t)==" ")r++;if(r%f!=0)return!1;var r=0;while(e.charAt(n++)==" ")r++;return f>2?r%f!=f-1:r%f==0}}var E=Infinity;w(function(e,t){var n=e.search(/\S/);n!==-1?(n<u&&(u=n),o&&!g(e,t)&&(o=!1)):E>e.length&&(E=e.length)}),u==Infinity&&(u=E,s=!1,o=!1),l&&u%f!=0&&(u=Math.floor(u/f)*f),w(o?m:v)},this.toggleBlockComment=function(e,t,n,r){var i=this.blockComment;if(!i)return;!i.start&&i[0]&&(i=i[0]);var s=new f(t,r.row,r.column),o=s.getCurrentToken(),u=t.selection,a=t.selection.toOrientedRange(),c,h;if(o&&/comment/.test(o.type)){var p,d;while(o&&/comment/.test(o.type)){var v=o.value.indexOf(i.start);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;p=new l(m,g,m,g+i.start.length);break}o=s.stepBackward()}var s=new f(t,r.row,r.column),o=s.getCurrentToken();while(o&&/comment/.test(o.type)){var v=o.value.indexOf(i.end);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;d=new l(m,g,m,g+i.end.length);break}o=s.stepForward()}d&&t.remove(d),p&&(t.remove(p),c=p.start.row,h=-i.start.length)}else h=i.start.length,c=n.start.row,t.insert(n.end,i.end),t.insert(n.start,i.start);a.start.row==c&&(a.start.column+=h),a.end.row==c&&(a.end.column+=h),t.selection.fromOrientedRange(a)},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.autoOutdent=function(e,t,n){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){this.$embeds=[],this.$modes={};for(var t in e)if(e[t]){var n=e[t],i=n.prototype.$id,s=r.$modes[i];s||(r.$modes[i]=s=new n),r.$modes[t]||(r.$modes[t]=s),this.$embeds.push(t),this.$modes[t]=s}var o=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"];for(var t=0;t<o.length;t++)(function(e){var n=o[t],r=e[n];e[o[t]]=function(){return this.$delegator(n,arguments,r)}})(this)},this.$delegator=function(e,t,n){var r=t[0]||"start";if(typeof r!="string"){if(Array.isArray(r[2])){var i=r[2][r[2].length-1],s=this.$modes[i];if(s)return s[e].apply(s,[r[1]].concat([].slice.call(t,1)))}r=r[0]||"start"}for(var o=0;o<this.$embeds.length;o++){if(!this.$modes[this.$embeds[o]])continue;var u=r.split(this.$embeds[o]);if(!u[0]&&u[1]){t[0]=u[1];var s=this.$modes[this.$embeds[o]];return s[e].apply(s,t)}}var a=n.apply(this,t);return n?a:undefined},this.transformAction=function(e,t,n,r,i){if(this.$behaviour){var s=this.$behaviour.getBehaviours();for(var o in s)if(s[o][t]){var u=s[o][t].apply(this,arguments);if(u)return u}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,n=[];for(var r in t){var i=t[r];for(var s=0,o=i.length;s<o;s++)if(typeof i[s].token=="string")/keyword|support|storage/.test(i[s].token)&&n.push(i[s].regex);else if(typeof i[s].token=="object")for(var u=0,a=i[s].token.length;u<a;u++)if(/keyword|support|storage/.test(i[s].token[u])){var r=i[s].regex.match(/\(.+?\)/g)[u];n.push(r.substr(1,r.length-2))}}this.completionKeywords=n}return e?n.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,n,r){var i=this.$keywordList||this.$createKeywordList();return i.map(function(e){return{name:e,value:e,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(c.prototype),t.Mode=c}),ace.define("ace/apply_delta",["require","exports","module"],function(e,t,n){"use strict";function r(e,t){throw console.log("Invalid Delta:",e),"Invalid Delta: "+t}function i(e,t){return t.row>=0&&t.row<e.length&&t.column>=0&&t.column<=e[t.row].length}function s(e,t){t.action!="insert"&&t.action!="remove"&&r(t,"delta.action must be 'insert' or 'remove'"),t.lines instanceof Array||r(t,"delta.lines must be an Array"),(!t.start||!t.end)&&r(t,"delta.start/end must be an present");var n=t.start;i(e,t.start)||r(t,"delta.start must be contained in document");var s=t.end;t.action=="remove"&&!i(e,s)&&r(t,"delta.end must contained in document for 'remove' actions");var o=s.row-n.row,u=s.column-(o==0?n.column:0);(o!=t.lines.length-1||t.lines[o].length!=u)&&r(t,"delta.range must match delta lines")}t.applyDelta=function(e,t,n){var r=t.start.row,i=t.start.column,s=e[r]||"";switch(t.action){case"insert":var o=t.lines;if(o.length===1)e[r]=s.substring(0,i)+t.lines[0]+s.substring(i);else{var u=[r,1].concat(t.lines);e.splice.apply(e,u),e[r]=s.substring(0,i)+e[r],e[r+t.lines.length-1]+=s.substring(i)}break;case"remove":var a=t.end.column,f=t.end.row;r===f?e[r]=s.substring(0,i)+s.substring(a):e.splice(r,f-r+1,s.substring(0,i)+e[f].substring(a))}}}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/event_emitter").EventEmitter,s=t.Anchor=function(e,t,n){this.$onChange=this.onChange.bind(this),this.attach(e),typeof n=="undefined"?this.setPosition(t.row,t.column):this.setPosition(t,n)};(function(){function e(e,t,n){var r=n?e.column<=t.column:e.column<t.column;return e.row<t.row||e.row==t.row&&r}function t(t,n,r){var i=t.action=="insert",s=(i?1:-1)*(t.end.row-t.start.row),o=(i?1:-1)*(t.end.column-t.start.column),u=t.start,a=i?u:t.end;return e(n,u,r)?{row:n.row,column:n.column}:e(a,n,!r)?{row:n.row+s,column:n.column+(n.row==a.row?o:0)}:{row:u.row,column:u.column}}r.implement(this,i),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(e){if(e.start.row==e.end.row&&e.start.row!=this.row)return;if(e.start.row>this.row)return;var n=t(e,{row:this.row,column:this.column},this.$insertRight);this.setPosition(n.row,n.column,!0)},this.setPosition=function(e,t,n){var r;n?r={row:e,column:t}:r=this.$clipPositionToDocument(e,t);if(this.row==r.row&&this.column==r.column)return;var i={row:this.row,column:this.column};this.row=r.row,this.column=r.column,this._signal("change",{old:i,value:r})},this.detach=function(){this.document.off("change",this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(e,t){var n={};return e>=this.document.getLength()?(n.row=Math.max(0,this.document.getLength()-1),n.column=this.document.getLine(n.row).length):e<0?(n.row=0,n.column=0):(n.row=e,n.column=Math.min(this.document.getLine(n.row).length,Math.max(0,t))),t<0&&(n.column=0),n}}).call(s.prototype)}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./apply_delta").applyDelta,s=e("./lib/event_emitter").EventEmitter,o=e("./range").Range,u=e("./anchor").Anchor,a=function(e){this.$lines=[""],e.length===0?this.$lines=[""]:Array.isArray(e)?this.insertMergedLines({row:0,column:0},e):this.insert({row:0,column:0},e)};(function(){r.implement(this,s),this.setValue=function(e){var t=this.getLength()-1;this.remove(new o(0,0,t,this.getLine(t).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new u(this,e,t)},"aaa".split(/a/).length===0?this.$split=function(e){return e.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(e){return e.split(/\r\n|\r|\n/)},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=t?t[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(e){if(this.$newLineMode===e)return;this.$newLineMode=e,this._signal("changeNewLineMode")},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return e=="\r\n"||e=="\r"||e=="\n"},this.getLine=function(e){return this.$lines[e]||""},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){return this.getLinesForRange(e).join(this.getNewLineCharacter())},this.getLinesForRange=function(e){var t;if(e.start.row===e.end.row)t=[this.getLine(e.start.row).substring(e.start.column,e.end.column)];else{t=this.getLines(e.start.row,e.end.row),t[0]=(t[0]||"").substring(e.start.column);var n=t.length-1;e.end.row-e.start.row==n&&(t[n]=t[n].substring(0,e.end.column))}return t},this.insertLines=function(e,t){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(e,t)},this.removeLines=function(e,t){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(e,t)},this.insertNewLine=function(e){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(e,["",""])},this.insert=function(e,t){return this.getLength()<=1&&this.$detectNewLine(t),this.insertMergedLines(e,this.$split(t))},this.insertInLine=function(e,t){var n=this.clippedPos(e.row,e.column),r=this.pos(e.row,e.column+t.length);return this.applyDelta({start:n,end:r,action:"insert",lines:[t]},!0),this.clonePos(r)},this.clippedPos=function(e,t){var n=this.getLength();e===undefined?e=n:e<0?e=0:e>=n&&(e=n-1,t=undefined);var r=this.getLine(e);return t==undefined&&(t=r.length),t=Math.min(Math.max(t,0),r.length),{row:e,column:t}},this.clonePos=function(e){return{row:e.row,column:e.column}},this.pos=function(e,t){return{row:e,column:t}},this.$clipPosition=function(e){var t=this.getLength();return e.row>=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):(e.row=Math.max(0,e.row),e.column=Math.min(Math.max(e.column,0),this.getLine(e.row).length)),e},this.insertFullLines=function(e,t){e=Math.min(Math.max(e,0),this.getLength());var n=0;e<this.getLength()?(t=t.concat([""]),n=0):(t=[""].concat(t),e--,n=this.$lines[e].length),this.insertMergedLines({row:e,column:n},t)},this.insertMergedLines=function(e,t){var n=this.clippedPos(e.row,e.column),r={row:n.row+t.length-1,column:(t.length==1?n.column:0)+t[t.length-1].length};return this.applyDelta({start:n,end:r,action:"insert",lines:t}),this.clonePos(r)},this.remove=function(e){var t=this.clippedPos(e.start.row,e.start.column),n=this.clippedPos(e.end.row,e.end.column);return this.applyDelta({start:t,end:n,action:"remove",lines:this.getLinesForRange({start:t,end:n})}),this.clonePos(t)},this.removeInLine=function(e,t,n){var r=this.clippedPos(e,t),i=this.clippedPos(e,n);return this.applyDelta({start:r,end:i,action:"remove",lines:this.getLinesForRange({start:r,end:i})},!0),this.clonePos(r)},this.removeFullLines=function(e,t){e=Math.min(Math.max(0,e),this.getLength()-1),t=Math.min(Math.max(0,t),this.getLength()-1);var n=t==this.getLength()-1&&e>0,r=t<this.getLength()-1,i=n?e-1:e,s=n?this.getLine(i).length:0,u=r?t+1:t,a=r?0:this.getLine(u).length,f=new o(i,s,u,a),l=this.$lines.slice(e,t+1);return this.applyDelta({start:f.start,end:f.end,action:"remove",lines:this.getLinesForRange(f)}),l},this.removeNewLine=function(e){e<this.getLength()-1&&e>=0&&this.applyDelta({start:this.pos(e,this.getLine(e).length),end:this.pos(e+1,0),action:"remove",lines:["",""]})},this.replace=function(e,t){e instanceof o||(e=o.fromPoints(e.start,e.end));if(t.length===0&&e.isEmpty())return e.start;if(t==this.getTextRange(e))return e.end;this.remove(e);var n;return t?n=this.insert(e.start,t):n=e.start,n},this.applyDeltas=function(e){for(var t=0;t<e.length;t++)this.applyDelta(e[t])},this.revertDeltas=function(e){for(var t=e.length-1;t>=0;t--)this.revertDelta(e[t])},this.applyDelta=function(e,t){var n=e.action=="insert";if(n?e.lines.length<=1&&!e.lines[0]:!o.comparePoints(e.start,e.end))return;n&&e.lines.length>2e4?this.$splitAndapplyLargeDelta(e,2e4):(i(this.$lines,e,t),this._signal("change",e))},this.$safeApplyDelta=function(e){var t=this.$lines.length;(e.action=="remove"&&e.start.row<t&&e.end.row<t||e.action=="insert"&&e.start.row<=t)&&this.applyDelta(e)},this.$splitAndapplyLargeDelta=function(e,t){var n=e.lines,r=n.length-t+1,i=e.start.row,s=e.start.column;for(var o=0,u=0;o<r;o=u){u+=t-1;var a=n.slice(o,u);a.push(""),this.applyDelta({start:this.pos(i+o,s),end:this.pos(i+u,s=0),action:e.action,lines:a},!0)}e.lines=n.slice(o),e.start.row=i+o,e.start.column=s,this.applyDelta(e,!0)},this.revertDelta=function(e){this.$safeApplyDelta({start:this.clonePos(e.start),end:this.clonePos(e.end),action:e.action=="insert"?"remove":"insert",lines:e.lines.slice()})},this.indexToPosition=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length;for(var i=t||0,s=n.length;i<s;i++){e-=n[i].length+r;if(e<0)return{row:i,column:e+n[i].length+r}}return{row:s-1,column:e+n[s-1].length+r}},this.positionToIndex=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length,i=0,s=Math.min(e.row,n.length);for(var o=t||0;o<s;++o)i+=n[o].length+r;return i+e.column}}).call(a.prototype),t.Document=a}),ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/event_emitter").EventEmitter,s=function(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var n=this;this.$worker=function(){if(!n.running)return;var e=new Date,t=n.currentLine,r=-1,i=n.doc,s=t;while(n.lines[t])t++;var o=i.getLength(),u=0;n.running=!1;while(t<o){n.$tokenizeRow(t),r=t;do t++;while(n.lines[t]);u++;if(u%5===0&&new Date-e>20){n.running=setTimeout(n.$worker,20);break}}n.currentLine=t,r==-1&&(r=t),s<=r&&n.fireUpdateEvent(s,r)}};(function(){r.implement(this,i),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){var n={first:e,last:t};this._signal("update",{data:n})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.start.row,n=e.end.row-t;if(n===0)this.lines[t]=null;else if(e.action=="remove")this.lines.splice(t,n+1,null),this.states.splice(t,n+1,null);else{var r=Array(n+1);r.unshift(t,1),this.lines.splice.apply(this.lines,r),this.states.splice.apply(this.states,r)}this.currentLine=Math.min(t,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&&this.$tokenizeRow(e),this.states[e]||"start"},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),n=this.states[e-1],r=this.tokenizer.getLineTokens(t,n,e);return this.states[e]+""!=r.state+""?(this.states[e]=r.state,this.lines[e+1]=null,this.currentLine>e+1&&(this.currentLine=e+1)):this.currentLine==e&&(this.currentLine=e+1),this.lines[e]=r.tokens}}).call(s.prototype),t.BackgroundTokenizer=s}),ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,n){"use strict";var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./range").Range,o=function(e,t,n){this.setRegexp(e),this.clazz=t,this.type=n||"text"};(function(){this.MAX_RANGES=500,this.setRegexp=function(e){if(this.regExp+""==e+"")return;this.regExp=e,this.cache=[]},this.update=function(e,t,n,i){if(!this.regExp)return;var o=i.firstRow,u=i.lastRow;for(var a=o;a<=u;a++){var f=this.cache[a];f==null&&(f=r.getMatchOffsets(n.getLine(a),this.regExp),f.length>this.MAX_RANGES&&(f=f.slice(0,this.MAX_RANGES)),f=f.map(function(e){return new s(a,e.offset,a,e.offset+e.length)}),this.cache[a]=f.length?f:"");for(var l=f.length;l--;)t.drawSingleLineMarker(e,f[l].toScreenRange(n),this.clazz,i)}}}).call(o.prototype),t.SearchHighlight=o}),ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(e,t,n){"use strict";function i(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];var n=t[t.length-1];this.range=new r(t[0].start.row,t[0].start.column,n.end.row,n.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(e){e.setFoldLine(this)},this)}var r=e("../range").Range;(function(){this.shiftRow=function(e){this.start.row+=e,this.end.row+=e,this.folds.forEach(function(t){t.start.row+=e,t.end.row+=e})},this.addFold=function(e){if(e.sameRow){if(e.start.row<this.startRow||e.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(e),this.folds.sort(function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)}),this.range.compareEnd(e.start.row,e.start.column)>0?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)<0&&(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e>=this.start.row&&e<=this.end.row},this.walk=function(e,t,n){var r=0,i=this.folds,s,o,u,a=!0;t==null&&(t=this.end.row,n=this.end.column);for(var f=0;f<i.length;f++){s=i[f],o=s.range.compareStart(t,n);if(o==-1){e(null,t,n,r,a);return}u=e(null,s.start.row,s.start.column,r,a),u=!u&&e(s.placeholder,s.start.row,s.start.column,r);if(u||o===0)return;a=!s.sameRow,r=s.end.column}e(null,t,n,r,a)},this.getNextFoldTo=function(e,t){var n,r;for(var i=0;i<this.folds.length;i++){n=this.folds[i],r=n.range.compareEnd(e,t);if(r==-1)return{fold:n,kind:"after"};if(r===0)return{fold:n,kind:"inside"}}return null},this.addRemoveChars=function(e,t,n){var r=this.getNextFoldTo(e,t),i,s;if(r){i=r.fold;if(r.kind=="inside"&&i.start.column!=t&&i.start.row!=e)window.console&&window.console.log(e,t,i);else if(i.start.row==e){s=this.folds;var o=s.indexOf(i);o===0&&(this.start.column+=n);for(o;o<s.length;o++){i=s[o],i.start.column+=n;if(!i.sameRow)return;i.end.column+=n}this.end.column+=n}}},this.split=function(e,t){var n=this.getNextFoldTo(e,t);if(!n||n.kind=="inside")return null;var r=n.fold,s=this.folds,o=this.foldData,u=s.indexOf(r),a=s[u-1];this.end.row=a.end.row,this.end.column=a.end.column,s=s.splice(u,s.length-u);var f=new i(o,s);return o.splice(o.indexOf(this)+1,0,f),f},this.merge=function(e){var t=e.folds;for(var n=0;n<t.length;n++)this.addFold(t[n]);var r=this.foldData;r.splice(r.indexOf(e),1)},this.toString=function(){var e=[this.range.toString()+": ["];return this.folds.forEach(function(t){e.push("  "+t.toString())}),e.push("]"),e.join("\n")},this.idxToPosition=function(e){var t=0;for(var n=0;n<this.folds.length;n++){var r=this.folds[n];e-=r.start.column-t;if(e<0)return{row:r.start.row,column:r.start.column+e};e-=r.placeholder.length;if(e<0)return r.start;t=r.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(i.prototype),t.FoldLine=i}),ace.define("ace/range_list",["require","exports","module","ace/range"],function(e,t,n){"use strict";var r=e("./range").Range,i=r.comparePoints,s=function(){this.ranges=[],this.$bias=1};(function(){this.comparePoints=i,this.pointIndex=function(e,t,n){var r=this.ranges;for(var s=n||0;s<r.length;s++){var o=r[s],u=i(e,o.end);if(u>0)continue;var a=i(e,o.start);return u===0?t&&a!==0?-s-2:s:a>0||a===0&&!t?s:-s-1}return-s-1},this.add=function(e){var t=!e.isEmpty(),n=this.pointIndex(e.start,t);n<0&&(n=-n-1);var r=this.pointIndex(e.end,t,n);return r<0?r=-r-1:r++,this.ranges.splice(n,r-n,e)},this.addList=function(e){var t=[];for(var n=e.length;n--;)t.push.apply(t,this.add(e[n]));return t},this.substractPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges.splice(t,1)},this.merge=function(){var e=[],t=this.ranges;t=t.sort(function(e,t){return i(e.start,t.start)});var n=t[0],r;for(var s=1;s<t.length;s++){r=n,n=t[s];var o=i(r.end,n.start);if(o<0)continue;if(o==0&&!r.isEmpty()&&!n.isEmpty())continue;i(r.end,n.end)<0&&(r.end.row=n.end.row,r.end.column=n.end.column),t.splice(s,1),e.push(n),n=r,s--}return this.ranges=t,e},this.contains=function(e,t){return this.pointIndex({row:e,column:t})>=0},this.containsPoint=function(e){return this.pointIndex(e)>=0},this.rangeAtPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges[t]},this.clipRows=function(e,t){var n=this.ranges;if(n[0].start.row>t||n[n.length-1].start.row<e)return[];var r=this.pointIndex({row:e,column:0});r<0&&(r=-r-1);var i=this.pointIndex({row:t,column:0},r);i<0&&(i=-i-1);var s=[];for(var o=r;o<i;o++)s.push(n[o]);return s},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&&this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){if(!this.session)return;this.session.removeListener("change",this.onChange),this.session=null},this.$onChange=function(e){var t=e.start,n=e.end,r=t.row,i=n.row,s=this.ranges;for(var o=0,u=s.length;o<u;o++){var a=s[o];if(a.end.row>=r)break}if(e.action=="insert"){var f=i-r,l=-t.column+n.column;for(;o<u;o++){var a=s[o];if(a.start.row>r)break;a.start.row==r&&a.start.column>=t.column&&(a.start.column==t.column&&this.$bias<=0||(a.start.column+=l,a.start.row+=f));if(a.end.row==r&&a.end.column>=t.column){if(a.end.column==t.column&&this.$bias<0)continue;a.end.column==t.column&&l>0&&o<u-1&&a.end.column>a.start.column&&a.end.column==s[o+1].start.column&&(a.end.column-=l),a.end.column+=l,a.end.row+=f}}}else{var f=r-i,l=t.column-n.column;for(;o<u;o++){var a=s[o];if(a.start.row>i)break;if(a.end.row<i&&(r<a.end.row||r==a.end.row&&t.column<a.end.column))a.end.row=r,a.end.column=t.column;else if(a.end.row==i)if(a.end.column<=n.column){if(f||a.end.column>t.column)a.end.column=t.column,a.end.row=t.row}else a.end.column+=l,a.end.row+=f;else a.end.row>i&&(a.end.row+=f);if(a.start.row<i&&(r<a.start.row||r==a.start.row&&t.column<a.start.column))a.start.row=r,a.start.column=t.column;else if(a.start.row==i)if(a.start.column<=n.column){if(f||a.start.column>t.column)a.start.column=t.column,a.start.row=t.row}else a.start.column+=l,a.start.row+=f;else a.start.row>i&&(a.start.row+=f)}}if(f!=0&&o<u)for(;o<u;o++){var a=s[o];a.start.row+=f,a.end.row+=f}}}).call(s.prototype),t.RangeList=s}),ace.define("ace/edit_session/fold",["require","exports","module","ace/range_list","ace/lib/oop"],function(e,t,n){"use strict";function o(e,t){e.row-=t.row,e.row==0&&(e.column-=t.column)}function u(e,t){o(e.start,t),o(e.end,t)}function a(e,t){e.row==0&&(e.column+=t.column),e.row+=t.row}function f(e,t){a(e.start,t),a(e.end,t)}var r=e("../range_list").RangeList,i=e("../lib/oop"),s=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};i.inherits(s,r),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(e){this.foldLine=e,this.subFolds.forEach(function(t){t.setFoldLine(e)})},this.clone=function(){var e=this.range.clone(),t=new s(e,this.placeholder);return this.subFolds.forEach(function(e){t.subFolds.push(e.clone())}),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(this.range.isEqual(e))return;u(e,this.start);var t=e.start.row,n=e.start.column;for(var r=0,i=-1;r<this.subFolds.length;r++){i=this.subFolds[r].range.compare(t,n);if(i!=1)break}var s=this.subFolds[r],o=0;if(i==0){if(s.range.containsRange(e))return s.addSubFold(e);o=1}var t=e.range.end.row,n=e.range.end.column;for(var a=r,i=-1;a<this.subFolds.length;a++){i=this.subFolds[a].range.compare(t,n);if(i!=1)break}i==0&&a++;var f=this.subFolds.splice(r,a-r,e),l=i==0?f.length-1:f.length;for(var c=o;c<l;c++)e.addSubFold(f[c]);return e.setFoldLine(this.foldLine),e},this.restoreRange=function(e){return f(e,this.start)}}.call(s.prototype)}),ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],function(e,t,n){"use strict";function u(){this.getFoldAt=function(e,t,n){var r=this.getFoldLine(e);if(!r)return null;var i=r.folds;for(var s=0;s<i.length;s++){var o=i[s].range;if(o.contains(e,t)){if(n==1&&o.isEnd(e,t)&&!o.isEmpty())continue;if(n==-1&&o.isStart(e,t)&&!o.isEmpty())continue;return i[s]}}},this.getFoldsInRange=function(e){var t=e.start,n=e.end,r=this.$foldData,i=[];t.column+=1,n.column-=1;for(var s=0;s<r.length;s++){var o=r[s].range.compareRange(e);if(o==2)continue;if(o==-2)break;var u=r[s].folds;for(var a=0;a<u.length;a++){var f=u[a];o=f.range.compareRange(e);if(o==-2)break;if(o==2)continue;if(o==42)break;i.push(f)}}return t.column-=1,n.column+=1,i},this.getFoldsInRangeList=function(e){if(Array.isArray(e)){var t=[];e.forEach(function(e){t=t.concat(this.getFoldsInRange(e))},this)}else var t=this.getFoldsInRange(e);return t},this.getAllFolds=function(){var e=[],t=this.$foldData;for(var n=0;n<t.length;n++)for(var r=0;r<t[n].folds.length;r++)e.push(t[n].folds[r]);return e},this.getFoldStringAt=function(e,t,n,r){r=r||this.getFoldLine(e);if(!r)return null;var i={end:{column:0}},s,o;for(var u=0;u<r.folds.length;u++){o=r.folds[u];var a=o.range.compareEnd(e,t);if(a==-1){s=this.getLine(o.start.row).substring(i.end.column,o.start.column);break}if(a===0)return null;i=o}return s||(s=this.getLine(o.start.row).substring(i.end.column)),n==-1?s.substring(0,t-i.end.column):n==1?s.substring(t-i.end.column):s},this.getFoldLine=function(e,t){var n=this.$foldData,r=0;t&&(r=n.indexOf(t)),r==-1&&(r=0);for(r;r<n.length;r++){var i=n[r];if(i.start.row<=e&&i.end.row>=e)return i;if(i.end.row>e)return null}return null},this.getNextFoldLine=function(e,t){var n=this.$foldData,r=0;t&&(r=n.indexOf(t)),r==-1&&(r=0);for(r;r<n.length;r++){var i=n[r];if(i.end.row>=e)return i}return null},this.getFoldedRowCount=function(e,t){var n=this.$foldData,r=t-e+1;for(var i=0;i<n.length;i++){var s=n[i],o=s.end.row,u=s.start.row;if(o>=t){u<t&&(u>=e?r-=t-u:r=0);break}o>=e&&(u>=e?r-=o-u:r-=o-e+1)}return r},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort(function(e,t){return e.start.row-t.start.row}),e},this.addFold=function(e,t){var n=this.$foldData,r=!1,o;e instanceof s?o=e:(o=new s(t,e),o.collapseChildren=t.collapseChildren),this.$clipRangeToDocument(o.range);var u=o.start.row,a=o.start.column,f=o.end.row,l=o.end.column,c=this.getFoldAt(u,a,1),h=this.getFoldAt(f,l,-1);if(c&&h==c)return c.addSubFold(o);c&&!c.range.isStart(u,a)&&this.removeFold(c),h&&!h.range.isEnd(f,l)&&this.removeFold(h);var p=this.getFoldsInRange(o.range);p.length>0&&(this.removeFolds(p),o.collapseChildren||p.forEach(function(e){o.addSubFold(e)}));for(var d=0;d<n.length;d++){var v=n[d];if(f==v.start.row){v.addFold(o),r=!0;break}if(u==v.end.row){v.addFold(o),r=!0;if(!o.sameRow){var m=n[d+1];if(m&&m.start.row==f){v.merge(m);break}}break}if(f<=v.start.row)break}return r||(v=this.$addFoldLine(new i(this.$foldData,o))),this.$useWrapMode?this.$updateWrapData(v.start.row,v.start.row):this.$updateRowLengthCache(v.start.row,v.start.row),this.$modified=!0,this._signal("changeFold",{data:o,action:"add"}),o},this.addFolds=function(e){e.forEach(function(e){this.addFold(e)},this)},this.removeFold=function(e){var t=e.foldLine,n=t.start.row,r=t.end.row,i=this.$foldData,s=t.folds;if(s.length==1)i.splice(i.indexOf(t),1);else if(t.range.isEnd(e.end.row,e.end.column))s.pop(),t.end.row=s[s.length-1].end.row,t.end.column=s[s.length-1].end.column;else if(t.range.isStart(e.start.row,e.start.column))s.shift(),t.start.row=s[0].start.row,t.start.column=s[0].start.column;else if(e.sameRow)s.splice(s.indexOf(e),1);else{var o=t.split(e.start.row,e.start.column);s=o.folds,s.shift(),o.start.row=s[0].start.row,o.start.column=s[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(n,r):this.$updateRowLengthCache(n,r)),this.$modified=!0,this._signal("changeFold",{data:e,action:"remove"})},this.removeFolds=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e[n]);t.forEach(function(e){this.removeFold(e)},this),this.$modified=!0},this.expandFold=function(e){this.removeFold(e),e.subFolds.forEach(function(t){e.restoreRange(t),this.addFold(t)},this),e.collapseChildren>0&&this.foldAll(e.start.row+1,e.end.row,e.collapseChildren-1),e.subFolds=[]},this.expandFolds=function(e){e.forEach(function(e){this.expandFold(e)},this)},this.unfold=function(e,t){var n,i;if(e==null)n=new r(0,0,this.getLength(),0),t==null&&(t=!0);else if(typeof e=="number")n=new r(e,0,e,this.getLine(e).length);else if("row"in e)n=r.fromPoints(e,e);else{if(Array.isArray(e))return i=[],e.forEach(function(e){i=i.concat(this.unfold(e))},this),i;n=e}i=this.getFoldsInRangeList(n);var s=i;while(i.length==1&&r.comparePoints(i[0].start,n.start)<0&&r.comparePoints(i[0].end,n.end)>0)this.expandFolds(i),i=this.getFoldsInRangeList(n);t!=0?this.removeFolds(i):this.expandFolds(i);if(s.length)return s},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){var n=this.getFoldLine(e,t);return n?n.end.row:e},this.getRowFoldStart=function(e,t){var n=this.getFoldLine(e,t);return n?n.start.row:e},this.getFoldDisplayLine=function(e,t,n,r,i){r==null&&(r=e.start.row),i==null&&(i=0),t==null&&(t=e.end.row),n==null&&(n=this.getLine(t).length);var s=this.doc,o="";return e.walk(function(e,t,n,u){if(t<r)return;if(t==r){if(n<i)return;u=Math.max(i,u)}e!=null?o+=e:o+=s.getLine(t).substring(u,n)},t,n),o},this.getDisplayLine=function(e,t,n,r){var i=this.getFoldLine(e);if(!i){var s;return s=this.doc.getLine(e),s.substring(r||0,t||s.length)}return this.getFoldDisplayLine(i,e,t,n,r)},this.$cloneFoldData=function(){var e=[];return e=this.$foldData.map(function(t){var n=t.folds.map(function(e){return e.clone()});return new i(e,n)}),e},this.toggleFold=function(e){var t=this.selection,n=t.getRange(),r,i;if(n.isEmpty()){var s=n.start;r=this.getFoldAt(s.row,s.column);if(r){this.expandFold(r);return}(i=this.findMatchingBracket(s))?n.comparePoint(i)==1?n.end=i:(n.start=i,n.start.column++,n.end.column--):(i=this.findMatchingBracket({row:s.row,column:s.column+1}))?(n.comparePoint(i)==1?n.end=i:n.start=i,n.start.column++):n=this.getCommentFoldRange(s.row,s.column)||n}else{var o=this.getFoldsInRange(n);if(e&&o.length){this.expandFolds(o);return}o.length==1&&(r=o[0])}r||(r=this.getFoldAt(n.start.row,n.start.column));if(r&&r.range.toString()==n.toString()){this.expandFold(r);return}var u="...";if(!n.isMultiLine()){u=this.getTextRange(n);if(u.length<4)return;u=u.trim().substring(0,2)+".."}this.addFold(u,n)},this.getCommentFoldRange=function(e,t,n){var i=new o(this,e,t),s=i.getCurrentToken(),u=s&&s.type;if(s&&/^comment|string/.test(u)){u=u.match(/comment|string/)[0],u=="comment"&&(u+="|doc-start");var a=new RegExp(u),f=new r;if(n!=1){do s=i.stepBackward();while(s&&a.test(s.type));i.stepForward()}f.start.row=i.getCurrentTokenRow(),f.start.column=i.getCurrentTokenColumn()+2,i=new o(this,e,t);if(n!=-1){var l=-1;do{s=i.stepForward();if(l==-1){var c=this.getState(i.$row);a.test(c)||(l=i.$row)}else if(i.$row>l)break}while(s&&a.test(s.type));s=i.stepBackward()}else s=i.getCurrentToken();return f.end.row=i.getCurrentTokenRow(),f.end.column=i.getCurrentTokenColumn()+s.value.length-2,f}},this.foldAll=function(e,t,n,r){n==undefined&&(n=1e5);var i=this.foldWidgets;if(!i)return;t=t||this.getLength(),e=e||0;for(var s=e;s<t;s++){i[s]==null&&(i[s]=this.getFoldWidget(s));if(i[s]!="start")continue;if(r&&!r(s))continue;var o=this.getFoldWidgetRange(s);o&&o.isMultiLine()&&o.end.row<=t&&o.start.row>=e&&(s=o.end.row,o.collapseChildren=n,this.addFold("...",o))}},this.foldToLevel=function(e){this.foldAll();while(e-->0)this.unfold(null,!1)},this.foldAllComments=function(){var e=this;this.foldAll(null,null,null,function(t){var n=e.getTokens(t);for(var r=0;r<n.length;r++){var i=n[r];if(i.type=="text"&&/^\s+$/.test(i.value))continue;return/comment/.test(i.type)?!0:!1}})},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error("invalid fold style: "+e+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle==e)return;this.$foldStyle=e,e=="manual"&&this.unfold();var t=this.$foldMode;this.$setFolding(null),this.$setFolding(t)},this.$setFolding=function(e){if(this.$foldMode==e)return;this.$foldMode=e,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation");if(!e||this.$foldStyle=="manual"){this.foldWidgets=null;return}this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)},this.getParentFoldRangeData=function(e,t){var n=this.foldWidgets;if(!n||t&&n[e])return{};var r=e-1,i;while(r>=0){var s=n[r];s==null&&(s=n[r]=this.getFoldWidget(r));if(s=="start"){var o=this.getFoldWidgetRange(r);i||(i=o);if(o&&o.end.row>=e)break}r--}return{range:r!==-1&&o,firstRange:i}},this.onFoldWidgetClick=function(e,t){t=t.domEvent;var n={children:t.shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey},r=this.$toggleFoldWidget(e,n);if(!r){var i=t.target||t.srcElement;i&&/ace_fold-widget/.test(i.className)&&(i.className+=" ace_invalid")}},this.$toggleFoldWidget=function(e,t){if(!this.getFoldWidget)return;var n=this.getFoldWidget(e),r=this.getLine(e),i=n==="end"?-1:1,s=this.getFoldAt(e,i===-1?0:r.length,i);if(s)return t.children||t.all?this.removeFold(s):this.expandFold(s),s;var o=this.getFoldWidgetRange(e,!0);if(o&&!o.isMultiLine()){s=this.getFoldAt(o.start.row,o.start.column,1);if(s&&o.isEqual(s.range))return this.removeFold(s),s}if(t.siblings){var u=this.getParentFoldRangeData(e);if(u.range)var a=u.range.start.row+1,f=u.range.end.row;this.foldAll(a,f,t.all?1e4:0)}else t.children?(f=o?o.end.row:this.getLength(),this.foldAll(e+1,f,t.all?1e4:0)):o&&(t.all&&(o.collapseChildren=1e4),this.addFold("...",o));return o},this.toggleFoldWidget=function(e){var t=this.selection.getCursor().row;t=this.getRowFoldStart(t);var n=this.$toggleFoldWidget(t,{});if(n)return;var r=this.getParentFoldRangeData(t,!0);n=r.range||r.firstRange;if(n){t=n.start.row;var i=this.getFoldAt(t,this.getLine(t).length,1);i?this.removeFold(i):this.addFold("...",n)}},this.updateFoldWidgets=function(e){var t=e.start.row,n=e.end.row-t;if(n===0)this.foldWidgets[t]=null;else if(e.action=="remove")this.foldWidgets.splice(t,n+1,null);else{var r=Array(n+1);r.unshift(t,1),this.foldWidgets.splice.apply(this.foldWidgets,r)}},this.tokenizerUpdateFoldWidgets=function(e){var t=e.data;t.first!=t.last&&this.foldWidgets.length>t.first&&this.foldWidgets.splice(t.first,this.foldWidgets.length)}}var r=e("../range").Range,i=e("./fold_line").FoldLine,s=e("./fold").Fold,o=e("../token_iterator").TokenIterator;t.Folding=u}),ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(e,t,n){"use strict";function s(){this.findMatchingBracket=function(e,t){if(e.column==0)return null;var n=t||this.getLine(e.row).charAt(e.column-1);if(n=="")return null;var r=n.match(/([\(\[\{])|([\)\]\}])/);return r?r[1]?this.$findClosingBracket(r[1],e):this.$findOpeningBracket(r[2],e):null},this.getBracketRange=function(e){var t=this.getLine(e.row),n=!0,r,s=t.charAt(e.column-1),o=s&&s.match(/([\(\[\{])|([\)\]\}])/);o||(s=t.charAt(e.column),e={row:e.row,column:e.column+1},o=s&&s.match(/([\(\[\{])|([\)\]\}])/),n=!1);if(!o)return null;if(o[1]){var u=this.$findClosingBracket(o[1],e);if(!u)return null;r=i.fromPoints(e,u),n||(r.end.column++,r.start.column--),r.cursor=r.end}else{var u=this.$findOpeningBracket(o[2],e);if(!u)return null;r=i.fromPoints(u,e),n||(r.start.column++,r.end.column--),r.cursor=r.start}return r},this.getMatchingBracketRanges=function(e){var t=this.getLine(e.row),n=t.charAt(e.column-1),r=n&&n.match(/([\(\[\{])|([\)\]\}])/);r||(n=t.charAt(e.column),e={row:e.row,column:e.column+1},r=n&&n.match(/([\(\[\{])|([\)\]\}])/));if(!r)return null;var s=new i(e.row,e.column-1,e.row,e.column),o=r[1]?this.$findClosingBracket(r[1],e):this.$findOpeningBracket(r[2],e);if(!o)return[s];var u=new i(o.row,o.column,o.row,o.column+1);return[s,u]},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp("(\\.?"+u.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+"));var a=t.column-o.getCurrentTokenColumn()-2,f=u.value;for(;;){while(a>=0){var l=f.charAt(a);if(l==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else l==e&&(s+=1);a-=1}do u=o.stepBackward();while(u&&!n.test(u.type));if(u==null)break;f=u.value,a=f.length-1}return null},this.$findClosingBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp("(\\.?"+u.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+"));var a=t.column-o.getCurrentTokenColumn();for(;;){var f=u.value,l=f.length;while(a<l){var c=f.charAt(a);if(c==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else c==e&&(s+=1);a+=1}do u=o.stepForward();while(u&&!n.test(u.type));if(u==null)break;a=0}return null}}var r=e("../token_iterator").TokenIterator,i=e("../range").Range;t.BracketMatch=s}),ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/lang"),s=e("./bidihandler").BidiHandler,o=e("./config"),u=e("./lib/event_emitter").EventEmitter,a=e("./selection").Selection,f=e("./mode/text").Mode,l=e("./range").Range,c=e("./document").Document,h=e("./background_tokenizer").BackgroundTokenizer,p=e("./search_highlight").SearchHighlight,d=function(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++d.$uid,this.$foldData.toString=function(){return this.join("\n")},this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this);if(typeof e!="object"||!e.getLine)e=new c(e);this.setDocument(e),this.selection=new a(this),this.$bidiHandler=new s(this),o.resetOptions(this),this.setMode(t),o._signal("session",this)};d.$uid=0,function(){function m(e){return e<4352?!1:e>=4352&&e<=4447||e>=4515&&e<=4519||e>=4602&&e<=4607||e>=9001&&e<=9002||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12283||e>=12288&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12589||e>=12593&&e<=12686||e>=12688&&e<=12730||e>=12736&&e<=12771||e>=12784&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=13054||e>=13056&&e<=19903||e>=19968&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=55216&&e<=55238||e>=55243&&e<=55291||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=65281&&e<=65376||e>=65504&&e<=65510}r.implement(this,u),this.setDocument=function(e){this.doc&&this.doc.off("change",this.$onChange),this.doc=e,e.on("change",this.$onChange),this.bgTokenizer&&this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(e){if(!e){this.$docRowCache=[],this.$screenRowCache=[];return}var t=this.$docRowCache.length,n=this.$getRowCacheIndex(this.$docRowCache,e)+1;t>n&&(this.$docRowCache.splice(n,t),this.$screenRowCache.splice(n,t))},this.$getRowCacheIndex=function(e,t){var n=0,r=e.length-1;while(n<=r){var i=n+r>>1,s=e[i];if(t>s)n=i+1;else{if(!(t<s))return i;r=i-1}}return n-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.bgTokenizer&&this.bgTokenizer.start(0)},this.onChangeFold=function(e){var t=e.data;this.$resetRowCache(t.start.row)},this.onChange=function(e){this.$modified=!0,this.$bidiHandler.onChange(e),this.$resetRowCache(e.start.row);var t=this.$updateInternalDataOnChange(e);!this.$fromUndo&&this.$undoManager&&(t&&t.length&&(this.$undoManager.add({action:"removeFolds",folds:t},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(e,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer&&this.bgTokenizer.$updateOnChange(e),this._signal("change",e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var n=this.bgTokenizer.getTokens(e),r,i=0;if(t==null){var s=n.length-1;i=this.getLine(e).length}else for(var s=0;s<n.length;s++){i+=n[s].value.length;if(i>=t)break}return r=n[s],r?(r.index=s,r.start=i-r.value.length,r):null},this.setUndoManager=function(e){this.$undoManager=e,this.$informUndoManager&&this.$informUndoManager.cancel();if(e){var t=this;e.addSession(this),this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.mergeUndoDeltas=!1},this.$informUndoManager=i.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?i.stringRepeat(" ",this.getTabSize()):"	"},this.setUseSoftTabs=function(e){this.setOption("useSoftTabs",e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption("tabSize",e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&&e.column%this.$tabSize===0},this.setNavigateWithinSoftTabs=function(e){this.setOption("navigateWithinSoftTabs",e)},this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption("overwrite",e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=""),this.$decorations[e]+=" "+t,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||"").replace(" "+t,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t<e.length;t++)this.$breakpoints[e[t]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(e,t){t===undefined&&(t="ace_breakpoint"),t?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.addMarker=function(e,t,n,r){var i=this.$markerId++,s={range:e,type:n||"line",renderer:typeof n=="function"?n:null,clazz:t,inFront:!!r,id:i};return r?(this.$frontMarkers[i]=s,this._signal("changeFrontMarker")):(this.$backMarkers[i]=s,this._signal("changeBackMarker")),i},this.addDynamicMarker=function(e,t){if(!e.update)return;var n=this.$markerId++;return e.id=n,e.inFront=!!t,t?(this.$frontMarkers[n]=e,this._signal("changeFrontMarker")):(this.$backMarkers[n]=e,this._signal("changeBackMarker")),e},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];if(!t)return;var n=t.inFront?this.$frontMarkers:this.$backMarkers;delete n[e],this._signal(t.inFront?"changeFrontMarker":"changeBackMarker")},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){if(!this.$searchHighlight){var t=new p(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(t)}this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,n,r){typeof t!="number"&&(n=t,t=e),n||(n="ace_step");var i=new l(e,0,t,Infinity);return i.id=this.addMarker(i,n,"fullLine",r),i},this.setAnnotations=function(e){this.$annotations=e,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r?\n)/m);t?this.$autoNewLine=t[1]:this.$autoNewLine="\n"},this.getWordRange=function(e,t){var n=this.getLine(e),r=!1;t>0&&(r=!!n.charAt(t-1).match(this.tokenRe)),r||(r=!!n.charAt(t).match(this.tokenRe));if(r)var i=this.tokenRe;else if(/^\s+$/.test(n.slice(t-1,t+1)))var i=/\s/;else var i=this.nonTokenRe;var s=t;if(s>0){do s--;while(s>=0&&n.charAt(s).match(i));s++}var o=t;while(o<n.length&&n.charAt(o).match(i))o++;return new l(e,s,e,o)},this.getAWordRange=function(e,t){var n=this.getWordRange(e,t),r=this.getLine(n.end.row);while(r.charAt(n.end.column).match(/[ \t]/))n.end.column+=1;return n},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption("useWorker",e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal("tokenizerUpdate",e)},this.$modes=o.$modes,this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&&typeof e=="object"){if(e.getTokenizer)return this.$onChangeMode(e);var n=e,r=n.path}else r=e||"ace/mode/text";this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new f);if(this.$modes[r]&&!n){this.$onChangeMode(this.$modes[r]),t&&t();return}this.$modeId=r,o.loadModule(["mode",r],function(e){if(this.$modeId!==r)return t&&t();this.$modes[r]&&!n?this.$onChangeMode(this.$modes[r]):e&&e.Mode&&(e=new e.Mode(n),n||(this.$modes[r]=e,e.$id=r),this.$onChangeMode(e)),t&&t()}.bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)},this.$onChangeMode=function(e,t){t||(this.$modeId=e.$id);if(this.$mode===e)return;var n=this.$mode;this.$mode=e,this.$stopWorker(),this.$useWorker&&this.$startWorker();var r=e.getTokenizer();if(r.on!==undefined){var i=this.onReloadTokenizer.bind(this);r.on("update",i)}if(!this.bgTokenizer){this.bgTokenizer=new h(r);var s=this;this.bgTokenizer.on("update",function(e){s._signal("tokenizerUpdate",e)})}else this.bgTokenizer.setTokenizer(r);this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(e.attachToSession&&e.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:n,mode:e}))},this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){o.warn("Could not load worker",e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){if(this.$scrollTop===e||isNaN(e))return;this.$scrollTop=e,this._signal("changeScrollTop",e)},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){if(this.$scrollLeft===e||isNaN(e))return;this.$scrollLeft=e,this._signal("changeScrollLeft",e)},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(this.lineWidgetsWidth!=null)return this.lineWidgetsWidth;var e=0;return this.lineWidgets.forEach(function(t){t&&t.screenWidth>e&&(e=t.screenWidth)}),this.lineWidgetWidth=e},this.$computeWidth=function(e){if(this.$modified||e){this.$modified=!1;if(this.$useWrapMode)return this.screenWidth=this.$wrapLimit;var t=this.doc.getAllLines(),n=this.$rowLengthCache,r=0,i=0,s=this.$foldData[i],o=s?s.start.row:Infinity,u=t.length;for(var a=0;a<u;a++){if(a>o){a=s.end.row+1;if(a>=u)break;s=this.$foldData[i++],o=s?s.start.row:Infinity}n[a]==null&&(n[a]=this.$getStringScreenWidth(t[a])[0]),n[a]>r&&(r=n[a])}this.screenWidth=r}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.removeFullLines=function(e,t){return this.doc.removeFullLines(e,t)},this.undoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;for(var n=e.length-1;n!=-1;n--){var r=e[n];r.action=="insert"||r.action=="remove"?this.doc.revertDelta(r):r.folds&&this.addFolds(r.folds)}!t&&this.$undoSelect&&(e.selectionBefore?this.selection.fromJSON(e.selectionBefore):this.selection.setRange(this.$getUndoSelection(e,!0))),this.$fromUndo=!1},this.redoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;for(var n=0;n<e.length;n++){var r=e[n];(r.action=="insert"||r.action=="remove")&&this.doc.$safeApplyDelta(r)}!t&&this.$undoSelect&&(e.selectionAfter?this.selection.fromJSON(e.selectionAfter):this.selection.setRange(this.$getUndoSelection(e,!1))),this.$fromUndo=!1},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t){function n(e){return t?e.action!=="insert":e.action==="insert"}var r,i;for(var s=0;s<e.length;s++){var o=e[s];if(!o.start)continue;if(!r){n(o)?r=l.fromPoints(o.start,o.end):r=l.fromPoints(o.start,o.start);continue}n(o)?(i=o.start,r.compare(i.row,i.column)==-1&&r.setStart(i),i=o.end,r.compare(i.row,i.column)==1&&r.setEnd(i)):(i=o.start,r.compare(i.row,i.column)==-1&&(r=l.fromPoints(o.start,o.start)))}return r},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,n){var r=this.getTextRange(e),i=this.getFoldsInRange(e),s=l.fromPoints(t,t);if(!n){this.remove(e);var o=e.start.row-e.end.row,u=o?-e.end.column:e.start.column-e.end.column;u&&(s.start.row==e.end.row&&s.start.column>e.end.column&&(s.start.column+=u),s.end.row==e.end.row&&s.end.column>e.end.column&&(s.end.column+=u)),o&&s.start.row>=e.end.row&&(s.start.row+=o,s.end.row+=o)}s.end=this.insert(s.start,r);if(i.length){var a=e.start,f=s.start,o=f.row-a.row,u=f.column-a.column;this.addFolds(i.map(function(e){return e=e.clone(),e.start.row==a.row&&(e.start.column+=u),e.end.row==a.row&&(e.end.column+=u),e.start.row+=o,e.end.row+=o,e}))}return s},this.indentRows=function(e,t,n){n=n.replace(/\t/g,this.getTabString());for(var r=e;r<=t;r++)this.doc.insertInLine({row:r,column:0},n)},this.outdentRows=function(e){var t=e.collapseRows(),n=new l(0,0,0,0),r=this.getTabSize();for(var i=t.start.row;i<=t.end.row;++i){var s=this.getLine(i);n.start.row=i,n.end.row=i;for(var o=0;o<r;++o)if(s.charAt(o)!=" ")break;o<r&&s.charAt(o)=="	"?(n.start.column=o,n.end.column=o+1):(n.start.column=0,n.end.column=o),this.remove(n)}},this.$moveLines=function(e,t,n){e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t);if(n<0){var r=this.getRowFoldStart(e+n);if(r<0)return 0;var i=r-e}else if(n>0){var r=this.getRowFoldEnd(t+n);if(r>this.doc.getLength()-1)return 0;var i=r-t}else{e=this.$clipRowToDocument(e),t=this.$clipRowToDocument(t);var i=t-e+1}var s=new l(e,0,t,Number.MAX_VALUE),o=this.getFoldsInRange(s).map(function(e){return e=e.clone(),e.start.row+=i,e.end.row+=i,e}),u=n==0?this.doc.getLines(e,t):this.doc.removeFullLines(e,t);return this.doc.insertFullLines(e+i,u),o.length&&this.addFolds(o),i},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return t<0?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){t=Math.max(0,t);if(e<0)e=0,t=0;else{var n=this.doc.getLength();e>=n?(e=n-1,t=this.doc.getLine(n-1).length):t=Math.min(this.doc.getLine(e).length,t)}return{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row<0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row>t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){if(e!=this.$useWrapMode){this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0);if(e){var t=this.getLength();this.$wrapData=Array(t),this.$updateWrapData(0,t-1)}this._signal("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){if(this.$wrapLimitRange.min!==e||this.$wrapLimitRange.max!==t)this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode")},this.adjustWrapLimit=function(e,t){var n=this.$wrapLimitRange;n.max<0&&(n={min:t,max:t});var r=this.$constrainWrapLimit(e,n.min,n.max);return r!=this.$wrapLimit&&r>1?(this.$wrapLimit=r,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1},this.$constrainWrapLimit=function(e,t,n){return t&&(e=Math.max(t,e)),n&&(e=Math.min(n,e)),e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,n=e.action,r=e.start,i=e.end,s=r.row,o=i.row,u=o-s,a=null;this.$updating=!0;if(u!=0)if(n==="remove"){this[t?"$wrapData":"$rowLengthCache"].splice(s,u);var f=this.$foldData;a=this.getFoldsInRange(e),this.removeFolds(a);var l=this.getFoldLine(i.row),c=0;if(l){l.addRemoveChars(i.row,i.column,r.column-i.column),l.shiftRow(-u);var h=this.getFoldLine(s);h&&h!==l&&(h.merge(l),l=h),c=f.indexOf(l)+1}for(c;c<f.length;c++){var l=f[c];l.start.row>=i.row&&l.shiftRow(-u)}o=s}else{var p=Array(u);p.unshift(s,0);var d=t?this.$wrapData:this.$rowLengthCache;d.splice.apply(d,p);var f=this.$foldData,l=this.getFoldLine(s),c=0;if(l){var v=l.range.compareInside(r.row,r.column);v==0?(l=l.split(r.row,r.column),l&&(l.shiftRow(u),l.addRemoveChars(o,0,i.column-r.column))):v==-1&&(l.addRemoveChars(s,0,i.column-r.column),l.shiftRow(u)),c=f.indexOf(l)+1}for(c;c<f.length;c++){var l=f[c];l.start.row>=s&&l.shiftRow(u)}}else{u=Math.abs(e.start.column-e.end.column),n==="remove"&&(a=this.getFoldsInRange(e),this.removeFolds(a),u=-u);var l=this.getFoldLine(s);l&&l.addRemoveChars(s,r.column,u)}return t&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,t?this.$updateWrapData(s,o):this.$updateRowLengthCache(s,o),a},this.$updateRowLengthCache=function(e,t,n){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(e,t){var r=this.doc.getAllLines(),i=this.getTabSize(),o=this.$wrapData,u=this.$wrapLimit,a,f,l=e;t=Math.min(t,r.length-1);while(l<=t)f=this.getFoldLine(l,f),f?(a=[],f.walk(function(e,t,i,o){var u;if(e!=null){u=this.$getDisplayTokens(e,a.length),u[0]=n;for(var f=1;f<u.length;f++)u[f]=s}else u=this.$getDisplayTokens(r[t].substring(o,i),a.length);a=a.concat(u)}.bind(this),f.end.row,r[f.end.row].length+1),o[f.start.row]=this.$computeWrapSplits(a,u,i),l=f.end.row+1):(a=this.$getDisplayTokens(r[l]),o[l]=this.$computeWrapSplits(a,u,i),l++)};var e=1,t=2,n=3,s=4,a=9,c=10,d=11,v=12;this.$computeWrapSplits=function(e,r,i){function g(){var t=0;if(m===0)return t;if(p)for(var n=0;n<e.length;n++){var r=e[n];if(r==c)t+=1;else{if(r!=d){if(r==v)continue;break}t+=i}}return h&&p!==!1&&(t+=i),Math.min(t,m)}function y(t){var n=t-f;for(var r=f;r<t;r++){var i=e[r];if(i===12||i===2)n-=1}o.length||(b=g(),o.indent=b),l+=n,o.push(l),f=t}if(e.length==0)return[];var o=[],u=e.length,f=0,l=0,h=this.$wrapAsCode,p=this.$indentedSoftWrap,m=r<=Math.max(2*i,8)||p===!1?0:Math.floor(r/2),b=0;while(u-f>r-b){var w=f+r-b;if(e[w-1]>=c&&e[w]>=c){y(w);continue}if(e[w]==n||e[w]==s){for(w;w!=f-1;w--)if(e[w]==n)break;if(w>f){y(w);continue}w=f+r;for(w;w<e.length;w++)if(e[w]!=s)break;if(w==e.length)break;y(w);continue}var E=Math.max(w-(r-(r>>2)),f-1);while(w>E&&e[w]<n)w--;if(h){while(w>E&&e[w]<n)w--;while(w>E&&e[w]==a)w--}else while(w>E&&e[w]<c)w--;if(w>E){y(++w);continue}w=f+r,e[w]==t&&w--,y(w-b)}return o},this.$getDisplayTokens=function(n,r){var i=[],s;r=r||0;for(var o=0;o<n.length;o++){var u=n.charCodeAt(o);if(u==9){s=this.getScreenTabSize(i.length+r),i.push(d);for(var f=1;f<s;f++)i.push(v)}else u==32?i.push(c):u>39&&u<48||u>57&&u<64?i.push(a):u>=4352&&m(u)?i.push(e,t):i.push(e)}return i},this.$getStringScreenWidth=function(e,t,n){if(t==0)return[0,0];t==null&&(t=Infinity),n=n||0;var r,i;for(i=0;i<e.length;i++){r=e.charCodeAt(i),r==9?n+=this.getScreenTabSize(n):r>=4352&&m(r)?n+=2:n+=1;if(n>t)break}return[n,i]},this.lineWidgets=null,this.getRowLength=function(e){var t=1;return this.lineWidgets&&(t+=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0),!this.$useWrapMode||!this.$wrapData[e]?t:this.$wrapData[e].length+t},this.getRowLineCount=function(e){return!this.$useWrapMode||!this.$wrapData[e]?1:this.$wrapData[e].length+1},this.getRowWrapIndent=function(e){if(this.$useWrapMode){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE),n=this.$wrapData[t.row];return n.length&&n[0]<t.column?n.indent:0}return 0},this.getScreenLastRowColumn=function(e){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(t.row,t.column)},this.getDocumentLastRowColumn=function(e,t){var n=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(n)},this.getDocumentLastRowColumnPosition=function(e,t){var n=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(n,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:undefined},this.getScreenTabSize=function(e){return this.$tabSize-(e%this.$tabSize|0)},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t,n){if(e<0)return{row:0,column:0};var r,i=0,s=0,o,u=0,a=0,f=this.$screenRowCache,l=this.$getRowCacheIndex(f,e),c=f.length;if(c&&l>=0)var u=f[l],i=this.$docRowCache[l],h=e>f[c-1];else var h=!c;var p=this.getLength()-1,d=this.getNextFoldLine(i),v=d?d.start.row:Infinity;while(u<=e){a=this.getRowLength(i);if(u+a>e||i>=p)break;u+=a,i++,i>v&&(i=d.end.row+1,d=this.getNextFoldLine(i,d),v=d?d.start.row:Infinity),h&&(this.$docRowCache.push(i),this.$screenRowCache.push(u))}if(d&&d.start.row<=i)r=this.getFoldDisplayLine(d),i=d.start.row;else{if(u+a<=e||i>p)return{row:p,column:this.getLine(p).length};r=this.getLine(i),d=null}var m=0,g=Math.floor(e-u);if(this.$useWrapMode){var y=this.$wrapData[i];y&&(o=y[g],g>0&&y.length&&(m=y.indent,s=y[g-1]||y[y.length-1],r=r.substring(s)))}return n!==undefined&&this.$bidiHandler.isBidiRow(u+g,i,g)&&(t=this.$bidiHandler.offsetToCol(n)),s+=this.$getStringScreenWidth(r,t-m)[1],this.$useWrapMode&&s>=o&&(s=o-1),d?d.idxToPosition(s):{row:i,column:s}},this.documentToScreenPosition=function(e,t){if(typeof t=="undefined")var n=this.$clipPositionToDocument(e.row,e.column);else n=this.$clipPositionToDocument(e,t);e=n.row,t=n.column;var r=0,i=null,s=null;s=this.getFoldAt(e,t,1),s&&(e=s.start.row,t=s.start.column);var o,u=0,a=this.$docRowCache,f=this.$getRowCacheIndex(a,e),l=a.length;if(l&&f>=0)var u=a[f],r=this.$screenRowCache[f],c=e>a[l-1];else var c=!l;var h=this.getNextFoldLine(u),p=h?h.start.row:Infinity;while(u<e){if(u>=p){o=h.end.row+1;if(o>e)break;h=this.getNextFoldLine(o,h),p=h?h.start.row:Infinity}else o=u+1;r+=this.getRowLength(u),u=o,c&&(this.$docRowCache.push(u),this.$screenRowCache.push(r))}var d="";h&&u>=p?(d=this.getFoldDisplayLine(h,e,t),i=h.start.row):(d=this.getLine(e).substring(0,t),i=e);var v=0;if(this.$useWrapMode){var m=this.$wrapData[i];if(m){var g=0;while(d.length>=m[g])r++,g++;d=d.substring(m[g-1]||0,d.length),v=g>0?m.indent:0}}return this.lineWidgets&&this.lineWidgets[u]&&this.lineWidgets[u].rowsAbove&&(r+=this.lineWidgets[u].rowsAbove),{row:r,column:v+this.$getStringScreenWidth(d)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(!this.$useWrapMode){e=this.getLength();var n=this.$foldData;for(var r=0;r<n.length;r++)t=n[r],e-=t.end.row-t.start.row}else{var i=this.$wrapData.length,s=0,r=0,t=this.$foldData[r++],o=t?t.start.row:Infinity;while(s<i){var u=this.$wrapData[s];e+=u?u.length+1:1,s++,s>o&&(s=t.end.row+1,t=this.$foldData[r++],o=t?t.start.row:Infinity)}}return this.lineWidgets&&(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(e){if(!this.$enableVarChar)return;this.$getStringScreenWidth=function(t,n,r){if(n===0)return[0,0];n||(n=Infinity),r=r||0;var i,s;for(s=0;s<t.length;s++){i=t.charAt(s),i==="	"?r+=this.getScreenTabSize(r):r+=e.getCharacterWidth(i);if(r>n)break}return[r,s]}},this.destroy=function(){this.bgTokenizer&&(this.bgTokenizer.setDocument(null),this.bgTokenizer=null),this.$stopWorker(),this.removeAllListeners(),this.doc&&this.doc.off("change",this.$onChange),this.selection.detach()},this.isFullWidth=m}.call(d.prototype),e("./edit_session/folding").Folding.call(d.prototype),e("./edit_session/bracket_match").BracketMatch.call(d.prototype),o.defineOptions(d.prototype,"session",{wrap:{set:function(e){!e||e=="off"?e=!1:e=="free"?e=!0:e=="printMargin"?e=-1:typeof e=="string"&&(e=parseInt(e,10)||!1);if(this.$wrap==e)return;this.$wrap=e;if(!e)this.setUseWrapMode(!1);else{var t=typeof e=="number"?e:null;this.setWrapLimitRange(t,t),this.setUseWrapMode(!0)}},get:function(){return this.getUseWrapMode()?this.$wrap==-1?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(e){e=e=="auto"?this.$mode.type!="text":e!="text",e!=this.$wrapAsCode&&(this.$wrapAsCode=e,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){e=parseInt(e),e>0&&this.$tabSize!==e&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(e){this.setFoldStyle(e)},handlesSet:!0},overwrite:{set:function(e){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId},handlesSet:!0}}),t.EditSession=d}),ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(e,t,n){"use strict";function u(e,t){function n(e){return/\w/.test(e)||t.regExp?"\\b":""}return n(e[0])+e+n(e[e.length-1])}var r=e("./lib/lang"),i=e("./lib/oop"),s=e("./range").Range,o=function(){this.$options={}};(function(){this.set=function(e){return i.mixin(this.$options,e),this},this.getOptions=function(){return r.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var t=this.$options,n=this.$matchIterator(e,t);if(!n)return!1;var r=null;return n.forEach(function(e,n,i,o){return r=new s(e,n,i,o),n==o&&t.start&&t.start.start&&t.skipCurrent!=0&&r.isEqual(t.start)?(r=null,!1):!0}),r},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var n=t.range,i=n?e.getLines(n.start.row,n.end.row):e.doc.getAllLines(),o=[],u=t.re;if(t.$isMultiLine){var a=u.length,f=i.length-a,l;e:for(var c=u.offset||0;c<=f;c++){for(var h=0;h<a;h++)if(i[c+h].search(u[h])==-1)continue e;var p=i[c],d=i[c+a-1],v=p.length-p.match(u[0])[0].length,m=d.match(u[a-1])[0].length;if(l&&l.end.row===c&&l.end.column>v)continue;o.push(l=new s(c,v,c+a-1,m)),a>2&&(c=c+a-2)}}else for(var g=0;g<i.length;g++){var y=r.getMatchOffsets(i[g],u);for(var h=0;h<y.length;h++){var b=y[h];o.push(new s(g,b.offset,g,b.offset+b.length))}}if(n){var w=n.start.column,E=n.start.column,g=0,h=o.length-1;while(g<h&&o[g].start.column<w&&o[g].start.row==n.start.row)g++;while(g<h&&o[h].end.column>E&&o[h].end.row==n.end.row)h--;o=o.slice(g,h+1);for(g=0,h=o.length;g<h;g++)o[g].start.row+=n.start.row,o[g].end.row+=n.start.row}return o},this.replace=function(e,t){var n=this.$options,r=this.$assembleRegExp(n);if(n.$isMultiLine)return t;if(!r)return;var i=r.exec(e);if(!i||i[0].length!=e.length)return null;t=e.replace(r,t);if(n.preserveCase){t=t.split("");for(var s=Math.min(e.length,e.length);s--;){var o=e[s];o&&o.toLowerCase()!=o?t[s]=t[s].toUpperCase():t[s]=t[s].toLowerCase()}t=t.join("")}return t},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var n=e.needle;if(!e.needle)return e.re=!1;e.regExp||(n=r.escapeRegExp(n)),e.wholeWord&&(n=u(n,e));var i=e.caseSensitive?"gm":"gmi";e.$isMultiLine=!t&&/[\n\r]/.test(n);if(e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(n,i);try{var s=new RegExp(n,i)}catch(o){s=!1}return e.re=s},this.$assembleMultilineRegExp=function(e,t){var n=e.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),r=[];for(var i=0;i<n.length;i++)try{r.push(new RegExp(n[i],t))}catch(s){return!1}return r},this.$matchIterator=function(e,t){var n=this.$assembleRegExp(t);if(!n)return!1;var r=t.backwards==1,i=t.skipCurrent!=0,s=t.range,o=t.start;o||(o=s?s[r?"end":"start"]:e.selection.getRange()),o.start&&(o=o[i!=r?"end":"start"]);var u=s?s.start.row:0,a=s?s.end.row:e.getLength()-1;if(r)var f=function(e){var n=o.row;if(c(n,o.column,e))return;for(n--;n>=u;n--)if(c(n,Number.MAX_VALUE,e))return;if(t.wrap==0)return;for(n=a,u=o.row;n>=u;n--)if(c(n,Number.MAX_VALUE,e))return};else var f=function(e){var n=o.row;if(c(n,o.column,e))return;for(n+=1;n<=a;n++)if(c(n,0,e))return;if(t.wrap==0)return;for(n=u,a=o.row;n<=a;n++)if(c(n,0,e))return};if(t.$isMultiLine)var l=n.length,c=function(t,i,s){var o=r?t-l+1:t;if(o<0||o+l>e.getLength())return;var u=e.getLine(o),a=u.search(n[0]);if(!r&&a<i||a===-1)return;for(var f=1;f<l;f++){u=e.getLine(o+f);if(u.search(n[f])==-1)return}var c=u.match(n[l-1])[0].length;if(r&&c>i)return;if(s(o,a,o+l-1,c))return!0};else if(r)var c=function(t,r,i){var s=e.getLine(t),o=[],u,a=0;n.lastIndex=0;while(u=n.exec(s)){var f=u[0].length;a=u.index;if(!f){if(a>=s.length)break;n.lastIndex=a+=1}if(u.index+f>r)break;o.push(u.index,f)}for(var l=o.length-1;l>=0;l-=2){var c=o[l-1],f=o[l];if(i(t,c,t,c+f))return!0}};else var c=function(t,r,i){var s=e.getLine(t),o,u;n.lastIndex=r;while(u=n.exec(s)){var a=u[0].length;o=u.index;if(i(t,o,t,o+a))return!0;if(!a){n.lastIndex=o+=1;if(o>=s.length)return!1}}};return{forEach:f}}}).call(o.prototype),t.Search=o}),ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(e,t,n){"use strict";function o(e,t){this.platform=t||(i.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(e),this.$singleCommand=!0}function u(e,t){o.call(this,e,t),this.$singleCommand=!1}var r=e("../lib/keys"),i=e("../lib/useragent"),s=r.KEY_MODS;u.prototype=o.prototype,function(){function e(e){return typeof e=="object"&&e.bindKey&&e.bindKey.position||(e.isDefault?-100:0)}this.addCommand=function(e){this.commands[e.name]&&this.removeCommand(e),this.commands[e.name]=e,e.bindKey&&this._buildKeyHash(e)},this.removeCommand=function(e,t){var n=e&&(typeof e=="string"?e:e.name);e=this.commands[n],t||delete this.commands[n];var r=this.commandKeyBinding;for(var i in r){var s=r[i];if(s==e)delete r[i];else if(Array.isArray(s)){var o=s.indexOf(e);o!=-1&&(s.splice(o,1),s.length==1&&(r[i]=s[0]))}}},this.bindKey=function(e,t,n){typeof e=="object"&&e&&(n==undefined&&(n=e.position),e=e[this.platform]);if(!e)return;if(typeof t=="function")return this.addCommand({exec:t,bindKey:e,name:t.name||e});e.split("|").forEach(function(e){var r="";if(e.indexOf(" ")!=-1){var i=e.split(/\s+/);e=i.pop(),i.forEach(function(e){var t=this.parseKeys(e),n=s[t.hashId]+t.key;r+=(r?" ":"")+n,this._addCommandToBinding(r,"chainKeys")},this),r+=" "}var o=this.parseKeys(e),u=s[o.hashId]+o.key;this._addCommandToBinding(r+u,t,n)},this)},this._addCommandToBinding=function(t,n,r){var i=this.commandKeyBinding,s;if(!n)delete i[t];else if(!i[t]||this.$singleCommand)i[t]=n;else{Array.isArray(i[t])?(s=i[t].indexOf(n))!=-1&&i[t].splice(s,1):i[t]=[i[t]],typeof r!="number"&&(r=e(n));var o=i[t];for(s=0;s<o.length;s++){var u=o[s],a=e(u);if(a>r)break}o.splice(s,0,n)}},this.addCommands=function(e){e&&Object.keys(e).forEach(function(t){var n=e[t];if(!n)return;if(typeof n=="string")return this.bindKey(n,t);typeof n=="function"&&(n={exec:n});if(typeof n!="object")return;n.name||(n.name=t),this.addCommand(n)},this)},this.removeCommands=function(e){Object.keys(e).forEach(function(t){this.removeCommand(e[t])},this)},this.bindKeys=function(e){Object.keys(e).forEach(function(t){this.bindKey(t,e[t])},this)},this._buildKeyHash=function(e){this.bindKey(e.bindKey,e)},this.parseKeys=function(e){var t=e.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(e){return e}),n=t.pop(),i=r[n];if(r.FUNCTION_KEYS[i])n=r.FUNCTION_KEYS[i].toLowerCase();else{if(!t.length)return{key:n,hashId:-1};if(t.length==1&&t[0]=="shift")return{key:n.toUpperCase(),hashId:-1}}var s=0;for(var o=t.length;o--;){var u=r.KEY_MODS[t[o]];if(u==null)return typeof console!="undefined"&&console.error("invalid modifier "+t[o]+" in "+e),!1;s|=u}return{key:n,hashId:s}},this.findKeyCommand=function(t,n){var r=s[t]+n;return this.commandKeyBinding[r]},this.handleKeyboard=function(e,t,n,r){if(r<0)return;var i=s[t]+n,o=this.commandKeyBinding[i];e.$keyChain&&(e.$keyChain+=" "+i,o=this.commandKeyBinding[e.$keyChain]||o);if(o)if(o=="chainKeys"||o[o.length-1]=="chainKeys")return e.$keyChain=e.$keyChain||i,{command:"null"};if(e.$keyChain)if(!!t&&t!=4||n.length!=1){if(t==-1||r>0)e.$keyChain=""}else e.$keyChain=e.$keyChain.slice(0,-i.length-1);return{command:o}},this.getStatusText=function(e,t){return t.$keyChain||""}}.call(o.prototype),t.HashHandler=o,t.MultiHashHandler=u}),ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("../keyboard/hash_handler").MultiHashHandler,s=e("../lib/event_emitter").EventEmitter,o=function(e,t){i.call(this,t,e),this.byName=this.commands,this.setDefaultHandler("exec",function(e){return e.command.exec(e.editor,e.args||{})})};r.inherits(o,i),function(){r.implement(this,s),this.exec=function(e,t,n){if(Array.isArray(e)){for(var r=e.length;r--;)if(this.exec(e[r],t,n))return!0;return!1}typeof e=="string"&&(e=this.commands[e]);if(!e)return!1;if(t&&t.$readOnly&&!e.readOnly)return!1;if(this.$checkCommandState!=0&&e.isAvailable&&!e.isAvailable(t))return!1;var i={editor:t,command:e,args:n};return i.returnValue=this._emit("exec",i),this._signal("afterExec",i),i.returnValue===!1?!1:!0},this.toggleRecording=function(e){if(this.$inReplay)return;return e&&e._emit("changeStatus"),this.recording?(this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},this.replay=function(e){if(this.$inReplay||!this.macro)return;if(this.recording)return this.toggleRecording(e);try{this.$inReplay=!0,this.macro.forEach(function(t){typeof t=="string"?this.exec(t,e):this.exec(t[0],e,t[1])},this)}finally{this.$inReplay=!1}},this.trimMacro=function(e){return e.map(function(e){return typeof e[0]!="string"&&(e[0]=e[0].name),e[1]||(e=e[0]),e})}}.call(o.prototype),t.CommandManager=o}),ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],function(e,t,n){"use strict";function o(e,t){return{win:e,mac:t}}var r=e("../lib/lang"),i=e("../config"),s=e("../range").Range;t.commands=[{name:"showSettingsMenu",description:"Show settings menu",bindKey:o("Ctrl-,","Command-,"),exec:function(e){i.loadModule("ace/ext/settings_menu",function(t){t.init(e),e.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",description:"Go to next error",bindKey:o("Alt-E","F4"),exec:function(e){i.loadModule("./ext/error_marker",function(t){t.showErrorMarker(e,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",description:"Go to previous error",bindKey:o("Alt-Shift-E","Shift-F4"),exec:function(e){i.loadModule("./ext/error_marker",function(t){t.showErrorMarker(e,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:o("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:o(null,"Ctrl-L"),exec:function(e){e.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:o("Ctrl-L","Command-L"),exec:function(e,t){typeof t=="number"&&!isNaN(t)&&e.gotoLine(t),e.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:o("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(e){e.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:o("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(e){e.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",description:"Toggle fold widget",bindKey:o("F2","F2"),exec:function(e){e.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",description:"Toggle parent fold widget",bindKey:o("Alt-F2","Alt-F2"),exec:function(e){e.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldAllComments",description:"Fold all comments",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAllComments()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:o("Alt-0","Command-Option-0"),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:o("Alt-Shift-0","Command-Option-Shift-0"),exec:function(e){e.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:o("Ctrl-K","Command-G"),exec:function(e){e.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:o("Ctrl-Shift-K","Command-Shift-G"),exec:function(e){e.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:o("Alt-K","Ctrl-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:o("Alt-Shift-K","Ctrl-Shift-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:o("Ctrl-F","Command-F"),exec:function(e){i.loadModule("ace/ext/searchbox",function(t){t.Search(e)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:o("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:o("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:o("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:o("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:o("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:o("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:o("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:o("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:o("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:o("Ctrl-Left","Option-Left"),exec:function(e){e.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:o("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:o("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:o("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:o("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:o("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:o("Ctrl-Right","Option-Right"),exec:function(e){e.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:o("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:o("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:o("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:o("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:o(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:o("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:o(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:o("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:o("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:o("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:o("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:o("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(e){e.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:o("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:o("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(e){e.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:o(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(e){},readOnly:!0},{name:"cut",description:"Cut",exec:function(e){var t=e.$copyWithEmptySelection&&e.selection.isEmpty(),n=t?e.selection.getLineRange():e.selection.getRange();e._emit("cut",n),n.isEmpty()||e.session.remove(n),e.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(e,t){e.$handlePaste(t)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:o("Ctrl-D","Command-D"),exec:function(e){e.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:o("Ctrl-Shift-D","Command-Shift-D"),exec:function(e){e.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:o("Ctrl-Alt-S","Command-Alt-S"),exec:function(e){e.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:o("Ctrl-/","Command-/"),exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:o("Ctrl-Shift-/","Command-Shift-/"),exec:function(e){e.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:o("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(e){e.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:o("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(e){e.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:o("Ctrl-H","Command-Option-F"),exec:function(e){i.loadModule("ace/ext/searchbox",function(t){t.Search(e,!0)})}},{name:"undo",description:"Undo",bindKey:o("Ctrl-Z","Command-Z"),exec:function(e){e.undo()}},{name:"redo",description:"Redo",bindKey:o("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(e){e.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:o("Alt-Shift-Up","Command-Option-Up"),exec:function(e){e.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:o("Alt-Up","Option-Up"),exec:function(e){e.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:o("Alt-Shift-Down","Command-Option-Down"),exec:function(e){e.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:o("Alt-Down","Option-Down"),exec:function(e){e.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:o("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(e){e.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:o("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(e){e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:o("Shift-Delete",null),exec:function(e){if(!e.selection.isEmpty())return!1;e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:o("Alt-Backspace","Command-Backspace"),exec:function(e){e.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:o("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(e){e.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:o("Ctrl-Shift-Backspace",null),exec:function(e){var t=e.selection.getRange();t.start.column=0,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:o("Ctrl-Shift-Delete",null),exec:function(e){var t=e.selection.getRange();t.end.column=Number.MAX_VALUE,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:o("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(e){e.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:o("Ctrl-Delete","Alt-Delete"),exec:function(e){e.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:o("Shift-Tab","Shift-Tab"),exec:function(e){e.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:o("Tab","Tab"),exec:function(e){e.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:o("Ctrl-[","Ctrl-["),exec:function(e){e.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:o("Ctrl-]","Ctrl-]"),exec:function(e){e.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(e,t){e.insert(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(e,t){e.insert(r.stringRepeat(t.text||"",t.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:o(null,"Ctrl-O"),exec:function(e){e.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:o("Alt-Shift-X","Ctrl-T"),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:o("Ctrl-U","Ctrl-U"),exec:function(e){e.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:o("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(e){e.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:o(null,null),exec:function(e){e.autoIndent()},multiSelectAction:"forEachLine",scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:o("Ctrl-Shift-L","Command-Shift-L"),exec:function(e){var t=e.selection.getRange();t.start.column=t.end.column=0,t.end.row++,e.selection.setRange(t,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",description:"Join lines",bindKey:o(null,null),exec:function(e){var t=e.selection.isBackwards(),n=t?e.selection.getSelectionLead():e.selection.getSelectionAnchor(),i=t?e.selection.getSelectionAnchor():e.selection.getSelectionLead(),o=e.session.doc.getLine(n.row).length,u=e.session.doc.getTextRange(e.selection.getRange()),a=u.replace(/\n\s*/," ").length,f=e.session.doc.getLine(n.row);for(var l=n.row+1;l<=i.row+1;l++){var c=r.stringTrimLeft(r.stringTrimRight(e.session.doc.getLine(l)));c.length!==0&&(c=" "+c),f+=c}i.row+1<e.session.doc.getLength()-1&&(f+=e.session.doc.getNewLineCharacter()),e.clearSelection(),e.session.doc.replace(new s(n.row,0,i.row+2,0),f),a>0?(e.selection.moveCursorTo(n.row,n.column),e.selection.selectTo(n.row,n.column+a)):(o=e.session.doc.getLine(n.row).length>o?o+1:o,e.selection.moveCursorTo(n.row,o))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:o(null,null),exec:function(e){var t=e.session.doc.getLength()-1,n=e.session.doc.getLine(t).length,r=e.selection.rangeList.ranges,i=[];r.length<1&&(r=[e.selection.getRange()]);for(var o=0;o<r.length;o++)o==r.length-1&&(r[o].end.row!==t||r[o].end.column!==n)&&i.push(new s(r[o].end.row,r[o].end.column,t,n)),o===0?(r[o].start.row!==0||r[o].start.column!==0)&&i.push(new s(0,0,r[o].start.row,r[o].start.column)):i.push(new s(r[o-1].end.row,r[o-1].end.column,r[o].start.row,r[o].start.column));e.exitMultiSelectMode(),e.clearSelection();for(var o=0;o<i.length;o++)e.selection.addRange(i[o],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",description:"Add new line after the current line",exec:function(e){e.selection.clearSelection(),e.navigateLineEnd(),e.insert("\n")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",description:"Add new line before the current line",exec:function(e){e.selection.clearSelection();var t=e.getCursorPosition();e.selection.moveTo(t.row-1,Number.MAX_VALUE),e.insert("\n"),t.row===0&&e.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",description:"Open command pallete",bindKey:o("F1","F1"),exec:function(e){e.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:o(null,null),exec:function(e){e.prompt({$type:"modes"})},readOnly:!0}];for(var u=1;u<9;u++)t.commands.push({name:"foldToLevel"+u,description:"Fold To Level "+u,level:u,exec:function(e){e.session.foldToLevel(this.level)},scrollIntoView:"center",readOnly:!0})}),ace.define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator","ace/clipboard"],function(e,t,n){"use strict";e("./lib/fixoldbrowsers");var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./lib/lang"),o=e("./lib/useragent"),u=e("./keyboard/textinput").TextInput,a=e("./mouse/mouse_handler").MouseHandler,f=e("./mouse/fold_handler").FoldHandler,l=e("./keyboard/keybinding").KeyBinding,c=e("./edit_session").EditSession,h=e("./search").Search,p=e("./range").Range,d=e("./lib/event_emitter").EventEmitter,v=e("./commands/command_manager").CommandManager,m=e("./commands/default_commands").commands,g=e("./config"),y=e("./token_iterator").TokenIterator,b=e("./clipboard"),w=function(e,t,n){this.$toDestroy=[];var r=e.getContainerElement();this.container=r,this.renderer=e,this.id="editor"+ ++w.$uid,this.commands=new v(o.isMac?"mac":"win",m),typeof document=="object"&&(this.textInput=new u(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new a(this),new f(this)),this.keyBinding=new l(this),this.$search=(new h).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=s.delayedCall(function(){this._signal("input",{}),this.session&&this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(e,t){t._$emitInputEvent.schedule(31)}),this.setSession(t||n&&n.session||new c("")),g.resetOptions(this),n&&this.setOptions(n),g._signal("editor",this)};w.$uid=0,function(){r.implement(this,d),this.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=s.delayedCall(this.endOperation.bind(this,!0)),this.on("change",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},this.endOperation=function(e){if(this.curOp&&this.session){if(e&&e.returnValue===!1||!this.session)return this.curOp=null;if(e==1&&this.curOp.command&&this.curOp.command.name=="mouse")return;this._signal("beforeEndOperation");if(!this.curOp)return;var t=this.curOp.command,n=t&&t.scrollIntoView;if(n){switch(n){case"center-animate":n="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var r=this.selection.getRange(),i=this.renderer.layerConfig;(r.start.row>=i.lastRow||r.end.row<=i.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead);break;default:}n=="animate"&&this.renderer.animateScrolling(this.curOp.scrollTop)}var s=this.selection.toJSON();this.curOp.selectionAfter=s,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(s),this.prevOp=this.curOp,this.curOp=null}},this.$mergeableCommands=["backspace","del","insertstring"],this.$historyTracker=function(e){if(!this.$mergeUndoDeltas)return;var t=this.prevOp,n=this.$mergeableCommands,r=t.command&&e.command.name==t.command.name;if(e.command.name=="insertstring"){var i=e.args;this.mergeNextCommand===undefined&&(this.mergeNextCommand=!0),r=r&&this.mergeNextCommand&&(!/\s/.test(i)||/\s/.test(t.args)),this.mergeNextCommand=!0}else r=r&&n.indexOf(e.command.name)!==-1;this.$mergeUndoDeltas!="always"&&Date.now()-this.sequenceStartTime>2e3&&(r=!1),r?this.session.mergeUndoDeltas=!0:n.indexOf(e.command.name)!==-1&&(this.sequenceStartTime=Date.now())},this.setKeyboardHandler=function(e,t){if(e&&typeof e=="string"&&e!="ace"){this.$keybindingId=e;var n=this;g.loadModule(["keybinding",e],function(r){n.$keybindingId==e&&n.keyBinding.setKeyboardHandler(r&&r.handler),t&&t()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(e),t&&t()},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){if(this.session==e)return;this.curOp&&this.endOperation(),this.curOp={};var t=this.session;if(t){this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange);var n=this.session.getSelection();n.off("changeCursor",this.$onCursorChange),n.off("changeSelection",this.$onSelectionChange)}this.session=e,e?(this.$onDocumentChange=this.onDocumentChange.bind(this),e.on("change",this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(e)),this._signal("changeSession",{session:e,oldSession:t}),this.curOp=null,t&&t._signal("changeEditor",{oldEditor:this}),e&&e._signal("changeEditor",{editor:this}),e&&e.bgTokenizer&&e.bgTokenizer.scheduleStart()},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?t==1?this.navigateFileEnd():t==-1&&this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption("fontSize")||i.computedStyle(this.container).fontSize},this.setFontSize=function(e){this.setOption("fontSize",e)},this.$highlightBrackets=function(){if(this.$highlightPending)return;var e=this;this.$highlightPending=!0,setTimeout(function(){e.$highlightPending=!1;var t=e.session;if(!t||!t.bgTokenizer)return;t.$bracketHighlight&&(t.$bracketHighlight.markerIds.forEach(function(e){t.removeMarker(e)}),t.$bracketHighlight=null);var n=t.getMatchingBracketRanges(e.getCursorPosition());!n&&t.$mode.getMatching&&(n=t.$mode.getMatching(e.session));if(!n)return;var r="ace_bracket";Array.isArray(n)?n.length==1&&(r="ace_error_bracket"):n=[n],n.length==2&&(p.comparePoints(n[0].end,n[1].start)==0?n=[p.fromPoints(n[0].start,n[1].end)]:p.comparePoints(n[0].start,n[1].end)==0&&(n=[p.fromPoints(n[1].start,n[0].end)])),t.$bracketHighlight={ranges:n,markerIds:n.map(function(e){return t.addMarker(e,r,"text")})}},50)},this.$highlightTags=function(){if(this.$highlightTagPending)return;var e=this;this.$highlightTagPending=!0,setTimeout(function(){e.$highlightTagPending=!1;var t=e.session;if(!t||!t.bgTokenizer)return;var n=e.getCursorPosition(),r=new y(e.session,n.row,n.column),i=r.getCurrentToken();if(!i||!/\b(?:tag-open|tag-name)/.test(i.type)){t.removeMarker(t.$tagHighlight),t.$tagHighlight=null;return}if(i.type.indexOf("tag-open")!==-1){i=r.stepForward();if(!i)return}var s=i.value,o=i.value,u=0,a=r.stepBackward();if(a.value==="<"){do a=i,i=r.stepForward(),i&&(i.type.indexOf("tag-name")!==-1?(o=i.value,s===o&&(a.value==="<"?u++:a.value==="</"&&u--)):s===o&&i.value==="/>"&&u--);while(i&&u>=0)}else{do{i=a,a=r.stepBackward();if(i)if(i.type.indexOf("tag-name")!==-1)s===i.value&&(a.value==="<"?u++:a.value==="</"&&u--);else if(i.value==="/>"){var f=0,l=a;while(l){if(l.type.indexOf("tag-name")!==-1&&l.value===s){u--;break}if(l.value==="<")break;l=r.stepBackward(),f++}for(var c=0;c<f;c++)r.stepForward()}}while(a&&u<=0);r.stepForward()}if(!i){t.removeMarker(t.$tagHighlight),t.$tagHighlight=null;return}var h=r.getCurrentTokenRow(),d=r.getCurrentTokenColumn(),v=new p(h,d,h,d+i.value.length),m=t.$backMarkers[t.$tagHighlight];t.$tagHighlight&&m!=undefined&&v.compareRange(m.range)!==0&&(t.removeMarker(t.$tagHighlight),t.$tagHighlight=null),t.$tagHighlight||(t.$tagHighlight=t.addMarker(v,"ace_bracket","text"))},50)},this.focus=function(){var e=this;setTimeout(function(){e.isFocused()||e.textInput.focus()}),this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){if(this.$isFocused)return;this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",e)},this.onBlur=function(e){if(!this.$isFocused)return;this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",e)},this.$cursorChange=function(){this.renderer.updateCursor(),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine()},this.onDocumentChange=function(e){var t=this.session.$useWrapMode,n=e.start.row==e.end.row?e.end.row:Infinity;this.renderer.updateLines(e.start.row,n,t),this._signal("change",e),this.$cursorChange()},this.onTokenizerUpdate=function(e){var t=e.data;this.renderer.updateLines(t.first,t.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var e=this.getSession(),t;if(this.$highlightActiveLine){if(this.$selectionStyle!="line"||!this.selection.isMultiLine())t=this.getCursorPosition();this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(t=!1),this.renderer.$maxLines&&this.session.getLength()===1&&!(this.renderer.$minLines>1)&&(t=!1)}if(e.$highlightLineMarker&&!t)e.removeMarker(e.$highlightLineMarker.id),e.$highlightLineMarker=null;else if(!e.$highlightLineMarker&&t){var n=new p(t.row,t.column,t.row,Infinity);n.id=e.addMarker(n,"ace_active-line","screenLine"),e.$highlightLineMarker=n}else t&&(e.$highlightLineMarker.start.row=t.row,e.$highlightLineMarker.end.row=t.row,e.$highlightLineMarker.start.column=t.column,e._signal("changeBackMarker"))},this.onSelectionChange=function(e){var t=this.session;t.$selectionMarker&&t.removeMarker(t.$selectionMarker),t.$selectionMarker=null;if(!this.selection.isEmpty()){var n=this.selection.getRange(),r=this.getSelectionStyle();t.$selectionMarker=t.addMarker(n,"ace_selection",r)}else this.$updateHighlightActiveLine();var i=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(i),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(t.isEmpty()||t.isMultiLine())return;var n=t.start.column,r=t.end.column,i=e.getLine(t.start.row),s=i.substring(n,r);if(s.length>5e3||!/[\w\d]/.test(s))return;var o=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:s}),u=i.substring(n-1,r+1);if(!o.test(u))return;return o},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText(),t=this.session.doc.getNewLineCharacter(),n=!1;if(!e&&this.$copyWithEmptySelection){n=!0;var r=this.selection.getAllRanges();for(var i=0;i<r.length;i++){var s=r[i];if(i&&r[i-1].start.row==s.start.row)continue;e+=this.session.getLine(s.start.row)+t}}var o={text:e};return this._signal("copy",o),b.lineMode=n?o.text:!1,o.text},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(e,t){var n={text:e,event:t};this.commands.exec("paste",this,n)},this.$handlePaste=function(e){typeof e=="string"&&(e={text:e}),this._signal("paste",e);var t=e.text,n=t===b.lineMode,r=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)n?r.insert({row:this.selection.lead.row,column:0},t):this.insert(t);else if(n)this.selection.rangeList.ranges.forEach(function(e){r.insert({row:e.start.row,column:0},t)});else{var i=t.split(/\r\n|\r|\n/),s=this.selection.rangeList.ranges,o=i.length==2&&(!i[0]||!i[1]);if(i.length!=s.length||o)return this.commands.exec("insertstring",this,t);for(var u=s.length;u--;){var a=s[u];a.isEmpty()||r.remove(a),r.insert(a.start,i[u])}}},this.execCommand=function(e,t){return this.commands.exec(e,this,t)},this.insert=function(e,t){var n=this.session,r=n.getMode(),i=this.getCursorPosition();if(this.getBehavioursEnabled()&&!t){var s=r.transformAction(n.getState(i.row),"insertion",this,n,e);s&&(e!==s.text&&(this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1)),e=s.text)}e=="	"&&(e=this.session.getTabString());if(!this.selection.isEmpty()){var o=this.getSelectionRange();i=this.session.remove(o),this.clearSelection()}else if(this.session.getOverwrite()&&e.indexOf("\n")==-1){var o=new p.fromPoints(i,i);o.end.column+=e.length,this.session.remove(o)}if(e=="\n"||e=="\r\n"){var u=n.getLine(i.row);if(i.column>u.search(/\S|$/)){var a=u.substr(i.column).search(/\S|$/);n.doc.removeInLine(i.row,i.column,i.column+a)}}this.clearSelection();var f=i.column,l=n.getState(i.row),u=n.getLine(i.row),c=r.checkOutdent(l,u,e);n.insert(i,e),s&&s.selection&&(s.selection.length==2?this.selection.setSelectionRange(new p(i.row,f+s.selection[0],i.row,f+s.selection[1])):this.selection.setSelectionRange(new p(i.row+s.selection[0],s.selection[1],i.row+s.selection[2],s.selection[3])));if(this.$enableAutoIndent){if(n.getDocument().isNewLine(e)){var h=r.getNextLineIndent(l,u.slice(0,i.column),n.getTabString());n.insert({row:i.row+1,column:0},h)}c&&r.autoOutdent(l,n,i.row)}},this.autoIndent=function(){var e=this.session,t=e.getMode(),n,r;if(this.selection.isEmpty())n=0,r=e.doc.getLength()-1;else{var i=this.getSelectionRange();n=i.start.row,r=i.end.row}var s="",o="",u="",a,f,l,c=e.getTabString();for(var h=n;h<=r;h++)h>0&&(s=e.getState(h-1),o=e.getLine(h-1),u=t.getNextLineIndent(s,o,c)),a=e.getLine(h),f=t.$getIndent(a),u!==f&&(f.length>0&&(l=new p(h,0,h,f.length),e.remove(l)),u.length>0&&e.insert({row:h,column:0},u)),t.autoOutdent(s,e,h)},this.onTextInput=function(e,t){if(!t)return this.keyBinding.onTextInput(e);this.startOperation({command:{name:"insertstring"}});var n=this.applyComposition.bind(this,e,t);this.selection.rangeCount?this.forEachSelection(n):n(),this.endOperation()},this.applyComposition=function(e,t){if(t.extendLeft||t.extendRight){var n=this.selection.getRange();n.start.column-=t.extendLeft,n.end.column+=t.extendRight,n.start.column<0&&(n.start.row--,n.start.column+=this.session.getLine(n.start.row).length+1),this.selection.setRange(n),!e&&!n.isEmpty()&&this.remove()}(e||!this.selection.isEmpty())&&this.insert(e,!0);if(t.restoreStart||t.restoreEnd){var n=this.selection.getRange();n.start.column-=t.restoreStart,n.end.column-=t.restoreEnd,this.selection.setRange(n)}},this.onCommandKey=function(e,t,n){return this.keyBinding.onCommandKey(e,t,n)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption("scrollSpeed",e)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(e){this.setOption("dragDelay",e)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(e){this.setOption("selectionStyle",e)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(e){this.setOption("highlightActiveLine",e)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(e){this.setOption("highlightSelectedWord",e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption("readOnly",e)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(e){this.setOption("behavioursEnabled",e)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(e){this.setOption("wrapBehavioursEnabled",e)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(e){this.setOption("showFoldWidgets",e)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(e){this.selection.isEmpty()&&(e=="left"?this.selection.selectLeft():this.selection.selectRight());var t=this.getSelectionRange();if(this.getBehavioursEnabled()){var n=this.session,r=n.getState(t.start.row),i=n.getMode().transformAction(r,"deletion",this,n,t);if(t.end.column===0){var s=n.getTextRange(t);if(s[s.length-1]=="\n"){var o=n.getLine(t.end.row);/^\s+$/.test(o)&&(t.end.column=o.length)}}i&&(t=i)}this.session.remove(t),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&&e.start.row==e.end.row&&(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(e)},this.transposeLetters=function(){if(!this.selection.isEmpty())return;var e=this.getCursorPosition(),t=e.column;if(t===0)return;var n=this.session.getLine(e.row),r,i;t<n.length?(r=n.charAt(t)+n.charAt(t-1),i=new p(e.row,t-1,e.row,t+1)):(r=n.charAt(t-1)+n.charAt(t-2),i=new p(e.row,t-2,e.row,t)),this.session.replace(i,r),this.session.selection.moveToPosition(i.end)},this.toLowerCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(t.start.row<t.end.row){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,"	");return}if(t.start.column<t.end.column){var r=e.getTextRange(t);if(!/^\s+$/.test(r)){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,"	");return}}var i=e.getLine(t.start.row),o=t.start,u=e.getTabSize(),a=e.documentToScreenColumn(o.row,o.column);if(this.session.getUseSoftTabs())var f=u-a%u,l=s.stringRepeat(" ",f);else{var f=a%u;while(i[t.start.column-1]==" "&&f)t.start.column--,f--;this.selection.setSelectionRange(t),l="	"}return this.insert(l)},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,"	")},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){var e=this.$getSelectedRows(),t=this.session,n=[];for(var r=e.first;r<=e.last;r++)n.push(t.getLine(r));n.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});var i=new p(0,0,0,0);for(var r=e.first;r<=e.last;r++){var s=t.getLine(r);i.start.row=r,i.end.row=r,i.end.column=s.length,t.replace(i,n[r-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),n=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,n,e)},this.getNumberAt=function(e,t){var n=/[\-]?[0-9]+(?:\.[0-9]+)?/g;n.lastIndex=0;var r=this.session.getLine(e);while(n.lastIndex<t){var i=n.exec(r);if(i.index<=t&&i.index+i[0].length>=t){var s={value:i[0],start:i.index,end:i.index+i[0].length};return s}}return null},this.modifyNumber=function(e){var t=this.selection.getCursor().row,n=this.selection.getCursor().column,r=new p(t,n-1,t,n),i=this.session.getTextRange(r);if(!isNaN(parseFloat(i))&&isFinite(i)){var s=this.getNumberAt(t,n);if(s){var o=s.value.indexOf(".")>=0?s.start+s.value.indexOf(".")+1:s.end,u=s.start+s.value.length-o,a=parseFloat(s.value);a*=Math.pow(10,u),o!==s.end&&n<o?e*=Math.pow(10,s.end-n-1):e*=Math.pow(10,s.end-n),a+=e,a/=Math.pow(10,u);var f=a.toFixed(u),l=new p(t,s.start,t,s.end);this.session.replace(l,f),this.moveCursorTo(t,Math.max(s.start+1,n+f.length-s.value.length))}}else this.toggleWord()},this.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],this.toggleWord=function(){var e=this.selection.getCursor().row,t=this.selection.getCursor().column;this.selection.selectWord();var n=this.getSelectedText(),r=this.selection.getWordRange().start.column,i=n.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),o=t-r-1;o<0&&(o=0);var u=0,a=0,f=this;n.match(/[A-Za-z0-9_]+/)&&i.forEach(function(t,i){a=u+t.length,o>=u&&o<=a&&(n=t,f.selection.clearSelection(),f.moveCursorTo(e,u+r),f.selection.selectTo(e,a+r)),u=a});var l=this.$toggleWordPairs,c;for(var h=0;h<l.length;h++){var p=l[h];for(var d=0;d<=1;d++){var v=+!d,m=n.match(new RegExp("^\\s?_?("+s.escapeRegExp(p[d])+")\\s?$","i"));if(m){var g=n.match(new RegExp("([_]|^|\\s)("+s.escapeRegExp(m[1])+")($|\\s)","g"));g&&(c=n.replace(new RegExp(s.escapeRegExp(p[d]),"i"),function(e){var t=p[v];return e.toUpperCase()==e?t=t.toUpperCase():e.charAt(0).toUpperCase()==e.charAt(0)&&(t=t.substr(0,0)+p[v].charAt(0).toUpperCase()+t.substr(1)),t}),this.insert(c),c="")}}}},this.removeLines=function(){var e=this.$getSelectedRows();this.session.removeFullLines(e.first,e.last),this.clearSelection()},this.duplicateSelection=function(){var e=this.selection,t=this.session,n=e.getRange(),r=e.isBackwards();if(n.isEmpty()){var i=n.start.row;t.duplicateLines(i,i)}else{var s=r?n.start:n.end,o=t.insert(s,t.getTextRange(n),!1);n.start=s,n.end=o,e.setSelectionRange(n,r)}},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(e,t,n){return this.session.moveText(e,t,n)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(e,t){var n,r,i=this.selection;if(!i.inMultiSelectMode||this.inVirtualSelectionMode){var s=i.toOrientedRange();n=this.$getSelectedRows(s),r=this.session.$moveLines(n.first,n.last,t?0:e),t&&e==-1&&(r=0),s.moveBy(r,0),i.fromOrientedRange(s)}else{var o=i.rangeList.ranges;i.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;var u=0,a=0,f=o.length;for(var l=0;l<f;l++){var c=l;o[l].moveBy(u,0),n=this.$getSelectedRows(o[l]);var h=n.first,p=n.last;while(++l<f){a&&o[l].moveBy(a,0);var d=this.$getSelectedRows(o[l]);if(t&&d.first!=p)break;if(!t&&d.first>p+1)break;p=d.last}l--,u=this.session.$moveLines(h,p,t?0:e),t&&e==-1&&(c=l+1);while(c<=l)o[c].moveBy(u,0),c++;t||(u=0),a+=u}i.fromOrientedRange(i.ranges[0]),i.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(e){return e=(e||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(e)},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var n=this.renderer,r=this.renderer.layerConfig,i=e*Math.floor(r.height/r.lineHeight);t===!0?this.selection.$moveSelection(function(){this.moveCursorBy(i,0)}):t===!1&&(this.selection.moveCursorBy(i,0),this.selection.clearSelection());var s=n.scrollTop;n.scrollBy(0,i*r.lineHeight),t!=null&&n.scrollCursorIntoView(null,.5),n.animateScrolling(s)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,n,r){this.renderer.scrollToLine(e,t,n,r)},this.centerSelection=function(){var e=this.getSelectionRange(),t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(t,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.selection.selectAll()},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e,t){var n=this.getCursorPosition(),r=new y(this.session,n.row,n.column),i=r.getCurrentToken(),s=i||r.stepForward();if(!s)return;var o,u=!1,a={},f=n.column-s.start,l,c={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(s.value.match(/[{}()\[\]]/g))for(;f<s.value.length&&!u;f++){if(!c[s.value[f]])continue;l=c[s.value[f]]+"."+s.type.replace("rparen","lparen"),isNaN(a[l])&&(a[l]=0);switch(s.value[f]){case"(":case"[":case"{":a[l]++;break;case")":case"]":case"}":a[l]--,a[l]===-1&&(o="bracket",u=!0)}}else s.type.indexOf("tag-name")!==-1&&(isNaN(a[s.value])&&(a[s.value]=0),i.value==="<"?a[s.value]++:i.value==="</"&&a[s.value]--,a[s.value]===-1&&(o="tag",u=!0));u||(i=s,s=r.stepForward(),f=0)}while(s&&!u);if(!o)return;var h,d;if(o==="bracket"){h=this.session.getBracketRange(n);if(!h){h=new p(r.getCurrentTokenRow(),r.getCurrentTokenColumn()+f-1,r.getCurrentTokenRow(),r.getCurrentTokenColumn()+f-1),d=h.start;if(t||d.row===n.row&&Math.abs(d.column-n.column)<2)h=this.session.getBracketRange(d)}}else if(o==="tag"){if(!s||s.type.indexOf("tag-name")===-1)return;var v=s.value;h=new p(r.getCurrentTokenRow(),r.getCurrentTokenColumn()-2,r.getCurrentTokenRow(),r.getCurrentTokenColumn()-2);if(h.compare(n.row,n.column)===0){u=!1;do s=i,i=r.stepBackward(),i&&(i.type.indexOf("tag-close")!==-1&&h.setEnd(r.getCurrentTokenRow(),r.getCurrentTokenColumn()+1),s.value===v&&s.type.indexOf("tag-name")!==-1&&(i.value==="<"?a[v]++:i.value==="</"&&a[v]--,a[v]===0&&(u=!0)));while(i&&!u)}s&&s.type.indexOf("tag-name")&&(d=h.start,d.row==n.row&&Math.abs(d.column-n.column)<2&&(d=h.end))}d=h&&h.cursor||d,d&&(e?h&&t?this.selection.setRange(h):h&&h.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(d.row,d.column):this.selection.moveTo(d.row,d.column))},this.gotoLine=function(e,t,n){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,n)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorLeft()}this.clearSelection()},this.navigateRight=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorRight()}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&&this.$search.set(t);var n=this.$search.find(this.session),r=0;return n?(this.$tryReplace(n,e)&&(r=1),this.selection.setSelectionRange(n),this.renderer.scrollSelectionIntoView(n.start,n.end),r):r},this.replaceAll=function(e,t){t&&this.$search.set(t);var n=this.$search.findAll(this.session),r=0;if(!n.length)return r;var i=this.getSelectionRange();this.selection.moveTo(0,0);for(var s=n.length-1;s>=0;--s)this.$tryReplace(n[s],e)&&r++;return this.selection.setSelectionRange(i),r},this.$tryReplace=function(e,t){var n=this.session.getTextRange(e);return t=this.$search.replace(n,t),t!==null?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,n){t||(t={}),typeof e=="string"||e instanceof RegExp?t.needle=e:typeof e=="object"&&r.mixin(t,e);var i=this.selection.getRange();t.needle==null&&(e=this.session.getTextRange(i)||this.$search.$options.needle,e||(i=this.session.getWordRange(i.start.row,i.start.column),e=this.session.getTextRange(i)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:i});var s=this.$search.find(this.session);if(t.preventScroll)return s;if(s)return this.revealRange(s,n),s;t.backwards?i.start=i.end:i.end=i.start,this.selection.setRange(i)},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.session.unfold(e),this.selection.setSelectionRange(e);var n=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),t!==!1&&this.renderer.animateScrolling(n)},this.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.$toDestroy&&(this.$toDestroy.forEach(function(e){e.destroy()}),this.$toDestroy=null),this.$mouseHandler&&this.$mouseHandler.destroy(),this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy(),this._$emitInputEvent&&this._$emitInputEvent.cancel(),this.removeAllListeners()},this.setAutoScrollEditorIntoView=function(e){if(!e)return;var t,n=this,r=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var i=this.$scrollAnchor;i.style.cssText="position:absolute",this.container.insertBefore(i,this.container.firstChild);var s=this.on("changeSelection",function(){r=!0}),o=this.renderer.on("beforeRender",function(){r&&(t=n.renderer.container.getBoundingClientRect())}),u=this.renderer.on("afterRender",function(){if(r&&t&&(n.isFocused()||n.searchBox&&n.searchBox.isFocused())){var e=n.renderer,s=e.$cursorLayer.$pixelPos,o=e.layerConfig,u=s.top-o.offset;s.top>=0&&u+t.top<0?r=!0:s.top<o.height&&s.top+t.top+o.lineHeight>window.innerHeight?r=!1:r=null,r!=null&&(i.style.top=u+"px",i.style.left=s.left+"px",i.style.height=o.lineHeight+"px",i.scrollIntoView(r)),r=t=null}});this.setAutoScrollEditorIntoView=function(e){if(e)return;delete this.setAutoScrollEditorIntoView,this.off("changeSelection",s),this.renderer.off("afterRender",u),this.renderer.off("beforeRender",o)}},this.$resetCursorStyle=function(){var e=this.$cursorStyle||"ace",t=this.renderer.$cursorLayer;if(!t)return;t.setSmoothBlinking(/smooth/.test(e)),t.isBlinking=!this.$readOnly&&e!="wide",i.setCssClass(t.element,"ace_slim-cursors",/slim/.test(e))},this.prompt=function(e,t,n){var r=this;g.loadModule("./ext/prompt",function(i){i.prompt(r,e,t,n)})}}.call(w.prototype),g.defineOptions(w.prototype,"editor",{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:e})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(e){this.textInput.setCopyWithEmptySelection(e)},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},keyboardHandler:{set:function(e){this.setKeyboardHandler(e)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(e){this.session.setValue(e)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(e){this.setSession(e)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(e){this.renderer.$gutterLayer.setShowLineNumbers(e),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),e&&this.$relativeLineNumbers?E.attach(this):E.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(e){this.$showLineNumbers&&e?E.attach(this):E.detach(this)}},placeholder:{set:function(e){this.$updatePlaceholder||(this.$updatePlaceholder=function(){var e=this.session&&(this.renderer.$composition||this.getValue());if(e&&this.renderer.placeholderNode)this.renderer.off("afterRender",this.$updatePlaceholder),i.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null;else if(!e&&!this.renderer.placeholderNode){this.renderer.on("afterRender",this.$updatePlaceholder),i.addCssClass(this.container,"ace_hasPlaceholder");var t=i.createElement("div");t.className="ace_placeholder",t.textContent=this.$placeholder||"",this.renderer.placeholderNode=t,this.renderer.content.appendChild(this.renderer.placeholderNode)}else!e&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||"")}.bind(this),this.on("input",this.$updatePlaceholder)),this.$updatePlaceholder()}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var E={getText:function(e,t){return(Math.abs(e.selection.lead.row-t)||t+1+(t<9?"\u00b7":""))+""},getWidth:function(e,t,n){return Math.max(t.toString().length,(n.lastRow+1).toString().length,2)*n.characterWidth},update:function(e,t){t.renderer.$loop.schedule(t.renderer.CHANGE_GUTTER)},attach:function(e){e.renderer.$gutterLayer.$renderer=this,e.on("changeSelection",this.update),this.update(null,e)},detach:function(e){e.renderer.$gutterLayer.$renderer==this&&(e.renderer.$gutterLayer.$renderer=null),e.off("changeSelection",this.update),this.update(null,e)}};t.Editor=w}),ace.define("ace/undomanager",["require","exports","module","ace/range"],function(e,t,n){"use strict";function i(e,t){for(var n=t;n--;){var r=e[n];if(r&&!r[0].ignore){while(n<t-1){var i=d(e[n],e[n+1]);e[n]=i[0],e[n+1]=i[1],n++}return!0}}}function a(e){var t=e.action=="insert",n=e.start,r=e.end,i=(r.row-n.row)*(t?1:-1),s=(r.column-n.column)*(t?1:-1);t&&(r=n);for(var o in this.marks){var a=this.marks[o],f=u(a,n);if(f<0)continue;if(f===0&&t){if(a.bias!=1){a.bias==-1;continue}f=1}var l=t?f:u(a,r);if(l>0){a.row+=i,a.column+=a.row==r.row?s:0;continue}!t&&l<=0&&(a.row=n.row,a.column=n.column,l===0&&(a.bias=1))}}function f(e){return{row:e.row,column:e.column}}function l(e){return{start:f(e.start),end:f(e.end),action:e.action,lines:e.lines.slice()}}function c(e){e=e||this;if(Array.isArray(e))return e.map(c).join("\n");var t="";e.action?(t=e.action=="insert"?"+":"-",t+="["+e.lines+"]"):e.value&&(Array.isArray(e.value)?t=e.value.map(h).join("\n"):t=h(e.value)),e.start&&(t+=h(e));if(e.id||e.rev)t+="	("+(e.id||e.rev)+")";return t}function h(e){return e.start.row+":"+e.start.column+"=>"+e.end.row+":"+e.end.column}function p(e,t){var n=e.action=="insert",r=t.action=="insert";if(n&&r)if(o(t.start,e.end)>=0)m(t,e,-1);else{if(!(o(t.start,e.start)<=0))return null;m(e,t,1)}else if(n&&!r)if(o(t.start,e.end)>=0)m(t,e,-1);else{if(!(o(t.end,e.start)<=0))return null;m(e,t,-1)}else if(!n&&r)if(o(t.start,e.start)>=0)m(t,e,1);else{if(!(o(t.start,e.start)<=0))return null;m(e,t,1)}else if(!n&&!r)if(o(t.start,e.start)>=0)m(t,e,1);else{if(!(o(t.end,e.start)<=0))return null;m(e,t,-1)}return[t,e]}function d(e,t){for(var n=e.length;n--;)for(var r=0;r<t.length;r++)if(!p(e[n],t[r])){while(n<e.length){while(r--)p(t[r],e[n]);r=t.length,n++}return[e,t]}return e.selectionBefore=t.selectionBefore=e.selectionAfter=t.selectionAfter=null,[t,e]}function v(e,t){var n=e.action=="insert",r=t.action=="insert";if(n&&r)o(e.start,t.start)<0?m(t,e,1):m(e,t,1);else if(n&&!r)o(e.start,t.end)>=0?m(e,t,-1):o(e.start,t.start)<=0?m(t,e,1):(m(e,s.fromPoints(t.start,e.start),-1),m(t,e,1));else if(!n&&r)o(t.start,e.end)>=0?m(t,e,-1):o(t.start,e.start)<=0?m(e,t,1):(m(t,s.fromPoints(e.start,t.start),-1),m(e,t,1));else if(!n&&!r)if(o(t.start,e.end)>=0)m(t,e,-1);else{if(!(o(t.end,e.start)<=0)){var i,u;return o(e.start,t.start)<0&&(i=e,e=y(e,t.start)),o(e.end,t.end)>0&&(u=y(e,t.end)),g(t.end,e.start,e.end,-1),u&&!i&&(e.lines=u.lines,e.start=u.start,e.end=u.end,u=e),[t,i,u].filter(Boolean)}m(e,t,-1)}return[t,e]}function m(e,t,n){g(e.start,t.start,t.end,n),g(e.end,t.start,t.end,n)}function g(e,t,n,r){e.row==(r==1?t:n).row&&(e.column+=r*(n.column-t.column)),e.row+=r*(n.row-t.row)}function y(e,t){var n=e.lines,r=e.end;e.end=f(t);var i=e.end.row-e.start.row,s=n.splice(i,n.length),o=i?t.column:t.column-e.start.column;n.push(s[0].substring(0,o)),s[0]=s[0].substr(o);var u={start:f(t),end:r,lines:s,action:e.action};return u}function b(e,t){t=l(t);for(var n=e.length;n--;){var r=e[n];for(var i=0;i<r.length;i++){var s=r[i],o=v(s,t);t=o[0],o.length!=2&&(o[2]?(r.splice(i+1,1,o[1],o[2]),i++):o[1]||(r.splice(i,1),i--))}r.length||e.splice(n,1)}return e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];for(var i=0;i<r.length;i++)b(e,r[i])}}var r=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(e){this.$session=e},this.add=function(e,t,n){if(this.$fromUndo)return;if(e==this.$lastDelta)return;this.$keepRedoStack||(this.$redoStack.length=0);if(t===!1||!this.lastDeltas)this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),e.id=this.$rev=++this.$maxRev;if(e.action=="remove"||e.action=="insert")this.$lastDelta=e;this.lastDeltas.push(e)},this.addSelection=function(e,t){this.selections.push({value:e,rev:t||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(e,t){t==null&&(t=this.$rev+1);var n=this.$undoStack;for(var r=n.length;r--;){var i=n[r][0];if(i.id<=e)break;i.id<t&&(i.ignore=!0)}this.lastDeltas=null},this.getSelection=function(e,t){var n=this.selections;for(var r=n.length;r--;){var i=n[r];if(i.rev<e)return t&&(i=n[r+1]),i}},this.getRevision=function(){return this.$rev},this.getDeltas=function(e,t){t==null&&(t=this.$rev+1);var n=this.$undoStack,r=null,i=0;for(var s=n.length;s--;){var o=n[s][0];o.id<t&&!r&&(r=s+1);if(o.id<=e){i=s+1;break}}return n.slice(i,r)},this.getChangedRanges=function(e,t){t==null&&(t=this.$rev+1)},this.getChangedLines=function(e,t){t==null&&(t=this.$rev+1)},this.undo=function(e,t){this.lastDeltas=null;var n=this.$undoStack;if(!i(n,n.length))return;e||(e=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var r=n.pop(),s=null;return r&&(s=e.undoChanges(r,t),this.$redoStack.push(r),this.$syncRev()),this.$fromUndo=!1,s},this.redo=function(e,t){this.lastDeltas=null,e||(e=this.$session),this.$fromUndo=!0;if(this.$redoStackBaseRev!=this.$rev){var n=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);w(this.$redoStack,n),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(e){e[0].id=++this.$maxRev},this)}var r=this.$redoStack.pop(),i=null;return r&&(i=e.redoChanges(r,t),this.$undoStack.push(r),this.$syncRev()),this.$fromUndo=!1,i},this.$syncRev=function(){var e=this.$undoStack,t=e[e.length-1],n=t&&t[0].id||0;this.$redoStackBaseRev=n,this.$rev=n},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length>0},this.canRedo=function(){return this.$redoStack.length>0},this.bookmark=function(e){e==undefined&&(e=this.$rev),this.mark=e},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(e){return e?c(e):c(this.$undoStack)+"\n---\n"+c(this.$redoStack)}}).call(r.prototype);var s=e("./range").Range,o=s.comparePoints,u=s.comparePoints;t.UndoManager=r}),ace.define("ace/layer/lines",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";var r=e("../lib/dom"),i=function(e,t){this.element=e,this.canvasHeight=t||5e5,this.element.style.height=this.canvasHeight*2+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0};(function(){this.moveContainer=function(e){r.translate(this.element,0,-(e.firstRowScreen*e.lineHeight%this.canvasHeight)-e.offset*this.$offsetCoefficient)},this.pageChanged=function(e,t){return Math.floor(e.firstRowScreen*e.lineHeight/this.canvasHeight)!==Math.floor(t.firstRowScreen*t.lineHeight/this.canvasHeight)},this.computeLineTop=function(e,t,n){var r=t.firstRowScreen*t.lineHeight,i=Math.floor(r/this.canvasHeight),s=n.documentToScreenRow(e,0)*t.lineHeight;return s-i*this.canvasHeight},this.computeLineHeight=function(e,t,n){return t.lineHeight*n.getRowLineCount(e)},this.getLength=function(){return this.cells.length},this.get=function(e){return this.cells[e]},this.shift=function(){this.$cacheCell(this.cells.shift())},this.pop=function(){this.$cacheCell(this.cells.pop())},this.push=function(e){if(Array.isArray(e)){this.cells.push.apply(this.cells,e);var t=r.createFragment(this.element);for(var n=0;n<e.length;n++)t.appendChild(e[n].element);this.element.appendChild(t)}else this.cells.push(e),this.element.appendChild(e.element)},this.unshift=function(e){if(Array.isArray(e)){this.cells.unshift.apply(this.cells,e);var t=r.createFragment(this.element);for(var n=0;n<e.length;n++)t.appendChild(e[n].element);this.element.firstChild?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}else this.cells.unshift(e),this.element.insertAdjacentElement("afterbegin",e.element)},this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},this.$cacheCell=function(e){if(!e)return;e.element.remove(),this.cellCache.push(e)},this.createCell=function(e,t,n,i){var s=this.cellCache.pop();if(!s){var o=r.createElement("div");i&&i(o),this.element.appendChild(o),s={element:o,text:"",row:e}}return s.row=e,s}}).call(i.prototype),t.Lines=i}),ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/layer/lines"],function(e,t,n){"use strict";function f(e){var t=document.createTextNode("");e.appendChild(t);var n=r.createElement("span");return e.appendChild(n),e}var r=e("../lib/dom"),i=e("../lib/oop"),s=e("../lib/lang"),o=e("../lib/event_emitter").EventEmitter,u=e("./lines").Lines,a=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_gutter-layer",e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new u(this.element),this.$lines.$offsetCoefficient=1};(function(){i.implement(this,o),this.setSession=function(e){this.session&&this.session.off("change",this.$updateAnnotations),this.session=e,e&&e.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t<e.length;t++){var n=e[t],r=n.row,i=this.$annotations[r];i||(i=this.$annotations[r]={text:[]});var o=n.text;o=o?s.escapeHTML(o):n.html||"",i.text.indexOf(o)===-1&&i.text.push(o);var u=n.type;u=="error"?i.className=" ace_error":u=="warning"&&i.className!=" ace_error"?i.className=" ace_warning":u=="info"&&!i.className&&(i.className=" ace_info")}},this.$updateAnnotations=function(e){if(!this.$annotations.length)return;var t=e.start.row,n=e.end.row-t;if(n!==0)if(e.action=="remove")this.$annotations.splice(t,n+1,null);else{var r=new Array(n+1);r.unshift(t,1),this.$annotations.splice.apply(this.$annotations,r)}},this.update=function(e){this.config=e;var t=this.session,n=e.firstRow,r=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1);this.oldLastRow=r,this.config=e,this.$lines.moveContainer(e),this.$updateCursorRow();var i=t.getNextFoldLine(n),s=i?i.start.row:Infinity,o=null,u=-1,a=n;for(;;){a>s&&(a=i.end.row+1,i=t.getNextFoldLine(a,i),s=i?i.start.row:Infinity);if(a>r){while(this.$lines.getLength()>u+1)this.$lines.pop();break}o=this.$lines.get(++u),o?o.row=a:(o=this.$lines.createCell(a,e,this.session,f),this.$lines.push(o)),this.$renderCell(o,e,i,a),a++}this._signal("afterRender"),this.$updateGutterWidth(e)},this.$updateGutterWidth=function(e){var t=this.session,n=t.gutterRenderer||this.$renderer,r=t.$firstLineNumber,i=this.$lines.last()?this.$lines.last().text:"";if(this.$fixedWidth||t.$useWrapMode)i=t.getLength()+r-1;var s=n?n.getWidth(t,i,e):i.toString().length*e.characterWidth,o=this.$padding||this.$computePadding();s+=o.left+o.right,s!==this.gutterWidth&&!isNaN(s)&&(this.gutterWidth=s,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",s))},this.$updateCursorRow=function(){if(!this.$highlightGutterLine)return;var e=this.session.selection.getCursor();if(this.$cursorRow===e.row)return;this.$cursorRow=e.row},this.updateLineHighlight=function(){if(!this.$highlightGutterLine)return;var e=this.session.selection.cursor.row;this.$cursorRow=e;if(this.$cursorCell&&this.$cursorCell.row==e)return;this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var t=this.$lines.cells;this.$cursorCell=null;for(var n=0;n<t.length;n++){var r=t[n];if(r.row>=this.$cursorRow){if(r.row>this.$cursorRow){var i=this.session.getFoldLine(this.$cursorRow);if(!(n>0&&i&&i.start.row==t[n-1].row))break;r=t[n-1]}r.element.className="ace_gutter-active-line "+r.element.className,this.$cursorCell=r;break}}},this.scrollLines=function(e){var t=this.config;this.config=e,this.$updateCursorRow();if(this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=Math.min(e.lastRow+e.gutterOffset,this.session.getLength()-1),r=this.oldLastRow;this.oldLastRow=n;if(!t||r<e.firstRow)return this.update(e);if(n<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var i=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);i>0;i--)this.$lines.shift();if(r>n)for(var i=this.session.getFoldedRowCount(n+1,r);i>0;i--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLines(e,e.firstRow,t.firstRow-1)),n>r&&this.$lines.push(this.$renderLines(e,r+1,n)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(e)},this.$renderLines=function(e,t,n){var r=[],i=t,s=this.session.getNextFoldLine(i),o=s?s.start.row:Infinity;for(;;){i>o&&(i=s.end.row+1,s=this.session.getNextFoldLine(i,s),o=s?s.start.row:Infinity);if(i>n)break;var u=this.$lines.createCell(i,e,this.session,f);this.$renderCell(u,e,s,i),r.push(u),i++}return r},this.$renderCell=function(e,t,n,i){var s=e.element,o=this.session,u=s.childNodes[0],a=s.childNodes[1],f=o.$firstLineNumber,l=o.$breakpoints,c=o.$decorations,h=o.gutterRenderer||this.$renderer,p=this.$showFoldWidgets&&o.foldWidgets,d=n?n.start.row:Number.MAX_VALUE,v="ace_gutter-cell ";this.$highlightGutterLine&&(i==this.$cursorRow||n&&i<this.$cursorRow&&i>=d&&this.$cursorRow<=n.end.row)&&(v+="ace_gutter-active-line ",this.$cursorCell!=e&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=e)),l[i]&&(v+=l[i]),c[i]&&(v+=c[i]),this.$annotations[i]&&(v+=this.$annotations[i].className),s.className!=v&&(s.className=v);if(p){var m=p[i];m==null&&(m=p[i]=o.getFoldWidget(i))}if(m){var v="ace_fold-widget ace_"+m;m=="start"&&i==d&&i<n.end.row?v+=" ace_closed":v+=" ace_open",a.className!=v&&(a.className=v);var g=t.lineHeight+"px";r.setStyle(a.style,"height",g),r.setStyle(a.style,"display","inline-block")}else a&&r.setStyle(a.style,"display","none");var y=(h?h.getText(o,i):i+f).toString();return y!==u.data&&(u.data=y),r.setStyle(e.element.style,"height",this.$lines.computeLineHeight(i,t,o)+"px"),r.setStyle(e.element.style,"top",this.$lines.computeLineTop(i,t,o)+"px"),e.text=y,e},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer="",this.setHighlightGutterLine=function(e){this.$highlightGutterLine=e},this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(e){this.$renderer=!e&&{getWidth:function(){return 0},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?r.addCssClass(this.element,"ace_folding-enabled"):r.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=r.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(e.borderLeftWidth)||0)+(parseInt(e.paddingLeft)||0)+1,this.$padding.right=(parseInt(e.borderRightWidth)||0)+(parseInt(e.paddingRight)||0),this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),n=this.element.getBoundingClientRect();if(e.x<t.left+n.left)return"markers";if(this.$showFoldWidgets&&e.x>n.right-t.right)return"foldWidgets"}}).call(a.prototype),t.Gutter=a}),ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(e,t,n){"use strict";var r=e("../range").Range,i=e("../lib/dom"),s=function(e){this.element=i.createElement("div"),this.element.className="ace_layer ace_marker-layer",e.appendChild(this.element)};(function(){function e(e,t,n,r){return(e?1:0)|(t?2:0)|(n?4:0)|(r?8:0)}this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.elt=function(e,t){var n=this.i!=-1&&this.element.childNodes[this.i];n?this.i++:(n=document.createElement("div"),this.element.appendChild(n),this.i=-1),n.style.cssText=t,n.className=e},this.update=function(e){if(!e)return;this.config=e,this.i=0;var t;for(var n in this.markers){var r=this.markers[n];if(!r.range){r.update(t,this,this.session,e);continue}var i=r.range.clipRows(e.firstRow,e.lastRow);if(i.isEmpty())continue;i=i.toScreenRange(this.session);if(r.renderer){var s=this.$getTop(i.start.row,e),o=this.$padding+i.start.column*e.characterWidth;r.renderer(t,i,o,s,e)}else r.type=="fullLine"?this.drawFullLineMarker(t,i,r.clazz,e):r.type=="screenLine"?this.drawScreenLineMarker(t,i,r.clazz,e):i.isMultiLine()?r.type=="text"?this.drawTextMarker(t,i,r.clazz,e):this.drawMultiLineMarker(t,i,r.clazz,e):this.drawSingleLineMarker(t,i,r.clazz+" ace_start"+" ace_br15",e)}if(this.i!=-1)while(this.i<this.element.childElementCount)this.element.removeChild(this.element.lastChild)},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(t,n,i,s,o){var u=this.session,a=n.start.row,f=n.end.row,l=a,c=0,h=0,p=u.getScreenLastRowColumn(l),d=new r(l,n.start.column,l,h);for(;l<=f;l++)d.start.row=d.end.row=l,d.start.column=l==a?n.start.column:u.getRowWrapIndent(l),d.end.column=p,c=h,h=p,p=l+1<f?u.getScreenLastRowColumn(l+1):l==f?0:n.end.column,this.drawSingleLineMarker(t,d,i+(l==a?" ace_start":"")+" ace_br"+e(l==a||l==a+1&&n.start.column,c<h,h>p,l==f),s,l==f?0:1,o)},this.drawMultiLineMarker=function(e,t,n,r,i){var s=this.$padding,o=r.lineHeight,u=this.$getTop(t.start.row,r),a=s+t.start.column*r.characterWidth;i=i||"";if(this.session.$bidiHandler.isBidiRow(t.start.row)){var f=t.clone();f.end.row=f.start.row,f.end.column=this.session.getLine(f.start.row).length,this.drawBidiSingleLineMarker(e,f,n+" ace_br1 ace_start",r,null,i)}else this.elt(n+" ace_br1 ace_start","height:"+o+"px;"+"right:0;"+"top:"+u+"px;left:"+a+"px;"+(i||""));if(this.session.$bidiHandler.isBidiRow(t.end.row)){var f=t.clone();f.start.row=f.end.row,f.start.column=0,this.drawBidiSingleLineMarker(e,f,n+" ace_br12",r,null,i)}else{u=this.$getTop(t.end.row,r);var l=t.end.column*r.characterWidth;this.elt(n+" ace_br12","height:"+o+"px;"+"width:"+l+"px;"+"top:"+u+"px;"+"left:"+s+"px;"+(i||""))}o=(t.end.row-t.start.row-1)*r.lineHeight;if(o<=0)return;u=this.$getTop(t.start.row+1,r);var c=(t.start.column?1:0)|(t.end.column?0:8);this.elt(n+(c?" ace_br"+c:""),"height:"+o+"px;"+"right:0;"+"top:"+u+"px;"+"left:"+s+"px;"+(i||""))},this.drawSingleLineMarker=function(e,t,n,r,i,s){if(this.session.$bidiHandler.isBidiRow(t.start.row))return this.drawBidiSingleLineMarker(e,t,n,r,i,s);var o=r.lineHeight,u=(t.end.column+(i||0)-t.start.column)*r.characterWidth,a=this.$getTop(t.start.row,r),f=this.$padding+t.start.column*r.characterWidth;this.elt(n,"height:"+o+"px;"+"width:"+u+"px;"+"top:"+a+"px;"+"left:"+f+"px;"+(s||""))},this.drawBidiSingleLineMarker=function(e,t,n,r,i,s){var o=r.lineHeight,u=this.$getTop(t.start.row,r),a=this.$padding,f=this.session.$bidiHandler.getSelections(t.start.column,t.end.column);f.forEach(function(e){this.elt(n,"height:"+o+"px;"+"width:"+e.width+(i||0)+"px;"+"top:"+u+"px;"+"left:"+(a+e.left)+"px;"+(s||""))},this)},this.drawFullLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;t.start.row!=t.end.row&&(o+=this.$getTop(t.end.row,r)-s),this.elt(n,"height:"+o+"px;"+"top:"+s+"px;"+"left:0;right:0;"+(i||""))},this.drawScreenLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;this.elt(n,"height:"+o+"px;"+"top:"+s+"px;"+"left:0;right:0;"+(i||""))}}).call(s.prototype),t.Marker=s}),ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/layer/lines","ace/lib/event_emitter"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("../lib/dom"),s=e("../lib/lang"),o=e("./lines").Lines,u=e("../lib/event_emitter").EventEmitter,a=function(e){this.dom=i,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new o(this.element)};(function(){r.implement(this,u),this.EOF_CHAR="\u00b6",this.EOL_CHAR_LF="\u00ac",this.EOL_CHAR_CRLF="\u00a4",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="\u2014",this.SPACE_CHAR="\u00b7",this.$padding=0,this.MAX_LINE_LENGTH=1e4,this.$updateEolChar=function(){var e=this.session.doc,t=e.getNewLineCharacter()=="\n"&&e.getNewLineMode()!="windows",n=t?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=n)return this.EOL_CHAR=n,!0},this.setPadding=function(e){this.$padding=e,this.element.style.margin="0 "+e+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){this.session=e,e&&this.$computeTabString()},this.showInvisibles=!1,this.showSpaces=!1,this.showTabs=!1,this.showEOL=!1,this.setShowInvisibles=function(e){return this.showInvisibles==e?!1:(this.showInvisibles=e,typeof e=="string"?(this.showSpaces=/tab/i.test(e),this.showTabs=/space/i.test(e),this.showEOL=/eol/i.test(e)):this.showSpaces=this.showTabs=this.showEOL=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides==e?!1:(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var e=this.session.getTabSize();this.tabSize=e;var t=this.$tabStrings=[0];for(var n=1;n<e+1;n++)if(this.showTabs){var r=this.dom.createElement("span");r.className="ace_invisible ace_invisible_tab",r.textContent=s.stringRepeat(this.TAB_CHAR,n),t.push(r)}else t.push(this.dom.createTextNode(s.stringRepeat(" ",n),this.element));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var i="ace_indent-guide",o=this.showSpaces?" ace_invisible ace_invisible_space":"",u=this.showSpaces?s.stringRepeat(this.SPACE_CHAR,this.tabSize):s.stringRepeat(" ",this.tabSize),a=this.showTabs?" ace_invisible ace_invisible_tab":"",f=this.showTabs?s.stringRepeat(this.TAB_CHAR,this.tabSize):u,r=this.dom.createElement("span");r.className=i+o,r.textContent=u,this.$tabStrings[" "]=r;var r=this.dom.createElement("span");r.className=i+a,r.textContent=f,this.$tabStrings["	"]=r}},this.updateLines=function(e,t,n){if(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)return this.update(e);this.config=e;var r=Math.max(t,e.firstRow),i=Math.min(n,e.lastRow),s=this.element.childNodes,o=0;for(var u=e.firstRow;u<r;u++){var a=this.session.getFoldLine(u);if(a){if(a.containsRow(r)){r=a.start.row;break}u=a.end.row}o++}var f=!1,u=r,a=this.session.getNextFoldLine(u),l=a?a.start.row:Infinity;for(;;){u>l&&(u=a.end.row+1,a=this.session.getNextFoldLine(u,a),l=a?a.start.row:Infinity);if(u>i)break;var c=s[o++];if(c){this.dom.removeChildren(c),this.$renderLine(c,u,u==l?a:!1),f&&(c.style.top=this.$lines.computeLineTop(u,e,this.session)+"px");var h=e.lineHeight*this.session.getRowLength(u)+"px";c.style.height!=h&&(f=!0,c.style.height=h)}u++}if(f)while(o<this.$lines.cells.length){var p=this.$lines.cells[o++];p.element.style.top=this.$lines.computeLineTop(p.row,e,this.session)+"px"}},this.scrollLines=function(e){var t=this.config;this.config=e;if(this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=e.lastRow,r=t?t.lastRow:-1;if(!t||r<e.firstRow)return this.update(e);if(n<t.firstRow)return this.update(e);if(!t||t.lastRow<e.firstRow)return this.update(e);if(e.lastRow<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var i=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);i>0;i--)this.$lines.shift();if(t.lastRow>e.lastRow)for(var i=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);i>0;i--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLinesFragment(e,e.firstRow,t.firstRow-1)),e.lastRow>t.lastRow&&this.$lines.push(this.$renderLinesFragment(e,t.lastRow+1,e.lastRow))},this.$renderLinesFragment=function(e,t,n){var r=[],s=t,o=this.session.getNextFoldLine(s),u=o?o.start.row:Infinity;for(;;){s>u&&(s=o.end.row+1,o=this.session.getNextFoldLine(s,o),u=o?o.start.row:Infinity);if(s>n)break;var a=this.$lines.createCell(s,e,this.session),f=a.element;this.dom.removeChildren(f),i.setStyle(f.style,"height",this.$lines.computeLineHeight(s,e,this.session)+"px"),i.setStyle(f.style,"top",this.$lines.computeLineTop(s,e,this.session)+"px"),this.$renderLine(f,s,s==u?o:!1),this.$useLineGroups()?f.className="ace_line_group":f.className="ace_line",r.push(a),s++}return r},this.update=function(e){this.$lines.moveContainer(e),this.config=e;var t=e.firstRow,n=e.lastRow,r=this.$lines;while(r.getLength())r.pop();r.push(this.$renderLinesFragment(e,t,n))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,n,r){var i=this,o=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC\u2066\u2067\u2068\u202A\u202B\u202D\u202E\u202C\u2069]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,u=this.dom.createFragment(this.element),a,f=0;while(a=o.exec(r)){var l=a[1],c=a[2],h=a[3],p=a[4],d=a[5];if(!i.showSpaces&&c)continue;var v=f!=a.index?r.slice(f,a.index):"";f=a.index+a[0].length,v&&u.appendChild(this.dom.createTextNode(v,this.element));if(l){var m=i.session.getScreenTabSize(t+a.index);u.appendChild(i.$tabStrings[m].cloneNode(!0)),t+=m-1}else if(c)if(i.showSpaces){var g=this.dom.createElement("span");g.className="ace_invisible ace_invisible_space",g.textContent=s.stringRepeat(i.SPACE_CHAR,c.length),u.appendChild(g)}else u.appendChild(this.com.createTextNode(c,this.element));else if(h){var g=this.dom.createElement("span");g.className="ace_invisible ace_invisible_space ace_invalid",g.textContent=s.stringRepeat(i.SPACE_CHAR,h.length),u.appendChild(g)}else if(p){t+=1;var g=this.dom.createElement("span");g.style.width=i.config.characterWidth*2+"px",g.className=i.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",g.textContent=i.showSpaces?i.SPACE_CHAR:p,u.appendChild(g)}else if(d){t+=1;var g=this.dom.createElement("span");g.style.width=i.config.characterWidth*2+"px",g.className="ace_cjk",g.textContent=d,u.appendChild(g)}}u.appendChild(this.dom.createTextNode(f?r.slice(f):r,this.element));if(!this.$textToken[n.type]){var y="ace_"+n.type.replace(/\./g," ace_"),g=this.dom.createElement("span");n.type=="fold"&&(g.style.width=n.value.length*this.config.characterWidth+"px"),g.className=y,g.appendChild(u),e.appendChild(g)}else e.appendChild(u);return t+r.length},this.renderIndentGuide=function(e,t,n){var r=t.search(this.$indentGuideRe);if(r<=0||r>=n)return t;if(t[0]==" "){r-=r%this.tabSize;var i=r/this.tabSize;for(var s=0;s<i;s++)e.appendChild(this.$tabStrings[" "].cloneNode(!0));return t.substr(r)}if(t[0]=="	"){for(var s=0;s<r;s++)e.appendChild(this.$tabStrings["	"].cloneNode(!0));return t.substr(r)}return t},this.$createLineElement=function(e){var t=this.dom.createElement("div");return t.className="ace_line",t.style.height=this.config.lineHeight+"px",t},this.$renderWrappedLine=function(e,t,n){var r=0,i=0,o=n[0],u=0,a=this.$createLineElement();e.appendChild(a);for(var f=0;f<t.length;f++){var l=t[f],c=l.value;if(f==0&&this.displayIndentGuides){r=c.length,c=this.renderIndentGuide(a,c,o);if(!c)continue;r-=c.length}if(r+c.length<o)u=this.$renderToken(a,u,l,c),r+=c.length;else{while(r+c.length>=o)u=this.$renderToken(a,u,l,c.substring(0,o-r)),c=c.substring(o-r),r=o,a=this.$createLineElement(),e.appendChild(a),a.appendChild(this.dom.createTextNode(s.stringRepeat("\u00a0",n.indent),this.element)),i++,u=0,o=n[i]||Number.MAX_VALUE;c.length!=0&&(r+=c.length,u=this.$renderToken(a,u,l,c))}}n[n.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(a,u,null,"",!0)},this.$renderSimpleLine=function(e,t){var n=0,r=t[0],i=r.value;this.displayIndentGuides&&(i=this.renderIndentGuide(e,i)),i&&(n=this.$renderToken(e,n,r,i));for(var s=1;s<t.length;s++){r=t[s],i=r.value;if(n+i.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(e,n,r,i);n=this.$renderToken(e,n,r,i)}},this.$renderOverflowMessage=function(e,t,n,r,i){n&&this.$renderToken(e,t,n,r.slice(0,this.MAX_LINE_LENGTH-t));var s=this.dom.createElement("span");s.className="ace_inline_button ace_keyword ace_toggle_wrap",s.textContent=i?"<hide>":"<click to see more...>",e.appendChild(s)},this.$renderLine=function(e,t,n){!n&&n!=0&&(n=this.session.getFoldLine(t));if(n)var r=this.$getFoldLineTokens(t,n);else var r=this.session.getTokens(t);var i=e;if(r.length){var s=this.session.getRowSplitData(t);if(s&&s.length){this.$renderWrappedLine(e,r,s);var i=e.lastChild}else{var i=e;this.$useLineGroups()&&(i=this.$createLineElement(),e.appendChild(i)),this.$renderSimpleLine(i,r)}}else this.$useLineGroups()&&(i=this.$createLineElement(),e.appendChild(i));if(this.showEOL&&i){n&&(t=n.end.row);var o=this.dom.createElement("span");o.className="ace_invisible ace_invisible_eol",o.textContent=t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,i.appendChild(o)}},this.$getFoldLineTokens=function(e,t){function i(e,t,n){var i=0,s=0;while(s+e[i].value.length<t){s+=e[i].value.length,i++;if(i==e.length)return}if(s!=t){var o=e[i].value.substring(t-s);o.length>n-t&&(o=o.substring(0,n-t)),r.push({type:e[i].type,value:o}),s=t+o.length,i+=1}while(s<n&&i<e.length){var o=e[i].value;o.length+s>n?r.push({type:e[i].type,value:o.substring(0,n-s)}):r.push(e[i]),s+=o.length,i+=1}}var n=this.session,r=[],s=n.getTokens(e);return t.walk(function(e,t,o,u,a){e!=null?r.push({type:"fold",value:e}):(a&&(s=n.getTokens(t)),s.length&&i(s,u,o))},t.end.row,this.session.getLine(t.end.row).length),r},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){}}).call(a.prototype),t.Text=a}),ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";var r=e("../lib/dom"),i=function(e){this.element=r.createElement("div"),this.element.className="ace_layer ace_cursor-layer",e.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),r.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(e){var t=this.cursors;for(var n=t.length;n--;)r.setStyle(t[n].style,"opacity",e?"":"0")},this.$startCssAnimation=function(){var e=this.cursors;for(var t=e.length;t--;)e[t].style.animationDuration=this.blinkInterval+"ms";this.$isAnimating=!0,setTimeout(function(){this.$isAnimating&&r.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){this.$isAnimating=!1,r.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&&(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&&(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&&(this.smoothBlinking=e,r.setCssClass(this.element,"ace_smooth-blinking",e),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var e=r.createElement("div");return e.className="ace_cursor",this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){if(this.cursors.length>1){var e=this.cursors.pop();return e.parentNode.removeChild(e),e}},this.hideCursor=function(){this.isVisible=!1,r.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,r.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var e=this.$updateCursors;clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&(this.$isSmoothBlinking=!1,r.removeCssClass(this.element,"ace_smooth-blinking")),e(!0);if(!this.isBlinking||!this.blinkInterval||!this.isVisible){this.$stopCssAnimation();return}this.smoothBlinking&&(this.$isSmoothBlinking=!0,setTimeout(function(){this.$isSmoothBlinking&&r.addCssClass(this.element,"ace_smooth-blinking")}.bind(this)));if(r.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var t=function(){this.timeoutId=setTimeout(function(){e(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){e(!0),t()},this.blinkInterval),t()}},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e||(e=this.session.selection.getCursor());var n=this.session.documentToScreenPosition(e),r=this.$padding+(this.session.$bidiHandler.isBidiRow(n.row,e.row)?this.session.$bidiHandler.getPosLeft(n.column):n.column*this.config.characterWidth),i=(n.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:r,top:i}},this.isCursorInView=function(e,t){return e.top>=0&&e.top<t.maxHeight},this.update=function(e){this.config=e;var t=this.session.$selectionMarkers,n=0,i=0;if(t===undefined||t.length===0)t=[{cursor:null}];for(var n=0,s=t.length;n<s;n++){var o=this.getPixelPosition(t[n].cursor,!0);if((o.top>e.height+e.offset||o.top<0)&&n>1)continue;var u=this.cursors[i++]||this.addCursor(),a=u.style;this.drawCursor?this.drawCursor(u,o,e,t[n],this.session):this.isCursorInView(o,e)?(r.setStyle(a,"display","block"),r.translate(u,o.left,o.top),r.setStyle(a,"width",Math.round(e.characterWidth)+"px"),r.setStyle(a,"height",e.lineHeight+"px")):r.setStyle(a,"display","none")}while(this.cursors.length>i)this.removeCursor();var f=this.session.getOverwrite();this.$setOverwrite(f),this.$pixelPos=o,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(e){e!=this.overwrite&&(this.overwrite=e,e?r.addCssClass(this.element,"ace_overwrite-cursors"):r.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(i.prototype),t.Cursor=i}),ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./lib/event"),o=e("./lib/event_emitter").EventEmitter,u=32768,a=function(e){this.element=i.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=i.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent="\u00a0",this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,s.addListener(this.element,"scroll",this.onScroll.bind(this)),s.addListener(this.element,"mousedown",s.preventDefault)};(function(){r.implement(this,o),this.setVisible=function(e){this.element.style.display=e?"":"none",this.isVisible=e,this.coeff=1}}).call(a.prototype);var f=function(e,t){a.call(this,e),this.scrollTop=0,this.scrollHeight=0,t.$scrollbarWidth=this.width=i.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px",this.$minWidth=0};r.inherits(f,a),function(){this.classSuffix="-v",this.onScroll=function(){if(!this.skipEvent){this.scrollTop=this.element.scrollTop;if(this.coeff!=1){var e=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-e)/(this.coeff-e)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1},this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},this.setHeight=function(e){this.element.style.height=e+"px"},this.setInnerHeight=this.setScrollHeight=function(e){this.scrollHeight=e,e>u?(this.coeff=u/e,e=u):this.coeff!=1&&(this.coeff=1),this.inner.style.height=e+"px"},this.setScrollTop=function(e){this.scrollTop!=e&&(this.skipEvent=!0,this.scrollTop=e,this.element.scrollTop=e*this.coeff)}}.call(f.prototype);var l=function(e,t){a.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};r.inherits(l,a),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+"px"},this.setInnerWidth=function(e){this.inner.style.width=e+"px"},this.setScrollWidth=function(e){this.inner.style.width=e+"px"},this.setScrollLeft=function(e){this.scrollLeft!=e&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(l.prototype),t.ScrollBar=f,t.ScrollBarV=f,t.ScrollBarH=l,t.VScrollBar=f,t.HScrollBar=l}),ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],function(e,t,n){"use strict";var r=e("./lib/event"),i=function(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=t||window;var n=this;this._flush=function(e){n.pending=!1;var t=n.changes;t&&(r.blockIdle(100),n.changes=0,n.onRender(t));if(n.changes){if(n.$recursionLimit--<0)return;n.schedule()}else n.$recursionLimit=2}};(function(){this.schedule=function(e){this.changes=this.changes|e,this.changes&&!this.pending&&(r.nextFrame(this._flush),this.pending=!0)},this.clear=function(e){var t=this.changes;return this.changes=0,t}}).call(i.prototype),t.RenderLoop=i}),ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/lib/useragent","ace/lib/event_emitter"],function(e,t,n){var r=e("../lib/oop"),i=e("../lib/dom"),s=e("../lib/lang"),o=e("../lib/event"),u=e("../lib/useragent"),a=e("../lib/event_emitter").EventEmitter,f=256,l=typeof ResizeObserver=="function",c=200,h=t.FontMetrics=function(e){this.el=i.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=i.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=i.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),this.$measureNode.textContent=s.stringRepeat("X",f),this.$characterSize={width:0,height:0},l?this.$addObserver():this.checkForSizeChanges()};(function(){r.implement(this,a),this.$characterSize={width:0,height:0},this.$setMeasureNodeStyles=function(e,t){e.width=e.height="auto",e.left=e.top="0px",e.visibility="hidden",e.position="absolute",e.whiteSpace="pre",u.isIE<8?e["font-family"]="inherit":e.font="inherit",e.overflow=t?"hidden":"visible"},this.checkForSizeChanges=function(e){e===undefined&&(e=this.$measureSizes());if(e&&(this.$characterSize.width!==e.width||this.$characterSize.height!==e.height)){this.$measureNode.style.fontWeight="bold";var t=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&&t.width===e.width&&t.height===e.height,this._emit("changeCharacterSize",{data:e})}},this.$addObserver=function(){var e=this;this.$observer=new window.ResizeObserver(function(t){e.checkForSizeChanges()}),this.$observer.observe(this.$measureNode)},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var e=this;return this.$pollSizeChangesTimer=o.onIdle(function t(){e.checkForSizeChanges(),o.onIdle(t,500)},500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(e){var t={height:(e||this.$measureNode).clientHeight,width:(e||this.$measureNode).clientWidth/f};return t.width===0||t.height===0?null:t},this.$measureCharWidth=function(e){this.$main.textContent=s.stringRepeat(e,f);var t=this.$main.getBoundingClientRect();return t.width/f},this.getCharacterWidth=function(e){var t=this.charSizes[e];return t===undefined&&(t=this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width),t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},this.$getZoom=function e(t){return!t||!t.parentElement?1:(window.getComputedStyle(t).zoom||1)*e(t.parentElement)},this.$initTransformMeasureNodes=function(){var e=function(e,t){return["div",{style:"position: absolute;top:"+e+"px;left:"+t+"px;"}]};this.els=i.buildDom([e(0,0),e(c,0),e(0,c),e(c,c)],this.el)},this.transformCoordinates=function(e,t){function r(e,t,n){var r=e[1]*t[0]-e[0]*t[1];return[(-t[1]*n[0]+t[0]*n[1])/r,(+e[1]*n[0]-e[0]*n[1])/r]}function i(e,t){return[e[0]-t[0],e[1]-t[1]]}function s(e,t){return[e[0]+t[0],e[1]+t[1]]}function o(e,t){return[e*t[0],e*t[1]]}function u(e){var t=e.getBoundingClientRect();return[t.left,t.top]}if(e){var n=this.$getZoom(this.el);e=o(1/n,e)}this.els||this.$initTransformMeasureNodes();var a=u(this.els[0]),f=u(this.els[1]),l=u(this.els[2]),h=u(this.els[3]),p=r(i(h,f),i(h,l),i(s(f,l),s(h,a))),d=o(1+p[0],i(f,a)),v=o(1+p[1],i(l,a));if(t){var m=t,g=p[0]*m[0]/c+p[1]*m[1]/c+1,y=s(o(m[0],d),o(m[1],v));return s(o(1/g/c,y),a)}var b=i(e,a),w=r(i(d,o(p[0],b)),i(v,o(p[1],b)),b);return o(c,w)}}).call(h.prototype)}),ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter","ace/lib/useragent"],function(e,t,n){"use strict";var r=e("./lib/oop"),i=e("./lib/dom"),s=e("./config"),o=e("./layer/gutter").Gutter,u=e("./layer/marker").Marker,a=e("./layer/text").Text,f=e("./layer/cursor").Cursor,l=e("./scrollbar").HScrollBar,c=e("./scrollbar").VScrollBar,h=e("./renderloop").RenderLoop,p=e("./layer/font_metrics").FontMetrics,d=e("./lib/event_emitter").EventEmitter,v='.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}',m=e("./lib/useragent"),g=m.isIE;i.importCssString(v,"ace_editor.css",!1);var y=function(e,t){var n=this;this.container=e||i.createElement("div"),i.addCssClass(this.container,"ace_editor"),i.HI_DPI&&i.addCssClass(this.container,"ace_hidpi"),this.setTheme(t),s.get("useStrictCSP")==null&&s.set("useStrictCSP",!1),this.$gutter=i.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden",!0),this.scroller=i.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=i.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new o(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new u(this.content);var r=this.$textLayer=new a(this.content);this.canvas=r.element,this.$markerFront=new u(this.content),this.$cursorLayer=new f(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new c(this.container,this),this.scrollBarH=new l(this.container,this),this.scrollBarV.on("scroll",function(e){n.$scrollAnimation||n.session.setScrollTop(e.data-n.scrollMargin.top)}),this.scrollBarH.on("scroll",function(e){n.$scrollAnimation||n.session.setScrollLeft(e.data-n.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new p(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.on("changeCharacterSize",function(e){n.updateCharacterSize(),n.onResize(!0,n.gutterWidth,n.$size.width,n.$size.height),n._signal("changeCharacterSize",e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!m.isIOS,this.$loop=new h(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),s.resetOptions(this),s._signal("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,r.implement(this,d),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),i.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")},this.setSession=function(e){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=e,e&&this.scrollMargin.top&&e.getScrollTop()<=0&&e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e);if(!e)return;this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode)},this.updateLines=function(e,t,n){t===undefined&&(t=Infinity),this.$changedLines?(this.$changedLines.firstRow>e&&(this.$changedLines.firstRow=e),this.$changedLines.lastRow<t&&(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t};if(this.$changedLines.lastRow<this.layerConfig.firstRow){if(!n)return;this.$changedLines.lastRow=this.layerConfig.lastRow}if(this.$changedLines.firstRow>this.layerConfig.lastRow)return;this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,n,r){if(this.resizing>2)return;this.resizing>0?this.resizing++:this.resizing=e?1:0;var i=this.container;r||(r=i.clientHeight||i.scrollHeight),n||(n=i.clientWidth||i.scrollWidth);var s=this.$updateCachedSize(e,t,n,r);if(!this.$size.scrollerHeight||!n&&!r)return this.resizing=0;e&&(this.$gutterLayer.$padding=null),e?this.$renderChanges(s|this.$changes,!0):this.$loop.schedule(s|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null},this.$updateCachedSize=function(e,t,n,r){r-=this.$extraHeight||0;var s=0,o=this.$size,u={width:o.width,height:o.height,scrollerHeight:o.scrollerHeight,scrollerWidth:o.scrollerWidth};r&&(e||o.height!=r)&&(o.height=r,s|=this.CHANGE_SIZE,o.scrollerHeight=o.height,this.$horizScroll&&(o.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",s|=this.CHANGE_SCROLL);if(n&&(e||o.width!=n)){s|=this.CHANGE_SIZE,o.width=n,t==null&&(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,i.setStyle(this.scrollBarH.element.style,"left",t+"px"),i.setStyle(this.scroller.style,"left",t+this.margin.left+"px"),o.scrollerWidth=Math.max(0,n-t-this.scrollBarV.getWidth()-this.margin.h),i.setStyle(this.$gutter.style,"left",this.margin.left+"px");var a=this.scrollBarV.getWidth()+"px";i.setStyle(this.scrollBarH.element.style,"right",a),i.setStyle(this.scroller.style,"right",a),i.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight());if(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||e)s|=this.CHANGE_FULL}return o.$dirty=!n||!r,s&&this._signal("resize",u),s},this.onGutterResize=function(e){var t=this.$showGutter?e:0;t!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,t,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-this.$padding*2,t=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(t,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption("animatedScroll",e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption("showInvisibles",e),this.session.$bidiHandler.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(e){this.setOption("displayIndentGuides",e)},this.setShowPrintMargin=function(e){this.setOption("showPrintMargin",e)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(e){this.setOption("printMarginColumn",e)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(e){return this.setOption("showGutter",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updatePrintMargin=function(){if(!this.$showPrintMargin&&!this.$printMarginEl)return;if(!this.$printMarginEl){var e=i.createElement("div");e.className="ace_layer ace_print-margin-layer",this.$printMarginEl=i.createElement("div"),this.$printMarginEl.className="ace_print-margin",e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)}var t=this.$printMarginEl.style;t.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",t.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&this.session.$wrap==-1&&this.adjustWrapLimit()},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(this.$isMousePressed)return;var e=this.textarea.style,t=this.$composition;if(!this.$keepTextAreaAtCursor&&!t){i.translate(this.textarea,-100,0);return}var n=this.$cursorLayer.$pixelPos;if(!n)return;t&&t.markerRange&&(n=this.$cursorLayer.getPixelPosition(t.markerRange.start,!0));var r=this.layerConfig,s=n.top,o=n.left;s-=r.offset;var u=t&&t.useTextareaForIME?this.lineHeight:g?0:1;if(s<0||s>r.height-u){i.translate(this.textarea,0,0);return}var a=1,f=this.$size.height-u;if(!t)s+=this.lineHeight;else if(t.useTextareaForIME){var l=this.textarea.value;a=this.characterWidth*this.session.$getStringScreenWidth(l)[0]}else s+=this.lineHeight+2;o-=this.scrollLeft,o>this.$size.scrollerWidth-a&&(o=this.$size.scrollerWidth-a),o+=this.gutterWidth+this.margin.left,i.setStyle(e,"height",u+"px"),i.setStyle(e,"width",a+"px"),i.translate(this.textarea,Math.min(o,this.$size.scrollerWidth-a),Math.min(s,f))},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)},this.getLastFullyVisibleRow=function(){var e=this.layerConfig,t=e.lastRow,n=this.session.documentToScreenRow(t,0)*e.lineHeight;return n-this.session.getScrollTop()>e.height-e.lineHeight?t-1:t},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,n,r){var i=this.scrollMargin;i.top=e|0,i.bottom=t|0,i.right=r|0,i.left=n|0,i.v=i.top+i.bottom,i.h=i.left+i.right,i.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-i.top),this.updateFull()},this.setMargin=function(e,t,n,r){var i=this.margin;i.top=e|0,i.bottom=t|0,i.right=r|0,i.left=n|0,i.v=i.top+i.bottom,i.h=i.left+i.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption("hScrollBarAlwaysVisible",e)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption("vScrollBarAlwaysVisible",e)},this.$updateScrollBarV=function(){var e=this.layerConfig.maxHeight,t=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(e-=(t-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>e-t&&(e=this.scrollTop+t,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(e+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){this.$changes&&(e|=this.$changes,this.$changes=0);if(!this.session||!this.container.offsetWidth||this.$frozen||!e&&!t){this.$changes|=e;return}if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender",e),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var n=this.layerConfig;if(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_TEXT||e&this.CHANGE_LINES||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL){e|=this.$computeLayerConfig()|this.$loop.clear();if(n.firstRow!=this.layerConfig.firstRow&&n.firstRowScreen==this.layerConfig.firstRowScreen){var r=this.scrollTop+(n.firstRow-this.layerConfig.firstRow)*this.lineHeight;r>0&&(this.scrollTop=r,e|=this.CHANGE_SCROLL,e|=this.$computeLayerConfig()|this.$loop.clear())}n=this.layerConfig,this.$updateScrollBarV(),e&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),i.translate(this.content,-this.scrollLeft,-n.offset);var s=n.width+2*this.$padding+"px",o=n.minHeight+"px";i.setStyle(this.content.style,"width",s),i.setStyle(this.content.style,"height",o)}e&this.CHANGE_H_SCROLL&&(i.translate(this.content,-this.scrollLeft,-n.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left");if(e&this.CHANGE_FULL){this.$changedLines=null,this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this._signal("afterRender",e);return}if(e&this.CHANGE_SCROLL){this.$changedLines=null,e&this.CHANGE_TEXT||e&this.CHANGE_LINES?this.$textLayer.update(n):this.$textLayer.scrollLines(n),this.$showGutter&&(e&this.CHANGE_GUTTER||e&this.CHANGE_LINES?this.$gutterLayer.update(n):this.$gutterLayer.scrollLines(n)),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this._signal("afterRender",e);return}e&this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(n),this.$showGutter&&this.$gutterLayer.update(n)):e&this.CHANGE_LINES?(this.$updateLines()||e&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(n):e&this.CHANGE_TEXT||e&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(n):e&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(n),e&this.CHANGE_CURSOR&&(this.$cursorLayer.update(n),this.$moveTextAreaToCursor()),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(n),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(n),this._signal("afterRender",e)},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,n=Math.min(t,Math.max((this.$minLines||1)*this.lineHeight,e))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(n+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&n>this.$maxPixelHeight&&(n=this.$maxPixelHeight);var r=n<=2*this.lineHeight,i=!r&&e>t;if(n!=this.desiredHeight||this.$size.height!=this.desiredHeight||i!=this.$vScroll){i!=this.$vScroll&&(this.$vScroll=i,this.scrollBarV.setVisible(i));var s=this.container.clientWidth;this.container.style.height=n+"px",this.$updateCachedSize(!0,this.$gutterWidth,s,n),this.desiredHeight=n,this._signal("autosize")}},this.$computeLayerConfig=function(){var e=this.session,t=this.$size,n=t.height<=2*this.lineHeight,r=this.session.getScreenLength(),i=r*this.lineHeight,s=this.$getLongestLine(),o=!n&&(this.$hScrollBarAlwaysVisible||t.scrollerWidth-s-2*this.$padding<0),u=this.$horizScroll!==o;u&&(this.$horizScroll=o,this.scrollBarH.setVisible(o));var a=this.$vScroll;this.$maxLines&&this.lineHeight>1&&this.$autosize();var f=t.scrollerHeight+this.lineHeight,l=!this.$maxLines&&this.$scrollPastEnd?(t.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;i+=l;var c=this.scrollMargin;this.session.setScrollTop(Math.max(-c.top,Math.min(this.scrollTop,i-t.scrollerHeight+c.bottom))),this.session.setScrollLeft(Math.max(-c.left,Math.min(this.scrollLeft,s+2*this.$padding-t.scrollerWidth+c.right)));var h=!n&&(this.$vScrollBarAlwaysVisible||t.scrollerHeight-i+l<0||this.scrollTop>c.top),p=a!==h;p&&(this.$vScroll=h,this.scrollBarV.setVisible(h));var d=this.scrollTop%this.lineHeight,v=Math.ceil(f/this.lineHeight)-1,m=Math.max(0,Math.round((this.scrollTop-d)/this.lineHeight)),g=m+v,y,b,w=this.lineHeight;m=e.screenToDocumentRow(m,0);var E=e.getFoldLine(m);E&&(m=E.start.row),y=e.documentToScreenRow(m,0),b=e.getRowLength(m)*w,g=Math.min(e.screenToDocumentRow(g,0),e.getLength()-1),f=t.scrollerHeight+e.getRowLength(g)*w+b,d=this.scrollTop-y*w;var S=0;if(this.layerConfig.width!=s||u)S=this.CHANGE_H_SCROLL;if(u||p)S|=this.$updateCachedSize(!0,this.gutterWidth,t.width,t.height),this._signal("scrollbarVisibilityChanged"),p&&(s=this.$getLongestLine());return this.layerConfig={width:s,padding:this.$padding,firstRow:m,firstRowScreen:y,lastRow:g,lineHeight:w,characterWidth:this.characterWidth,minHeight:f,maxHeight:i,offset:d,gutterOffset:w?Math.max(0,Math.ceil((d+t.height-t.scrollerHeight)/w)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(s-this.$padding),S},this.$updateLines=function(){if(!this.$changedLines)return;var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow;this.$changedLines=null;var n=this.layerConfig;if(e>n.lastRow+1)return;if(t<n.firstRow)return;if(t===Infinity){this.$showGutter&&this.$gutterLayer.update(n),this.$textLayer.update(n);return}return this.$textLayer.updateLines(n,e,t),!0},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(e+=1),this.$textLayer&&e>this.$textLayer.MAX_LINE_LENGTH&&(e=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,n){this.scrollCursorIntoView(e,n),this.scrollCursorIntoView(t,n)},this.scrollCursorIntoView=function(e,t,n){if(this.$size.scrollerHeight===0)return;var r=this.$cursorLayer.getPixelPosition(e),i=r.left,s=r.top,o=n&&n.top||0,u=n&&n.bottom||0,a=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;a+o>s?(t&&a+o>s+this.lineHeight&&(s-=t*this.$size.scrollerHeight),s===0&&(s=-this.scrollMargin.top),this.session.setScrollTop(s)):a+this.$size.scrollerHeight-u<s+this.lineHeight&&(t&&a+this.$size.scrollerHeight-u<s-this.lineHeight&&(s+=t*this.$size.scrollerHeight),this.session.setScrollTop(s+this.lineHeight+u-this.$size.scrollerHeight));var f=this.scrollLeft;f>i?(i<this.$padding+2*this.layerConfig.characterWidth&&(i=-this.scrollMargin.left),this.session.setScrollLeft(i)):f+this.$size.scrollerWidth<i+this.characterWidth?this.session.setScrollLeft(Math.round(i+this.characterWidth-this.$size.scrollerWidth)):f<=this.$padding&&i-f<this.characterWidth&&this.session.setScrollLeft(0)},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){typeof e=="number"&&(e={row:e,column:0});var n=this.$cursorLayer.getPixelPosition(e),r=this.$size.scrollerHeight-this.lineHeight,i=n.top-r*(t||0);return this.session.setScrollTop(i),i},this.STEPS=8,this.$calcSteps=function(e,t){var n=0,r=this.STEPS,i=[],s=function(e,t,n){return n*(Math.pow(e-1,3)+1)+t};for(n=0;n<r;++n)i.push(s(n/this.STEPS,e,t-e));return i},this.scrollToLine=function(e,t,n,r){var i=this.$cursorLayer.getPixelPosition({row:e,column:0}),s=i.top;t&&(s-=this.$size.scrollerHeight/2);var o=this.scrollTop;this.session.setScrollTop(s),n!==!1&&this.animateScrolling(o,r)},this.animateScrolling=function(e,t){var n=this.scrollTop;if(!this.$animatedScroll)return;var r=this;if(e==n)return;if(this.$scrollAnimation){var i=this.$scrollAnimation.steps;if(i.length){e=i[0];if(e==n)return}}var s=r.$calcSteps(e,n);this.$scrollAnimation={from:e,to:n,steps:s},clearInterval(this.$timer),r.session.setScrollTop(s.shift()),r.session.$scrollTop=n,this.$timer=setInterval(function(){if(!r.session)return clearInterval(r.$timer);s.length?(r.session.setScrollTop(s.shift()),r.session.$scrollTop=n):n!=null?(r.session.$scrollTop=-1,r.session.setScrollTop(n),n=null):(r.$timer=clearInterval(r.$timer),r.$scrollAnimation=null,t&&t())},10)},this.scrollToY=function(e){this.scrollTop!==e&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&&(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(e)},this.scrollBy=function(e,t){t&&this.session.setScrollTop(this.session.getScrollTop()+t),e&&this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){if(t<0&&this.session.getScrollTop()>=1-this.scrollMargin.top)return!0;if(t>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom)return!0;if(e<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left)return!0;if(e>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right)return!0},this.pixelToScreenCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var r=this.$fontMetrics.transformCoordinates([e,t]);e=r[1]-this.gutterWidth-this.margin.left,t=r[0]}else n=this.scroller.getBoundingClientRect();var i=e+this.scrollLeft-n.left-this.$padding,s=i/this.characterWidth,o=Math.floor((t+this.scrollTop-n.top)/this.lineHeight),u=this.$blockCursor?Math.floor(s):Math.round(s);return{row:o,column:u,side:s-u>0?1:-1,offsetX:i}},this.screenToTextCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var r=this.$fontMetrics.transformCoordinates([e,t]);e=r[1]-this.gutterWidth-this.margin.left,t=r[0]}else n=this.scroller.getBoundingClientRect();var i=e+this.scrollLeft-n.left-this.$padding,s=i/this.characterWidth,o=this.$blockCursor?Math.floor(s):Math.round(s),u=Math.floor((t+this.scrollTop-n.top)/this.lineHeight);return this.session.screenToDocumentPosition(u,Math.max(o,0),i)},this.textToScreenCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),r=this.session.documentToScreenPosition(e,t),i=this.$padding+(this.session.$bidiHandler.isBidiRow(r.row,e)?this.session.$bidiHandler.getPosLeft(r.column):Math.round(r.column*this.characterWidth)),s=r.row*this.lineHeight;return{pageX:n.left+i-this.scrollLeft,pageY:n.top+s-this.scrollTop}},this.visualizeFocus=function(){i.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){i.removeCssClass(this.container,"ace_focus")},this.showComposition=function(e){this.$composition=e,e.cssText||(e.cssText=this.textarea.style.cssText),e.useTextareaForIME==undefined&&(e.useTextareaForIME=this.$useTextareaForIME),this.$useTextareaForIME?(i.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):e.markerId=this.session.addMarker(e.markerRange,"ace_composition_marker","text")},this.setCompositionText=function(e){var t=this.session.selection.cursor;this.addToken(e,"composition_placeholder",t.row,t.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){if(!this.$composition)return;this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),i.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText;var e=this.session.selection.cursor;this.removeExtraToken(e.row,e.column),this.$composition=null,this.$cursorLayer.element.style.display=""},this.addToken=function(e,t,n,r){var i=this.session;i.bgTokenizer.lines[n]=null;var s={type:t,value:e},o=i.getTokens(n);if(r==null)o.push(s);else{var u=0;for(var a=0;a<o.length;a++){var f=o[a];u+=f.value.length;if(r<=u){var l=f.value.length-(u-r),c=f.value.slice(0,l),h=f.value.slice(l);o.splice(a,1,{type:f.type,value:c},s,{type:f.type,value:h});break}}}this.updateLines(n,n)},this.removeExtraToken=function(e,t){this.updateLines(e,e)},this.setTheme=function(e,t){function o(r){if(n.$themeId!=e)return t&&t();if(!r||!r.cssClass)throw new Error("couldn't load module "+e+" or it didn't call define");r.$id&&(n.$themeId=r.$id),i.importCssString(r.cssText,r.cssClass,n.container),n.theme&&i.removeCssClass(n.container,n.theme.cssClass);var s="padding"in r?r.padding:"padding"in(n.theme||{})?4:n.$padding;n.$padding&&s!=n.$padding&&n.setPadding(s),n.$theme=r.cssClass,n.theme=r,i.addCssClass(n.container,r.cssClass),i.setCssClass(n.container,"ace_dark",r.isDark),n.$size&&(n.$size.width=0,n.$updateSizeAsync()),n._dispatchEvent("themeLoaded",{theme:r}),t&&t()}var n=this;this.$themeId=e,n._dispatchEvent("themeChange",{theme:e});if(!e||typeof e=="string"){var r=e||this.$options.theme.initialValue;s.loadModule(["theme",r],o)}else o(e)},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){i.setCssClass(this.container,e,t!==!1)},this.unsetStyle=function(e){i.removeCssClass(this.container,e)},this.setCursorStyle=function(e){i.setStyle(this.scroller.style,"cursor",e)},this.setMouseCursor=function(e){i.setStyle(this.scroller.style,"cursor",e)},this.attachToShadowRoot=function(){i.importCssString(v,"ace_editor.css",this.container)},this.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy(),this.removeAllListeners(),this.container.textContent=""}}).call(y.prototype),s.defineOptions(y.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){typeof e=="number"&&(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){i.setCssClass(this.$gutter,"ace_fade-fold-widgets",e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(e){this.$gutterLayer.setHighlightGutterLine(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(e){(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){(!this.$vScrollBarAlwaysVisible||!this.$vScroll)&&this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){typeof e=="number"&&(e+="px"),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(e){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(e){e=+e||0;if(this.$scrollPastEnd==e)return;this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!m.isMobile&&!m.isIE}}),t.VirtualRenderer=y}),ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],function(e,t,n){"use strict";function u(e){var t="importScripts('"+i.qualifyURL(e)+"');";try{return new Blob([t],{type:"application/javascript"})}catch(n){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,s=new r;return s.append(t),s.getBlob("application/javascript")}}function a(e){if(typeof Worker=="undefined")return{postMessage:function(){},terminate:function(){}};if(o.get("loadWorkerFromBlob")){var t=u(e),n=window.URL||window.webkitURL,r=n.createObjectURL(t);return new Worker(r)}return new Worker(e)}var r=e("../lib/oop"),i=e("../lib/net"),s=e("../lib/event_emitter").EventEmitter,o=e("../config"),f=function(e){e.postMessage||(e=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=e,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){r.implement(this,s),this.$createWorkerFromOldConfig=function(t,n,r,i,s){e.nameToUrl&&!e.toUrl&&(e.toUrl=e.nameToUrl);if(o.get("packaged")||!e.toUrl)i=i||o.moduleUrl(n,"worker");else{var u=this.$normalizePath;i=i||u(e.toUrl("ace/worker/worker.js",null,"_"));var f={};t.forEach(function(t){f[t]=u(e.toUrl(t,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}return this.$worker=a(i),s&&this.send("importScripts",s),this.$worker.postMessage({init:!0,tlns:f,module:n,classname:r}),this.$worker},this.onMessage=function(e){var t=e.data;switch(t.type){case"event":this._signal(t.name,{data:t.data});break;case"call":var n=this.callbacks[t.id];n&&(n(t.data),delete this.callbacks[t.id]);break;case"error":this.reportError(t.data);break;case"log":window.console&&console.log&&console.log.apply(console,t.data)}},this.reportError=function(e){window.console&&console.error&&console.error(e)},this.$normalizePath=function(e){return i.qualifyURL(e)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,n){if(n){var r=this.callbackId++;this.callbacks[r]=n,t.push(r)}this.send(e,t)},this.emit=function(e,t){try{t.data&&t.data.err&&(t.data.err={message:t.data.err.message,stack:t.data.err.stack,code:t.data.err.code}),this.$worker.postMessage({event:e,data:{data:t.data}})}catch(n){console.error(n.stack)}},this.attachToDocument=function(e){this.$doc&&this.terminate(),this.$doc=e,this.call("setValue",[e.getValue()]),e.on("change",this.changeListener)},this.changeListener=function(e){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),e.action=="insert"?this.deltaQueue.push(e.start,e.lines):this.deltaQueue.push(e.start,e.end)},this.$sendDeltaQueue=function(){var e=this.deltaQueue;if(!e)return;this.deltaQueue=null,e.length>50&&e.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:e})}}).call(f.prototype);var l=function(e,t,n){var r=null,i=!1,u=Object.create(s),a=[],l=new f({messageBuffer:a,terminate:function(){},postMessage:function(e){a.push(e);if(!r)return;i?setTimeout(c):c()}});l.setEmitSync=function(e){i=e};var c=function(){var e=a.shift();e.command?r[e.command].apply(r,e.args):e.event&&u._signal(e.event,e.data)};return u.postMessage=function(e){l.onMessage({data:e})},u.callback=function(e,t){this.postMessage({type:"call",id:t,data:e})},u.emit=function(e,t){this.postMessage({type:"event",name:e,data:t})},o.loadModule(["worker",t],function(e){r=new e[n](u);while(a.length)c()}),l};t.UIWorkerClient=l,t.WorkerClient=f,t.createWorker=a}),ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(e,t,n){"use strict";var r=e("./range").Range,i=e("./lib/event_emitter").EventEmitter,s=e("./lib/oop"),o=function(e,t,n,r,i,s){var o=this;this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=i,this.othersClass=s,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=r,this.$onCursorChange=function(){setTimeout(function(){o.onCursorChange()})},this.$pos=n;var u=e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=u.length,this.setup(),e.selection.on("changeCursor",this.$onCursorChange)};(function(){s.implement(this,i),this.setup=function(){var e=this,t=this.doc,n=this.session;this.selectionBefore=n.selection.toJSON(),n.selection.inMultiSelectMode&&n.selection.toSingleRange(),this.pos=t.createAnchor(this.$pos.row,this.$pos.column);var i=this.pos;i.$insertRight=!0,i.detach(),i.markerId=n.addMarker(new r(i.row,i.column,i.row,i.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(n){var r=t.createAnchor(n.row,n.column);r.$insertRight=!0,r.detach(),e.others.push(r)}),n.setUndoSelect(!1)},this.showOtherMarkers=function(){if(this.othersActive)return;var e=this.session,t=this;this.othersActive=!0,this.others.forEach(function(n){n.markerId=e.addMarker(new r(n.row,n.column,n.row,n.column+t.length),t.othersClass,null,!1)})},this.hideOtherMarkers=function(){if(!this.othersActive)return;this.othersActive=!1;for(var e=0;e<this.others.length;e++)this.session.removeMarker(this.others[e].markerId)},this.onUpdate=function(e){if(this.$updating)return this.updateAnchors(e);var t=e;if(t.start.row!==t.end.row)return;if(t.start.row!==this.pos.row)return;this.$updating=!0;var n=e.action==="insert"?t.end.column-t.start.column:t.start.column-t.end.column,i=t.start.column>=this.pos.column&&t.start.column<=this.pos.column+this.length+1,s=t.start.column-this.pos.column;this.updateAnchors(e),i&&(this.length+=n);if(i&&!this.session.$fromUndo)if(e.action==="insert")for(var o=this.others.length-1;o>=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};this.doc.insertMergedLines(a,e.lines)}else if(e.action==="remove")for(var o=this.others.length-1;o>=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};this.doc.remove(new r(a.row,a.column,a.row,a.column-n))}this.$updating=!1,this.updateMarkers()},this.updateAnchors=function(e){this.pos.onChange(e);for(var t=this.others.length;t--;)this.others[t].onChange(e);this.updateMarkers()},this.updateMarkers=function(){if(this.$updating)return;var e=this,t=this.session,n=function(n,i){t.removeMarker(n.markerId),n.markerId=t.addMarker(new r(n.row,n.column,n.row,n.column+e.length),i,null,!1)};n(this.pos,this.mainClass);for(var i=this.others.length;i--;)n(this.others[i],this.othersClass)},this.onCursorChange=function(e){if(this.$updating||!this.session)return;var t=this.session.selection.getCursor();t.row===this.pos.row&&t.column>=this.pos.column&&t.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",e)):(this.hideOtherMarkers(),this._emit("cursorLeave",e))},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.off("change",this.$onUpdate),this.session.selection.off("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(this.$undoStackDepth===-1)return;var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth;for(var n=0;n<t;n++)e.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}).call(o.prototype),t.PlaceHolder=o}),ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(e,t,n){function s(e,t){return e.row==t.row&&e.column==t.column}function o(e){var t=e.domEvent,n=t.altKey,o=t.shiftKey,u=t.ctrlKey,a=e.getAccelKey(),f=e.getButton();u&&i.isMac&&(f=t.button);if(e.editor.inMultiSelectMode&&f==2){e.editor.textInput.onContextMenu(e.domEvent);return}if(!u&&!n&&!a){f===0&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode();return}if(f!==0)return;var l=e.editor,c=l.selection,h=l.inMultiSelectMode,p=e.getDocumentPosition(),d=c.getCursor(),v=e.inSelection()||c.isEmpty()&&s(p,d),m=e.x,g=e.y,y=function(e){m=e.clientX,g=e.clientY},b=l.session,w=l.renderer.pixelToScreenCoordinates(m,g),E=w,S;if(l.$mouseHandler.$enableJumpToDef)u&&n||a&&n?S=o?"block":"add":n&&l.$blockSelectEnabled&&(S="block");else if(a&&!n){S="add";if(!h&&o)return}else n&&l.$blockSelectEnabled&&(S="block");S&&i.isMac&&t.ctrlKey&&l.$mouseHandler.cancelContextMenu();if(S=="add"){if(!h&&v)return;if(!h){var x=c.toOrientedRange();l.addSelectionMarker(x)}var T=c.rangeList.rangeAtPoint(p);l.inVirtualSelectionMode=!0,o&&(T=null,x=c.ranges[0]||x,l.removeSelectionMarker(x)),l.once("mouseup",function(){var e=c.toOrientedRange();T&&e.isEmpty()&&s(T.cursor,e.cursor)?c.substractPoint(e.cursor):(o?c.substractPoint(x.cursor):x&&(l.removeSelectionMarker(x),c.addRange(x)),c.addRange(e)),l.inVirtualSelectionMode=!1})}else if(S=="block"){e.stop(),l.inVirtualSelectionMode=!0;var N,C=[],k=function(){var e=l.renderer.pixelToScreenCoordinates(m,g),t=b.screenToDocumentPosition(e.row,e.column,e.offsetX);if(s(E,e)&&s(t,c.lead))return;E=e,l.selection.moveToPosition(t),l.renderer.scrollCursorIntoView(),l.removeSelectionMarkers(C),C=c.rectangularRangeBlock(E,w),l.$mouseHandler.$clickSelection&&C.length==1&&C[0].isEmpty()&&(C[0]=l.$mouseHandler.$clickSelection.clone()),C.forEach(l.addSelectionMarker,l),l.updateSelectionMarkers()};h&&!a?c.toSingleRange():!h&&a&&(N=c.toOrientedRange(),l.addSelectionMarker(N)),o?w=b.documentToScreenPosition(c.lead):c.moveToPosition(p),E={row:-1,column:-1};var L=function(e){k(),clearInterval(O),l.removeSelectionMarkers(C),C.length||(C=[c.toOrientedRange()]),N&&(l.removeSelectionMarker(N),c.toSingleRange(N));for(var t=0;t<C.length;t++)c.addRange(C[t]);l.inVirtualSelectionMode=!1,l.$mouseHandler.$clickSelection=null},A=k;r.capture(l.container,y,L);var O=setInterval(function(){A()},20);return e.preventDefault()}}var r=e("../lib/event"),i=e("../lib/useragent");t.onMouseDown=o}),ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(e,t,n){t.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(e){e.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(e){e.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(e){e.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(e){e.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(e){e.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(e){e.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.rangeCount>1?e.multiSelect.joinSelections():e.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(e){e.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(e){e.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],t.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(e){e.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(e){return e&&e.inMultiSelectMode}}];var r=e("../keyboard/hash_handler").HashHandler;t.keyboardHandler=new r(t.multiSelectCommands)}),ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(e,t,n){function h(e,t,n){return c.$options.wrap=!0,c.$options.needle=t,c.$options.backwards=n==-1,c.find(e)}function v(e,t){return e.row==t.row&&e.column==t.column}function m(e){if(e.$multiselectOnSessionChange)return;e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=t.onSessionChange.bind(e),e.$checkMultiselectChange=e.$checkMultiselectChange.bind(e),e.$multiselectOnSessionChange(e),e.on("changeSession",e.$multiselectOnSessionChange),e.on("mousedown",o),e.commands.addCommands(f.defaultCommands),g(e)}function g(e){function r(t){n&&(e.renderer.setMouseCursor(""),n=!1)}if(!e.textInput)return;var t=e.textInput.getElement(),n=!1;u.addListener(t,"keydown",function(t){var i=t.keyCode==18&&!(t.ctrlKey||t.shiftKey||t.metaKey);e.$blockSelectEnabled&&i?n||(e.renderer.setMouseCursor("crosshair"),n=!0):n&&r()},e),u.addListener(t,"keyup",r,e),u.addListener(t,"blur",r,e)}var r=e("./range_list").RangeList,i=e("./range").Range,s=e("./selection").Selection,o=e("./mouse/multi_select_handler").onMouseDown,u=e("./lib/event"),a=e("./lib/lang"),f=e("./commands/multi_select_commands");t.commands=f.defaultCommands.concat(f.multiSelectCommands);var l=e("./search").Search,c=new l,p=e("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(p.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(!e)return;if(!this.inMultiSelectMode&&this.rangeCount===0){var n=this.toOrientedRange();this.rangeList.add(n),this.rangeList.add(e);if(this.rangeList.ranges.length!=2)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(n),this.$onAddRange(n)}e.cursor||(e.cursor=e.end);var r=this.rangeList.add(e);return this.$onAddRange(e),r.length&&this.$onRemoveRange(r),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&&this.$onRemoveRange(t),e&&this.fromOrientedRange(e)},this.substractPoint=function(e){var t=this.rangeList.substractPoint(e);if(t)return this.$onRemoveRange(t),t[0]},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length&&this.$onRemoveRange(e)},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal("addRange",{range:e})},this.$onRemoveRange=function(e){this.rangeCount=this.rangeList.ranges.length;if(this.rangeCount==1&&this.inMultiSelectMode){var t=this.rangeList.ranges.pop();e.push(t),this.rangeCount=0}for(var n=e.length;n--;){var r=this.ranges.indexOf(e[n]);this.ranges.splice(r,1)}this._signal("removeRange",{ranges:e}),this.rangeCount===0&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),t=t||this.ranges[0],t&&!t.isEqual(this.getRange())&&this.fromOrientedRange(t)},this.$initRangeList=function(){if(this.rangeList)return;this.rangeList=new r,this.ranges=[],this.rangeCount=0},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){var e=this.ranges.length?this.ranges:[this.getRange()],t=[];for(var n=0;n<e.length;n++){var r=e[n],s=r.start.row,o=r.end.row;if(s===o)t.push(r.clone());else{t.push(new i(s,r.start.column,s,this.session.getLine(s).length));while(++s<o)t.push(this.getLineRange(s,!0));t.push(new i(o,0,o,r.end.column))}n==0&&!this.isBackwards()&&(t=t.reverse())}this.toSingleRange();for(var n=t.length;n--;)this.addRange(t[n])},this.joinSelections=function(){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)},this.toggleBlockSelection=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var r=this.session.documentToScreenPosition(this.cursor),s=this.session.documentToScreenPosition(this.anchor),o=this.rectangularRangeBlock(r,s);o.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(e,t,n){var r=[],s=e.column<t.column;if(s)var o=e.column,u=t.column,a=e.offsetX,f=t.offsetX;else var o=t.column,u=e.column,a=t.offsetX,f=e.offsetX;var l=e.row<t.row;if(l)var c=e.row,h=t.row;else var c=t.row,h=e.row;o<0&&(o=0),c<0&&(c=0),c==h&&(n=!0);var p;for(var d=c;d<=h;d++){var m=i.fromPoints(this.session.screenToDocumentPosition(d,o,a),this.session.screenToDocumentPosition(d,u,f));if(m.isEmpty()){if(p&&v(m.end,p))break;p=m.end}m.cursor=s?m.start:m.end,r.push(m)}l&&r.reverse();if(!n){var g=r.length-1;while(r[g].isEmpty()&&g>0)g--;if(g>0){var y=0;while(r[y].isEmpty())y++}for(var b=g;b>=y;b--)r[b].isEmpty()&&r.splice(b,1)}return r}}.call(s.prototype);var d=e("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,"ace_selection",t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){if(!e.marker)return;this.session.removeMarker(e.marker);var t=this.session.$selectionMarkers.indexOf(e);t!=-1&&this.session.$selectionMarkers.splice(t,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length},this.removeSelectionMarkers=function(e){var t=this.session.$selectionMarkers;for(var n=e.length;n--;){var r=e[n];if(!r.marker)continue;this.session.removeMarker(r.marker);var i=t.indexOf(r);i!=-1&&t.splice(i,1)}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){if(this.inMultiSelectMode)return;this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(f.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onSingleSelect=function(e){if(this.session.multiSelect.inVirtualMode)return;this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(f.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection")},this.$onMultiSelectExec=function(e){var t=e.command,n=e.editor;if(!n.multiSelect)return;if(!t.multiSelectAction){var r=t.exec(n,e.args||{});n.multiSelect.addRange(n.multiSelect.toOrientedRange()),n.multiSelect.mergeOverlappingRanges()}else t.multiSelectAction=="forEach"?r=n.forEachSelection(t,e.args):t.multiSelectAction=="forEachLine"?r=n.forEachSelection(t,e.args,!0):t.multiSelectAction=="single"?(n.exitMultiSelectMode(),r=t.exec(n,e.args||{})):r=t.multiSelectAction(n,e.args||{});return r},this.forEachSelection=function(e,t,n){if(this.inVirtualSelectionMode)return;var r=n&&n.keepOrder,i=n==1||n&&n.$byLines,o=this.session,u=this.selection,a=u.rangeList,f=(r?u:a).ranges,l;if(!f.length)return e.exec?e.exec(this,t||{}):e(this,t||{});var c=u._eventRegistry;u._eventRegistry={};var h=new s(o);this.inVirtualSelectionMode=!0;for(var p=f.length;p--;){if(i)while(p>0&&f[p].start.row==f[p-1].end.row)p--;h.fromOrientedRange(f[p]),h.index=p,this.selection=o.selection=h;var d=e.exec?e.exec(this,t||{}):e(this,t||{});!l&&d!==undefined&&(l=d),h.toOrientedRange(f[p])}h.detach(),this.selection=o.selection=u,this.inVirtualSelectionMode=!1,u._eventRegistry=c,u.mergeOverlappingRanges(),u.ranges[0]&&u.fromOrientedRange(u.ranges[0]);var v=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),v&&v.from==v.to&&this.renderer.animateScrolling(v.from),l},this.exitMultiSelectMode=function(){if(!this.inMultiSelectMode||this.inVirtualSelectionMode)return;this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var t=this.multiSelect.rangeList.ranges,n=[];for(var r=0;r<t.length;r++)n.push(this.session.getTextRange(t[r]));var i=this.session.getDocument().getNewLineCharacter();e=n.join(i),e.length==(n.length-1)*i.length&&(e="")}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.$checkMultiselectChange=function(e,t){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var n=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&t==this.multiSelect.anchor)return;var r=t==this.multiSelect.anchor?n.cursor==n.start?n.end:n.start:n.cursor;r.row!=t.row||this.session.$clipPositionToDocument(r.row,r.column).column!=t.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()}},this.findAll=function(e,t,n){t=t||{},t.needle=e||t.needle;if(t.needle==undefined){var r=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();t.needle=this.session.getTextRange(r)}this.$search.set(t);var i=this.$search.findAll(this.session);if(!i.length)return 0;var s=this.multiSelect;n||s.toSingleRange(i[0]);for(var o=i.length;o--;)s.addRange(i[o],!0);return r&&s.rangeList.rangeAtPoint(r.start)&&s.addRange(r,!0),i.length},this.selectMoreLines=function(e,t){var n=this.selection.toOrientedRange(),r=n.cursor==n.end,s=this.session.documentToScreenPosition(n.cursor);this.selection.$desiredColumn&&(s.column=this.selection.$desiredColumn);var o=this.session.screenToDocumentPosition(s.row+e,s.column);if(!n.isEmpty())var u=this.session.documentToScreenPosition(r?n.end:n.start),a=this.session.screenToDocumentPosition(u.row+e,u.column);else var a=o;if(r){var f=i.fromPoints(o,a);f.cursor=f.start}else{var f=i.fromPoints(a,o);f.cursor=f.end}f.desiredColumn=s.column;if(!this.selection.inMultiSelectMode)this.selection.addRange(n);else if(t)var l=n.cursor;this.selection.addRange(f),l&&this.selection.substractPoint(l)},this.transposeSelections=function(e){var t=this.session,n=t.multiSelect,r=n.ranges;for(var i=r.length;i--;){var s=r[i];if(s.isEmpty()){var o=t.getWordRange(s.start.row,s.start.column);s.start.row=o.start.row,s.start.column=o.start.column,s.end.row=o.end.row,s.end.column=o.end.column}}n.mergeOverlappingRanges();var u=[];for(var i=r.length;i--;){var s=r[i];u.unshift(t.getTextRange(s))}e<0?u.unshift(u.pop()):u.push(u.shift());for(var i=r.length;i--;){var s=r[i],o=s.clone();t.replace(s,u[i]),s.start.row=o.start.row,s.start.column=o.start.column}n.fromOrientedRange(n.ranges[0])},this.selectMore=function(e,t,n){var r=this.session,i=r.multiSelect,s=i.toOrientedRange();if(s.isEmpty()){s=r.getWordRange(s.start.row,s.start.column),s.cursor=e==-1?s.start:s.end,this.multiSelect.addRange(s);if(n)return}var o=r.getTextRange(s),u=h(r,o,e);u&&(u.cursor=e==-1?u.start:u.end,this.session.unfold(u),this.multiSelect.addRange(u),this.renderer.scrollCursorIntoView(null,.5)),t&&this.multiSelect.substractPoint(s.cursor)},this.alignCursors=function(){var e=this.session,t=e.multiSelect,n=t.ranges,r=-1,s=n.filter(function(e){if(e.cursor.row==r)return!0;r=e.cursor.row});if(!n.length||s.length==n.length-1){var o=this.selection.getRange(),u=o.start.row,f=o.end.row,l=u==f;if(l){var c=this.session.getLength(),h;do h=this.session.getLine(f);while(/[=:]/.test(h)&&++f<c);do h=this.session.getLine(u);while(/[=:]/.test(h)&&--u>0);u<0&&(u=0),f>=c&&(f=c-1)}var p=this.session.removeFullLines(u,f);p=this.$reAlignText(p,l),this.session.insert({row:u,column:0},p.join("\n")+"\n"),l||(o.start.column=0,o.end.column=p[p.length-1].length),this.selection.setRange(o)}else{s.forEach(function(e){t.substractPoint(e.cursor)});var d=0,v=Infinity,m=n.map(function(t){var n=t.cursor,r=e.getLine(n.row),i=r.substr(n.column).search(/\S/g);return i==-1&&(i=0),n.column>d&&(d=n.column),i<v&&(v=i),i});n.forEach(function(t,n){var r=t.cursor,s=d-r.column,o=m[n]-v;s>o?e.insert(r,a.stringRepeat(" ",s-o)):e.remove(new i(r.row,r.column,r.row,r.column-s+o)),t.start.column=t.end.column=d,t.start.row=t.end.row=r.row,t.cursor=t.end}),t.fromOrientedRange(n[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}},this.$reAlignText=function(e,t){function u(e){return a.stringRepeat(" ",e)}function f(e){return e[2]?u(i)+e[2]+u(s-e[2].length+o)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function l(e){return e[2]?u(i+s-e[2].length)+e[2]+u(o)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}function c(e){return e[2]?u(i)+e[2]+u(o)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}var n=!0,r=!0,i,s,o;return e.map(function(e){var t=e.match(/(\s*)(.*?)(\s*)([=:].*)/);return t?i==null?(i=t[1].length,s=t[2].length,o=t[3].length,t):(i+s+o!=t[1].length+t[2].length+t[3].length&&(r=!1),i!=t[1].length&&(n=!1),i>t[1].length&&(i=t[1].length),s<t[2].length&&(s=t[2].length),o>t[3].length&&(o=t[3].length),t):[e]}).map(t?f:n?r?l:f:c)}}).call(d.prototype),t.onSessionChange=function(e){var t=e.session;t&&!t.multiSelect&&(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t&&t.multiSelect;var n=e.oldSession;n&&(n.multiSelect.off("addRange",this.$onAddRange),n.multiSelect.off("removeRange",this.$onRemoveRange),n.multiSelect.off("multiSelect",this.$onMultiSelect),n.multiSelect.off("singleSelect",this.$onSingleSelect),n.multiSelect.lead.off("change",this.$checkMultiselectChange),n.multiSelect.anchor.off("change",this.$checkMultiselectChange)),t&&(t.multiSelect.on("addRange",this.$onAddRange),t.multiSelect.on("removeRange",this.$onRemoveRange),t.multiSelect.on("multiSelect",this.$onMultiSelect),t.multiSelect.on("singleSelect",this.$onSingleSelect),t.multiSelect.lead.on("change",this.$checkMultiselectChange),t.multiSelect.anchor.on("change",this.$checkMultiselectChange)),t&&this.inMultiSelectMode!=t.selection.inMultiSelectMode&&(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},t.MultiSelect=m,e("./config").defineOptions(d.prototype,"editor",{enableMultiselect:{set:function(e){m(this),e?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",o)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",o))},value:!0},enableBlockSelect:{set:function(e){this.$blockSelectEnabled=e},value:!0}})}),ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(e,t,n){"use strict";var r=e("../../range").Range,i=t.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);return this.foldingStartMarker.test(r)?"start":t=="markbeginend"&&this.foldingStopMarker&&this.foldingStopMarker.test(r)?"end":""},this.getFoldWidgetRange=function(e,t,n){return null},this.indentationBlock=function(e,t,n){var i=/\S/,s=e.getLine(t),o=s.search(i);if(o==-1)return;var u=n||s.length,a=e.getLength(),f=t,l=t;while(++t<a){var c=e.getLine(t).search(i);if(c==-1)continue;if(c<=o){var h=e.getTokenAt(t,0);if(!h||h.type!=="string")break}l=t}if(l>f){var p=e.getLine(l).length;return new r(f,u,l,p)}},this.openingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i+1},u=e.$findClosingBracket(t,o,s);if(!u)return;var a=e.foldWidgets[u.row];return a==null&&(a=e.getFoldWidget(u.row)),a=="start"&&u.row>o.row&&(u.row--,u.column=e.getLine(u.row).length),r.fromPoints(o,u)},this.closingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i},u=e.$findOpeningBracket(t,o);if(!u)return;return u.column++,o.column--,r.fromPoints(u,o)}}).call(i.prototype)}),ace.define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";t.isDark=!1,t.cssClass="ace-tm",t.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',t.$id="ace/theme/textmate";var r=e("../lib/dom");r.importCssString(t.cssText,t.cssClass,!1)}),ace.define("ace/line_widgets",["require","exports","module","ace/lib/dom"],function(e,t,n){"use strict";function i(e){this.session=e,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}var r=e("./lib/dom");(function(){this.getRowLength=function(e){var t;return this.lineWidgets?t=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0:t=0,!this.$useWrapMode||!this.$wrapData[e]?1+t:this.$wrapData[e].length+1+t},this.$getWidgetScreenLength=function(){var e=0;return this.lineWidgets.forEach(function(t){t&&t.rowCount&&!t.hidden&&(e+=t.rowCount)}),e},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(e){e&&e.widgetManager&&e.widgetManager!=this&&e.widgetManager.detach();if(this.editor==e)return;this.detach(),this.editor=e,e&&(e.widgetManager=this,e.renderer.on("beforeRender",this.measureWidgets),e.renderer.on("afterRender",this.renderWidgets))},this.detach=function(e){var t=this.editor;if(!t)return;this.editor=null,t.widgetManager=null,t.renderer.off("beforeRender",this.measureWidgets),t.renderer.off("afterRender",this.renderWidgets);var n=this.session.lineWidgets;n&&n.forEach(function(e){e&&e.el&&e.el.parentNode&&(e._inDocument=!1,e.el.parentNode.removeChild(e.el))})},this.updateOnFold=function(e,t){var n=t.lineWidgets;if(!n||!e.action)return;var r=e.data,i=r.start.row,s=r.end.row,o=e.action=="add";for(var u=i+1;u<s;u++)n[u]&&(n[u].hidden=o);n[s]&&(o?n[i]?n[s].hidden=o:n[i]=n[s]:(n[i]==n[s]&&(n[i]=undefined),n[s].hidden=o))},this.updateOnChange=function(e){var t=this.session.lineWidgets;if(!t)return;var n=e.start.row,r=e.end.row-n;if(r!==0)if(e.action=="remove"){var i=t.splice(n+1,r);!t[n]&&i[i.length-1]&&(t[n]=i.pop()),i.forEach(function(e){e&&this.removeLineWidget(e)},this),this.$updateRows()}else{var s=new Array(r);t[n]&&t[n].column!=null&&e.start.column>t[n].column&&n++,s.unshift(n,0),t.splice.apply(t,s),this.$updateRows()}},this.$updateRows=function(){var e=this.session.lineWidgets;if(!e)return;var t=!0;e.forEach(function(e,n){if(e){t=!1,e.row=n;while(e.$oldWidget)e.$oldWidget.row=n,e=e.$oldWidget}}),t&&(this.session.lineWidgets=null)},this.$registerLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var t=this.session.lineWidgets[e.row];return t&&(e.$oldWidget=t,t.el&&t.el.parentNode&&(t.el.parentNode.removeChild(t.el),t._inDocument=!1)),this.session.lineWidgets[e.row]=e,e},this.addLineWidget=function(e){this.$registerLineWidget(e),e.session=this.session;if(!this.editor)return e;var t=this.editor.renderer;e.html&&!e.el&&(e.el=r.createElement("div"),e.el.innerHTML=e.html),e.el&&(r.addCssClass(e.el,"ace_lineWidgetContainer"),e.el.style.position="absolute",e.el.style.zIndex=5,t.container.appendChild(e.el),e._inDocument=!0,e.coverGutter||(e.el.style.zIndex=3),e.pixelHeight==null&&(e.pixelHeight=e.el.offsetHeight)),e.rowCount==null&&(e.rowCount=e.pixelHeight/t.layerConfig.lineHeight);var n=this.session.getFoldAt(e.row,0);e.$fold=n;if(n){var i=this.session.lineWidgets;e.row==n.end.row&&!i[n.start.row]?i[n.start.row]=e:e.hidden=!0}return this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,t),this.onWidgetChanged(e),e},this.removeLineWidget=function(e){e._inDocument=!1,e.session=null,e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el);if(e.editor&&e.editor.destroy)try{e.editor.destroy()}catch(t){}if(this.session.lineWidgets){var n=this.session.lineWidgets[e.row];if(n==e)this.session.lineWidgets[e.row]=e.$oldWidget,e.$oldWidget&&this.onWidgetChanged(e.$oldWidget);else while(n){if(n.$oldWidget==e){n.$oldWidget=e.$oldWidget;break}n=n.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(e){var t=this.session.lineWidgets,n=t&&t[e],r=[];while(n)r.push(n),n=n.$oldWidget;return r},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var n=this.session._changedWidgets,r=t.layerConfig;if(!n||!n.length)return;var i=Infinity;for(var s=0;s<n.length;s++){var o=n[s];if(!o||!o.el)continue;if(o.session!=this.session)continue;if(!o._inDocument){if(this.session.lineWidgets[o.row]!=o)continue;o._inDocument=!0,t.container.appendChild(o.el)}o.h=o.el.offsetHeight,o.fixedWidth||(o.w=o.el.offsetWidth,o.screenWidth=Math.ceil(o.w/r.characterWidth));var u=o.h/r.lineHeight;o.coverLine&&(u-=this.session.getRowLineCount(o.row),u<0&&(u=0)),o.rowCount!=u&&(o.rowCount=u,o.row<i&&(i=o.row))}i!=Infinity&&(this.session._emit("changeFold",{data:{start:{row:i}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]},this.renderWidgets=function(e,t){var n=t.layerConfig,r=this.session.lineWidgets;if(!r)return;var i=Math.min(this.firstRow,n.firstRow),s=Math.max(this.lastRow,n.lastRow,r.length);while(i>0&&!r[i])i--;this.firstRow=n.firstRow,this.lastRow=n.lastRow,t.$cursorLayer.config=n;for(var o=i;o<=s;o++){var u=r[o];if(!u||!u.el)continue;if(u.hidden){u.el.style.top=-100-(u.pixelHeight||0)+"px";continue}u._inDocument||(u._inDocument=!0,t.container.appendChild(u.el));var a=t.$cursorLayer.getPixelPosition({row:o,column:0},!0).top;u.coverLine||(a+=n.lineHeight*this.session.getRowLineCount(u.row)),u.el.style.top=a-n.offset+"px";var f=u.coverGutter?0:t.gutterWidth;u.fixedWidth||(f-=t.scrollLeft),u.el.style.left=f+"px",u.fullWidth&&u.screenWidth&&(u.el.style.minWidth=n.width+2*n.padding+"px"),u.fixedWidth?u.el.style.right=t.scrollBar.getWidth()+"px":u.el.style.right=""}}}).call(i.prototype),t.LineWidgets=i}),ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],function(e,t,n){"use strict";function o(e,t,n){var r=0,i=e.length-1;while(r<=i){var s=r+i>>1,o=n(t,e[s]);if(o>0)r=s+1;else{if(!(o<0))return s;i=s-1}}return-(r+1)}function u(e,t,n){var r=e.getAnnotations().sort(s.comparePoints);if(!r.length)return;var i=o(r,{row:t,column:-1},s.comparePoints);i<0&&(i=-i-1),i>=r.length?i=n>0?0:r.length-1:i===0&&n<0&&(i=r.length-1);var u=r[i];if(!u||!n)return;if(u.row===t){do u=r[i+=n];while(u&&u.row===t);if(!u)return r.slice()}var a=[];t=u.row;do a[n<0?"unshift":"push"](u),u=r[i+=n];while(u&&u.row==t);return a.length&&a}var r=e("../line_widgets").LineWidgets,i=e("../lib/dom"),s=e("../range").Range;t.showErrorMarker=function(e,t){var n=e.session;n.widgetManager||(n.widgetManager=new r(n),n.widgetManager.attach(e));var s=e.getCursorPosition(),o=s.row,a=n.widgetManager.getWidgetsAtRow(o).filter(function(e){return e.type=="errorMarker"})[0];a?a.destroy():o-=t;var f=u(n,o,t),l;if(f){var c=f[0];s.column=(c.pos&&typeof c.column!="number"?c.pos.sc:c.column)||0,s.row=c.row,l=e.renderer.$gutterLayer.$annotations[s.row]}else{if(a)return;l={text:["Looks good!"],className:"ace_ok"}}e.session.unfold(s.row),e.selection.moveToPosition(s);var h={row:s.row,fixedWidth:!0,coverGutter:!0,el:i.createElement("div"),type:"errorMarker"},p=h.el.appendChild(i.createElement("div")),d=h.el.appendChild(i.createElement("div"));d.className="error_widget_arrow "+l.className;var v=e.renderer.$cursorLayer.getPixelPosition(s).left;d.style.left=v+e.renderer.gutterWidth-5+"px",h.el.className="error_widget_wrapper",p.className="error_widget "+l.className,p.innerHTML=l.text.join("<br>"),p.appendChild(i.createElement("div"));var m=function(e,t,n){if(t===0&&(n==="esc"||n==="return"))return h.destroy(),{command:"null"}};h.destroy=function(){if(e.$mouseHandler.isMousePressed)return;e.keyBinding.removeKeyboardHandler(m),n.widgetManager.removeLineWidget(h),e.off("changeSelection",h.destroy),e.off("changeSession",h.destroy),e.off("mouseup",h.destroy),e.off("change",h.destroy)},e.keyBinding.addKeyboardHandler(m),e.on("changeSelection",h.destroy),e.on("changeSession",h.destroy),e.on("mouseup",h.destroy),e.on("change",h.destroy),e.session.widgetManager.addLineWidget(h),h.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:h.el.offsetHeight})},i.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","error_marker.css",!1)}),ace.define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/range","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"],function(e,t,n){"use strict";e("./lib/fixoldbrowsers");var r=e("./lib/dom"),i=e("./lib/event"),s=e("./range").Range,o=e("./editor").Editor,u=e("./edit_session").EditSession,a=e("./undomanager").UndoManager,f=e("./virtual_renderer").VirtualRenderer;e("./worker/worker_client"),e("./keyboard/hash_handler"),e("./placeholder"),e("./multi_select"),e("./mode/folding/fold_mode"),e("./theme/textmate"),e("./ext/error_marker"),t.config=e("./config"),t.require=e,typeof define=="function"&&(t.define=define),t.edit=function(e,n){if(typeof e=="string"){var s=e;e=document.getElementById(s);if(!e)throw new Error("ace.edit can't find div #"+s)}if(e&&e.env&&e.env.editor instanceof o)return e.env.editor;var u="";if(e&&/input|textarea/i.test(e.tagName)){var a=e;u=a.value,e=r.createElement("pre"),a.parentNode.replaceChild(e,a)}else e&&(u=e.textContent,e.innerHTML="");var l=t.createEditSession(u),c=new o(new f(e),l,n),h={document:l,editor:c,onResize:c.resize.bind(c,null)};return a&&(h.textarea=a),i.addListener(window,"resize",h.onResize),c.on("destroy",function(){i.removeListener(window,"resize",h.onResize),h.editor.container.env=null}),c.container.env=c.env=h,c},t.createEditSession=function(e,t){var n=new u(e,t);return n.setUndoManager(new a),n},t.Range=s,t.Editor=o,t.EditSession=u,t.UndoManager=a,t.VirtualRenderer=f,t.version=t.config.version});            (function() {
                ace.require(["ace/ace"], function(a) {
                    if (a) {
                        a.config.init(true);
                        a.define = ace.define;
                    }
                    if (!window.ace)
                        window.ace = a;
                    for (var key in a) if (a.hasOwnProperty(key))
                        window.ace[key] = a[key];
                    window.ace["default"] = window.ace;
                    if (typeof module == "object" && typeof exports == "object" && module) {
                        module.exports = window.ace;
                    }
                });
            })();
        </script> <script id='ace_editor'  type='text/javascript'  charset='utf-8'>ace.define("ace/snippets",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/editor"],function(e,t,n){"use strict";function p(e){var t=(new Date).toLocaleString("en-us",e);return t.length==1?"0"+t:t}var r=e("./lib/dom"),i=e("./lib/oop"),s=e("./lib/event_emitter").EventEmitter,o=e("./lib/lang"),u=e("./range").Range,a=e("./range_list").RangeList,f=e("./keyboard/hash_handler").HashHandler,l=e("./tokenizer").Tokenizer,c=e("./clipboard"),h={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,n){var r=e.session.getTextRange();return n?r.replace(/\n\r?([ \t]*\S)/g,"\n"+n+"$1"):r},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return c.getText&&c.getText()},FILENAME:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\\]*$/,"")},FILEPATH:function(e){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.start||""},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.end||""},LINE_COMMENT:function(e){var t=e.session.$mode||{};return t.lineCommentStart||""},CURRENT_YEAR:p.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:p.bind(null,{year:"2-digit"}),CURRENT_MONTH:p.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:p.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:p.bind(null,{month:"short"}),CURRENT_DATE:p.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:p.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:p.bind(null,{weekday:"short"}),CURRENT_HOUR:p.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:p.bind(null,{minute:"2-digit"}),CURRENT_SECOND:p.bind(null,{second:"2-digit"})};h.SELECTED_TEXT=h.SELECTION;var d=function(){this.snippetMap={},this.snippetNameMap={}};(function(){i.implement(this,s),this.getTokenizer=function(){return d.$tokenizer||this.createTokenizer()},this.createTokenizer=function(){function e(e){return e=e.substr(1),/^\d+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return"(?:[^\\\\"+e+"]|\\\\.)"}var n={regex:"/("+t("/")+"+)/",onMatch:function(e,t,n){var r=n[0];return r.fmtString=!0,r.guard=e.slice(1,-1),r.flag="",""},next:"formatString"};return d.$tokenizer=new l({start:[{regex:/\\./,onMatch:function(e,t,n){var r=e[1];return r=="}"&&n.length?e=r:"`$\\".indexOf(r)!=-1&&(e=r),[e]}},{regex:/}/,onMatch:function(e,t,n){return[n.length?n.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:e},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(t,n,r){var i=e(t.substr(1));return r.unshift(i[0]),i},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+t("\\|")+"*\\|",onMatch:function(e,t,n){var r=e.slice(1,-1).replace(/\\[,|\\]|,/g,function(e){return e.length==2?e[1]:"\0"}).split("\0").map(function(e){return{value:e}});return n[0].choices=r,[r[0]]},next:"start"},n,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(e,t,n){return n.length&&n[0].expectElse?(n[0].expectElse=!1,n[0].ifEnd={elseEnd:n[0]},[n[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(e,t,n){var r=e[1];return r=="}"&&n.length?e=r:"`$\\".indexOf(r)!=-1?e=r:r=="n"?e="\n":r=="t"?e="	":"ulULE".indexOf(r)!=-1&&(e={changeCase:r,local:r>"a"}),[e]}},{regex:"/\\w*}",onMatch:function(e,t,n){var r=n.shift();return r&&(r.flag=e.slice(1,-1)),this.next=r&&r.tabstopId?"start":"",[r||e]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(e,t,n){return[{text:e.slice(1)}]}},{regex:/\${\w+/,onMatch:function(e,t,n){var r={text:e.slice(2)};return n.unshift(r),[r]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(e,t,n){var r=n.shift();return this.next=r&&r.tabstopId?"start":"",[r||e]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(e,t,n){var r=n[0];return r.formatFunction=e.slice(2,-1),[n.shift()]},next:"formatString"},n,{regex:/:[\?\-+]?/,onMatch:function(e,t,n){e[1]=="+"&&(n[0].ifEnd=n[0]),e[1]=="?"&&(n[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),d.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.getVariableValue=function(e,t,n){if(/^\d+$/.test(t))return(this.variables.__||{})[t]||"";if(/^[A-Z]\d+$/.test(t))return(this.variables[t[0]+"__"]||{})[t.substr(1)]||"";t=t.replace(/^TM_/,"");if(!this.variables.hasOwnProperty(t))return"";var r=this.variables[t];return typeof r=="function"&&(r=this.variables[t](e,t,n)),r==null?"":r},this.variables=h,this.tmStrFormat=function(e,t,n){if(!t.fmt)return e;var r=t.flag||"",i=t.guard;i=new RegExp(i,r.replace(/[^gim]/g,""));var s=typeof t.fmt=="string"?this.tokenizeTmSnippet(t.fmt,"formatString"):t.fmt,o=this,u=e.replace(i,function(){var e=o.variables.__;o.variables.__=[].slice.call(arguments);var t=o.resolveVariables(s,n),r="E";for(var i=0;i<t.length;i++){var u=t[i];if(typeof u=="object"){t[i]="";if(u.changeCase&&u.local){var a=t[i+1];a&&typeof a=="string"&&(u.changeCase=="u"?t[i]=a[0].toUpperCase():t[i]=a[0].toLowerCase(),t[i+1]=a.substr(1))}else u.changeCase&&(r=u.changeCase)}else r=="U"?t[i]=u.toUpperCase():r=="L"&&(t[i]=u.toLowerCase())}return o.variables.__=e,t.join("")});return u},this.tmFormatFunction=function(e,t,n){return t.formatFunction=="upcase"?e.toUpperCase():t.formatFunction=="downcase"?e.toLowerCase():e},this.resolveVariables=function(e,t){function f(t){var n=e.indexOf(t,s+1);n!=-1&&(s=n)}var n=[],r="",i=!0;for(var s=0;s<e.length;s++){var o=e[s];if(typeof o=="string"){n.push(o),o=="\n"?(i=!0,r=""):i&&(r=/^\t*/.exec(o)[0],i=/\S/.test(o));continue}if(!o)continue;i=!1;if(o.fmtString){var u=e.indexOf(o,s+1);u==-1&&(u=e.length),o.fmt=e.slice(s+1,u),s=u}if(o.text){var a=this.getVariableValue(t,o.text,r)+"";o.fmtString&&(a=this.tmStrFormat(a,o,t)),o.formatFunction&&(a=this.tmFormatFunction(a,o,t)),a&&!o.ifEnd?(n.push(a),f(o)):!a&&o.ifEnd&&f(o.ifEnd)}else o.elseEnd?f(o.elseEnd):o.tabstopId!=null?n.push(o):o.changeCase!=null&&n.push(o)}return n},this.insertSnippetForSelection=function(e,t){function f(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(typeof r=="object"){if(a[r.tabstopId])continue;var i=e.lastIndexOf(r,n-1);r=t[i]||{tabstopId:r.tabstopId}}t[n]=r}return t}var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=e.session.getTabString(),s=r.match(/^\s*/)[0];n.column<s.length&&(s=s.slice(0,n.column)),t=t.replace(/\r/g,"");var o=this.tokenizeTmSnippet(t);o=this.resolveVariables(o,e),o=o.map(function(e){return e=="\n"?e+s:typeof e=="string"?e.replace(/\t/g,i):e});var u=[];o.forEach(function(e,t){if(typeof e!="object")return;var n=e.tabstopId,r=u[n];r||(r=u[n]=[],r.index=n,r.value="",r.parents={});if(r.indexOf(e)!==-1)return;e.choices&&!r.choices&&(r.choices=e.choices),r.push(e);var i=o.indexOf(e,t+1);if(i===-1)return;var s=o.slice(t+1,i),a=s.some(function(e){return typeof e=="object"});a&&!r.value?r.value=s:s.length&&(!r.value||typeof r.value!="string")&&(r.value=s.join(""))}),u.forEach(function(e){e.length=0});var a={};for(var l=0;l<o.length;l++){var c=o[l];if(typeof c!="object")continue;var h=c.tabstopId,p=u[h],d=o.indexOf(c,l+1);if(a[h]){a[h]===c&&(delete a[h],Object.keys(a).forEach(function(e){p.parents[e]=!0}));continue}a[h]=c;var m=p.value;typeof m!="string"?m=f(m):c.fmt&&(m=this.tmStrFormat(m,c,e)),o.splice.apply(o,[l+1,Math.max(0,d-l)].concat(m,c)),p.indexOf(c)===-1&&p.push(c)}var g=0,y=0,b="";o.forEach(function(e){if(typeof e=="string"){var t=e.split("\n");t.length>1?(y=t[t.length-1].length,g+=t.length-1):y+=e.length,b+=e}else e&&(e.start?e.end={row:g,column:y}:e.start={row:g,column:y})});var w=e.getSelectionRange(),E=e.session.replace(w,b),S=new v(e),x=e.inVirtualSelectionMode&&e.selection.index;S.addTabstops(u,w.start,E,x)},this.insertSnippet=function(e,t){var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t);e.forEachSelection(function(){n.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||"";t=t.split("/").pop();if(t==="html"||t==="php"){t==="php"&&!e.session.$mode.inlinePhp&&(t="html");var n=e.getCursorPosition(),r=e.session.getState(n.row);typeof r=="object"&&(r=r[0]),r.substring&&(r.substring(0,3)=="js-"?t="javascript":r.substring(0,4)=="css-"?t="css":r.substring(0,4)=="php-"&&(t="php"))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),n=[t],r=this.snippetMap;return r[t]&&r[t].includeScopes&&n.push.apply(n,r[t].includeScopes),n.push("_"),n},this.expandWithTab=function(e,t){var n=this,r=e.forEachSelection(function(){return n.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return r&&e.tabstopManager&&e.tabstopManager.tabNext(),r},this.expandSnippetForSelection=function(e,t){var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=r.substring(0,n.column),s=r.substr(n.column),o=this.snippetMap,u;return this.getActiveScopes(e).some(function(e){var t=o[e];return t&&(u=this.findMatchingSnippet(t,i,s)),!!u},this),u?t&&t.dryRun?!0:(e.session.doc.removeInLine(n.row,n.column-u.replaceBefore.length,n.column+u.replaceAfter.length),this.variables.M__=u.matchBefore,this.variables.T__=u.matchAfter,this.insertSnippetForSelection(e,u.content),this.variables.M__=this.variables.T__=null,!0):!1},this.findMatchingSnippet=function(e,t,n){for(var r=e.length;r--;){var i=e[r];if(i.startRe&&!i.startRe.test(t))continue;if(i.endRe&&!i.endRe.test(n))continue;if(!i.startRe&&!i.endRe)continue;return i.matchBefore=i.startRe?i.startRe.exec(t):[""],i.matchAfter=i.endRe?i.endRe.exec(n):[""],i.replaceBefore=i.triggerRe?i.triggerRe.exec(t)[0]:"",i.replaceAfter=i.endTriggerRe?i.endTriggerRe.exec(n)[0]:"",i}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){function s(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function u(e,t,n){return e=s(e),t=s(t),n?(e=t+e,e&&e[e.length-1]!="$"&&(e+="$")):(e+=t,e&&e[0]!="^"&&(e="^"+e)),new RegExp(e)}function a(e){e.scope||(e.scope=t||"_"),t=e.scope,n[t]||(n[t]=[],r[t]={});var s=r[t];if(e.name){var a=s[e.name];a&&i.unregister(a),s[e.name]=e}n[t].push(e),e.prefix&&(e.tabTrigger=e.prefix),!e.content&&e.body&&(e.content=Array.isArray(e.body)?e.body.join("\n"):e.body),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=o.escapeRegExp(e.tabTrigger));if(!e.trigger&&!e.guard&&!e.endTrigger&&!e.endGuard)return;e.startRe=u(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=u(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger)}var n=this.snippetMap,r=this.snippetNameMap,i=this;e||(e=[]),Array.isArray(e)?e.forEach(a):Object.keys(e).forEach(function(t){a(e[t])}),this._signal("registerSnippets",{scope:t})},this.unregister=function(e,t){function i(e){var i=r[e.scope||t];if(i&&i[e.name]){delete i[e.name];var s=n[e.scope||t],o=s&&s.indexOf(e);o>=0&&s.splice(o,1)}}var n=this.snippetMap,r=this.snippetNameMap;e.content?i(e):Array.isArray(e)&&e.forEach(i)},this.parseSnippetFile=function(e){e=e.replace(/\r/g,"");var t=[],n={},r=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm,i;while(i=r.exec(e)){if(i[1])try{n=JSON.parse(i[1]),t.push(n)}catch(s){}if(i[4])n.content=i[4].replace(/^\t/gm,""),t.push(n),n={};else{var o=i[2],u=i[3];if(o=="regex"){var a=/\/((?:[^\/\\]|\\.)*)|$/g;n.guard=a.exec(u)[1],n.trigger=a.exec(u)[1],n.endTrigger=a.exec(u)[1],n.endGuard=a.exec(u)[1]}else o=="snippet"?(n.tabTrigger=u.match(/^\S*/)[0],n.name||(n.name=u)):o&&(n[o]=u)}}return t},this.getSnippetByName=function(e,t){var n=this.snippetNameMap,r;return this.getActiveScopes(t).some(function(t){var i=n[t];return i&&(r=i[e]),!!r},this),r}}).call(d.prototype);var v=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=o.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){var t=e.action[0]=="r",n=this.selectedTabstop||{},r=n.parents||{},i=(this.tabstops||[]).slice();for(var s=0;s<i.length;s++){var o=i[s],u=o==n||r[o.index];o.rangeList.$bias=u?0:1;if(e.action=="remove"&&o!==n){var a=o.parents&&o.parents[n.index],f=o.rangeList.pointIndex(e.start,a);f=f<0?-f-1:f+1;var l=o.rangeList.pointIndex(e.end,a);l=l<0?-l-1:l-1;var c=o.rangeList.ranges.slice(f,l);for(var h=0;h<c.length;h++)this.removeRange(c[h])}o.rangeList.$onChange(e)}var p=this.editor.session;!this.$inChange&&t&&p.getLength()==1&&!p.getValue()&&this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(!e||!e.hasLinkedRanges||!e.firstNonLinked)return;this.$inChange=!0;var n=this.editor.session,r=n.getTextRange(e.firstNonLinked);for(var i=0;i<e.length;i++){var s=e[i];if(!s.linked)continue;var o=s.original,u=t.snippetManager.tmStrFormat(r,o,this.editor);n.replace(s,u)}this.$inChange=!1},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(!this.editor)return;var e=this.editor.selection.lead,t=this.editor.selection.anchor,n=this.editor.selection.isEmpty();for(var r=0;r<this.ranges.length;r++){if(this.ranges[r].linked)continue;var i=this.ranges[r].contains(e.row,e.column),s=n||this.ranges[r].contains(t.row,t.column);if(i&&s)return}this.detach()},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,n=this.index+(e||1);n=Math.min(Math.max(n,1),t),n==t&&(n=0),this.selectTabstop(n),n===0&&this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];t&&this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index];if(!t||!t.length)return;this.selectedTabstop=t;var n=t.firstNonLinked||t;t.choices&&(n.cursor=n.start);if(!this.editor.inVirtualSelectionMode){var r=this.editor.multiSelect;r.toSingleRange(n);for(var i=0;i<t.length;i++){if(t.hasLinkedRanges&&t[i].linked)continue;r.addRange(t[i].clone(),!0)}}else this.editor.selection.fromOrientedRange(n);this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})},this.addTabstops=function(e,t,n){var r=this.useLink||!this.editor.getOption("enableMultiselect");this.$openTabstops||(this.$openTabstops=[]);if(!e[0]){var i=u.fromPoints(n,n);g(i.start,t),g(i.end,t),e[0]=[i],e[0].index=0}var s=this.index,o=[s+1,0],f=this.ranges;e.forEach(function(e,n){var i=this.$openTabstops[n]||e;for(var s=0;s<e.length;s++){var l=e[s],c=u.fromPoints(l.start,l.end||l.start);m(c.start,t),m(c.end,t),c.original=l,c.tabstop=i,f.push(c),i!=e?i.unshift(c):i[s]=c,l.fmtString||i.firstNonLinked&&r?(c.linked=!0,i.hasLinkedRanges=!0):i.firstNonLinked||(i.firstNonLinked=c)}i.firstNonLinked||(i.hasLinkedRanges=!1),i===e&&(o.push(i),this.$openTabstops[n]=i),this.addTabstopMarkers(i),i.rangeList=i.rangeList||new a,i.rangeList.$bias=0,i.rangeList.addList(i)},this),o.length>2&&(this.tabstops.length&&o.push(o.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,o))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);t!=-1&&e.tabstop.splice(t,1),t=this.ranges.indexOf(e),t!=-1&&this.ranges.splice(t,1),t=e.tabstop.rangeList.ranges.indexOf(e),t!=-1&&e.tabstop.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),t!=-1&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new f,this.keyboardHandler.bindKeys({Tab:function(e){if(t.snippetManager&&t.snippetManager.expandWithTab(e))return;e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView()},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}})}).call(v.prototype);var m=function(e,t){e.row==0&&(e.column+=t.column),e.row+=t.row},g=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};r.importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}","snippets.css",!1),t.snippetManager=new d;var y=e("./editor").Editor;(function(){this.insertSnippet=function(e,n){return t.snippetManager.insertSnippet(this,e,n)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(y.prototype)}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom"],function(e,t,n){"use strict";var r=e("../virtual_renderer").VirtualRenderer,i=e("../editor").Editor,s=e("../range").Range,o=e("../lib/event"),u=e("../lib/lang"),a=e("../lib/dom"),f=function(e){var t=new r(e);t.$maxLines=4;var n=new i(t);return n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),n.renderer.setHighlightGutterLine(!1),n.$mouseHandler.$focusTimeout=0,n.$highlightTagPending=!0,n},l=function(e){var t=a.createElement("div"),n=new f(t);e&&e.appendChild(t),t.style.display="none",n.renderer.content.style.cursor="default",n.renderer.setStyle("ace_autocomplete"),n.setOption("displayIndentGuides",!1),n.setOption("dragDelay",150);var r=function(){};n.focus=r,n.$isFocused=!0,n.renderer.$cursorLayer.restartTimer=r,n.renderer.$cursorLayer.element.style.opacity=0,n.renderer.$maxLines=8,n.renderer.$keepTextAreaAtCursor=!1,n.setHighlightActiveLine(!1),n.session.highlight(""),n.session.$searchHighlight.clazz="ace_highlight-marker",n.on("mousedown",function(e){var t=e.getDocumentPosition();n.selection.moveToPosition(t),c.start.row=c.end.row=t.row,e.stop()});var i,l=new s(-1,0,-1,Infinity),c=new s(-1,0,-1,Infinity);c.id=n.session.addMarker(c,"ace_active-line","fullLine"),n.setSelectOnHover=function(e){e?l.id&&(n.session.removeMarker(l.id),l.id=null):l.id=n.session.addMarker(l,"ace_line-hover","fullLine")},n.setSelectOnHover(!1),n.on("mousemove",function(e){if(!i){i=e;return}if(i.x==e.x&&i.y==e.y)return;i=e,i.scrollTop=n.renderer.scrollTop;var t=i.getDocumentPosition().row;l.start.row!=t&&(l.id||n.setRow(t),p(t))}),n.renderer.on("beforeRender",function(){if(i&&l.start.row!=-1){i.$pos=null;var e=i.getDocumentPosition().row;l.id||n.setRow(e),p(e,!0)}}),n.renderer.on("afterRender",function(){var e=n.getRow(),t=n.renderer.$textLayer,r=t.element.childNodes[e-t.config.firstRow];r!==t.selectedNode&&t.selectedNode&&a.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=r,r&&a.addCssClass(r,"ace_selected")});var h=function(){p(-1)},p=function(e,t){e!==l.start.row&&(l.start.row=l.end.row=e,t||n.session._emit("changeBackMarker"),n._emit("changeHoverMarker"))};n.getHoveredRow=function(){return l.start.row},o.addListener(n.container,"mouseout",h),n.on("hide",h),n.on("changeSelection",h),n.session.doc.getLength=function(){return n.data.length},n.session.doc.getLine=function(e){var t=n.data[e];return typeof t=="string"?t:t&&t.value||""};var d=n.session.bgTokenizer;return d.$tokenizeRow=function(e){function s(e,n){e&&r.push({type:(t.className||"")+(n||""),value:e})}var t=n.data[e],r=[];if(!t)return r;typeof t=="string"&&(t={value:t});var i=t.caption||t.value||t.name,o=i.toLowerCase(),u=(n.filterText||"").toLowerCase(),a=0,f=0;for(var l=0;l<=u.length;l++)if(l!=f&&(t.matchMask&1<<l||l==u.length)){var c=u.slice(f,l);f=l;var h=o.indexOf(c,a);if(h==-1)continue;s(i.slice(a,h),""),a=h+c.length,s(i.slice(h,a),"completion-highlight")}return s(i.slice(a,i.length),""),t.meta&&r.push({type:"completion-meta",value:t.meta}),t.message&&r.push({type:"completion-message",value:t.message}),r},d.$updateOnChange=r,d.start=r,n.session.$computeWidth=function(){return this.screenWidth=0},n.isOpen=!1,n.isTopdown=!1,n.autoSelect=!0,n.filterText="",n.data=[],n.setData=function(e,t){n.filterText=t||"",n.setValue(u.stringRepeat("\n",e.length),-1),n.data=e||[],n.setRow(0)},n.getData=function(e){return n.data[e]},n.getRow=function(){return c.start.row},n.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),c.start.row!=e&&(n.selection.clearSelection(),c.start.row=c.end.row=e||0,n.session._emit("changeBackMarker"),n.moveCursorTo(e||0,0),n.isOpen&&n._signal("select"))},n.on("changeSelection",function(){n.isOpen&&n.setRow(n.selection.lead.row),n.renderer.scrollCursorIntoView()}),n.hide=function(){this.container.style.display="none",this._signal("hide"),n.isOpen=!1},n.show=function(e,t,r){var s=this.container,o=window.innerHeight,u=window.innerWidth,a=this.renderer,f=a.$maxLines*t*1.4,l=e.top+this.$borderSize,c=l>o/2&&!r;c&&l+t+f>o?(a.$maxPixelHeight=l-2*this.$borderSize,s.style.top="",s.style.bottom=o-l+"px",n.isTopdown=!1):(l+=t,a.$maxPixelHeight=o-l-.2*t,s.style.top=l+"px",s.style.bottom="",n.isTopdown=!0),s.style.display="";var h=e.left;h+s.offsetWidth>u&&(h=u-s.offsetWidth),s.style.left=h+"px",this._signal("show"),i=null,n.isOpen=!0},n.goTo=function(e){var t=this.getRow(),n=this.session.getLength()-1;switch(e){case"up":t=t<=0?n:t-1;break;case"down":t=t>=n?-1:t+1;break;case"start":t=0;break;case"end":t=n}this.setRow(t)},n.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},n.$imageSize=0,n.$borderSize=1,n};a.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}","autocompletion.css",!1),t.AcePopup=l,t.$singleLineEditor=f}),ace.define("ace/autocomplete/util",["require","exports","module"],function(e,t,n){"use strict";t.parForEach=function(e,t,n){var r=0,i=e.length;i===0&&n();for(var s=0;s<i;s++)t(e[s],function(e,t){r++,r===i&&n(e,t)})};var r=/[a-zA-Z_0-9\$\-\u00A2-\u2000\u2070-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t-1;s>=0;s--){if(!n.test(e[s]))break;i.push(e[s])}return i.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t;s<e.length;s++){if(!n.test(e[s]))break;i.push(e[s])}return i},t.getCompletionPrefix=function(e){var t=e.getCursorPosition(),n=e.session.getLine(t.row),r;return e.completers.forEach(function(e){e.identifierRegexps&&e.identifierRegexps.forEach(function(e){!r&&e&&(r=this.retrievePrecedingIdentifier(n,t.column,e))}.bind(this))}.bind(this)),r||this.retrievePrecedingIdentifier(n,t.column)}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config"],function(e,t,n){"use strict";var r=e("./keyboard/hash_handler").HashHandler,i=e("./autocomplete/popup").AcePopup,s=e("./autocomplete/util"),o=e("./lib/lang"),u=e("./lib/dom"),a=e("./snippets").snippetManager,f=e("./config"),l=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new r,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=o.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=o.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new i(document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,n){this.popup||this.$init(),this.popup.autoSelect=this.autoSelect,this.popup.setData(this.completions.filtered,this.completions.filterText),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var r=e.renderer;this.popup.setRow(this.autoSelect?0:-1);if(!n){this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var i=r.layerConfig.lineHeight,s=r.$cursorLayer.getPixelPosition(this.base,!0);s.left-=this.popup.getTextLeftOffset();var o=e.container.getBoundingClientRect();s.top+=o.top-r.layerConfig.offset,s.left+=o.left-e.renderer.scrollLeft,s.left+=r.gutterWidth,this.popup.show(s,i)}else n&&!t&&this.detach();this.changeTimer.cancel()},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,n=this.editor.textInput.getElement(),r=e.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(e.relatedTarget),i=this.popup&&this.popup.container;t!=n&&t.parentNode!=i&&!r&&t!=this.tooltipNode&&e.relatedTarget!=n&&this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){this.popup.goTo(e)},this.insertMatch=function(e,t){e||(e=this.popup.getData(this.popup.getRow()));if(!e)return!1;var n=this.completions;this.editor.startOperation({command:{name:"insertMatch"}});if(e.completer&&e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(n.filterText){var r=this.editor.selection.getAllRanges();for(var i=0,s;s=r[i];i++)s.start.column-=n.filterText.length,this.editor.session.remove(s)}e.snippet?a.insertSnippet(this.editor,e.snippet):this.editor.execCommand("insertstring",e.value||e)}this.completions==n&&this.detach(),this.editor.endOperation()},this.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(!!t||!!e.tabstopManager)return t;e.completer.goTo("down")},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var n=e.getSession(),r=e.getCursorPosition(),i=s.getCompletionPrefix(e);this.base=n.doc.createAnchor(r.row,r.column-i.length),this.base.$insertRight=!0;var o=[],u=e.completers.length;return e.completers.forEach(function(a,f){a.getCompletions(e,n,r,i,function(n,r){!n&&r&&(o=o.concat(r)),t(null,{prefix:s.getCompletionPrefix(e),matches:o,finished:--u===0})})}),!0},this.showPopup=function(e,t){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,t)},this.updateCompletions=function(e,t){if(e&&this.base&&this.completions){var n=this.editor.getCursorPosition(),r=this.editor.session.getTextRange({start:this.base,end:n});if(r==this.completions.filterText)return;this.completions.setFilter(r);if(!this.completions.filtered.length)return this.detach();if(this.completions.filtered.length==1&&this.completions.filtered[0].value==r&&!this.completions.filtered[0].snippet)return this.detach();this.openPopup(this.editor,r,e);return}if(t&&t.matches){var n=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(n.row,n.column),this.base.$insertRight=!0,this.completions=new c(t.matches),this.openPopup(this.editor,"",e)}var i=this.gatherCompletionsId,s=function(e){if(!e.finished)return;return this.detach()}.bind(this),o=function(t){var n=t.prefix,r=t.matches;this.completions=new c(r),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(n);var i=this.completions.filtered;if(!i.length)return s(t);if(i.length==1&&i[0].value==n&&!i[0].snippet)return s(t);if(this.autoInsert&&i.length==1&&t.finished)return this.insertMatch(i[0]);this.openPopup(this.editor,n,e)}.bind(this),u=!0,a=null;this.gatherCompletions(this.editor,function(e,t){var n=t.prefix,r=t&&t.matches;if(!r||!r.length)return s(t);if(n.indexOf(t.prefix)!==0||i!=this.gatherCompletionsId)return;if(u){a=t;return}o(t)}.bind(this)),u=!1;if(a){var f=a;a=null,o(f)}},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,n=t&&(t[e.getHoveredRow()]||t[e.getRow()]),r=null;if(!n||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();this.editor.completers.some(function(e){return e.getDocTooltip&&(r=e.getDocTooltip(n)),r}),!r&&typeof n!="string"&&(r=n),typeof r=="string"&&(r={docText:r});if(!r||!r.docHTML&&!r.docText)return this.hideDocTooltip();this.showDocTooltip(r)},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=u.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&&(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var n=this.popup,r=n.container.getBoundingClientRect();t.style.top=n.container.style.top,t.style.bottom=n.container.style.bottom,t.style.display="block",window.innerWidth-r.right<320?r.left<320?n.isTopdown?(t.style.top=r.bottom+"px",t.style.left=r.left+"px",t.style.right="",t.style.bottom=""):(t.style.top=n.container.offsetTop-t.offsetHeight+"px",t.style.left=r.left+"px",t.style.right="",t.style.bottom=""):(t.style.right=window.innerWidth-r.left+"px",t.style.left=""):(t.style.left=r.right+1+"px",t.style.right="")},this.hideDocTooltip=function(){this.tooltipTimer.cancel();if(!this.tooltipNode)return;var e=this.tooltipNode;!this.editor.isFocused()&&document.activeElement==e&&this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)},this.onTooltipClick=function(e){var t=e.target;while(t&&t!=this.tooltipNode){if(t.nodeName=="A"&&t.href){t.rel="noreferrer",t.target="_blank";break}t=t.parentNode}},this.destroy=function(){this.detach();if(this.popup){this.popup.destroy();var e=this.popup.container;e&&e.parentNode&&e.parentNode.removeChild(e)}this.editor&&this.editor.completer==this&&this.editor.completer==null,this.popup=null}}).call(l.prototype),l.for=function(e){return e.completer?e.completer:(f.get("sharedPopups")?(l.$shared||(l.$sharedInstance=new l),e.completer=l.$sharedInstance):(e.completer=new l,e.once("destroy",function(e,t){t.completer.destroy()})),e.completer)},l.startCommand={name:"startAutocomplete",exec:function(e,t){var n=l.for(e);n.autoInsert=!1,n.autoSelect=!0,n.showPopup(e,t),n.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var c=function(e,t){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length>this.filterText&&e.lastIndexOf(this.filterText,0)===0)var t=this.filtered;else var t=this.all;this.filterText=e,t=this.filterCompletions(t,this.filterText),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)});var n=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t===n?!1:(n=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var n=[],r=t.toUpperCase(),i=t.toLowerCase();e:for(var s=0,o;o=e[s];s++){var u=o.caption||o.value||o.snippet;if(!u)continue;var a=-1,f=0,l=0,c,h;if(this.exactMatch){if(t!==u.substr(0,t.length))continue e}else{var p=u.toLowerCase().indexOf(i);if(p>-1)l=p;else for(var d=0;d<t.length;d++){var v=u.indexOf(i[d],a+1),m=u.indexOf(r[d],a+1);c=v>=0?m<0||v<m?v:m:m;if(c<0)continue e;h=c-a-1,h>0&&(a===-1&&(l+=10),l+=h,f|=1<<d),a=c}}o.matchMask=f,o.exactMatch=l?0:1,o.$score=(o.score||0)-l,n.push(o)}return n}}).call(c.prototype),t.Autocomplete=l,t.FilteredList=c}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(e,t,n){function s(e,t){var n=e.getTextRange(r.fromPoints({row:0,column:0},t));return n.split(i).length-1}function o(e,t){var n=s(e,t),r=e.getValue().split(i),o=Object.create(null),u=r[n];return r.forEach(function(e,t){if(!e||e===u)return;var i=Math.abs(n-t),s=r.length-i;o[e]?o[e]=Math.max(s,o[e]):o[e]=s}),o}var r=e("../range").Range,i=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;t.getCompletions=function(e,t,n,r,i){var s=o(t,n),u=Object.keys(s);i(null,u.map(function(e){return{caption:e,value:e,score:s[e],meta:"local"}}))}}),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/autocomplete/text_completer","ace/editor","ace/config"],function(e,t,n){"use strict";var r=e("../snippets").snippetManager,i=e("../autocomplete").Autocomplete,s=e("../config"),o=e("../lib/lang"),u=e("../autocomplete/util"),a=e("../autocomplete/text_completer"),f={getCompletions:function(e,t,n,r,i){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,n,r,i);var s=e.session.getState(n.row),o=t.$mode.getCompletions(s,t,n,r);i(null,o)}},l=function(e){var t={};return e.replace(/\${(\d+)(:(.*?))?}/g,function(e,n,r,i){return t[n]=i||""}).replace(/\$(\d+?)/g,function(e,n){return t[n]})},c={getCompletions:function(e,t,n,i,s){var o=[],u=t.getTokenAt(n.row,n.column);u&&u.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?o.push("html-tag"):o=r.getActiveScopes(e);var a=r.snippetMap,f=[];o.forEach(function(e){var t=a[e]||[];for(var n=t.length;n--;){var r=t[n],i=r.name||r.tabTrigger;if(!i)continue;f.push({caption:i,snippet:r.content,meta:r.tabTrigger&&!r.name?r.tabTrigger+"\u21e5 ":"snippet",type:"snippet"})}},this),s(null,f)},getDocTooltip:function(e){e.type=="snippet"&&!e.docHTML&&(e.docHTML=["<b>",o.escapeHTML(e.caption),"</b>","<hr></hr>",o.escapeHTML(l(e.snippet))].join(""))}},h=[c,a,f];t.setCompleters=function(e){h.length=0,e&&h.push.apply(h,e)},t.addCompleter=function(e){h.push(e)},t.textCompleter=a,t.keyWordCompleter=f,t.snippetCompleter=c;var p={name:"expandSnippet",exec:function(e){return r.expandWithTab(e)},bindKey:"Tab"},d=function(e,t){v(t.session.$mode)},v=function(e){typeof e=="string"&&(e=s.$modes[e]);if(!e)return;r.files||(r.files={}),m(e.$id,e.snippetFileId),e.modes&&e.modes.forEach(v)},m=function(e,t){if(!t||!e||r.files[e])return;r.files[e]={},s.loadModule(t,function(t){if(!t)return;r.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=r.parseSnippetFile(t.snippetText)),r.register(t.snippets||[],t.scope),t.includeScopes&&(r.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){v("ace/mode/"+e)}))})},g=function(e){var t=e.editor,n=t.completer&&t.completer.activated;if(e.command.name==="backspace")n&&!u.getCompletionPrefix(t)&&t.completer.detach();else if(e.command.name==="insertstring"){var r=u.getCompletionPrefix(t);if(r&&!n){var s=i.for(t);s.autoInsert=!1,s.showPopup(t)}}},y=e("../editor").Editor;e("../config").defineOptions(y.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:h),this.commands.addCommand(i.startCommand)):this.commands.removeCommand(i.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:h),this.commands.on("afterExec",g)):this.commands.removeListener("afterExec",g)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(p),this.on("changeMode",d),d(null,this)):(this.commands.removeCommand(p),this.off("changeMode",d))},value:!1}})});                (function() {
                    ace.require(["ace/ext/language_tools"], function(m) {
                        if (typeof module == "object" && typeof exports == "object" && module) {
                            module.exports = m;
                        }
                    });
                })();
            </script> <script id='ace_juno_mode'  type='text/javascript'  charset='utf-8'>ace.define("ace/mode/juno_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;



var JunoHighlightRules = function() {

  var builtinFunctions = ('MAX_SAFE_INTEGER LispSyntaxError sub_type __VERBOSITY__ int float values '+
			  'pairs keys take prepend first last length conj reverse map bind to_object '+
			  'to_array slice rest second third chop chomp not push pop list flatten '+
			  'jslambda join lowercase uppercase log split split_by is_object? is_array? '+
			  'is_number? is_function? is_set? is_element? is_string? is_nil? is_regex? '+
			  'is_date? ends_with? starts_with? delete_prop blank? contains? make_set '+
			  'meta_for_symbol describe undefine eval_exp indirect_new range add '+
			  'merge_objects index_of resolve_path min_value max_value interlace trim ' +
			  'assert unquotify or_args special_operators defclog NOT_FOUND ' +
			  'check_external_env_default *namespace* pending_ns_loads pend_load load_pends '+
			  'symbols set_global get_global symbol_definition compile env_log '+
			  'evaluate_local evaluate eval_struct built_ins set_compiler clone *env_config* '+
			  'create_namespace set_namespace delete_namespace namespaces current_namespace '+
			  'eval reader add_escape_encoding get_outside_global as_lisp lisp_writer clone_to_new '+
			  'save_env null defmacro read_lisp desym desym_ref deref when if_compile_time_defined '+
			  'defexternal defun defun_sync macroexpand macroexpand_nq check_type get_object_path '+
			  'do_deferred_splice define defbinding define_env type destructure_list '+
			  'destructuring_bind split_by_recurse reduce bind_function is_reference? scan_str '+
			  'remove_prop object_methods expand_dot_accessor getf_ctx setf_ctx set_path minmax '+
			  'gen_multiples path_multiply splice_in_return_a splice_in_return_b aif ifa '+
			  'map_range range_inc HSV_to_RGB color_for_number flatten_ctx identify_symbols unless '+
			  'use_quoted_initializer random_int resolve_multi_path symbol_tree except_nil each '+
			  'replace cl_encode_string path_to_js_syntax first_is_upper_case? safe_access_2 '+
			  'safe_access compile_to_js evaluate_compiled_source form_structure '+
			  'validate_form_structure *compiler_syntax_rules* compiler_source_chain '+
			  'compiler_syntax_validation describe_all is_value? sort and* or* either is_symbol? '+
			  'get_function_args findpaths warn success in_background show export_symbols '+
			  'register_feature uniq time_in_millis defns use_ns bind_and_call save_locally '+
			  'fetch_text import system_date_format system_date_formatter tzoffset date_components '+
			  'formatted_date *LANGUAGE* dtext nth use_symbols use_unique_symbols compiler '+
			  'read_text_file readline_mod streams repl set_repl repl_config $ $$ $$$ '+
			  'prop set_prop Environment push pop list ');

    var keywords = ('throw try defvar typeof instanceof == < > <= >= eq return yield jslambda cond apply ' +
		    'defglobal do fn if let new function progn javascript catch evaluate eval call -> import '+
		    'dynamic_import quote for_each for_with declare');

    var buildinConstants = ("true false nil");

    var keywordMapper = this.createKeywordMapper({
        "keyword": keywords,
        "constant.language": buildinConstants,
        "support.function": builtinFunctions
    }, "identifier", false, " ");

    this.$rules = {
        "start" : [
            {
                token : "comment",
                regex : ";.*$"
            }, {
                token : "keyword", //parens
                regex : "[\\(|\\)]"
            }, {
                token : "keyword", //lists
                regex : "[\\'\\(]"
            }, {
                token : "keyword", //vectors
                regex : "[\\[|\\]]"
            }, {
                token : "keyword", //sets and maps
                regex : "[\\{|\\}|\\#\\{|\\#\\}]"
            }, {
                    token : "keyword", // ampersands
                    regex : '[\\&]'
            }, {
                    token : "keyword", // metadata
                    regex : '[\\#\\^\\{]'
            }, {
                    token : "keyword", // anonymous fn syntactic sugar
                    regex : '[\\%]'
            }, {
                    token : "keyword", // deref reader macro
                    regex : '[@]'
            }, {
                token : "constant.numeric", // hex
                regex : "0[xX][0-9a-fA-F]+\\b"
            }, {
                token : "constant.numeric", // float
                regex : "[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"
            }, {
                token : "constant.language",
                regex : '[!|\\$|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+||=|!=|<=|>=|<>|<|>|!|&&]'
            }, {
                token : keywordMapper,
                regex : "[a-zA-Z_$][a-zA-Z0-9_$\\-]*\\b"
            }, {
                token : "string", // single line
                regex : '"',
                next: "string"
            }, {
                token : "constant", // symbol
                regex : /:[^()\[\]{}'"\^%`,;\s]+/
            }, {
                token : "string.regexp", //Regular Expressions
                regex : '/#"(?:\\.|(?:\\")|[^""\n])*"/g'
            }

        ],
        "string" : [
            {
                token : "constant.language.escape",
                regex : "\\\\.|\\\\$"
            }, {
                token : "string",
                regex : '[^"\\\\]+'
            }, {
                token : "string",
                regex : '"',
                next : "start"
            }
        ]
    };
};

oop.inherits(JunoHighlightRules, TextHighlightRules);

exports.JunoHighlightRules = JunoHighlightRules;
});

ace.define("ace/mode/matching_parens_outdent",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;

var MatchingParensOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\)/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\))/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        var match = line.match(/^(\s+)/);
        if (match) {
            return match[1];
        }

        return "";
    };

}).call(MatchingParensOutdent.prototype);

exports.MatchingParensOutdent = MatchingParensOutdent;
});

ace.define("ace/mode/juno",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/juno_highlight_rules","ace/mode/matching_parens_outdent"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var JunoHighlightRules = require("./juno_highlight_rules").JunoHighlightRules;
var MatchingParensOutdent = require("./matching_parens_outdent").MatchingParensOutdent;

var Mode = function() {
    this.HighlightRules = JunoHighlightRules;
    this.$outdent = new MatchingParensOutdent();
    this.$behaviour = this.$defaultBehaviour;
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = ";";
  this.minorIndentFunctions = ["defun", "defun-sync", "defmacro", "define", "when", "let", "destructuring-bind" ];

    this.$toIndent = function(str) {
        return str.split('').map(function(ch) {
            if (/\s/.exec(ch)) {
                return ch;
            } else {
                return ' ';
            }
        }).join('');
    };

    this.$calculateIndent = function(line, tab) {
        var baseIndent = this.$getIndent(line);
        var delta = 0;
        var isParen, ch;
        for (var i = line.length - 1; i >= 0; i--) {
            ch = line[i];
            if (ch === '(') {
                delta--;
                isParen = true;
            } else if (ch === '(' || ch === '[' || ch === '{') {
                delta--;
                isParen = false;
            } else if (ch === ')' || ch === ']' || ch === '}') {
                delta++;
            }
            if (delta < 0) {
                break;
            }
        }
        if (delta < 0 && isParen) {
            i += 1;
            var iBefore = i;
            var fn = '';
            while (true) {
                ch = line[i];
                if (ch === ' ' || ch === '\t') {
                    if(this.minorIndentFunctions.indexOf(fn) !== -1) {
                        return this.$toIndent(line.substring(0, iBefore - 1) + tab);
                    } else {
                        return this.$toIndent(line.substring(0, i + 1));
                    }
                } else if (ch === undefined) {
                    return this.$toIndent(line.substring(0, iBefore - 1) + tab);
                }
                fn += line[i];
                i++;
            }
        } else if(delta < 0 && !isParen) {
            return this.$toIndent(line.substring(0, i+1));
        } else if(delta > 0) {
            baseIndent = baseIndent.substring(0, baseIndent.length - tab.length);
            return baseIndent;
        } else {
            return baseIndent;
        }
    };

    this.getNextLineIndent = function(state, line, tab) {
        return this.$calculateIndent(line, tab);
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };

    this.$id = "ace/mode/juno";
    this.snippetFileId = "ace/snippets/juno";
}).call(Mode.prototype);

exports.Mode = Mode;
});                (function() {
                    ace.require(["ace/mode/juno"], function(m) {
                        if (typeof module == "object" && typeof exports == "object" && module) {
                            module.exports = m;
                        }
                    });
                })();
            
</script> <script id='ace_js_mode'  type='text/javascript'  charset='utf-8'>ace.define("ace/mode/doc_comment_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var DocCommentHighlightRules = function() {
    this.$rules = {
        "start" : [ {
            token : "comment.doc.tag",
            regex : "@[\\w\\d_]+" // TODO: fix email addresses
        }, 
        DocCommentHighlightRules.getTagRule(),
        {
            defaultToken : "comment.doc",
            caseInsensitive: true
        }]
    };
};

oop.inherits(DocCommentHighlightRules, TextHighlightRules);

DocCommentHighlightRules.getTagRule = function(start) {
    return {
        token : "comment.doc.tag.storage.type",
        regex : "\\b(?:TODO|FIXME|XXX|HACK)\\b"
    };
};

DocCommentHighlightRules.getStartRule = function(start) {
    return {
        token : "comment.doc", // doc comment
        regex : "\\/\\*(?=\\*)",
        next  : start
    };
};

DocCommentHighlightRules.getEndRule = function (start) {
    return {
        token : "comment.doc", // closing comment
        regex : "\\*\\/",
        next  : start
    };
};


exports.DocCommentHighlightRules = DocCommentHighlightRules;

});

ace.define("ace/mode/javascript_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var DocCommentHighlightRules = require("./doc_comment_highlight_rules").DocCommentHighlightRules;
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;
var identifierRe = "[a-zA-Z\\$_\u00a1-\uffff][a-zA-Z\\d\\$_\u00a1-\uffff]*";

var JavaScriptHighlightRules = function(options) {
    var keywordMapper = this.createKeywordMapper({
        "variable.language":
            "Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|"  + // Constructors
            "Namespace|QName|XML|XMLList|"                                             + // E4X
            "ArrayBuffer|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|"   +
            "Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|"                    +
            "Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|"   + // Errors
            "SyntaxError|TypeError|URIError|"                                          +
            "decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|eval|isFinite|" + // Non-constructor functions
            "isNaN|parseFloat|parseInt|"                                               +
            "JSON|Math|"                                                               + // Other
            "this|arguments|prototype|window|document"                                 , // Pseudo
        "keyword":
            "const|yield|import|get|set|async|await|" +
            "break|case|catch|continue|default|delete|do|else|finally|for|function|" +
            "if|in|of|instanceof|new|return|switch|throw|try|typeof|let|var|while|with|debugger|" +
            "__parent__|__count__|escape|unescape|with|__proto__|" +
            "class|enum|extends|super|export|implements|private|public|interface|package|protected|static",
        "storage.type":
            "const|let|var|function",
        "constant.language":
            "null|Infinity|NaN|undefined",
        "support.function":
            "alert",
        "constant.language.boolean": "true|false"
    }, "identifier");
    var kwBeforeRe = "case|do|else|finally|in|instanceof|return|throw|try|typeof|yield|void";

    var escapedRe = "\\\\(?:x[0-9a-fA-F]{2}|" + // hex
        "u[0-9a-fA-F]{4}|" + // unicode
        "u{[0-9a-fA-F]{1,6}}|" + // es6 unicode
        "[0-2][0-7]{0,2}|" + // oct
        "3[0-7][0-7]?|" + // oct
        "[4-7][0-7]?|" + //oct
        ".)";

    this.$rules = {
        "no_regex" : [
            DocCommentHighlightRules.getStartRule("doc-start"),
            comments("no_regex"),
            {
                token : "string",
                regex : "'(?=.)",
                next  : "qstring"
            }, {
                token : "string",
                regex : '"(?=.)',
                next  : "qqstring"
            }, {
                token : "constant.numeric", // hexadecimal, octal and binary
                regex : /0(?:[xX][0-9a-fA-F]+|[oO][0-7]+|[bB][01]+)\b/
            }, {
                token : "constant.numeric", // decimal integers and floats
                regex : /(?:\d\d*(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+\b)?/
            }, {
                token : [
                    "storage.type", "punctuation.operator", "support.function",
                    "punctuation.operator", "entity.name.function", "text","keyword.operator"
                ],
                regex : "(" + identifierRe + ")(\\.)(prototype)(\\.)(" + identifierRe +")(\\s*)(=)",
                next: "function_arguments"
            }, {
                token : [
                    "storage.type", "punctuation.operator", "entity.name.function", "text",
                    "keyword.operator", "text", "storage.type", "text", "paren.lparen"
                ],
                regex : "(" + identifierRe + ")(\\.)(" + identifierRe +")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : [
                    "entity.name.function", "text", "keyword.operator", "text", "storage.type",
                    "text", "paren.lparen"
                ],
                regex : "(" + identifierRe +")(\\s*)(=)(\\s*)(function)(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : [
                    "storage.type", "punctuation.operator", "entity.name.function", "text",
                    "keyword.operator", "text",
                    "storage.type", "text", "entity.name.function", "text", "paren.lparen"
                ],
                regex : "(" + identifierRe + ")(\\.)(" + identifierRe +")(\\s*)(=)(\\s*)(function)(\\s+)(\\w+)(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : [
                    "storage.type", "text", "entity.name.function", "text", "paren.lparen"
                ],
                regex : "(function)(\\s+)(" + identifierRe + ")(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : [
                    "entity.name.function", "text", "punctuation.operator",
                    "text", "storage.type", "text", "paren.lparen"
                ],
                regex : "(" + identifierRe + ")(\\s*)(:)(\\s*)(function)(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : [
                    "text", "text", "storage.type", "text", "paren.lparen"
                ],
                regex : "(:)(\\s*)(function)(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : "keyword",
                regex : "from(?=\\s*('|\"))"
            }, {
                token : "keyword",
                regex : "(?:" + kwBeforeRe + ")\\b",
                next : "start"
            }, {
                token : ["support.constant"],
                regex : /that\b/
            }, {
                token : ["storage.type", "punctuation.operator", "support.function.firebug"],
                regex : /(console)(\.)(warn|info|log|error|time|trace|timeEnd|assert)\b/
            }, {
                token : keywordMapper,
                regex : identifierRe
            }, {
                token : "punctuation.operator",
                regex : /[.](?![.])/,
                next  : "property"
            }, {
                token : "storage.type",
                regex : /=>/,
                next  : "start"
            }, {
                token : "keyword.operator",
                regex : /--|\+\+|\.{3}|===|==|=|!=|!==|<+=?|>+=?|!|&&|\|\||\?:|[!$%&*+\-~\/^]=?/,
                next  : "start"
            }, {
                token : "punctuation.operator",
                regex : /[?:,;.]/,
                next  : "start"
            }, {
                token : "paren.lparen",
                regex : /[\[({]/,
                next  : "start"
            }, {
                token : "paren.rparen",
                regex : /[\])}]/
            }, {
                token: "comment",
                regex: /^#!.*$/
            }
        ],
        property: [{
                token : "text",
                regex : "\\s+"
            }, {
                token : [
                    "storage.type", "punctuation.operator", "entity.name.function", "text",
                    "keyword.operator", "text",
                    "storage.type", "text", "entity.name.function", "text", "paren.lparen"
                ],
                regex : "(" + identifierRe + ")(\\.)(" + identifierRe +")(\\s*)(=)(\\s*)(function)(?:(\\s+)(\\w+))?(\\s*)(\\()",
                next: "function_arguments"
            }, {
                token : "punctuation.operator",
                regex : /[.](?![.])/
            }, {
                token : "support.function",
                regex : /(s(?:h(?:ift|ow(?:Mod(?:elessDialog|alDialog)|Help))|croll(?:X|By(?:Pages|Lines)?|Y|To)?|t(?:op|rike)|i(?:n|zeToContent|debar|gnText)|ort|u(?:p|b(?:str(?:ing)?)?)|pli(?:ce|t)|e(?:nd|t(?:Re(?:sizable|questHeader)|M(?:i(?:nutes|lliseconds)|onth)|Seconds|Ho(?:tKeys|urs)|Year|Cursor|Time(?:out)?|Interval|ZOptions|Date|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Date|FullYear)|FullYear|Active)|arch)|qrt|lice|avePreferences|mall)|h(?:ome|andleEvent)|navigate|c(?:har(?:CodeAt|At)|o(?:s|n(?:cat|textual|firm)|mpile)|eil|lear(?:Timeout|Interval)?|a(?:ptureEvents|ll)|reate(?:StyleSheet|Popup|EventObject))|t(?:o(?:GMTString|S(?:tring|ource)|U(?:TCString|pperCase)|Lo(?:caleString|werCase))|est|a(?:n|int(?:Enabled)?))|i(?:s(?:NaN|Finite)|ndexOf|talics)|d(?:isableExternalCapture|ump|etachEvent)|u(?:n(?:shift|taint|escape|watch)|pdateCommands)|j(?:oin|avaEnabled)|p(?:o(?:p|w)|ush|lugins.refresh|a(?:ddings|rse(?:Int|Float)?)|r(?:int|ompt|eference))|e(?:scape|nableExternalCapture|val|lementFromPoint|x(?:p|ec(?:Script|Command)?))|valueOf|UTC|queryCommand(?:State|Indeterm|Enabled|Value)|f(?:i(?:nd|le(?:ModifiedDate|Size|CreatedDate|UpdatedDate)|xed)|o(?:nt(?:size|color)|rward)|loor|romCharCode)|watch|l(?:ink|o(?:ad|g)|astIndexOf)|a(?:sin|nchor|cos|t(?:tachEvent|ob|an(?:2)?)|pply|lert|b(?:s|ort))|r(?:ou(?:nd|teEvents)|e(?:size(?:By|To)|calc|turnValue|place|verse|l(?:oad|ease(?:Capture|Events)))|andom)|g(?:o|et(?:ResponseHeader|M(?:i(?:nutes|lliseconds)|onth)|Se(?:conds|lection)|Hours|Year|Time(?:zoneOffset)?|Da(?:y|te)|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Da(?:y|te)|FullYear)|FullYear|A(?:ttention|llResponseHeaders)))|m(?:in|ove(?:B(?:y|elow)|To(?:Absolute)?|Above)|ergeAttributes|a(?:tch|rgins|x))|b(?:toa|ig|o(?:ld|rderWidths)|link|ack))\b(?=\()/
            }, {
                token : "support.function.dom",
                regex : /(s(?:ub(?:stringData|mit)|plitText|e(?:t(?:NamedItem|Attribute(?:Node)?)|lect))|has(?:ChildNodes|Feature)|namedItem|c(?:l(?:ick|o(?:se|neNode))|reate(?:C(?:omment|DATASection|aption)|T(?:Head|extNode|Foot)|DocumentFragment|ProcessingInstruction|E(?:ntityReference|lement)|Attribute))|tabIndex|i(?:nsert(?:Row|Before|Cell|Data)|tem)|open|delete(?:Row|C(?:ell|aption)|T(?:Head|Foot)|Data)|focus|write(?:ln)?|a(?:dd|ppend(?:Child|Data))|re(?:set|place(?:Child|Data)|move(?:NamedItem|Child|Attribute(?:Node)?)?)|get(?:NamedItem|Element(?:sBy(?:Name|TagName|ClassName)|ById)|Attribute(?:Node)?)|blur)\b(?=\()/
            }, {
                token :  "support.constant",
                regex : /(s(?:ystemLanguage|cr(?:ipts|ollbars|een(?:X|Y|Top|Left))|t(?:yle(?:Sheets)?|atus(?:Text|bar)?)|ibling(?:Below|Above)|ource|uffixes|e(?:curity(?:Policy)?|l(?:ection|f)))|h(?:istory|ost(?:name)?|as(?:h|Focus))|y|X(?:MLDocument|SLDocument)|n(?:ext|ame(?:space(?:s|URI)|Prop))|M(?:IN_VALUE|AX_VALUE)|c(?:haracterSet|o(?:n(?:structor|trollers)|okieEnabled|lorDepth|mp(?:onents|lete))|urrent|puClass|l(?:i(?:p(?:boardData)?|entInformation)|osed|asses)|alle(?:e|r)|rypto)|t(?:o(?:olbar|p)|ext(?:Transform|Indent|Decoration|Align)|ags)|SQRT(?:1_2|2)|i(?:n(?:ner(?:Height|Width)|put)|ds|gnoreCase)|zIndex|o(?:scpu|n(?:readystatechange|Line)|uter(?:Height|Width)|p(?:sProfile|ener)|ffscreenBuffering)|NEGATIVE_INFINITY|d(?:i(?:splay|alog(?:Height|Top|Width|Left|Arguments)|rectories)|e(?:scription|fault(?:Status|Ch(?:ecked|arset)|View)))|u(?:ser(?:Profile|Language|Agent)|n(?:iqueID|defined)|pdateInterval)|_content|p(?:ixelDepth|ort|ersonalbar|kcs11|l(?:ugins|atform)|a(?:thname|dding(?:Right|Bottom|Top|Left)|rent(?:Window|Layer)?|ge(?:X(?:Offset)?|Y(?:Offset)?))|r(?:o(?:to(?:col|type)|duct(?:Sub)?|mpter)|e(?:vious|fix)))|e(?:n(?:coding|abledPlugin)|x(?:ternal|pando)|mbeds)|v(?:isibility|endor(?:Sub)?|Linkcolor)|URLUnencoded|P(?:I|OSITIVE_INFINITY)|f(?:ilename|o(?:nt(?:Size|Family|Weight)|rmName)|rame(?:s|Element)|gColor)|E|whiteSpace|l(?:i(?:stStyleType|n(?:eHeight|kColor))|o(?:ca(?:tion(?:bar)?|lName)|wsrc)|e(?:ngth|ft(?:Context)?)|a(?:st(?:M(?:odified|atch)|Index|Paren)|yer(?:s|X)|nguage))|a(?:pp(?:MinorVersion|Name|Co(?:deName|re)|Version)|vail(?:Height|Top|Width|Left)|ll|r(?:ity|guments)|Linkcolor|bove)|r(?:ight(?:Context)?|e(?:sponse(?:XML|Text)|adyState))|global|x|m(?:imeTypes|ultiline|enubar|argin(?:Right|Bottom|Top|Left))|L(?:N(?:10|2)|OG(?:10E|2E))|b(?:o(?:ttom|rder(?:Width|RightWidth|BottomWidth|Style|Color|TopWidth|LeftWidth))|ufferDepth|elow|ackground(?:Color|Image)))\b/
            }, {
                token : "identifier",
                regex : identifierRe
            }, {
                regex: "",
                token: "empty",
                next: "no_regex"
            }
        ],
        "start": [
            DocCommentHighlightRules.getStartRule("doc-start"),
            comments("start"),
            {
                token: "string.regexp",
                regex: "\\/",
                next: "regex"
            }, {
                token : "text",
                regex : "\\s+|^$",
                next : "start"
            }, {
                token: "empty",
                regex: "",
                next: "no_regex"
            }
        ],
        "regex": [
            {
                token: "regexp.keyword.operator",
                regex: "\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"
            }, {
                token: "string.regexp",
                regex: "/[sxngimy]*",
                next: "no_regex"
            }, {
                token : "invalid",
                regex: /\{\d+\b,?\d*\}[+*]|[+*$^?][+*]|[$^][?]|\?{3,}/
            }, {
                token : "constant.language.escape",
                regex: /\(\?[:=!]|\)|\{\d+\b,?\d*\}|[+*]\?|[()$^+*?.]/
            }, {
                token : "constant.language.delimiter",
                regex: /\|/
            }, {
                token: "constant.language.escape",
                regex: /\[\^?/,
                next: "regex_character_class"
            }, {
                token: "empty",
                regex: "$",
                next: "no_regex"
            }, {
                defaultToken: "string.regexp"
            }
        ],
        "regex_character_class": [
            {
                token: "regexp.charclass.keyword.operator",
                regex: "\\\\(?:u[\\da-fA-F]{4}|x[\\da-fA-F]{2}|.)"
            }, {
                token: "constant.language.escape",
                regex: "]",
                next: "regex"
            }, {
                token: "constant.language.escape",
                regex: "-"
            }, {
                token: "empty",
                regex: "$",
                next: "no_regex"
            }, {
                defaultToken: "string.regexp.charachterclass"
            }
        ],
        "function_arguments": [
            {
                token: "variable.parameter",
                regex: identifierRe
            }, {
                token: "punctuation.operator",
                regex: "[, ]+"
            }, {
                token: "punctuation.operator",
                regex: "$"
            }, {
                token: "empty",
                regex: "",
                next: "no_regex"
            }
        ],
        "qqstring" : [
            {
                token : "constant.language.escape",
                regex : escapedRe
            }, {
                token : "string",
                regex : "\\\\$",
                consumeLineEnd  : true
            }, {
                token : "string",
                regex : '"|$',
                next  : "no_regex"
            }, {
                defaultToken: "string"
            }
        ],
        "qstring" : [
            {
                token : "constant.language.escape",
                regex : escapedRe
            }, {
                token : "string",
                regex : "\\\\$",
                consumeLineEnd  : true
            }, {
                token : "string",
                regex : "'|$",
                next  : "no_regex"
            }, {
                defaultToken: "string"
            }
        ]
    };


    if (!options || !options.noES6) {
        this.$rules.no_regex.unshift({
            regex: "[{}]", onMatch: function(val, state, stack) {
                this.next = val == "{" ? this.nextState : "";
                if (val == "{" && stack.length) {
                    stack.unshift("start", state);
                }
                else if (val == "}" && stack.length) {
                    stack.shift();
                    this.next = stack.shift();
                    if (this.next.indexOf("string") != -1 || this.next.indexOf("jsx") != -1)
                        return "paren.quasi.end";
                }
                return val == "{" ? "paren.lparen" : "paren.rparen";
            },
            nextState: "start"
        }, {
            token : "string.quasi.start",
            regex : /`/,
            push  : [{
                token : "constant.language.escape",
                regex : escapedRe
            }, {
                token : "paren.quasi.start",
                regex : /\${/,
                push  : "start"
            }, {
                token : "string.quasi.end",
                regex : /`/,
                next  : "pop"
            }, {
                defaultToken: "string.quasi"
            }]
        });

        if (!options || options.jsx != false)
            JSX.call(this);
    }

    this.embedRules(DocCommentHighlightRules, "doc-",
        [ DocCommentHighlightRules.getEndRule("no_regex") ]);

    this.normalizeRules();
};

oop.inherits(JavaScriptHighlightRules, TextHighlightRules);

function JSX() {
    var tagRegex = identifierRe.replace("\\d", "\\d\\-");
    var jsxTag = {
        onMatch : function(val, state, stack) {
            var offset = val.charAt(1) == "/" ? 2 : 1;
            if (offset == 1) {
                if (state != this.nextState)
                    stack.unshift(this.next, this.nextState, 0);
                else
                    stack.unshift(this.next);
                stack[2]++;
            } else if (offset == 2) {
                if (state == this.nextState) {
                    stack[1]--;
                    if (!stack[1] || stack[1] < 0) {
                        stack.shift();
                        stack.shift();
                    }
                }
            }
            return [{
                type: "meta.tag.punctuation." + (offset == 1 ? "" : "end-") + "tag-open.xml",
                value: val.slice(0, offset)
            }, {
                type: "meta.tag.tag-name.xml",
                value: val.substr(offset)
            }];
        },
        regex : "</?" + tagRegex + "",
        next: "jsxAttributes",
        nextState: "jsx"
    };
    this.$rules.start.unshift(jsxTag);
    var jsxJsRule = {
        regex: "{",
        token: "paren.quasi.start",
        push: "start"
    };
    this.$rules.jsx = [
        jsxJsRule,
        jsxTag,
        {include : "reference"},
        {defaultToken: "string"}
    ];
    this.$rules.jsxAttributes = [{
        token : "meta.tag.punctuation.tag-close.xml",
        regex : "/?>",
        onMatch : function(value, currentState, stack) {
            if (currentState == stack[0])
                stack.shift();
            if (value.length == 2) {
                if (stack[0] == this.nextState)
                    stack[1]--;
                if (!stack[1] || stack[1] < 0) {
                    stack.splice(0, 2);
                }
            }
            this.next = stack[0] || "start";
            return [{type: this.token, value: value}];
        },
        nextState: "jsx"
    },
    jsxJsRule,
    comments("jsxAttributes"),
    {
        token : "entity.other.attribute-name.xml",
        regex : tagRegex
    }, {
        token : "keyword.operator.attribute-equals.xml",
        regex : "="
    }, {
        token : "text.tag-whitespace.xml",
        regex : "\\s+"
    }, {
        token : "string.attribute-value.xml",
        regex : "'",
        stateName : "jsx_attr_q",
        push : [
            {token : "string.attribute-value.xml", regex: "'", next: "pop"},
            {include : "reference"},
            {defaultToken : "string.attribute-value.xml"}
        ]
    }, {
        token : "string.attribute-value.xml",
        regex : '"',
        stateName : "jsx_attr_qq",
        push : [
            {token : "string.attribute-value.xml", regex: '"', next: "pop"},
            {include : "reference"},
            {defaultToken : "string.attribute-value.xml"}
        ]
    },
    jsxTag
    ];
    this.$rules.reference = [{
        token : "constant.language.escape.reference.xml",
        regex : "(?:&#[0-9]+;)|(?:&#x[0-9a-fA-F]+;)|(?:&[a-zA-Z0-9_:\\.-]+;)"
    }];
}

function comments(next) {
    return [
        {
            token : "comment", // multi line comment
            regex : /\/\*/,
            next: [
                DocCommentHighlightRules.getTagRule(),
                {token : "comment", regex : "\\*\\/", next : next || "pop"},
                {defaultToken : "comment", caseInsensitive: true}
            ]
        }, {
            token : "comment",
            regex : "\\/\\/",
            next: [
                DocCommentHighlightRules.getTagRule(),
                {token : "comment", regex : "$|^", next : next || "pop"},
                {defaultToken : "comment", caseInsensitive: true}
            ]
        }
    ];
}
exports.JavaScriptHighlightRules = JavaScriptHighlightRules;
});

ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;

var MatchingBraceOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\}/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\})/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

}).call(MatchingBraceOutdent.prototype);

exports.MatchingBraceOutdent = MatchingBraceOutdent;
});

ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {
    
    this.foldingStartMarker = /([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;
    this.singleLineBlockCommentRe= /^\s*(\/\*).*\*\/\s*$/;
    this.tripleStarBlockCommentRe = /^\s*(\/\*\*\*).*\*\/\s*$/;
    this.startRegionRe = /^\s*(\/\*|\/\/)#?region\b/;
    this._getFoldWidgetBase = this.getFoldWidget;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
    
        if (this.singleLineBlockCommentRe.test(line)) {
            if (!this.startRegionRe.test(line) && !this.tripleStarBlockCommentRe.test(line))
                return "";
        }
    
        var fw = this._getFoldWidgetBase(session, foldStyle, row);
    
        if (!fw && this.startRegionRe.test(line))
            return "start"; // lineCommentRegionStart
    
        return fw;
    };

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        
        if (this.startRegionRe.test(line))
            return this.getCommentRegionBlock(session, line, row);
        
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };
    this.getCommentRegionBlock = function(session, line, row) {
        var startColumn = line.search(/\s*$/);
        var maxRow = session.getLength();
        var startRow = row;
        
        var re = /^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;
        var depth = 1;
        while (++row < maxRow) {
            line = session.getLine(row);
            var m = re.exec(line);
            if (!m) continue;
            if (m[1]) depth--;
            else depth++;

            if (!depth) break;
        }

        var endRow = row;
        if (endRow > startRow) {
            return new Range(startRow, startColumn, endRow, line.length);
        }
    };

}).call(FoldMode.prototype);

});

ace.define("ace/mode/javascript",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/javascript_highlight_rules","ace/mode/matching_brace_outdent","ace/worker/worker_client","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var JavaScriptHighlightRules = require("./javascript_highlight_rules").JavaScriptHighlightRules;
var MatchingBraceOutdent = require("./matching_brace_outdent").MatchingBraceOutdent;
var WorkerClient = require("../worker/worker_client").WorkerClient;
var CstyleBehaviour = require("./behaviour/cstyle").CstyleBehaviour;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;

var Mode = function() {
    this.HighlightRules = JavaScriptHighlightRules;
    
    this.$outdent = new MatchingBraceOutdent();
    this.$behaviour = new CstyleBehaviour();
    this.foldingRules = new CStyleFoldMode();
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = "//";
    this.blockComment = {start: "/*", end: "*/"};
    this.$quotes = {'"': '"', "'": "'", "`": "`"};

    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;
        var endState = tokenizedLine.state;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        if (state == "start" || state == "no_regex") {
            var match = line.match(/^.*(?:\bcase\b.*:|[\{\(\[])\s*$/);
            if (match) {
                indent += tab;
            }
        } else if (state == "doc-start") {
            if (endState == "start" || endState == "no_regex") {
                return "";
            }
            var match = line.match(/^\s*(\/?)\*/);
            if (match) {
                if (match[1]) {
                    indent += " ";
                }
                indent += "* ";
            }
        }

        return indent;
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };

    this.createWorker = function(session) {
        var worker = new WorkerClient(["ace"], "ace/mode/javascript_worker", "JavaScriptWorker");
        worker.attachToDocument(session.getDocument());

        worker.on("annotate", function(results) {
            session.setAnnotations(results.data);
        });

        worker.on("terminate", function() {
            session.clearAnnotations();
        });

        return worker;
    };

    this.$id = "ace/mode/javascript";
    this.snippetFileId = "ace/snippets/javascript";
}).call(Mode.prototype);

exports.Mode = Mode;
});                (function() {
                    ace.require(["ace/mode/javascript"], function(m) {
                        if (typeof module == "object" && typeof exports == "object" && module) {
                            module.exports = m;
                        }
                    });
                })();
            </script> <script id='ace_json_mode'  type='text/javascript'  charset='utf-8'>ace.define("ace/mode/json_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("./text_highlight_rules").TextHighlightRules,s=function(){this.$rules={start:[{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"string",regex:'"',next:"string"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"text",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"comment",regex:"\\/\\/.*$"},{token:"comment.start",regex:"\\/\\*",next:"comment"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],string:[{token:"constant.language.escape",regex:/\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|["\\\/bfnrt])/},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],comment:[{token:"comment.end",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}};r.inherits(s,i),t.JsonHighlightRules=s}),ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(e,t,n){"use strict";var r=e("../range").Range,i=function(){};(function(){this.checkOutdent=function(e,t){return/^\s+$/.test(e)?/^\s*\}/.test(t):!1},this.autoOutdent=function(e,t){var n=e.getLine(t),i=n.match(/^(\s*\})/);if(!i)return 0;var s=i[1].length,o=e.findMatchingBracket({row:t,column:s});if(!o||o.row==t)return 0;var u=this.$getIndent(e.getLine(o.row));e.replace(new r(t,0,t,s-1),u)},this.$getIndent=function(e){return e.match(/^\s*/)[0]}}).call(i.prototype),t.MatchingBraceOutdent=i}),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("../../range").Range,s=e("./fold_mode").FoldMode,o=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};r.inherits(o,s),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);if(this.singleLineBlockCommentRe.test(r)&&!this.startRegionRe.test(r)&&!this.tripleStarBlockCommentRe.test(r))return"";var i=this._getFoldWidgetBase(e,t,n);return!i&&this.startRegionRe.test(r)?"start":i},this.getFoldWidgetRange=function(e,t,n,r){var i=e.getLine(n);if(this.startRegionRe.test(i))return this.getCommentRegionBlock(e,i,n);var s=i.match(this.foldingStartMarker);if(s){var o=s.index;if(s[1])return this.openingBracketBlock(e,s[1],n,o);var u=e.getCommentFoldRange(n,o+s[0].length,1);return u&&!u.isMultiLine()&&(r?u=this.getSectionRange(e,n):t!="all"&&(u=null)),u}if(t==="markbegin")return;var s=i.match(this.foldingStopMarker);if(s){var o=s.index+s[0].length;return s[1]?this.closingBracketBlock(e,s[1],n,o):e.getCommentFoldRange(n,o,-1)}},this.getSectionRange=function(e,t){var n=e.getLine(t),r=n.search(/\S/),s=t,o=n.length;t+=1;var u=t,a=e.getLength();while(++t<a){n=e.getLine(t);var f=n.search(/\S/);if(f===-1)continue;if(r>f)break;var l=this.getFoldWidgetRange(e,"all",t);if(l){if(l.start.row<=s)break;if(l.isMultiLine())t=l.end.row;else if(r==f)break}u=t}return new i(s,o,u,e.getLine(u).length)},this.getCommentRegionBlock=function(e,t,n){var r=t.search(/\s*$/),s=e.getLength(),o=n,u=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,a=1;while(++n<s){t=e.getLine(n);var f=u.exec(t);if(!f)continue;f[1]?a--:a++;if(!a)break}var l=n;if(l>o)return new i(o,r,l,t.length)}}.call(o.prototype)}),ace.define("ace/mode/json",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/json_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle","ace/worker/worker_client"],function(e,t,n){"use strict";var r=e("../lib/oop"),i=e("./text").Mode,s=e("./json_highlight_rules").JsonHighlightRules,o=e("./matching_brace_outdent").MatchingBraceOutdent,u=e("./behaviour/cstyle").CstyleBehaviour,a=e("./folding/cstyle").FoldMode,f=e("../worker/worker_client").WorkerClient,l=function(){this.HighlightRules=s,this.$outdent=new o,this.$behaviour=new u,this.foldingRules=new a};r.inherits(l,i),function(){this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t);if(e=="start"){var i=t.match(/^.*[\{\(\[]\s*$/);i&&(r+=n)}return r},this.checkOutdent=function(e,t,n){return this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){this.$outdent.autoOutdent(t,n)},this.createWorker=function(e){var t=new f(["ace"],"ace/mode/json_worker","JsonWorker");return t.attachToDocument(e.getDocument()),t.on("annotate",function(t){e.setAnnotations(t.data)}),t.on("terminate",function(){e.clearAnnotations()}),t},this.$id="ace/mode/json"}.call(l.prototype),t.Mode=l});                (function() {
                    ace.require(["ace/mode/json"], function(m) {
                        if (typeof module == "object" && typeof exports == "object" && module) {
                            module.exports = m;
                        }
                    });
                })();
            </script> <script id='ace_css_mode'  type='text/javascript'  charset='utf-8'>ace.define("ace/mode/css_highlight_rules",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var lang = require("../lib/lang");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;
var supportType = exports.supportType = "align-content|align-items|align-self|all|animation|animation-delay|animation-direction|animation-duration|animation-fill-mode|animation-iteration-count|animation-name|animation-play-state|animation-timing-function|backface-visibility|background|background-attachment|background-blend-mode|background-clip|background-color|background-image|background-origin|background-position|background-repeat|background-size|border|border-bottom|border-bottom-color|border-bottom-left-radius|border-bottom-right-radius|border-bottom-style|border-bottom-width|border-collapse|border-color|border-image|border-image-outset|border-image-repeat|border-image-slice|border-image-source|border-image-width|border-left|border-left-color|border-left-style|border-left-width|border-radius|border-right|border-right-color|border-right-style|border-right-width|border-spacing|border-style|border-top|border-top-color|border-top-left-radius|border-top-right-radius|border-top-style|border-top-width|border-width|bottom|box-shadow|box-sizing|caption-side|clear|clip|color|column-count|column-fill|column-gap|column-rule|column-rule-color|column-rule-style|column-rule-width|column-span|column-width|columns|content|counter-increment|counter-reset|cursor|direction|display|empty-cells|filter|flex|flex-basis|flex-direction|flex-flow|flex-grow|flex-shrink|flex-wrap|float|font|font-family|font-size|font-size-adjust|font-stretch|font-style|font-variant|font-weight|hanging-punctuation|height|justify-content|left|letter-spacing|line-height|list-style|list-style-image|list-style-position|list-style-type|margin|margin-bottom|margin-left|margin-right|margin-top|max-height|max-width|max-zoom|min-height|min-width|min-zoom|nav-down|nav-index|nav-left|nav-right|nav-up|opacity|order|outline|outline-color|outline-offset|outline-style|outline-width|overflow|overflow-x|overflow-y|padding|padding-bottom|padding-left|padding-right|padding-top|page-break-after|page-break-before|page-break-inside|perspective|perspective-origin|position|quotes|resize|right|tab-size|table-layout|text-align|text-align-last|text-decoration|text-decoration-color|text-decoration-line|text-decoration-style|text-indent|text-justify|text-overflow|text-shadow|text-transform|top|transform|transform-origin|transform-style|transition|transition-delay|transition-duration|transition-property|transition-timing-function|unicode-bidi|user-select|user-zoom|vertical-align|visibility|white-space|width|word-break|word-spacing|word-wrap|z-index";
var supportFunction = exports.supportFunction = "rgb|rgba|url|attr|counter|counters";
var supportConstant = exports.supportConstant = "absolute|after-edge|after|all-scroll|all|alphabetic|always|antialiased|armenian|auto|avoid-column|avoid-page|avoid|balance|baseline|before-edge|before|below|bidi-override|block-line-height|block|bold|bolder|border-box|both|bottom|box|break-all|break-word|capitalize|caps-height|caption|center|central|char|circle|cjk-ideographic|clone|close-quote|col-resize|collapse|column|consider-shifts|contain|content-box|cover|crosshair|cubic-bezier|dashed|decimal-leading-zero|decimal|default|disabled|disc|disregard-shifts|distribute-all-lines|distribute-letter|distribute-space|distribute|dotted|double|e-resize|ease-in|ease-in-out|ease-out|ease|ellipsis|end|exclude-ruby|fill|fixed|georgian|glyphs|grid-height|groove|hand|hanging|hebrew|help|hidden|hiragana-iroha|hiragana|horizontal|icon|ideograph-alpha|ideograph-numeric|ideograph-parenthesis|ideograph-space|ideographic|inactive|include-ruby|inherit|initial|inline-block|inline-box|inline-line-height|inline-table|inline|inset|inside|inter-ideograph|inter-word|invert|italic|justify|katakana-iroha|katakana|keep-all|last|left|lighter|line-edge|line-through|line|linear|list-item|local|loose|lower-alpha|lower-greek|lower-latin|lower-roman|lowercase|lr-tb|ltr|mathematical|max-height|max-size|medium|menu|message-box|middle|move|n-resize|ne-resize|newspaper|no-change|no-close-quote|no-drop|no-open-quote|no-repeat|none|normal|not-allowed|nowrap|nw-resize|oblique|open-quote|outset|outside|overline|padding-box|page|pointer|pre-line|pre-wrap|pre|preserve-3d|progress|relative|repeat-x|repeat-y|repeat|replaced|reset-size|ridge|right|round|row-resize|rtl|s-resize|scroll|se-resize|separate|slice|small-caps|small-caption|solid|space|square|start|static|status-bar|step-end|step-start|steps|stretch|strict|sub|super|sw-resize|table-caption|table-cell|table-column-group|table-column|table-footer-group|table-header-group|table-row-group|table-row|table|tb-rl|text-after-edge|text-before-edge|text-bottom|text-size|text-top|text|thick|thin|transparent|underline|upper-alpha|upper-latin|upper-roman|uppercase|use-script|vertical-ideographic|vertical-text|visible|w-resize|wait|whitespace|z-index|zero|zoom";
var supportConstantColor = exports.supportConstantColor = "aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkgrey|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkslategrey|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dimgrey|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|grey|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightgrey|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightslategrey|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|rebeccapurple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|slategrey|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen";
var supportConstantFonts = exports.supportConstantFonts = "arial|century|comic|courier|cursive|fantasy|garamond|georgia|helvetica|impact|lucida|symbol|system|tahoma|times|trebuchet|utopia|verdana|webdings|sans-serif|serif|monospace";

var numRe = exports.numRe = "\\-?(?:(?:[0-9]+(?:\\.[0-9]+)?)|(?:\\.[0-9]+))";
var pseudoElements = exports.pseudoElements = "(\\:+)\\b(after|before|first-letter|first-line|moz-selection|selection)\\b";
var pseudoClasses  = exports.pseudoClasses =  "(:)\\b(active|checked|disabled|empty|enabled|first-child|first-of-type|focus|hover|indeterminate|invalid|last-child|last-of-type|link|not|nth-child|nth-last-child|nth-last-of-type|nth-of-type|only-child|only-of-type|required|root|target|valid|visited)\\b";

var CssHighlightRules = function() {

    var keywordMapper = this.createKeywordMapper({
        "support.function": supportFunction,
        "support.constant": supportConstant,
        "support.type": supportType,
        "support.constant.color": supportConstantColor,
        "support.constant.fonts": supportConstantFonts
    }, "text", true);

    this.$rules = {
        "start" : [{
            include : ["strings", "url", "comments"]
        }, {
            token: "paren.lparen",
            regex: "\\{",
            next:  "ruleset"
        }, {
            token: "paren.rparen",
            regex: "\\}"
        }, {
            token: "string",
            regex: "@(?!viewport)",
            next:  "media"
        }, {
            token: "keyword",
            regex: "#[a-z0-9-_]+"
        }, {
            token: "keyword",
            regex: "%"
        }, {
            token: "variable",
            regex: "\\.[a-z0-9-_]+"
        }, {
            token: "string",
            regex: ":[a-z0-9-_]+"
        }, {
            token : "constant.numeric",
            regex : numRe
        }, {
            token: "constant",
            regex: "[a-z0-9-_]+"
        }, {
            caseInsensitive: true
        }],

        "media": [{
            include : ["strings", "url", "comments"]
        }, {
            token: "paren.lparen",
            regex: "\\{",
            next:  "start"
        }, {
            token: "paren.rparen",
            regex: "\\}",
            next:  "start"
        }, {
            token: "string",
            regex: ";",
            next:  "start"
        }, {
            token: "keyword",
            regex: "(?:media|supports|document|charset|import|namespace|media|supports|document"
                + "|page|font|keyframes|viewport|counter-style|font-feature-values"
                + "|swash|ornaments|annotation|stylistic|styleset|character-variant)"
        }],

        "comments" : [{
            token: "comment", // multi line comment
            regex: "\\/\\*",
            push: [{
                token : "comment",
                regex : "\\*\\/",
                next : "pop"
            }, {
                defaultToken : "comment"
            }]
        }],

        "ruleset" : [{
            regex : "-(webkit|ms|moz|o)-",
            token : "text"
        }, {
            token : "punctuation.operator",
            regex : "[:;]"
        }, {
            token : "paren.rparen",
            regex : "\\}",
            next : "start"
        }, {
            include : ["strings", "url", "comments"]
        }, {
            token : ["constant.numeric", "keyword"],
            regex : "(" + numRe + ")(ch|cm|deg|em|ex|fr|gd|grad|Hz|in|kHz|mm|ms|pc|pt|px|rad|rem|s|turn|vh|vmax|vmin|vm|vw|%)"
        }, {
            token : "constant.numeric",
            regex : numRe
        }, {
            token : "constant.numeric",  // hex6 color
            regex : "#[a-f0-9]{6}"
        }, {
            token : "constant.numeric", // hex3 color
            regex : "#[a-f0-9]{3}"
        }, {
            token : ["punctuation", "entity.other.attribute-name.pseudo-element.css"],
            regex : pseudoElements
        }, {
            token : ["punctuation", "entity.other.attribute-name.pseudo-class.css"],
            regex : pseudoClasses
        }, {
            include: "url"
        }, {
            token : keywordMapper,
            regex : "\\-?[a-zA-Z_][a-zA-Z0-9_\\-]*"
        }, {
            caseInsensitive: true
        }],

        url: [{
            token : "support.function",
            regex : "(?:url(:?-prefix)?|domain|regexp)\\(",
            push: [{
                token : "support.function",
                regex : "\\)",
                next : "pop"
            }, {
                defaultToken: "string"
            }]
        }],

        strings: [{
            token : "string.start",
            regex : "'",
            push : [{
                token : "string.end",
                regex : "'|$",
                next: "pop"
            }, {
                include : "escapes"
            }, {
                token : "constant.language.escape",
                regex : /\\$/,
                consumeLineEnd: true
            }, {
                defaultToken: "string"
            }]
        }, {
            token : "string.start",
            regex : '"',
            push : [{
                token : "string.end",
                regex : '"|$',
                next: "pop"
            }, {
                include : "escapes"
            }, {
                token : "constant.language.escape",
                regex : /\\$/,
                consumeLineEnd: true
            }, {
                defaultToken: "string"
            }]
        }],
        escapes: [{
            token : "constant.language.escape",
            regex : /\\([a-fA-F\d]{1,6}|[^a-fA-F\d])/
        }]

    };

    this.normalizeRules();
};

oop.inherits(CssHighlightRules, TextHighlightRules);

exports.CssHighlightRules = CssHighlightRules;

});

ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;

var MatchingBraceOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\}/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\})/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

}).call(MatchingBraceOutdent.prototype);

exports.MatchingBraceOutdent = MatchingBraceOutdent;
});

ace.define("ace/mode/css_completions",["require","exports","module"], function(require, exports, module) {
"use strict";

var propertyMap = {
    "background": {"#$0": 1},
    "background-color": {"#$0": 1, "transparent": 1, "fixed": 1},
    "background-image": {"url('/$0')": 1},
    "background-repeat": {"repeat": 1, "repeat-x": 1, "repeat-y": 1, "no-repeat": 1, "inherit": 1},
    "background-position": {"bottom":2, "center":2, "left":2, "right":2, "top":2, "inherit":2},
    "background-attachment": {"scroll": 1, "fixed": 1},
    "background-size": {"cover": 1, "contain": 1},
    "background-clip": {"border-box": 1, "padding-box": 1, "content-box": 1},
    "background-origin": {"border-box": 1, "padding-box": 1, "content-box": 1},
    "border": {"solid $0": 1, "dashed $0": 1, "dotted $0": 1, "#$0": 1},
    "border-color": {"#$0": 1},
    "border-style": {"solid":2, "dashed":2, "dotted":2, "double":2, "groove":2, "hidden":2, "inherit":2, "inset":2, "none":2, "outset":2, "ridged":2},
    "border-collapse": {"collapse": 1, "separate": 1},
    "bottom": {"px": 1, "em": 1, "%": 1},
    "clear": {"left": 1, "right": 1, "both": 1, "none": 1},
    "color": {"#$0": 1, "rgb(#$00,0,0)": 1},
    "cursor": {"default": 1, "pointer": 1, "move": 1, "text": 1, "wait": 1, "help": 1, "progress": 1, "n-resize": 1, "ne-resize": 1, "e-resize": 1, "se-resize": 1, "s-resize": 1, "sw-resize": 1, "w-resize": 1, "nw-resize": 1},
    "display": {"none": 1, "block": 1, "inline": 1, "inline-block": 1, "table-cell": 1},
    "empty-cells": {"show": 1, "hide": 1},
    "float": {"left": 1, "right": 1, "none": 1},
    "font-family": {"Arial":2,"Comic Sans MS":2,"Consolas":2,"Courier New":2,"Courier":2,"Georgia":2,"Monospace":2,"Sans-Serif":2, "Segoe UI":2,"Tahoma":2,"Times New Roman":2,"Trebuchet MS":2,"Verdana": 1},
    "font-size": {"px": 1, "em": 1, "%": 1},
    "font-weight": {"bold": 1, "normal": 1},
    "font-style": {"italic": 1, "normal": 1},
    "font-variant": {"normal": 1, "small-caps": 1},
    "height": {"px": 1, "em": 1, "%": 1},
    "left": {"px": 1, "em": 1, "%": 1},
    "letter-spacing": {"normal": 1},
    "line-height": {"normal": 1},
    "list-style-type": {"none": 1, "disc": 1, "circle": 1, "square": 1, "decimal": 1, "decimal-leading-zero": 1, "lower-roman": 1, "upper-roman": 1, "lower-greek": 1, "lower-latin": 1, "upper-latin": 1, "georgian": 1, "lower-alpha": 1, "upper-alpha": 1},
    "margin": {"px": 1, "em": 1, "%": 1},
    "margin-right": {"px": 1, "em": 1, "%": 1},
    "margin-left": {"px": 1, "em": 1, "%": 1},
    "margin-top": {"px": 1, "em": 1, "%": 1},
    "margin-bottom": {"px": 1, "em": 1, "%": 1},
    "max-height": {"px": 1, "em": 1, "%": 1},
    "max-width": {"px": 1, "em": 1, "%": 1},
    "min-height": {"px": 1, "em": 1, "%": 1},
    "min-width": {"px": 1, "em": 1, "%": 1},
    "overflow": {"hidden": 1, "visible": 1, "auto": 1, "scroll": 1},
    "overflow-x": {"hidden": 1, "visible": 1, "auto": 1, "scroll": 1},
    "overflow-y": {"hidden": 1, "visible": 1, "auto": 1, "scroll": 1},
    "padding": {"px": 1, "em": 1, "%": 1},
    "padding-top": {"px": 1, "em": 1, "%": 1},
    "padding-right": {"px": 1, "em": 1, "%": 1},
    "padding-bottom": {"px": 1, "em": 1, "%": 1},
    "padding-left": {"px": 1, "em": 1, "%": 1},
    "page-break-after": {"auto": 1, "always": 1, "avoid": 1, "left": 1, "right": 1},
    "page-break-before": {"auto": 1, "always": 1, "avoid": 1, "left": 1, "right": 1},
    "position": {"absolute": 1, "relative": 1, "fixed": 1, "static": 1},
    "right": {"px": 1, "em": 1, "%": 1},
    "table-layout": {"fixed": 1, "auto": 1},
    "text-decoration": {"none": 1, "underline": 1, "line-through": 1, "blink": 1},
    "text-align": {"left": 1, "right": 1, "center": 1, "justify": 1},
    "text-transform": {"capitalize": 1, "uppercase": 1, "lowercase": 1, "none": 1},
    "top": {"px": 1, "em": 1, "%": 1},
    "vertical-align": {"top": 1, "bottom": 1},
    "visibility": {"hidden": 1, "visible": 1},
    "white-space": {"nowrap": 1, "normal": 1, "pre": 1, "pre-line": 1, "pre-wrap": 1},
    "width": {"px": 1, "em": 1, "%": 1},
    "word-spacing": {"normal": 1},
    "filter": {"alpha(opacity=$0100)": 1},

    "text-shadow": {"$02px 2px 2px #777": 1},
    "text-overflow": {"ellipsis-word": 1, "clip": 1, "ellipsis": 1},
    "-moz-border-radius": 1,
    "-moz-border-radius-topright": 1,
    "-moz-border-radius-bottomright": 1,
    "-moz-border-radius-topleft": 1,
    "-moz-border-radius-bottomleft": 1,
    "-webkit-border-radius": 1,
    "-webkit-border-top-right-radius": 1,
    "-webkit-border-top-left-radius": 1,
    "-webkit-border-bottom-right-radius": 1,
    "-webkit-border-bottom-left-radius": 1,
    "-moz-box-shadow": 1,
    "-webkit-box-shadow": 1,
    "transform": {"rotate($00deg)": 1, "skew($00deg)": 1},
    "-moz-transform": {"rotate($00deg)": 1, "skew($00deg)": 1},
    "-webkit-transform": {"rotate($00deg)": 1, "skew($00deg)": 1 }
};

var CssCompletions = function() {

};

(function() {

    this.completionsDefined = false;

    this.defineCompletions = function() {
        if (document) {
            var style = document.createElement('c').style;

            for (var i in style) {
                if (typeof style[i] !== 'string')
                    continue;

                var name = i.replace(/[A-Z]/g, function(x) {
                    return '-' + x.toLowerCase();
                });

                if (!propertyMap.hasOwnProperty(name))
                    propertyMap[name] = 1;
            }
        }

        this.completionsDefined = true;
    };

    this.getCompletions = function(state, session, pos, prefix) {
        if (!this.completionsDefined) {
            this.defineCompletions();
        }

        if (state==='ruleset' || session.$mode.$id == "ace/mode/scss") {
            var line = session.getLine(pos.row).substr(0, pos.column);
            if (/:[^;]+$/.test(line)) {
                /([\w\-]+):[^:]*$/.test(line);

                return this.getPropertyValueCompletions(state, session, pos, prefix);
            } else {
                return this.getPropertyCompletions(state, session, pos, prefix);
            }
        }

        return [];
    };

    this.getPropertyCompletions = function(state, session, pos, prefix) {
        var properties = Object.keys(propertyMap);
        return properties.map(function(property){
            return {
                caption: property,
                snippet: property + ': $0;',
                meta: "property",
                score: 1000000
            };
        });
    };

    this.getPropertyValueCompletions = function(state, session, pos, prefix) {
        var line = session.getLine(pos.row).substr(0, pos.column);
        var property = (/([\w\-]+):[^:]*$/.exec(line) || {})[1];

        if (!property)
            return [];
        var values = [];
        if (property in propertyMap && typeof propertyMap[property] === "object") {
            values = Object.keys(propertyMap[property]);
        }
        return values.map(function(value){
            return {
                caption: value,
                snippet: value,
                meta: "property value",
                score: 1000000
            };
        });
    };

}).call(CssCompletions.prototype);

exports.CssCompletions = CssCompletions;
});

ace.define("ace/mode/behaviour/css",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Behaviour = require("../behaviour").Behaviour;
var CstyleBehaviour = require("./cstyle").CstyleBehaviour;
var TokenIterator = require("../../token_iterator").TokenIterator;

var CssBehaviour = function () {

    this.inherit(CstyleBehaviour);

    this.add("colon", "insertion", function (state, action, editor, session, text) {
        if (text === ':' && editor.selection.isEmpty()) {
            var cursor = editor.getCursorPosition();
            var iterator = new TokenIterator(session, cursor.row, cursor.column);
            var token = iterator.getCurrentToken();
            if (token && token.value.match(/\s+/)) {
                token = iterator.stepBackward();
            }
            if (token && token.type === 'support.type') {
                var line = session.doc.getLine(cursor.row);
                var rightChar = line.substring(cursor.column, cursor.column + 1);
                if (rightChar === ':') {
                    return {
                       text: '',
                       selection: [1, 1]
                    };
                }
                if (/^(\s+[^;]|\s*$)/.test(line.substring(cursor.column))) {
                    return {
                       text: ':;',
                       selection: [1, 1]
                    };
                }
            }
        }
    });

    this.add("colon", "deletion", function (state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected === ':') {
            var cursor = editor.getCursorPosition();
            var iterator = new TokenIterator(session, cursor.row, cursor.column);
            var token = iterator.getCurrentToken();
            if (token && token.value.match(/\s+/)) {
                token = iterator.stepBackward();
            }
            if (token && token.type === 'support.type') {
                var line = session.doc.getLine(range.start.row);
                var rightChar = line.substring(range.end.column, range.end.column + 1);
                if (rightChar === ';') {
                    range.end.column ++;
                    return range;
                }
            }
        }
    });

    this.add("semicolon", "insertion", function (state, action, editor, session, text) {
        if (text === ';' && editor.selection.isEmpty()) {
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar === ';') {
                return {
                   text: '',
                   selection: [1, 1]
                };
            }
        }
    });

    this.add("!important", "insertion", function (state, action, editor, session, text) {
        if (text === '!' && editor.selection.isEmpty()) {
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);

            if (/^\s*(;|}|$)/.test(line.substring(cursor.column))) {
                return {
                    text: '!important',
                    selection: [10, 10]
                };
            }
        }
    });

};
oop.inherits(CssBehaviour, CstyleBehaviour);

exports.CssBehaviour = CssBehaviour;
});

ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {
    
    this.foldingStartMarker = /([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;
    this.singleLineBlockCommentRe= /^\s*(\/\*).*\*\/\s*$/;
    this.tripleStarBlockCommentRe = /^\s*(\/\*\*\*).*\*\/\s*$/;
    this.startRegionRe = /^\s*(\/\*|\/\/)#?region\b/;
    this._getFoldWidgetBase = this.getFoldWidget;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
    
        if (this.singleLineBlockCommentRe.test(line)) {
            if (!this.startRegionRe.test(line) && !this.tripleStarBlockCommentRe.test(line))
                return "";
        }
    
        var fw = this._getFoldWidgetBase(session, foldStyle, row);
    
        if (!fw && this.startRegionRe.test(line))
            return "start"; // lineCommentRegionStart
    
        return fw;
    };

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        
        if (this.startRegionRe.test(line))
            return this.getCommentRegionBlock(session, line, row);
        
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };
    this.getCommentRegionBlock = function(session, line, row) {
        var startColumn = line.search(/\s*$/);
        var maxRow = session.getLength();
        var startRow = row;
        
        var re = /^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;
        var depth = 1;
        while (++row < maxRow) {
            line = session.getLine(row);
            var m = re.exec(line);
            if (!m) continue;
            if (m[1]) depth--;
            else depth++;

            if (!depth) break;
        }

        var endRow = row;
        if (endRow > startRow) {
            return new Range(startRow, startColumn, endRow, line.length);
        }
    };

}).call(FoldMode.prototype);

});

ace.define("ace/mode/css",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/css_highlight_rules","ace/mode/matching_brace_outdent","ace/worker/worker_client","ace/mode/css_completions","ace/mode/behaviour/css","ace/mode/folding/cstyle"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var CssHighlightRules = require("./css_highlight_rules").CssHighlightRules;
var MatchingBraceOutdent = require("./matching_brace_outdent").MatchingBraceOutdent;
var WorkerClient = require("../worker/worker_client").WorkerClient;
var CssCompletions = require("./css_completions").CssCompletions;
var CssBehaviour = require("./behaviour/css").CssBehaviour;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;

var Mode = function() {
    this.HighlightRules = CssHighlightRules;
    this.$outdent = new MatchingBraceOutdent();
    this.$behaviour = new CssBehaviour();
    this.$completer = new CssCompletions();
    this.foldingRules = new CStyleFoldMode();
};
oop.inherits(Mode, TextMode);

(function() {

    this.foldingRules = "cStyle";
    this.blockComment = {start: "/*", end: "*/"};

    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);
        var tokens = this.getTokenizer().getLineTokens(line, state).tokens;
        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        var match = line.match(/^.*\{\s*$/);
        if (match) {
            indent += tab;
        }

        return indent;
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };

    this.getCompletions = function(state, session, pos, prefix) {
        return this.$completer.getCompletions(state, session, pos, prefix);
    };

    this.createWorker = function(session) {
        var worker = new WorkerClient(["ace"], "ace/mode/css_worker", "Worker");
        worker.attachToDocument(session.getDocument());

        worker.on("annotate", function(e) {
            session.setAnnotations(e.data);
        });

        worker.on("terminate", function() {
            session.clearAnnotations();
        });

        return worker;
    };

    this.$id = "ace/mode/css";
    this.snippetFileId = "ace/snippets/css";
}).call(Mode.prototype);

exports.Mode = Mode;

});                (function() {
                    ace.require(["ace/mode/css"], function(m) {
                        if (typeof module == "object" && typeof exports == "object" && module) {
                            module.exports = m;
                        }
                    });
                })();
            </script></head> <body style='height: 100vh; overflow: hidden;'><header id='page_header'  style='background: #F3F3F3; height: 28px; display: flex;'/> <div id='lower_right_corner'  style='position: absolute; right: 50px; bottom: 5px; width: 255px;'/></body></html>